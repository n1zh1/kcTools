var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype["return"]=function(a){this.abruptCompletion_={"return":a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){var c=$jscomp.makeIterator(a),d=c.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=b;else return this.yieldAllIterator_=c,this.yield(d.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){var c=this.finallyContexts_.splice(b||0)[0];if(c=this.abruptCompletion_=this.abruptCompletion_||c){if(c.isException)return this.jumpToErrorHandler_();void 0!=c.jumpTo&&this.finallyAddress_<c.jumpTo?(this.nextAddress=c.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_["return"]);this.context_["return"](a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a["return"],done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this["throw"]=function(b){return a.throw_(b)};this["return"]=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){var c=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(c,a.prototype);return c};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a["throw"](d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
function initialize(){location.search&&(window.location.href="../simulator/"+location.search);document.getElementById("confirm_tab_close").checked=setting.confirmTabClosing;document.getElementById("presets_order").value=setting.presetsOrder;document.getElementById("empty_folder_visible").checked=setting.visibleEmptyFolder;$(".fleet_tab.active").removeClass("active");setLocalPresets();loadSessionStorage("display_public")&&$("#public_preset_tab").tab("show")}
function setLocalPresets(){var a=loadLocalStorage("presets");a||(a=[]);$("#btn_search_preset").prop("disabled",!1);setPresets(a);$(".folder_content").on("show.bs.collapse",function(){folder_content_Show($(this))});$(".folder_content").on("hide.bs.collapse",function(){folder_content_Hide($(this))})}
function setPresets(a,b){var c=(b=void 0===b?!0:b)?"presets_container":"public_presets_container",d=castInt(document.getElementById("presets_order").value),e=document.getElementById("search_preset").value.trim(),f=document.getElementById("empty_folder_visible").checked;setting.visibleEmptyFolder=f;b&&e&&(a=a.filter(function(w){return 0<=w[1].indexOf(e)}));if(b)switch(d){case 1:a.sort(function(w,r){return w[4]<r[4]?1:-1});break;case 2:a.sort(function(w,r){return w[4]>r[4]?1:-1});break;case 3:a.sort(function(w,
r){return w[1]<r[1]?1:-1});break;case 4:a.sort(function(w,r){return w[1]>r[1]?1:-1})}setting.presetsOrder=d;saveSetting();var g=0===d&&!e&&b,n=document.createDocumentFragment();if(b){var l=createDiv("preset_container new d-flex "+(a.length?"":"border_delete")),k=createDiv("new_body mx-auto my-auto","",a.length?"\u65b0\u898f\u4f5c\u6210":"\u7de8\u6210\u3092\u65b0\u898f\u4f5c\u6210");l.appendChild(k);n.appendChild(l)}else b||0!==a.length||(l=createDiv("d-flex empty_container"),k=createDiv("mx-auto my-auto",
"","\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002"),l.appendChild(k),n.appendChild(l));k=setting.presetFolders;l=[];for(var u={},t=0;t<k.length;u={$jscomp$loop$prop$folder$32:u.$jscomp$loop$prop$folder$32},t++){u.$jscomp$loop$prop$folder$32=k[t];var y=createDiv(),v=a.filter(function(w){return function(r){return 6<=r.length&&r[5]===w.$jscomp$loop$prop$folder$32.id}}(u)).length,q=createDiv("preset_container folder_header "+(0!==v||f?"":"d-none"));v&&(q.dataset.toggle=
"collapse",q.dataset.target="#folder"+u.$jscomp$loop$prop$folder$32.id);q.dataset.folderid=u.$jscomp$loop$prop$folder$32.id;var h=createDiv("d-flex my-auto ml-3 mr-2"),p=createDiv("preset_name align-self-center");p.innerHTML='<i class="fas fa-folder'+(v?"-open":" opacity4")+' mr-2 cur_move handle"></i>'+u.$jscomp$loop$prop$folder$32.name;h.appendChild(p);p=createDiv("ml-3 font_size_12 align-self-center font_color_half preset_count");p.textContent="( "+v+"\u4ef6 )";v&&h.appendChild(p);p=document.createElement("input");
p.type="text";p.maxLength=50;p.className="form-control form-control-sm preset_name_edit mb-1 mr-3 d-none";p.value=u.$jscomp$loop$prop$folder$32.name;h.appendChild(p);p=createDiv("d-flex ml-auto btns_container");var m=createDiv("ml-auto r_btn btn_commit_folder d-none");m.dataset.toggle="tooltip";m.dataset.offset="-50%";m.title="\u9078\u629e\u3057\u305f\u7de8\u6210\u3092\u3053\u306e\u30d5\u30a9\u30eb\u30c0\u30fc\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002";m.innerHTML='<i class="fas fa-save"></i>';p.appendChild(m);
m=createDiv("ml-2 r_btn btn_rollback_folder d-none");m.dataset.toggle="tooltip";m.dataset.offset="-50%";m.title="\u30ad\u30e3\u30f3\u30bb\u30eb\u3057\u307e\u3059\u3002";m.innerHTML='<i class="fas fa-undo"></i>';p.appendChild(m);m=createDiv("ml-auto r_btn btn_add_preset");m.dataset.toggle="tooltip";m.dataset.offset="-50%";m.title="\u3053\u306e\u30d5\u30a9\u30eb\u30c0\u30fc\u306b\u79fb\u52d5\u3055\u305b\u308b\u7de8\u6210\u3092\u4e00\u62ec\u3067\u9078\u629e\u3057\u307e\u3059\u3002";m.innerHTML='<i class="fas fa-folder-download"></i>';
p.appendChild(m);m=createDiv("ml-auto r_btn btn_commit d-none");m.dataset.toggle="tooltip";m.dataset.offset="-50%";m.title="\u7de8\u96c6\u5185\u5bb9\u3092\u78ba\u5b9a\u3057\u307e\u3059\u3002";m.innerHTML='<i class="fas fa-save"></i>';p.appendChild(m);m=createDiv("ml-2 r_btn btn_rollback d-none");m.dataset.toggle="tooltip";m.dataset.offset="-50%";m.title="\u7de8\u96c6\u5185\u5bb9\u3092\u53d6\u308a\u6d88\u3057\u307e\u3059\u3002";m.innerHTML='<i class="fas fa-undo"></i>';p.appendChild(m);m=createDiv("ml-2 r_btn btn_edit_start");
m.dataset.toggle="tooltip";m.dataset.offset="-50%";m.title="\u30d5\u30a9\u30eb\u30c0\u30fc\u540d\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002";m.innerHTML='<i class="fas fa-pencil"></i>';p.appendChild(m);h.appendChild(p);q.appendChild(h);h=document.createElement("div");h.id="folder"+u.$jscomp$loop$prop$folder$32.id;h.dataset.folderid=u.$jscomp$loop$prop$folder$32.id;h.className="folder_content pl-5";v&&(h.classList.add("collapse"),u.$jscomp$loop$prop$folder$32.isOpen&&h.classList.add("show"));
y.appendChild(h);l.push({id:u.$jscomp$loop$prop$folder$32.id,header:q,container:h})}f=createDiv("","preset_sortable_container");k={};u=$jscomp.makeIterator(a);for(t=u.next();!t.done;k={$jscomp$loop$prop$preset$34:k.$jscomp$loop$prop$preset$34},t=u.next())if(k.$jscomp$loop$prop$preset$34=t.value,k.$jscomp$loop$prop$preset$34[1]&&!(b&&e&&0>k.$jscomp$loop$prop$preset$34[1].indexOf(e))){t=createDiv();y=createDiv("preset_container");y.dataset.presetid=k.$jscomp$loop$prop$preset$34[0];b||(y.dataset.presetdata=
k.$jscomp$loop$prop$preset$34[2]);v=createDiv("preset_header");y.appendChild(v);v=createDiv("preset_body d-flex mx-2");g&&(q=createDiv("mt-4 sortable_handle_parent align-self-center"),q.innerHTML='<i class="sortable_handle fa-menu2"></i>',v.appendChild(q));q=createDiv("mr-2 preset_abstract flex-grow-1");q.appendChild(createDiv("preset_name","",k.$jscomp$loop$prop$preset$34[1]));h=document.createElement("input");h.type="text";h.maxLength=50;h.className="form-control form-control-sm preset_name_edit mb-1 d-none";
h.value=k.$jscomp$loop$prop$preset$34[1];q.appendChild(h);m=decodePreset(k.$jscomp$loop$prop$preset$34[2])[1];h=createDiv("d-flex ships flex-wrap");p=5;m.length&&6<=m[0].length&&2===m[0][5]&&(p=6);m=$jscomp.makeIterator(m);for(var B=m.next();!B.done;B=m.next()){B=B.value;if(h.childNodes.length>p)break;if(!(0>=B[0])){var C=document.createElement("img");C.className="ship_image";C.width=100;C.height=25;C.src="../img/ship/"+B[0]+".png";h.appendChild(C)}}q.appendChild(h);h=createDiv("preset_memo_view border mt-1 px-1 py-1 "+
(k.$jscomp$loop$prop$preset$34[3]?"":"d-none"),"");h.textContent=AutoLink(k.$jscomp$loop$prop$preset$34[3]);q.appendChild(h);h=document.createElement("textarea");h.className="form-control preset_memo mt-1 w-100 d-none";h.value=k.$jscomp$loop$prop$preset$34[3]?k.$jscomp$loop$prop$preset$34[3]:"";p=h.value.match(/\n/g);h.rows=p&&p.length?p.length+2:2;q.appendChild(h);v.appendChild(q);q=createDiv("d-flex ml-auto pt-2 btns_container");b?(h=createDiv("ml-auto r_btn btn_commit d-none"),h.dataset.toggle=
"tooltip",h.dataset.offset="-50%",h.title="\u7de8\u96c6\u5185\u5bb9\u3092\u78ba\u5b9a\u3057\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-save"></i>',q.appendChild(h),h=createDiv("ml-2 r_btn btn_rollback d-none"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",h.title="\u7de8\u96c6\u5185\u5bb9\u3092\u53d6\u308a\u6d88\u3057\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-undo"></i>',q.appendChild(h),h=createDiv("ml-auto r_btn btn_edit_start"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",
h.title="\u7de8\u6210\u540d\u3084\u7de8\u6210\u30e1\u30e2\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-pencil"></i>',q.appendChild(h),h=createDiv("ml-2 r_btn btn_share"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",h.title="\u7de8\u6210\u306e\u5171\u6709\u3092\u884c\u3044\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-share-alt"></i>',q.appendChild(h),h=createDiv("ml-2 r_btn btn_copy"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",h.title="\u7de8\u6210\u3092\u8907\u88fd\u3057\u3066\u65b0\u3057\u3044\u7de8\u6210\u30bf\u30d6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002",
h.innerHTML='<i class="fas fa-copy"></i>',q.appendChild(h),h=createDiv("ml-2 r_btn btn_move_folder"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",h.title="\u6240\u5c5e\u30d5\u30a9\u30eb\u30c0\u30fc\u3092\u5909\u66f4\u3057\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-folder-upload"></i>',q.appendChild(h),h=createDiv("ml-2 r_btn btn_delete"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",h.title="\u7de8\u6210\u3092\u524a\u9664\u3057\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-trash-o"></i>',
q.appendChild(h)):(h=createDiv("ml-2 r_btn btn_open"),h.dataset.toggle="tooltip",h.dataset.offset="-50%",h.title="\u7de8\u6210\u3092\u5c55\u958b\u3057\u307e\u3059\u3002",h.innerHTML='<i class="fas fa-folder-open-o"></i>',q.appendChild(h));v.appendChild(q);y.appendChild(v);b?(v=createDiv("update_date mr-1","","\u66f4\u65b0\u65e5\u6642: "+(k.$jscomp$loop$prop$preset$34[4]?k.$jscomp$loop$prop$preset$34[4].split(".")[0]:"-")),y.appendChild(v)):(v=createDiv("update_date mr-3","",(k.$jscomp$loop$prop$preset$34[5]?
"\u4f5c\u6210\u8005: "+k.$jscomp$loop$prop$preset$34[5]+"\u3000":"")+" "+(k.$jscomp$loop$prop$preset$34[4]?k.$jscomp$loop$prop$preset$34[4].split(".")[0]:"-")),y.appendChild(v));t.appendChild(y);b&&6<=k.$jscomp$loop$prop$preset$34.length?(y=l.find(function(w){return function(r){return r.id===w.$jscomp$loop$prop$preset$34[5]}}(k)))?y.container.appendChild(t):f.appendChild(t):f.appendChild(t)}n.appendChild(f);if(b){g=createDiv("","foldersParent");l=$jscomp.makeIterator(l);for(f=l.next();!f.done;f=l.next())f=
f.value,k=createDiv(),k.appendChild(f.header),k.appendChild(f.container),g.appendChild(k);n.appendChild(g)}!b&&prevSnapShot&&(g=createDiv("d-flex preset_container more_load"),l=createDiv("mx-auto my-auto","","\u3082\u3063\u3068\u8aad\u307f\u8fbc\u3080"),g.appendChild(l),n.appendChild(g));document.getElementById(c).innerHTML="";document.getElementById(c).appendChild(n);$("#"+c+" .r_btn").tooltip();if(0===d&&!e&&b)for(Sortable.create(document.getElementById("preset_sortable_container"),{animation:200,
handle:".sortable_handle",onStart:function(){document.getElementById("header").classList.add("d-none");document.getElementById("main_footer").classList.add("d-none")},onEnd:function(){document.getElementById("header").classList.remove("d-none");document.getElementById("main_footer").classList.remove("d-none");for(var w=loadLocalStorage("presets"),r=[],z={},A=$jscomp.makeIterator(document.getElementsByClassName("preset_container")),x=A.next();!x.done;z={$jscomp$loop$prop$c$36:z.$jscomp$loop$prop$c$36},
x=A.next())z.$jscomp$loop$prop$c$36=x.value,(x=w.find(function(D){return function(E){return E[0]===D.$jscomp$loop$prop$c$36.dataset.presetid}}(z)))&&r.push(x);r.length&&(saveLocalStorage("presets",r),inform_success("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u9806\u5e8f\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002"))}}),c=setting.presetFolders,d=0;d<c.length;d++)Sortable.create(document.getElementById("folder"+c[d].id),{animation:200,handle:".sortable_handle",onStart:function(){document.getElementById("header").classList.add("d-none");
document.getElementById("main_footer").classList.add("d-none")},onEnd:function(){document.getElementById("header").classList.remove("d-none");document.getElementById("main_footer").classList.remove("d-none");for(var w=loadLocalStorage("presets"),r=[],z={},A=$jscomp.makeIterator(document.getElementsByClassName("preset_container")),x=A.next();!x.done;z={$jscomp$loop$prop$c$38:z.$jscomp$loop$prop$c$38},x=A.next())z.$jscomp$loop$prop$c$38=x.value,(x=w.find(function(D){return function(E){return E[0]===
D.$jscomp$loop$prop$c$38.dataset.presetid}}(z)))&&r.push(x);r.length&&(saveLocalStorage("presets",r),inform_success("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u9806\u5e8f\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002"))}});b&&document.getElementById("foldersParent")&&Sortable.create(document.getElementById("foldersParent"),{animation:200,handle:".handle",onStart:function(){document.getElementById("header").classList.add("d-none");document.getElementById("main_footer").classList.add("d-none")},
onEnd:function(){document.getElementById("header").classList.remove("d-none");document.getElementById("main_footer").classList.remove("d-none");for(var w=setting.presetFolders,r=[],z={},A=$jscomp.makeIterator(document.getElementsByClassName("folder_header")),x=A.next();!x.done;z={$jscomp$loop$prop$c$40:z.$jscomp$loop$prop$c$40},x=A.next())z.$jscomp$loop$prop$c$40=x.value,(x=w.find(function(D){return function(E){return E.id===castInt(D.$jscomp$loop$prop$c$40.dataset.folderid)}}(z)))&&r.push(x);r.length&&
(setting.presetFolders=r,saveSetting(),inform_success("\u30d5\u30a9\u30eb\u30c0\u30fc\u306e\u9806\u5e8f\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002"))}})}
function map_select_Changed(){var a=castInt($("#map_select").val());$("#btn_search_preset").prop("disabled",!1);$("#presets_order").removeClass("d-none");400<a?($("#select_preset_level").parent().removeClass("d-none"),$("#select_preset_level").val(4)):0===a?($("#presets_order").val(1),$("#presets_order").change(),$("#presets_order").addClass("d-none")):($("#select_preset_level").parent().addClass("d-none"),$("#select_preset_level").val(0))}var prevSnapShot=null,STEP=20;
function searchUploadedPreset(){var a=getPublicPresetsQuery(),b=[];fb||initializeFB();if(fb){var c=null;c=a.map?fb.collection("presets").where("map","==",a.map).where("level","==",a.level).orderBy(a.sortKey,a.order).limit(STEP):fb.collection("presets").orderBy(a.sortKey,a.order).limit(STEP);c.get().then(function(d){prevSnapShot=d.docs[d.docs.length-1];d.forEach(function(e){var f=e.data();e=e.data().createdAt?e.data().createdAt.toDate():new Date;e=["",f.name+(0===a.map&&0<f.level?"\u3010"+DIFFICULTY.find(function(g){return g.id===
f.level}).name+"\u3011":""),f.data,f.memo,formatDate(e,"yyyy/MM/dd HH:mm"),f.user];b.push(e)});if(b.length<STEP||!a.map)prevSnapShot=null;setPresets(b,!1);saveSessionStorage("search_result",{map:a.map,level:a.level,sortKey:a.sortKey,order:a.order,presets:b})})["catch"](function(d){console.error(d);inform_danger("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})}}
function getPublicPresetsQuery(){$("#btn_search_preset").prop("disabled",!0);var a=castInt($("#map_select").val()),b=400<a?castInt($("#select_preset_level").val()):0,c="createdAt",d="desc";switch(castInt(document.getElementById("presets_order").value)){case 2:d="asc";break;case 3:c="name";break;case 4:c="name",d="asc"}return{map:a,level:b,sortKey:c,order:d}}
function more_load_presets(){var a=$(".more_load");a.html('<div class="w-100 text-center py-3"><div class="spinner-border" role="status"><span class="sr-only"></span></div></div>');a.removeClass("more_load");var b=getPublicPresetsQuery();if((a=loadSessionStorage("search_result"))&&prevSnapShot)if(a.map!==b.map||a.level!==b.level||a.sortKey!==b.sortKey||a.order!==b.order)searchUploadedPreset();else{var c=a.presets;fb||initializeFB();fb&&fb.collection("presets").where("map","==",b.map).where("level",
"==",b.level).orderBy(b.sortKey,b.order).startAfter(prevSnapShot).limit(STEP).get().then(function(d){prevSnapShot=d.docs[d.docs.length-1];d.forEach(function(e){var f=e.data();e=e.data().createdAt?e.data().createdAt.toDate():new Date;f=["",f.name,f.data,f.memo,formatDate(e,"yyyy/MM/dd HH:mm"),f.user];c.push(f)});d.docs.length<STEP&&(prevSnapShot=null);setPresets(c,!1);saveSessionStorage("search_result",{map:b.map,level:b.level,sortKey:b.sortKey,order:b.order,presets:c})})["catch"](function(d){console.error(d);
inform_danger("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})}else searchUploadedPreset()}
function btn_add_preset_Clicked(a,b){b.stopPropagation();var c=a.closest(".preset_container");c.find(".btn_edit_start").addClass("d-none");c.find(".btn_add_preset").addClass("d-none");c.find(".btn_commit_folder").removeClass("d-none");c.find(".btn_rollback_folder").removeClass("d-none");$(".preset_container:not(.folder_header)").addClass("folder_selectable");$(".btns_container").addClass("d-none").removeClass("d-flex");c.find(".btns_container").removeClass("d-none").addClass("d-flex");inform_success("\u3053\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u79fb\u52d5\u3055\u305b\u308b\u7de8\u6210\u3092\u9078\u629e\u3057\u3001\u4fdd\u5b58\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}
function btn_commit_folder_Clicked(a,b){b.stopPropagation();var c=a.closest(".preset_container");c.find(".btn_commit_folder").tooltip("hide");var d=castInt(c[0].dataset.folderid);if(c=setting.presetFolders.find(function(f){return f.id===d})){var e=loadLocalStorage("presets");$(".folder_selectable.selected").each(function(f,g){var n=$(g)[0].dataset.presetid,l=e?e.find(function(k){return k[0]===n}):null;l&&6<=l.length?l[5]=d:l&&5===l.length&&l.push(d)});saveLocalStorage("presets",e);setLocalPresets();
inform_success("\u9078\u629e\u3055\u308c\u305f\u7de8\u6210\u3092\u30d5\u30a9\u30eb\u30c0\u30fc\u300e"+c.name+"\u300f\u306b\u79fb\u52d5\u3057\u307e\u3057\u305f\u3002")}else inform_danger("\u30d5\u30a9\u30eb\u30c0\u30fc\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),btn_rollback_folder_Clicked(a,b)}
function btn_rollback_folder_Clicked(a,b){b.stopPropagation();var c=a.closest(".preset_container");c.find(".btn_edit_start").removeClass("d-none");c.find(".btn_add_preset").removeClass("d-none");c.find(".btn_commit_folder").addClass("d-none");c.find(".btn_rollback_folder").addClass("d-none");$(".folder_selectable").removeClass("folder_selectable");$(".btns_container").removeClass("d-none").addClass("d-flex")}
function folder_selectable_Clicked(a){a.hasClass("selected")?a.removeClass("selected"):a.addClass("selected")}function folder_content_Show(a){var b=castInt(a[0].dataset.folderid);if(a=setting.presetFolders.find(function(c){return c.id===b}))a.isOpen=!0,saveSetting()}function folder_content_Hide(a){var b=castInt(a[0].dataset.folderid);if(a=setting.presetFolders.find(function(c){return c.id===b}))a.isOpen=!1,saveSetting()}
function btn_edit_start_Clicked(a,b){b.stopPropagation();$(".preset_container.editting").each(function(d,e){btn_rollback_Clicked($(e).find(".btn_rollback"));inform_warning($(e).find(".preset_name").text()+"\u306e\u7de8\u96c6\u306f\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f\u3002")});var c=a.closest(".preset_container");c.addClass("editting");c.removeClass("sortable_handle");c.find(".preset_name").addClass("d-none");c.find(".preset_count").addClass("d-none");c.find(".preset_name_edit").removeClass("d-none");
c.find(".preset_memo").removeClass("d-none");c.find(".preset_memo_view").addClass("d-none");c.find(".btn_commit").removeClass("d-none");c.find(".btn_rollback").removeClass("d-none");c.find(".btn_copy").addClass("d-none");c.find(".btn_move_folder").addClass("d-none");c.find(".btn_edit_start").addClass("d-none");c.find(".btn_add_preset").addClass("d-none")}
function btn_rollback_Clicked(a,b){(b=void 0===b?null:b)&&b.stopPropagation();var c=a.closest(".preset_container");c.find(".preset_name").removeClass("d-none");c.find(".preset_count").removeClass("d-none");c.find(".preset_name_edit").addClass("d-none");c.find(".preset_memo").addClass("d-none");c.find(".preset_memo_view").text()&&c.find(".preset_memo_view").removeClass("d-none");c.find(".btn_commit").addClass("d-none");c.find(".btn_rollback").addClass("d-none");c.find(".btn_copy").removeClass("d-none");
c.find(".btn_move_folder").removeClass("d-none");c.find(".btn_edit_start").removeClass("d-none");c.find(".btn_add_preset").removeClass("d-none");c.removeClass("editting");c.addClass("sortable_handle")}
function btn_commit_Clicked(a,b){b=void 0===b?null:b;var c=a.closest(".preset_container");if(c.hasClass("folder_header")){var d=setting.presetFolders,e=castInt(c[0].dataset.folderid),f=d.findIndex(function(k){return k.id===e});if(0<=f){var g=c.find(".preset_name_edit").val().trim();80<g.length&&(g=g.slice(0,80),c.find(".preset_name_edit").val(g));c.find(".preset_name").find(".fas").hasClass("opacity4")?c.find(".preset_name").html('<i class="fas fa-folder mr-2 opacity4"></i>'+g):c.find(".preset_name").html('<i class="fas fa-folder-open mr-2"></i>'+
g);d[f].name=g;saveSetting();inform_success("\u30d5\u30a9\u30eb\u30c0\u540d\u306e\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002")}}else{var n=c[0].dataset.presetid;(d=loadLocalStorage("presets"))||(d=[]);f=d.findIndex(function(k){return k[0]===n});if(0<=f){g=c.find(".preset_name_edit").val().trim();var l=c.find(".preset_memo").val().trim();g&&(50<g.length&&(g=g.slice(0,50),c.find(".preset_name_edit").val(g)),d[f][1]=g,c.find(".preset_name").text(g));400<l.length&&(l=l.slice(0,400),c.find(".preset_memo").val(l));
d[f][3]=l;f=l.replace(/\r?\n/g," ");c.find(".preset_memo_view").text(f);f.trim().length?c.find(".preset_memo_view").removeClass("d-none"):c.find(".preset_memo_view").addClass("d-none");saveLocalStorage("presets",d);inform_success("\u7de8\u6210\u60c5\u5831\u306e\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002")}}btn_rollback_Clicked(a,b);setTab();$(".fleet_tab.active").removeClass("active")}
function btn_delete_Clicked(a,b){b.stopPropagation();var c=$("#modal_confirm");c.find(".modal-body").html('<div class="mt-2">\u7de8\u6210\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f</div>');c[0].dataset.target=a.closest(".preset_container")[0].dataset.presetid;confirmType="deletePreset";c.modal("show")}
function preset_Clicked(a){var b=loadLocalStorage("presets"),c=a[0].dataset.presetid;b=b?b.find(function(e){return e[0]===c}):null;var d={id:getUniqueId(),name:getMaxUntitled(),history:{index:0,histories:["Noi6BpgWgRnX4wtOC2o6ZzgAZL6HhG4QBEZ4ccpEcAZgIYA2AzgKaR7E8kQDMxLEA"]},memo:""};b&&(d.id=b[0],d.name=a.find(".preset_name").text(),d.history.histories[0]=b[2],d.memo=b[3]);(a=loadLocalStorage("activePresets"))||(a={activeId:"",presets:[]});(b=a.presets.find(function(e){return e.id===d.id}))?d=b:a.presets.push(d);
a.activeId=d.id;saveLocalStorage("activePresets",a);window.location.href="../simulator/?p="+d.history.histories[d.history.index]}
function public_preset_Clicked(a){var b=a.closest(".preset_container");a=b[0].dataset.presetdata;var c=b.find(".preset_name").text();b={id:getUniqueId(),name:c,history:{index:0,histories:[a]},memo:b.find(".preset_memo").val()};(c=loadLocalStorage("activePresets"))||(c={activeId:"",presets:[]});c.presets.push(b);c.activeId=b.id;saveLocalStorage("activePresets",c);window.location.href="../simulator/?p="+a}
function btn_share_Clicked(a,b){b.stopPropagation();var c=loadLocalStorage("presets"),d=a.closest(".preset_container")[0].dataset.presetid;c&&c.find(function(e){return e[0]===d})?($("#modal_share")[0].dataset.presetId=a.closest(".preset_container")[0].dataset.presetid,$("#modal_share").modal("show")):inform_danger("\u5bfe\u8c61\u306e\u7de8\u6210\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}
function btn_copy_Clicked(a,b){b.stopPropagation();var c=loadLocalStorage("presets"),d=a.closest(".preset_container")[0].dataset.presetid;if(c=c?c.find(function(f){return f[0]===d}):null){c={id:getUniqueId(),name:c[1]+"_\u30b3\u30d4\u30fc",history:{index:0,histories:[c[2]]},memo:c[3]};var e=loadLocalStorage("activePresets");e||(e={activeId:"",presets:[]});e.presets.push(c);e.activeId=c.id;saveLocalStorage("activePresets",e);window.location.href="../simulator/?p="+c.history.histories[c.history.index]}else inform_danger("\u8907\u88fd\u5bfe\u8c61\u306e\u7de8\u6210\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}
function btn_move_folder_Clicked(a,b){b.stopPropagation();var c=loadLocalStorage("presets"),d=a.closest(".preset_container")[0].dataset.presetid;if(c=c?c.find(function(n){return n[0]===d}):null){for(var e='<option value="0">\u6307\u5b9a\u306a\u3057</option>',f=$jscomp.makeIterator(setting.presetFolders),g=f.next();!g.done;g=f.next())g=g.value,e+='<option value="'+g.id+'">'+g.name+"</option>";$("#preset_folder").html(e);$("#modal_folder_confirm")[0].dataset.target=c[0];$("#modal_folder_confirm").modal("show")}else inform_danger("\u79fb\u52d5\u5bfe\u8c61\u306e\u30d7\u30ea\u30bb\u30c3\u30c8\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}
function modal_folder_confirm_ok_Clicked(){var a=loadLocalStorage("presets"),b=$("#modal_folder_confirm")[0].dataset.target,c=a?a.find(function(f){return f[0]===b}):null;if(c){var d=castInt($("#preset_folder").val()),e=setting.presetFolders.find(function(f){return f.id===d});6<=c.length?c[5]=d:5===c.length&&c.push(d);saveLocalStorage("presets",a);inform_success("\u30d7\u30ea\u30bb\u30c3\u30c8\u300e"+c[1]+"\u300f\u3092\u30d5\u30a9\u30eb\u30c0\u30fc\u300e"+(e?e.name:"\u672a\u6307\u5b9a")+"\u300f\u306b\u79fb\u52d5\u3057\u307e\u3057\u305f");
setLocalPresets()}else inform_danger("\u79fb\u52d5\u5bfe\u8c61\u306e\u30d7\u30ea\u30bb\u30c3\u30c8\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}function topTab_Clicked(){var a=getActivePreset();a.id?window.location.href="../simulator/?p="+a.history.histories[a.history.index]:preset_Clicked($("#add_new_tab"))}
function version_detail_Clicked(){if(!document.getElementById("version_inform_body").innerHTML){for(var a=CHANGE_LOG.find(function(l){return l.id===LATEST_VERSION}),b=document.createDocumentFragment(),c=$jscomp.makeIterator(a.changes),d=c.next();!d.done;d=c.next()){d=d.value;var e=createDiv("mt-3"),f=document.createElement("div"),g=document.createElement("span");g.className="mr-1 pt-1 badge badge-pill badge-"+(0===d.type?"success":1===d.type?"info":"danger");g.textContent=0===d.type?"\u65b0\u898f":
1===d.type?"\u5909\u66f4":"\u4fee\u6b63";var n=document.createElement("span");n.innerHTML=d.title;f.appendChild(g);f.appendChild(n);e.appendChild(f);d.content&&(f=createDiv("font_size_12 pl-3"),f.innerHTML=d.content,e.appendChild(f));b.appendChild(e)}document.getElementById("version").textContent=a.id;document.getElementById("version_inform_body").appendChild(b);setting.version=a.id;saveSetting();document.getElementsByClassName("version_detail")[0].classList.remove("unread")}$("#modal_version_inform").modal("show")}
function loadSiteHistory(){if(!document.getElementById("site_history_body").innerHTML){for(var a=document.createDocumentFragment(),b=0,c=LATEST_VERSION,d=$jscomp.makeIterator(CHANGE_LOG),e=d.next();!e.done;e=d.next()){e=e.value;var f=createDiv("my-3 ver_log border-bottom"),g=createDiv("py-2","","v"+e.id);if(c===e.id){var n=document.createElement("span");n.className="ml-2 pt-1 badge badge-pill badge-danger";n.textContent="New";g.appendChild(n)}f.appendChild(g);for(g=0;g<e.changes.length;g++){n=e.changes[g];
var l="log_"+b++ +"_"+g,k=document.createElement("div");k.className="py-2 px-2 d-flex collapsed history_item history_item_no_content";var u=document.createElement("div");u.className="d-flex flex-nowrap align-self-center";var t=document.createElement("div");t.className="align-self-center";var y=document.createElement("span");y.className="mr-2 pt-1 badge badge-pill badge-"+(0===n.type?"success":1===n.type?"info":"danger");y.textContent=0===n.type?"\u65b0\u898f":1===n.type?"\u5909\u66f4":"\u4fee\u6b63";
var v=document.createElement("div");v.className="align-self-center";v.innerHTML=n.title;t.appendChild(y);u.appendChild(t);u.appendChild(v);k.appendChild(u);f.appendChild(k);n.content&&(k.dataset.toggle="collapse",k.dataset.target="#"+l,k.classList.remove("history_item_no_content"),k=document.createElement("div"),k.id=l,k.className="border-top collapse history_content",l=document.createElement("div"),l.className="pl-3 py-2 font_size_12",l.innerHTML=n.content,k.appendChild(l),f.appendChild(k));a.appendChild(f)}}b=
document.createElement("div");b.className="mt-2 font_size_12";b.textContent=LAST_UPDATE_DATE;a.appendChild(b);document.getElementById("site_history_body").appendChild(a)}}
function modal_confirm_ok_Clicked(){var a=$("#modal_confirm");if("deletePreset"===confirmType){var b=loadLocalStorage("presets");b=b.filter(function(c){return c[0]!==a[0].dataset.target});saveLocalStorage("presets",b);b=loadLocalStorage("activePresets");b.presets=b.presets.filter(function(c){return c.id!==a[0].dataset.target});saveLocalStorage("activePresets",b);setLocalPresets();inform_success("\u524a\u9664\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002");setTab();a.modal("hide")}else"deleteLocalStorageAll"===
confirmType?(window.localStorage.clear(),setLocalPresets(),setTab(),window.localStorage.clear(),a.modal("hide")):"sendComment"===confirmType&&(send_comment(),a.modal("hide"));$(".fleet_tab.active").removeClass("active")}function first_time_Clicked(){$("#abstract").collapse("show");setTimeout(function(){$("body,html").animate({scrollTop:$("#first_time").offset().top-80},300,"swing")},200);return!1}
function site_manual_Clicked(){$("#abstract").collapse("show");setTimeout(function(){$("body,html").animate({scrollTop:$("#manual").offset().top-80},300,"swing")},200);return!1}
function initializeBoard(){fb||initializeFB();if(fb)fb.collection("comments").orderBy("createdAt","desc").limit(30).onSnapshot(function(a){var b=document.createDocumentFragment();a.forEach(function(c){var d=document.createElement("div");d.className="general_box my-3 px-3 pt-3 pb-1 comment";var e=document.createElement("div");e.className="d-flex mb-1";var f=document.createElement("div");f.className="comment_index text-primary";f.dataset.number=c.data().number;f.textContent=c.data().number+":";var g=
document.createElement("div");g.className="comment_writer ml-1 mr-2";g.textContent=c.data().author;var n=c.data().createdAt?c.data().createdAt.toDate():new Date,l=document.createElement("div");l.className="comment_date opacity6 font_size_11 align-self-center";l.textContent=" -- "+formatDate(n,"yyyy/MM/dd HH:mm:ss");e.appendChild(f);e.appendChild(g);e.appendChild(l);f=new Date;f.setDate(f.getDate()-7);n>f&&(f.setDate(f.getDate()+4),g=document.createElement("div"),g.className="font_size_11 align-self-center ml-1 "+
(n>f?"text-danger":"text-success"),g.textContent="New",e.appendChild(g));n=document.createElement("div");n.className="comment_content align-self-center";n.textContent=c.data().content;d.appendChild(e);d.appendChild(n);b.appendChild(d)});document.getElementById("coment_board").innerHTML="";document.getElementById("coment_board").appendChild(b)});comment_text_Changed()}
function comment_index_Clicked(a){a=castInt(a[0].dataset.number);document.getElementById("comment_text").value.trim().length?document.getElementById("comment_text").value+=">>"+a+"\n":document.getElementById("comment_text").value=">>"+a+"\n";setTimeout(function(){$("body,html").animate({scrollTop:$("#comments").offset().top-20},20,"swing")},20);document.getElementById("comment_text").focus()}
function comment_text_Changed(){var a=document.getElementById("comment_author"),b=document.getElementById("comment_text"),c=b.value,d=c.match(/\n/g),e=!0;"noro"===a.value.trim()?(document.getElementById("author_validate").textContent="\u4f7f\u7528\u3067\u304d\u306a\u3044\u540d\u524d\u3067\u3059\u3002",a.classList.add("is-invalid"),e=!1):20<a.value.trim().length?(document.getElementById("author_validate").textContent="20\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002",
a.classList.add("is-invalid"),e=!1):a.classList.remove("is-invalid");0===c.trim().length?(document.getElementById("comment_validate").textContent="",b.classList.remove("is-invalid"),e=!1):1E3<c.length?(document.getElementById("comment_validate").textContent="1000\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",b.classList.add("is-invalid"),e=!1):d&&15<=d.length?(document.getElementById("comment_validate").textContent="\u898f\u5b9a\u884c\u6570\u3092\u8d85\u3048\u307e\u3057\u305f\u3002\u884c\u6570\u3092\u6e1b\u3089\u3057\u3066\u4e0b\u3055\u3044\u3002",
b.classList.add("is-invalid"),e=!1):b.classList.remove("is-invalid");document.getElementById("btn_send_comment").disabled=!e;e&&(a.classList.remove("is-invalid"),b.classList.remove("is-invalid"))}
function btn_send_comment_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u30b3\u30e1\u30f3\u30c8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3 font_size_12">\u30fb\u516c\u5e8f\u826f\u4fd7\u306b\u53cd\u3059\u308b\u66f8\u304d\u8fbc\u307f\u306f\u3054\u9060\u616e\u304f\u3060\u3055\u3044\u3002</div>\n\t\t<div class="font_size_12">\u30fb\u9001\u4fe1\u3057\u305f\u5185\u5bb9\u306f\u3001\u539f\u5247\u3042\u3068\u304b\u3089\u5909\u66f4/\u524a\u9664\u306f\u3067\u304d\u307e\u305b\u3093\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t\t<div class="font_size_12">\u30fb\u3069\u3046\u3057\u3066\u3082\u5909\u66f4\u30fb\u524a\u9664\u3057\u305f\u3044\u5834\u5408\u306f\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType=
"sendComment";a.modal("show")}
function send_comment(){if(fb){var a=document.getElementById("comment_author").value.trim(),b=document.getElementById("comment_text").value.trim();a||(a="\u540d\u7121\u3057\u3055\u3093");fb.runTransaction(function(c){var d=fb.collection("comments"),e=d.doc();return c.get(e).then(function(){var f,g,n;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:return l.yield(d.orderBy("createdAt","desc").limit(1).get(),2);case 2:f=l.yieldResult;if(!f){l.jumpTo(0);break}g=
0;return l.yield(Promise.all(f.docs.map(function(k){var u;return $jscomp.asyncExecutePromiseGeneratorProgram(function(t){if(1==t.nextAddress)return t.yield(k.data(),2);if(3!=t.nextAddress)return u=t.yieldResult,t.yield(u.number,3);g=t.yieldResult;t.jumpToEnd()})})),4);case 4:if(!(0<=castInt(g,-1)))return l["return"](Promise.reject("ID\u63a1\u756a\u30a8\u30e9\u30fc :",g));n={number:castInt(g)+1,author:a,content:b,createdAt:firebase.firestore.FieldValue.serverTimestamp()};return l.yield(c.set(e,n),
6);case 6:return l["return"](n)}})})}).then(function(c){document.getElementById("comment_text").value="";document.getElementById("btn_send_comment").disabled=!0})["catch"](function(c){console.error(c);alert("\u30b3\u30e1\u30f3\u30c8\u306e\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})}else alert("\u8b0e\u306e\u7406\u7531\u306b\u3088\u308a\u3001\u30b3\u30e1\u30f3\u30c8\u306e\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}
function btn_url_shorten_Clicked(){var a,b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress){a=document.getElementById("btn_url_shorten");b=document.getElementById("input_url");c=b.value.trim();if(a.classList.contains("shortening"))return e["return"]();a.classList.add("shortening");a.textContent="\u77ed\u7e2e\u4e2d";return c?c.match(/^(https?|ftp)(:\/\/[-_.!~*'()a-zA-Z0-9;\/?:@&=+\$,%#]+)$/)?c.match(/^(https:\/\/aircalc.page.link\/)([.!~*'()a-zA-Z0-9;\/?:@&=+\$,%#]+)$/)?
e.jumpTo(2):e.yield(postURLData(c).then(function(f){f.error||!f.shortLink?(b.value="",inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")):(b.value=f.shortLink,inform_success("URL\u306e\u77ed\u7e2e\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"))})["catch"](function(f){b.value="";inform_danger("\u5165\u529b\u5024\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}),2):(b.value="",(d=readDeckBuilder(c))?
window.location.href="../simulator/?predeck="+c:readEquipmentJson(c)?inform_success("\u6240\u6301\u88c5\u5099\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"):readShipJson(c)?inform_success("\u6240\u6301\u8266\u5a18\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"):inform_danger("\u5165\u529b\u5024\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.jumpTo(2)):(b.value="",inform_warning("URL\u3084\u30c7\u30c3\u30ad\u30d3\u30eb\u30c0\u30fc\u5f62\u5f0f\u306e\u6587\u5b57\u5217\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),
e.jumpTo(2))}a.textContent="URL\u77ed\u7e2e";a.classList.remove("shortening");e.jumpToEnd()})}
function public_preset_tab_Shown(){$("#btn_search_preset").parent().removeClass("d-none");$("#map_select").parent().removeClass("d-none");$("#search_preset_parent").addClass("d-none");$("#empty_folder_visible_parent").addClass("d-none");0===castInt($("#presets_order").val())&&($("#presets_order").val(1),$("#presets_order").change(),$("#presets_order").addClass("d-none"));$("#presets_order").find('option[value="0"]').prop("disabled",!0);saveSessionStorage("display_public",!0);if(!$("#map_select").html()){for(var a=
'<option value="0">\u5168\u3066\u306e\u6d77\u57df\uff08\u6700\u65b0\u306e20\u4ef6\uff09</option>',b={},c=$jscomp.makeIterator(WORLD_DATA),d=c.next();!d.done;b={$jscomp$loop$prop$world$42:b.$jscomp$loop$prop$world$42},d=c.next()){d=d.value;b.$jscomp$loop$prop$world$42=d.world;var e=MAP_DATA.filter(function(f){return function(g){return Math.floor(g.area/10)===f.$jscomp$loop$prop$world$42}}(b));a+='<optgroup label="'+d.name+'">';d=$jscomp.makeIterator(e);for(e=d.next();!e.done;e=d.next())e=e.value,a+=
'<option value="'+e.area+'">'+(20<b.$jscomp$loop$prop$world$42?"E":b.$jscomp$loop$prop$world$42)+"-"+e.area%10+" : "+e.name+"</option>"}$("#map_select").html(a);if(a=loadSessionStorage("search_result"))$("#map_select").val(a.map),setPresets(a.presets,!1)}map_select_Changed()}
function public_preset_tab_Hidden(){$("#btn_search_preset").parent().addClass("d-none");$("#map_select").parent().addClass("d-none");$("#search_preset_parent").removeClass("d-none");$("#empty_folder_visible_parent").removeClass("d-none");$("#presets_order").find('option[value="0"]').prop("disabled",!1);$("#presets_order").removeClass("d-none");saveSessionStorage("display_public",!1)}
function site_theme_Changed(a){a=a.attr("id");document.body.classList.remove(setting.themeColor);document.body.classList.add(a);"dark_theme"===a||"dark_gradient_theme"===a||"deep_blue_theme"===a?(mainColor="#e0e0e0",document.body.classList.add("dark-theme")):(mainColor="#000000",document.body.classList.remove("dark-theme"));document.getElementById("input_url").classList.add("form-control-dark");setting.themeColor=a;saveSetting();document.body.style.color=mainColor}
function confirm_tab_close_Clicked(){setting.confirmTabClosing=document.getElementById("confirm_tab_close").checked;saveSetting()}function output_data_Clicked(a){a.hasClass("is-valid")&&copyInputTextToClipboard(a)&&inform_success("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002")}
function btn_output_url_Clicked(){var a,b,c,d,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return f.setCatchFinallyBlocks(2),a=getModalSharePreset(),b=$("#output_url"),d=c="https://noro6.github.io/kcTools/?d="+a[2],e=!1,f.yield(postURLData(c).then(function(g){g.error||!g.shortLink?console.log(g):(e=!0,d=g.shortLink)})["catch"](function(g){return console.error(g)}),4);if(2!=f.nextAddress)return e?(b.val(d),b.nextAll(".valid-feedback").text("\u751f\u6210\u3057\u307e\u3057\u305f\u3002\u4e0a\u8a18URL\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3055\u308c\u307e\u3059\u3002"),
b.removeClass("is-invalid").addClass("is-valid")):(b.nextAll(".valid-feedback").text("\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),b.addClass("is-invalid").removeClass("is-valid")),f.leaveTryBlock(0);f.enterCatchBlock();$("#output_url").addClass("is-invalid").removeClass("is-valid");return f["return"]()})}
function btn_output_deck_Clicked(){var a=$("#output_deck");a.nextAll(".valid-feedback").text("");a.removeClass("is-invalid").removeClass("is-valid");var b=getModalSharePreset();b&&(b=decodePreset(b[2]),b=convertToDeckBuilder(b[1],b[0]),$("#output_deck").val(b),b?(a.nextAll(".valid-feedback").text("\u751f\u6210\u3057\u307e\u3057\u305f\u3002\u4e0a\u8a18\u6587\u5b57\u5217\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3055\u308c\u307e\u3059\u3002"),
a.removeClass("is-invalid").addClass("is-valid")):a.addClass("is-invalid").removeClass("is-valid"))}function open_deckBuilder(){var a=getModalSharePreset();a&&(a=decodePreset(a[2]),window.open("http://kancolle-calc.net/deckbuilder.html?predeck="+convertToDeckBuilder(a[1],a[0])))}function open_Jervis(){var a=getModalSharePreset();a&&(a=decodePreset(a[2]),window.open("https://kcjervis.github.io/jervis/?operation-json="+convertToDeckBuilder_j(a[1],a[0])))}
function getModalSharePreset(){var a=loadLocalStorage("presets"),b=$("#modal_share")[0].dataset.presetId;a=a?a.find(function(c){return c[0]===b}):null;return a?a:(inform_danger("\u5bfe\u8c61\u306e\u7de8\u6210\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002"),null)}
function btn_output_presets_Clicked(){var a=loadLocalStorage("presets");a&&(document.getElementById("presets_data_output").value=JSON.stringify(a),inform_success("\u51fa\u529b\u3057\u307e\u3057\u305f\u3002"))}function presets_data_output_Clicked(a){a[0].value.trim()&&copyInputTextToClipboard(a)&&inform_success("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002")}
function btn_load_presets_Clicked(){var a=loadLocalStorage("presets");try{var b=document.getElementById("presets_data_input").value.trim(),c=JSON.parse(b);b=[];for(var d=$jscomp.makeIterator(c),e=d.next();!e.done;e=d.next()){var f=e.value;if(3>f.length)throw"\u9805\u76ee\u6570\u4e0d\u5099\u30a8\u30e9\u30fc";JSON.parse(b64_to_utf8(f[2]));var g=[f[0],f[1],f[2],"",formatDate(new Date,"yyyy/MM/dd HH:mm:ss"),0];6===f.length?(g[3]=f[3],g[4]=f[4],g[5]=f[5]):5===f.length?(g[3]=f[3],g[4]=f[4]):4===f.length&&
(g[3]=f[3]);b.push(g)}saveLocalStorage("presets",b);inform_success("\u5fa9\u5143\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002");document.getElementById("presets_data_input").value="";setLocalPresets()}catch(n){a&&saveLocalStorage("presets",a),inform_danger("\u5fa9\u5143\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u5fa9\u5143\u3092\u4e2d\u6b62\u3057\u307e\u3057\u305f\u3002")}}
document.addEventListener("DOMContentLoaded",function(){initialize();document.getElementById("btn_top").addEventListener("click",function(){window.location.href="../list/"});$("#header").on("click",".fleet_tab",topTab_Clicked);$("#main").on("click",".version_detail",version_detail_Clicked);$("#main").on("click",".btn_first_time",first_time_Clicked);$("#main").on("click",".btn_site_manual",site_manual_Clicked);$("#main").on("click",".theme_select",function(){site_theme_Changed($(this))});$("#main").on("input",
"#search_preset",setLocalPresets);$("#main").on("change","#presets_order",setLocalPresets);$("#main").on("click","#btn_search_preset",searchUploadedPreset);$("#main").on("change","#map_select",map_select_Changed);$("#main").on("click","#empty_folder_visible",setLocalPresets);$("#main").on("change","#select_preset_level",function(){$("#btn_search_preset").prop("disabled",!1)});$("#public_presets_container").on("click",".preset_container .btn_open",function(){public_preset_Clicked($(this))});$("#public_presets_container").on("click",
".preset_container.more_load",more_load_presets);$("#presets_container").on("click",".preset_container:not(.editting, .folder_header, .folder_selectable)",function(){preset_Clicked($(this))});$("#presets_container").on("click",".btn_edit_start",function(a){btn_edit_start_Clicked($(this),a)});$("#presets_container").on("click",".btn_commit",function(a){btn_commit_Clicked($(this),a)});$("#presets_container").on("click",".btn_rollback",function(a){btn_rollback_Clicked($(this),a)});$("#presets_container").on("click",
".btn_share",function(a){btn_share_Clicked($(this),a)});$("#presets_container").on("click",".btn_copy",function(a){btn_copy_Clicked($(this),a)});$("#presets_container").on("click",".btn_move_folder",function(a){btn_move_folder_Clicked($(this),a)});$("#presets_container").on("click",".btn_delete",function(a){btn_delete_Clicked($(this),a)});$("#presets_container").on("click",".folder_header.editting",function(a){a.stopPropagation()});$("#presets_container").on("click",".btn_add_preset",function(a){btn_add_preset_Clicked($(this),
a)});$("#presets_container").on("click",".btn_commit_folder",function(a){btn_commit_folder_Clicked($(this),a)});$("#presets_container").on("click",".btn_rollback_folder",function(a){btn_rollback_folder_Clicked($(this),a)});$("#presets_container").on("click",".preset_container.folder_selectable",function(){folder_selectable_Clicked($(this))});$("#public_preset_tab").on("shown.bs.tab",public_preset_tab_Shown);$("#public_preset_tab").on("hidden.bs.tab",public_preset_tab_Hidden);$("#site_history").on("show.bs.collapse",
".collapse",loadSiteHistory);$("#site_board").on("show.bs.collapse",".collapse",initializeBoard);$("#site_board").on("click","#btn_send_comment",btn_send_comment_Clicked);$("#site_board").on("input","#comment_author",comment_text_Changed);$("#site_board").on("input","#comment_text",comment_text_Changed);$("#site_board").on("click",".comment_index",function(){comment_index_Clicked($(this))});$("#config_content").on("click","#confirm_tab_close",confirm_tab_close_Clicked);$("#config_content").on("click",
"#btn_output_presets",btn_output_presets_Clicked);$("#config_content").on("focus","#presets_data_output",function(){$(this).select()});$("#config_content").on("click","#presets_data_output",function(){presets_data_output_Clicked($(this))});$("#config_content").on("click","#btn_load_presets",btn_load_presets_Clicked);$("#config_content").on("focus","#presets_data_input",function(){$(this).select()});$("#config_content").on("click","#btn_reset_localStorage",btn_reset_localStorage_Clicked);$("#btn_url_shorten").click(btn_url_shorten_Clicked);
$("#modal_confirm").on("click",".btn_ok",modal_confirm_ok_Clicked);$("#modal_folder_confirm").on("click",".btn_ok",modal_folder_confirm_ok_Clicked);$("#modal_share").on("click",".btn_output_url",btn_output_url_Clicked);$("#modal_share").on("click",".btn_output_deck",btn_output_deck_Clicked);$("#modal_share").on("focus","#output_url",function(){$(this).select()});$("#modal_share").on("focus","#output_deck",function(){$(this).select()});$("#modal_share").on("input","#output_url",function(){$(this).removeClass("is-valid")});
$("#modal_share").on("input","#output_deck",function(){$(this).removeClass("is-valid")});$("#modal_share").on("click","#output_url",function(){output_data_Clicked($(this))});$("#modal_share").on("click","#output_deck",function(){output_data_Clicked($(this))});$("#modal_share").on("click","#open_deckBuilder",open_deckBuilder);$("#modal_share").on("click","#open_jervis",open_Jervis)});