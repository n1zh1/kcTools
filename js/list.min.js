var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var h=e[f];if(!(h in d))return;d=d[h]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype["return"]=function(a){this.abruptCompletion_={"return":a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){var c=$jscomp.makeIterator(a),d=c.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=b;else return this.yieldAllIterator_=c,this.yield(d.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){var c=this.finallyContexts_.splice(b||0)[0];if(c=this.abruptCompletion_=this.abruptCompletion_||c){if(c.isException)return this.jumpToErrorHandler_();void 0!=c.jumpTo&&this.finallyAddress_<c.jumpTo?(this.nextAddress=c.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_["return"]);this.context_["return"](a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a["return"],done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this["throw"]=function(b){return a.throw_(b)};this["return"]=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){var c=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(c,a.prototype);return c};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a["throw"](d)}return new Promise(function(d,e){function f(h){h.done?d(h.value):Promise.resolve(h.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
function initialize(){location.search&&(window.location.href="../simulator/"+location.search);document.getElementById("confirm_tab_close").checked=setting.confirmTabClosing;document.getElementById("presets_order").value=setting.presetsOrder;$(".fleet_tab.active").removeClass("active");setLocalPresets();loadSessionStorage("display_public")&&$("#public_preset_tab").tab("show")}
function setLocalPresets(){var a=loadLocalStorage("presets");a||(a=[]);$("#btn_search_preset").prop("disabled",!1);setPresets(a)}
function setPresets(a,b){var c=(b=void 0===b?!0:b)?"presets_container":"public_presets_container",d=castInt(document.getElementById("presets_order").value),e=document.getElementById("search_preset").value.trim();if(b)switch(d){case 1:a.sort(function(v,t){return v[4]<t[4]?1:-1});break;case 2:a.sort(function(v,t){return v[4]>t[4]?1:-1});break;case 3:a.sort(function(v,t){return v[1]<t[1]?1:-1});break;case 4:a.sort(function(v,t){return v[1]>t[1]?1:-1})}setting.presetsOrder=d;saveSetting();var f=0===d&&
!e&&b,h=document.createDocumentFragment();if(b){var k=createDiv("preset_container new d-flex "+(a.length?"":"border_delete")),l=createDiv("new_body mx-auto my-auto","",a.length?"\u65b0\u898f\u4f5c\u6210":"\u7de8\u6210\u3092\u65b0\u898f\u4f5c\u6210");k.appendChild(l);h.appendChild(k)}else b||0!==a.length||(k=createDiv("d-flex empty_container"),l=createDiv("mx-auto my-auto","","\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002"),k.appendChild(l),h.appendChild(k));
k=createDiv("","preset_sortable_container");l=$jscomp.makeIterator(a);for(var n=l.next();!n.done;n=l.next()){var m=n.value;if(m[1]&&!(b&&e&&0>m[1].indexOf(e))){n=createDiv();var p=createDiv("preset_container");p.dataset.presetid=m[0];b||(p.dataset.presetdata=m[2]);var w=createDiv("preset_header "+(f?"sortable_handle":""));p.appendChild(w);w=createDiv("preset_body d-flex mx-2");var q=createDiv("mr-2 preset_abstract flex-grow-1");q.appendChild(createDiv("preset_name","",m[1]));var g=document.createElement("input");
g.type="text";g.maxLength=50;g.className="form-control form-control-sm preset_name_edit mb-1 d-none";g.value=m[1];q.appendChild(g);var u=decodePreset(m[2]);g=u[0];u=u[1];for(var x=createDiv("d-flex land_base_status"),r=1;3>=r;r++)x.appendChild(createDiv("land_base_state no_"+r+" mr-1 "+(1<=g.length&&g[1].length>=r&&0<=g[1][r-1]?"":"disabled"),"","\u7b2c"+r+"\u57fa\u5730\u822a\u7a7a\u968a"));q.appendChild(x);g=createDiv("d-flex ships flex-wrap");u=$jscomp.makeIterator(u);for(x=u.next();!x.done;x=u.next()){x=
x.value;if(5<g.childNodes.length)break;0>=x[0]||(r=document.createElement("img"),r.className="ship_image",r.width=100,r.height=25,r.src="../img/ship/"+x[0]+".png",g.appendChild(r))}q.appendChild(g);g=createDiv("preset_memo_view border mt-1 px-1 py-1 "+(m[3]?"":"d-none"),"",m[3]);q.appendChild(g);g=document.createElement("textarea");g.className="form-control preset_memo mt-1 w-100 d-none";g.value=m[3]?m[3]:"";u=g.value.match(/\n/g);g.rows=u&&u.length?u.length+2:2;q.appendChild(g);w.appendChild(q);
q=createDiv("d-flex ml-auto pt-2 btns_container");b?(g=createDiv("ml-auto r_btn btn_commit d-none"),g.dataset.toggle="tooltip",g.dataset.offset="-50%",g.title="\u7de8\u96c6\u5185\u5bb9\u3092\u78ba\u5b9a\u3057\u307e\u3059\u3002",g.innerHTML='<i class="fas fa-save"></i>',q.appendChild(g),g=createDiv("ml-2 r_btn btn_rollback d-none"),g.dataset.toggle="tooltip",g.dataset.offset="-50%",g.title="\u7de8\u96c6\u5185\u5bb9\u3092\u53d6\u308a\u6d88\u3057\u307e\u3059\u3002",g.innerHTML='<i class="fas fa-undo"></i>',
q.appendChild(g),g=createDiv("ml-auto r_btn btn_edit_start"),g.dataset.toggle="tooltip",g.dataset.offset="-50%",g.title="\u7de8\u6210\u540d\u3084\u7de8\u6210\u30e1\u30e2\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002",g.innerHTML='<i class="fas fa-pencil"></i>',q.appendChild(g),g=createDiv("ml-2 r_btn btn_copy"),g.dataset.toggle="tooltip",g.dataset.offset="-50%",g.title="\u3053\u306e\u7de8\u6210\u5185\u5bb9\u304c\u8907\u88fd\u3055\u308c\u305f\u65b0\u3057\u3044\u7de8\u6210\u30bf\u30d6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002",
g.innerHTML='<i class="fas fa-copy"></i>',q.appendChild(g),g=createDiv("ml-2 r_btn btn_delete"),g.dataset.toggle="tooltip",g.dataset.offset="-50%",g.title="\u7de8\u6210\u3092\u524a\u9664\u3057\u307e\u3059\u3002",g.innerHTML='<i class="fas fa-trash-o"></i>',q.appendChild(g)):(g=createDiv("ml-2 r_btn btn_open"),g.dataset.toggle="tooltip",g.dataset.offset="-50%",g.title="\u7de8\u6210\u3092\u5c55\u958b\u3057\u307e\u3059\u3002",g.innerHTML='<i class="fas fa-folder-open-o"></i>',q.appendChild(g));w.appendChild(q);
p.appendChild(w);b?(m=createDiv("update_date mr-1","","\u66f4\u65b0\u65e5\u6642: "+m[4].split(".")[0]),p.appendChild(m)):(m=createDiv("update_date mr-3","",(m[5]?"\u4f5c\u6210\u8005: "+m[5]+"\u3000":"")+"\u4f5c\u6210\u65e5\u6642: "+m[4].split(".")[0]),p.appendChild(m));n.appendChild(p);k.appendChild(n)}}h.appendChild(k);!b&&prevSnapShot&&(f=createDiv("d-flex preset_container more_load"),k=createDiv("mx-auto my-auto","","\u3082\u3063\u3068\u8aad\u307f\u8fbc\u3080"),f.appendChild(k),h.appendChild(f));
document.getElementById(c).innerHTML="";document.getElementById(c).appendChild(h);$("#"+c+" .r_btn").tooltip();0===d&&!e&&b&&Sortable.create(document.getElementById("preset_sortable_container"),{animation:200,handle:".sortable_handle",onEnd:function(){for(var v=loadLocalStorage("presets"),t=[],z={},A=$jscomp.makeIterator(document.getElementsByClassName("preset_container")),y=A.next();!y.done;z={$jscomp$loop$prop$c$11:z.$jscomp$loop$prop$c$11},y=A.next())z.$jscomp$loop$prop$c$11=y.value,(y=v.find(function(B){return function(C){return C[0]===
B.$jscomp$loop$prop$c$11.dataset.presetid}}(z)))&&t.push(y);t.length&&(saveLocalStorage("presets",t),inform_success("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u9806\u5e8f\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002"))}})}
function map_select_Changed(){var a=castInt($("#map_select").val());$("#btn_search_preset").prop("disabled",!1);400<a?($("#select_preset_level").parent().removeClass("d-none"),$("#select_preset_level").val(4)):($("#select_preset_level").parent().addClass("d-none"),$("#select_preset_level").val(0))}var prevSnapShot=null,STEP=20;
function searchUploadedPreset(){var a=getPublicPresetsQuery(),b=[];fb||initializeFB();fb&&fb.collection("presets").where("map","==",a.map).where("level","==",a.level).orderBy(a.sortKey,a.order).limit(STEP).get().then(function(c){prevSnapShot=c.docs[c.docs.length-1];c.forEach(function(d){var e=d.data();d=d.data().createdAt?d.data().createdAt.toDate():new Date;e=["",e.name,e.data,e.memo,formatDate(d,"yyyy/MM/dd HH:mm:ss"),e.user];b.push(e)});b.length<STEP&&(prevSnapShot=null);setPresets(b,!1);saveSessionStorage("search_result",
{map:a.map,level:a.level,sortKey:a.sortKey,order:a.order,presets:b})})["catch"](function(c){console.error(c);inform_danger("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})}
function getPublicPresetsQuery(){$("#btn_search_preset").prop("disabled",!0);var a=castInt($("#map_select").val()),b=400<a?castInt($("#select_preset_level").val()):0,c="createdAt",d="desc";switch(castInt(document.getElementById("presets_order").value)){case 2:d="asc";break;case 3:c="name";break;case 4:c="name",d="asc"}return{map:a,level:b,sortKey:c,order:d}}
function more_load_presets(){var a=$(".more_load");a.html('<div class="w-100 text-center py-3"><div class="spinner-border" role="status"><span class="sr-only"></span></div></div>');a.removeClass("more_load");var b=getPublicPresetsQuery();if((a=loadSessionStorage("search_result"))&&prevSnapShot)if(a.map!==b.map||a.level!==b.level||a.sortKey!==b.sortKey||a.order!==b.order)searchUploadedPreset();else{var c=a.presets;fb||initializeFB();fb&&fb.collection("presets").where("map","==",b.map).where("level",
"==",b.level).orderBy(b.sortKey,b.order).startAfter(prevSnapShot).limit(STEP).get().then(function(d){prevSnapShot=d.docs[d.docs.length-1];d.forEach(function(e){var f=e.data();e=e.data().createdAt?e.data().createdAt.toDate():new Date;f=["",f.name,f.data,f.memo,formatDate(e,"yyyy/MM/dd HH:mm:ss"),f.user];c.push(f)});d.docs.length<STEP&&(prevSnapShot=null);setPresets(c,!1);saveSessionStorage("search_result",{map:b.map,level:b.level,sortKey:b.sortKey,order:b.order,presets:c})})["catch"](function(d){console.error(d);
inform_danger("\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")})}else searchUploadedPreset()}
function btn_edit_start_Clicked(a,b){b.stopPropagation();$(".preset_container.editting").each(function(d,e){btn_rollback_Clicked($(e).find(".btn_rollback"));inform_warning($(e).find(".preset_name").text()+"\u306e\u7de8\u96c6\u306f\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f\u3002")});var c=a.closest(".preset_container");c.addClass("editting");c.removeClass("sortable_handle");c.find(".preset_name").addClass("d-none");c.find(".preset_name_edit").removeClass("d-none");c.find(".preset_memo").removeClass("d-none");
c.find(".preset_memo_view").addClass("d-none");c.find(".btn_commit").removeClass("d-none");c.find(".btn_rollback").removeClass("d-none");c.find(".btn_copy").addClass("d-none");c.find(".btn_edit_start").addClass("d-none")}
function btn_rollback_Clicked(a,b){(b=void 0===b?null:b)&&b.stopPropagation();var c=a.closest(".preset_container");c.find(".preset_name").removeClass("d-none");c.find(".preset_name_edit").addClass("d-none");c.find(".preset_memo").addClass("d-none");c.find(".preset_memo_view").text()&&c.find(".preset_memo_view").removeClass("d-none");c.find(".btn_commit").addClass("d-none");c.find(".btn_rollback").addClass("d-none");c.find(".btn_copy").removeClass("d-none");c.find(".btn_edit_start").removeClass("d-none");
c.removeClass("editting");c.addClass("sortable_handle")}
function btn_commit_Clicked(a,b){b=void 0===b?null:b;var c=a.closest(".preset_container"),d=c[0].dataset.presetid,e=loadLocalStorage("presets");e||(e=[]);var f=e.findIndex(function(l){return l[0]===d});if(0<=f){var h=c.find(".preset_name_edit").val().trim(),k=c.find(".preset_memo").val().trim();h&&(50<h.length&&(h=h.slice(0,50),c.find(".preset_name_edit").val(h)),e[f][1]=h,c.find(".preset_name").text(h));400<k.length&&(k=k.slice(0,400),c.find(".preset_memo").val(k));e[f][3]=k;f=k.replace(/\r?\n/g,
" ");c.find(".preset_memo_view").text(f);f.trim().length?c.find(".preset_memo_view").removeClass("d-none"):c.find(".preset_memo_view").addClass("d-none");saveLocalStorage("presets",e)}btn_rollback_Clicked(a,b);setTab();$(".fleet_tab.active").removeClass("active");inform_success("\u7de8\u6210\u60c5\u5831\u306e\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002")}
function btn_delete_Clicked(a,b){b.stopPropagation();var c=$("#modal_confirm");c.find(".modal-body").html('<div class="mt-2">\u7de8\u6210\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f</div>');c[0].dataset.target=a.closest(".preset_container")[0].dataset.presetid;confirmType="deletePreset";c.modal("show")}
function preset_Clicked(a){var b=loadLocalStorage("presets"),c=a[0].dataset.presetid;b=b?b.find(function(e){return e[0]===c}):null;var d={id:getUniqueId(),name:getMaxUntitled(),history:{index:0,histories:["Noi6BpgWgRnX41BYLgAZKe-H6IBEB4cSaA3gQMYCuALgJYB2AkgCYEBcmBATgIZ0AplxjoedfgCMANiM6pwBKQHtebIb1HiAvhBwAzfjIDOQ8EdPnFZIA"]}};b&&(d.id=b[0],d.name=a.find(".preset_name").text(),d.history.histories[0]=b[2]);(a=loadLocalStorage("activePresets"))||(a={activeId:"",presets:[]});(b=a.presets.find(function(e){return e.id===
d.id}))?d=b:a.presets.push(d);a.activeId=d.id;saveLocalStorage("activePresets",a);window.location.href="../simulator/?p="+d.history.histories[d.history.index]}function public_preset_Clicked(a){var b=a.closest(".preset_container");a=b[0].dataset.presetdata;b=b.find(".preset_name").text();window.location.href="../simulator/?d="+a+"&name="+encodeURIComponent(b)}
function btn_copy_Clicked(a,b){b.stopPropagation();var c=loadLocalStorage("presets"),d=a.closest(".preset_container")[0].dataset.presetid;if(c=c?c.find(function(f){return f[0]===d}):null){c={id:getUniqueId(),name:c[1]+"_\u30b3\u30d4\u30fc",history:{index:0,histories:[c[2]]}};var e=loadLocalStorage("activePresets");e||(e={activeId:"",presets:[]});e.presets.push(c);e.activeId=c.id;saveLocalStorage("activePresets",e);window.location.href="../simulator/?p="+c.history.histories[c.history.index]}else inform_danger("\u8907\u88fd\u5bfe\u8c61\u306e\u7de8\u6210\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002")}
function topTab_Clicked(){var a=getActivePreset();a.id?window.location.href="../simulator/?p="+a.history.histories[a.history.index]:preset_Clicked($("#add_new_tab"))}
function version_detail_Clicked(){if(!document.getElementById("version_inform_body").innerHTML){for(var a=CHANGE_LOG.find(function(l){return l.id===LATEST_VERSION}),b=document.createDocumentFragment(),c=$jscomp.makeIterator(a.changes),d=c.next();!d.done;d=c.next()){d=d.value;var e=createDiv("mt-3"),f=document.createElement("div"),h=document.createElement("span");h.className="mr-1 pt-1 badge badge-pill badge-"+(0===d.type?"success":1===d.type?"info":"danger");h.textContent=0===d.type?"\u65b0\u898f":
1===d.type?"\u5909\u66f4":"\u4fee\u6b63";var k=document.createElement("span");k.innerHTML=d.title;f.appendChild(h);f.appendChild(k);e.appendChild(f);d.content&&(f=createDiv("font_size_12 pl-3"),f.innerHTML=d.content,e.appendChild(f));b.appendChild(e)}document.getElementById("version").textContent=a.id;document.getElementById("version_inform_body").appendChild(b);setting.version=a.id;saveSetting();document.getElementsByClassName("version_detail")[0].classList.remove("unread")}$("#modal_version_inform").modal("show")}
function loadSiteHistory(){if(!document.getElementById("site_history_body").innerHTML){for(var a=document.createDocumentFragment(),b=0,c=LATEST_VERSION,d=$jscomp.makeIterator(CHANGE_LOG),e=d.next();!e.done;e=d.next()){e=e.value;var f=createDiv("my-3 ver_log border-bottom"),h=createDiv("py-2","","v"+e.id);if(c===e.id){var k=document.createElement("span");k.className="ml-2 pt-1 badge badge-pill badge-danger";k.textContent="New";h.appendChild(k)}f.appendChild(h);for(h=0;h<e.changes.length;h++){k=e.changes[h];
var l="log_"+b++ +"_"+h,n=document.createElement("div");n.className="py-2 px-2 d-flex collapsed history_item history_item_no_content";var m=document.createElement("div");m.className="d-flex flex-nowrap align-self-center";var p=document.createElement("div");p.className="align-self-center";var w=document.createElement("span");w.className="mr-2 pt-1 badge badge-pill badge-"+(0===k.type?"success":1===k.type?"info":"danger");w.textContent=0===k.type?"\u65b0\u898f":1===k.type?"\u5909\u66f4":"\u4fee\u6b63";
var q=document.createElement("div");q.className="align-self-center";q.innerHTML=k.title;p.appendChild(w);m.appendChild(p);m.appendChild(q);n.appendChild(m);f.appendChild(n);k.content&&(n.dataset.toggle="collapse",n.dataset.target="#"+l,n.classList.remove("history_item_no_content"),n=document.createElement("div"),n.id=l,n.className="border-top collapse history_content",l=document.createElement("div"),l.className="pl-3 py-2 font_size_12",l.innerHTML=k.content,n.appendChild(l),f.appendChild(n));a.appendChild(f)}}b=
document.createElement("div");b.className="mt-2 font_size_12";b.textContent=LAST_UPDATE_DATE;a.appendChild(b);document.getElementById("site_history_body").appendChild(a)}}
function modal_confirm_ok_Clicked(){var a=$("#modal_confirm");if("deletePreset"===confirmType){var b=loadLocalStorage("presets");b=b.filter(function(c){return c[0]!==a[0].dataset.target});saveLocalStorage("presets",b);b=loadLocalStorage("activePresets");b.presets=b.presets.filter(function(c){return c.id!==a[0].dataset.target});saveLocalStorage("activePresets",b);setLocalPresets();setTab();a.modal("hide")}else"deleteLocalStorageAll"===confirmType?(window.localStorage.clear(),setLocalPresets(),setTab(),
a.modal("hide")):"sendComment"===confirmType&&(send_comment(),a.modal("hide"));$(".fleet_tab.active").removeClass("active")}function first_time_Clicked(){$("#abstract").collapse("show");setTimeout(function(){$("body,html").animate({scrollTop:$("#first_time").offset().top-80},300,"swing")},200);return!1}function site_manual_Clicked(){$("#abstract").collapse("show");setTimeout(function(){$("body,html").animate({scrollTop:$("#manual").offset().top-80},300,"swing")},200);return!1}
function initializeBoard(){fb||initializeFB();if(fb)fb.collection("comments").orderBy("createdAt","desc").limit(30).onSnapshot(function(a){var b=document.createDocumentFragment();a.forEach(function(c){var d=document.createElement("div");d.className="general_box my-3 px-3 pt-3 pb-1 comment";var e=document.createElement("div");e.className="d-flex mb-1";var f=document.createElement("div");f.className="comment_index text-primary";f.dataset.number=c.data().number;f.textContent=c.data().number+":";var h=
document.createElement("div");h.className="comment_writer ml-1 mr-2";h.textContent=c.data().author;var k=c.data().createdAt?c.data().createdAt.toDate():new Date,l=document.createElement("div");l.className="comment_date opacity6 font_size_11 align-self-center";l.textContent=" -- "+formatDate(k,"yyyy/MM/dd HH:mm:ss");e.appendChild(f);e.appendChild(h);e.appendChild(l);f=new Date;f.setDate(f.getDate()-7);k>f&&(f.setDate(f.getDate()+4),h=document.createElement("div"),h.className="font_size_11 align-self-center ml-1 "+
(k>f?"text-danger":"text-success"),h.textContent="New",e.appendChild(h));k=document.createElement("div");k.className="comment_content align-self-center";k.textContent=c.data().content;d.appendChild(e);d.appendChild(k);b.appendChild(d)});document.getElementById("coment_board").innerHTML="";document.getElementById("coment_board").appendChild(b)});comment_text_Changed()}
function comment_index_Clicked(a){a=castInt(a[0].dataset.number);document.getElementById("comment_text").value.trim().length?document.getElementById("comment_text").value+=">>"+a+"\n":document.getElementById("comment_text").value=">>"+a+"\n";setTimeout(function(){$("body,html").animate({scrollTop:$("#comments").offset().top-20},20,"swing")},20);document.getElementById("comment_text").focus()}
function comment_text_Changed(){var a=document.getElementById("comment_author"),b=document.getElementById("comment_text"),c=b.value,d=c.match(/\n/g),e=!0;"noro"===a.value.trim()?(document.getElementById("author_validate").textContent="\u4f7f\u7528\u3067\u304d\u306a\u3044\u540d\u524d\u3067\u3059\u3002",a.classList.add("is-invalid"),e=!1):20<a.value.trim().length?(document.getElementById("author_validate").textContent="20\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u4e0b\u3055\u3044\u3002",
a.classList.add("is-invalid"),e=!1):a.classList.remove("is-invalid");0===c.trim().length?(document.getElementById("comment_validate").textContent="",b.classList.remove("is-invalid"),e=!1):1E3<c.length?(document.getElementById("comment_validate").textContent="1000\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",b.classList.add("is-invalid"),e=!1):d&&15<=d.length?(document.getElementById("comment_validate").textContent="\u898f\u5b9a\u884c\u6570\u3092\u8d85\u3048\u307e\u3057\u305f\u3002\u884c\u6570\u3092\u6e1b\u3089\u3057\u3066\u4e0b\u3055\u3044\u3002",
b.classList.add("is-invalid"),e=!1):b.classList.remove("is-invalid");document.getElementById("btn_send_comment").disabled=!e;e&&(a.classList.remove("is-invalid"),b.classList.remove("is-invalid"))}
function btn_send_comment_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u30b3\u30e1\u30f3\u30c8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3 font_size_12">\u30fb\u516c\u5e8f\u826f\u4fd7\u306b\u53cd\u3059\u308b\u66f8\u304d\u8fbc\u307f\u306f\u3054\u9060\u616e\u304f\u3060\u3055\u3044\u3002</div>\n\t\t<div class="font_size_12">\u30fb\u9001\u4fe1\u3057\u305f\u5185\u5bb9\u306f\u3001\u539f\u5247\u3042\u3068\u304b\u3089\u5909\u66f4/\u524a\u9664\u306f\u3067\u304d\u307e\u305b\u3093\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t\t<div class="font_size_12">\u30fb\u3069\u3046\u3057\u3066\u3082\u5909\u66f4\u30fb\u524a\u9664\u3057\u305f\u3044\u5834\u5408\u306f\u3054\u9023\u7d61\u304f\u3060\u3055\u3044\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType=
"sendComment";a.modal("show")}
function send_comment(){if(fb){var a=document.getElementById("comment_author").value.trim(),b=document.getElementById("comment_text").value.trim();a||(a="\u540d\u7121\u3057\u3055\u3093");fb.runTransaction(function(c){var d=fb.collection("comments"),e=d.doc();return c.get(e).then(function(){var f,h,k;return $jscomp.asyncExecutePromiseGeneratorProgram(function(l){switch(l.nextAddress){case 1:return l.yield(d.orderBy("createdAt","desc").limit(1).get(),2);case 2:f=l.yieldResult;if(!f){l.jumpTo(0);break}h=
0;return l.yield(Promise.all(f.docs.map(function(n){var m;return $jscomp.asyncExecutePromiseGeneratorProgram(function(p){if(1==p.nextAddress)return p.yield(n.data(),2);if(3!=p.nextAddress)return m=p.yieldResult,p.yield(m.number,3);h=p.yieldResult;p.jumpToEnd()})})),4);case 4:if(!(0<=castInt(h,-1)))return l["return"](Promise.reject("ID\u63a1\u756a\u30a8\u30e9\u30fc :",h));k={number:castInt(h)+1,author:a,content:b,createdAt:firebase.firestore.FieldValue.serverTimestamp()};return l.yield(c.set(e,k),
6);case 6:return l["return"](k)}})})}).then(function(c){document.getElementById("comment_text").value="";document.getElementById("btn_send_comment").disabled=!0})["catch"](function(c){console.error(c);alert("\u30b3\u30e1\u30f3\u30c8\u306e\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")})}else alert("\u8b0e\u306e\u7406\u7531\u306b\u3088\u308a\u3001\u30b3\u30e1\u30f3\u30c8\u306e\u6295\u7a3f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}
function btn_url_shorten_Clicked(){var a,b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress){a=document.getElementById("btn_url_shorten");b=document.getElementById("input_url");c=b.value.trim();if(a.classList.contains("shortening"))return e["return"]();a.classList.add("shortening");a.textContent="\u77ed\u7e2e\u4e2d";return c?c.match(/^(https?|ftp)(:\/\/[-_.!~*'()a-zA-Z0-9;\/?:@&=+\$,%#]+)$/)?c.match(/^(https:\/\/aircalc.page.link\/)([.!~*'()a-zA-Z0-9;\/?:@&=+\$,%#]+)$/)?
e.jumpTo(2):e.yield(postURLData(c).then(function(f){f.error||!f.shortLink?(b.value="",inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")):(b.value=f.shortLink,inform_success("URL\u306e\u77ed\u7e2e\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"))})["catch"](function(f){b.value="";inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}),2):(b.value="",(d=readDeckBuilder(c))?
window.location.href="../simulator/?predeck="+c:readEquipmentJson(c)?inform_success("\u6240\u6301\u88c5\u5099\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"):readShipJson(c)?inform_success("\u6240\u6301\u8266\u5a18\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"):inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),e.jumpTo(2)):(b.value="",inform_warning("URL\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),
e.jumpTo(2))}a.textContent="URL\u77ed\u7e2e";a.classList.remove("shortening");e.jumpToEnd()})}
function public_preset_tab_Shown(){$("#btn_search_preset").parent().removeClass("d-none");$("#map_select").parent().removeClass("d-none");$("#search_preset_parent").addClass("d-none");saveSessionStorage("display_public",!0);if(!$("#map_select").html()){for(var a="",b={},c=$jscomp.makeIterator(WORLD_DATA),d=c.next();!d.done;b={$jscomp$loop$prop$world$13:b.$jscomp$loop$prop$world$13},d=c.next()){d=d.value;b.$jscomp$loop$prop$world$13=d.world;var e=MAP_DATA.filter(function(f){return function(h){return Math.floor(h.area/
10)===f.$jscomp$loop$prop$world$13}}(b));a+='<optgroup label="'+d.name+'">';d=$jscomp.makeIterator(e);for(e=d.next();!e.done;e=d.next())e=e.value,a+='<option value="'+e.area+'">'+(20<b.$jscomp$loop$prop$world$13?"E":b.$jscomp$loop$prop$world$13)+"-"+e.area%10+" : "+e.name+"</option>"}$("#map_select").html(a);if(a=loadSessionStorage("search_result"))$("#map_select").val(a.map),map_select_Changed(),setPresets(a.presets,!1)}}
function public_preset_tab_Hidden(){$("#btn_search_preset").parent().addClass("d-none");$("#map_select").parent().addClass("d-none");$("#search_preset_parent").removeClass("d-none");saveSessionStorage("display_public",!1)}
function site_theme_Changed(a){a=a.attr("id");document.body.classList.remove(setting.themeColor);document.body.classList.add(a);"dark_theme"===a||"dark_gradient_theme"===a||"deep_blue_theme"===a?(mainColor="#e0e0e0",document.body.classList.add("dark-theme")):(mainColor="#000000",document.body.classList.remove("dark-theme"));document.getElementById("input_url").classList.add("form-control-dark");setting.themeColor=a;saveSetting();document.body.style.color=mainColor}
function confirm_tab_close_Clicked(){setting.confirmTabClosing=document.getElementById("confirm_tab_close").checked;saveSetting()}
document.addEventListener("DOMContentLoaded",function(){initialize();document.getElementById("btn_top").addEventListener("click",function(){window.location.href="../list/"});$("#header").on("click",".fleet_tab",topTab_Clicked);$("#main").on("click",".version_detail",version_detail_Clicked);$("#main").on("click",".btn_first_time",first_time_Clicked);$("#main").on("click",".btn_site_manual",site_manual_Clicked);$("#main").on("click",".theme_select",function(){site_theme_Changed($(this))});$("#main").on("input",
"#search_preset",setLocalPresets);$("#main").on("change","#presets_order",setLocalPresets);$("#main").on("click","#btn_search_preset",searchUploadedPreset);$("#main").on("change","#map_select",map_select_Changed);$("#main").on("change","#select_preset_level",function(){$("#btn_search_preset").prop("disabled",!1)});$("#public_presets_container").on("click",".preset_container .btn_open",function(){public_preset_Clicked($(this))});$("#public_presets_container").on("click",".preset_container.more_load",
more_load_presets);$("#presets_container").on("click",".preset_container:not(.editting)",function(){preset_Clicked($(this))});$("#presets_container").on("click",".btn_edit_start",function(a){btn_edit_start_Clicked($(this),a)});$("#presets_container").on("click",".btn_commit",function(a){btn_commit_Clicked($(this),a)});$("#presets_container").on("click",".btn_rollback",function(a){btn_rollback_Clicked($(this),a)});$("#presets_container").on("click",".btn_copy",function(a){btn_copy_Clicked($(this),
a)});$("#presets_container").on("click",".btn_delete",function(a){btn_delete_Clicked($(this),a)});$("#public_preset_tab").on("shown.bs.tab",public_preset_tab_Shown);$("#public_preset_tab").on("hidden.bs.tab",public_preset_tab_Hidden);$("#site_history").on("show.bs.collapse",".collapse",loadSiteHistory);$("#site_board").on("show.bs.collapse",".collapse",initializeBoard);$("#site_board").on("click","#btn_send_comment",btn_send_comment_Clicked);$("#site_board").on("input","#comment_author",comment_text_Changed);
$("#site_board").on("input","#comment_text",comment_text_Changed);$("#site_board").on("click",".comment_index",function(){comment_index_Clicked($(this))});$("#config_content").on("click","#confirm_tab_close",confirm_tab_close_Clicked);$("#config_content").on("click","#btn_reset_localStorage",btn_reset_localStorage_Clicked);$("#btn_url_shorten").click(btn_url_shorten_Clicked);$("#modal_confirm").on("click",".btn_ok",modal_confirm_ok_Clicked)});