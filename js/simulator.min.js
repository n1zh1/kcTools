var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(a){var b=function(){};b.prototype=a;return new b};$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};
$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};
$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&($jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+e,e=
$jscomp.propertyToPolyfillSymbol[e],$jscomp.defineProperty(d,e,{configurable:!0,writable:!0,value:b})))};
$jscomp.getConstructImplementation=function(){function a(){function c(){}new c;Reflect.construct(c,[],function(){});return new c instanceof c}if($jscomp.TRUST_ES6_POLYFILLS&&"undefined"!=typeof Reflect&&Reflect.construct){if(a())return Reflect.construct;var b=Reflect.construct;return function(c,d,e){c=b(c,d);e&&Reflect.setPrototypeOf(c,e.prototype);return c}}return function(c,d,e){void 0===e&&(e=c);e=$jscomp.objectCreate(e.prototype||Object.prototype);return Function.prototype.apply.call(c,e,d)||
e}};$jscomp.construct={valueOf:$jscomp.getConstructImplementation}.valueOf();$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;
$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var c=$jscomp.setPrototypeOf;c(a,b)}else for(c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.superClass_=b.prototype};$jscomp.generator={};
$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};
$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};
$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype["return"]=function(a){this.abruptCompletion_={"return":a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};
$jscomp.generator.Context.prototype.yieldAll=function(a,b){var c=$jscomp.makeIterator(a),d=c.next();$jscomp.generator.ensureIteratorResultIsObject_(d);if(d.done)this.yieldResult=d.value,this.nextAddress=b;else return this.yieldAllIterator_=c,this.yield(d.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){var c=this.finallyContexts_.splice(b||0)[0];if(c=this.abruptCompletion_=this.abruptCompletion_||c){if(c.isException)return this.jumpToErrorHandler_();void 0!=c.jumpTo&&this.finallyAddress_<c.jumpTo?(this.nextAddress=c.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(c){return{value:c,done:!0}},a,this.context_["return"]);this.context_["return"](a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var d=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(d);if(!d.done)return this.context_.stop_(),d;var e=d.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,e);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a["return"],done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this["throw"]=function(b){return a.throw_(b)};this["return"]=function(b){return a.return_(b)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){var c=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&a.prototype&&$jscomp.setPrototypeOf(c,a.prototype);return c};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(d){return a.next(d)}function c(d){return a["throw"](d)}return new Promise(function(d,e){function f(g){g.done?d(g.value):Promise.resolve(g.value).then(b,c).then(f,e)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
var MAX_SLOT=99,IMAGES={},SHOOT_DOWN_TABLE,SHOOT_DOWN_TABLE_ENEMY,AIR_STATUS_TABLE,$target=null,basicSortedPlanes=[],isOut=!1,isDefMode=!1,battleCount=1,displayBattle=1,timer=!1,planePreset=null,initialProf120Plane=[],isCtrlPress=!1,releaseTimer=null,usedPlane=[],usedShip=[],chartInstance=null,subChartInstance=null,resultData={enemyAirPowers:[],enemyAirPowerResults:[],enemySlots:[],enemySlotAllDead:[],landBaseAirPowers:[],landBaseAirStatus:[],fleetAirPower:0,fleetAirStatus:[],fleetSlots:[],defenseAirPower:0,
usedSteels:0},inputAntiAirWeights=[],fleetStage2Table=[],ENEMY_PATTERN=[],Fleet=function(){this.ships=[];this.fullEscortAirPower=this.escortAirPower=this.fullUnionAirPower=this.unionAirPower=this.fullAirPower=this.airPower=0};Fleet.prototype.updateAirPower=function(){this.escortAirPower=this.airPower=this.unionAirPower=0;for(var a=$jscomp.makeIterator(this.ships),b=a.next();!b.done;b=a.next())b=b.value,this.unionAirPower+=b.airPower,b.isEscort?this.escortAirPower+=b.airPower:this.airPower+=b.airPower};
Fleet.prototype.initFullAirPower=function(){this.fullAirPower=this.airPower;this.fullEscortAirPower=this.escortAirPower;this.fullUnionAirPower=this.unionAirPower};var Ship=function(a){this.fleetNo=a;this.planes=[];this.isEscort=!1;this.fullAirPower=this.airPower=0};Ship.prototype.updateAirPower=function(){for(var a=0,b=$jscomp.makeIterator(this.planes),c=b.next();!c.done;c=b.next())a+=c.value.airPower;this.airPower=a};Ship.prototype.initFullAirPower=function(){this.fullAirPower=this.airPower};
var LandBaseAll=function(){this.landBases=[];this.rocketBonus=this.defense2AirPower=this.defenseAirPower=0};
LandBaseAll.prototype.updateDefenseAirPower=function(){for(var a=0,b=0,c=$jscomp.makeIterator(this.landBases),d=c.next();!d.done;d=c.next())if(d=d.value,0===d.mode){b+=d.defenseAirPower;d=$jscomp.makeIterator(d.planes);for(var e=d.next();!e.done;e=d.next())ROCKETS.includes(e.value.id)&&a++}this.rocketBonus=0===a?.5:1===a?.8:2===a?1.1:1.2;this.defenseAirPower=b;this.defense2AirPower=Math.floor(this.rocketBonus*b)};
var LandBase=function(a,b){this.baseNo=a;this.planes=[];this.mode=b;this.target=[-1,-1];this.reconCorr=this.defenseAirPower=this.fullAirPower=this.airPower=0;this.defenseCorr=1;this.results=[];for(var c=0;c<battleCount;c++)this.results.push(new AirStatusResult)};
LandBase.prototype.updateAirPower=function(){for(var a=0,b=$jscomp.makeIterator(this.planes),c=b.next();!c.done;c=b.next())a+=c.value.airPower;b=a;if(1>this.reconCorr){this.reconCorr=1;c=this.planes.filter(function(f){return f.isRecon});var d=$jscomp.makeIterator(c);for(c=d.next();!c.done;c=d.next()){c=getReconnaissancesAdjust(c.value,!1);var e=a*c;e>b&&(b=e,this.reconCorr=c)}}else b=a*this.reconCorr;this.airPower=Math.floor(b)};
LandBase.prototype.updateDefenseAirPower=function(){var a=getArraySum(this.planes.map(function(f){return f.defenseAirPower})),b=a,c=this.planes.filter(function(f){return f.isRecon});c=$jscomp.makeIterator(c);for(var d=c.next();!d.done;d=c.next()){d=getReconnaissancesAdjust(d.value,!0);var e=a*d;e>b&&(b=e,this.reconCorr=d)}this.defenseAirPower=Math.floor(b)};
LandBase.prototype.getRange=function(){for(var a=999,b=1,c=$jscomp.makeIterator(this.planes),d=c.next();!d.done;d=c.next())d=d.value,d.id&&(a=d.radius<a?d.radius:a,d.isRecon&&(b=b<d.radius?d.radius:b));return 999>b&&b>a?Math.round(a+Math.min(Math.sqrt(b-a),3)):999===a?0:a};LandBase.prototype.getSumFuel=function(){return getArraySum(this.planes.map(function(a){return a.fuel}))};LandBase.prototype.getSumAmmo=function(){return getArraySum(this.planes.map(function(a){return a.ammo}))};
LandBase.prototype.getSumBauxite=function(){return getArraySum(this.planes.map(function(a){return a.bauxite}))};
var Plane=function(a,b,c,d){b=void 0===b?0:b;c=void 0===c?0:c;d=void 0===d?0:d;this.id=0;this.name="-";this.avoid=this.accuracy=this.cost=this.radius=this.fullAirPower=this.airPower=this.scout=this.interception=this.antiBomber=this.bonusAntiAir=this.antiAir=this.type=0;this.canBattle=this.isAttacker=this.isRecon=this.isFighter=!1;this.contact=0;this.selectRate=[];this.fullSlot=0;this.slot=b;this.slotNo=this.bonusAirPower=this.bauxite=this.ammo=this.fuel=this.level=this.remodel=0;var e=PLANE_DATA.find(function(f){return f.id===
a});e&&(this.id=e.id,this.name=e.abbr?e.abbr:e.name,this.type=e.type,this.antiAir=e.antiAir,this.antiBomber=e.antiBomber,this.interception=e.interception,this.scout=e.scout,this.radius=e.radius,this.cost=e.cost,this.accuracy=e.accuracy,this.avoid=e.avoid,this.isFighter=FIGHTERS.includes(e.type),this.isAttacker=ATTACKERS.includes(e.type),this.isRecon=RECONNAISSANCES.includes(e.type),this.canBattle=!this.isRecon,this.remodel=c,this.level=d,this.validateSlot(b),this.calcBonusAirPower(),this.bonusAntiAir=
Plane.getBonusAntiAir(this.id,this.type,this.remodel,this.antiAir),this.antiAir+=this.bonusAntiAir,this.updateAirPower(),0<this.slot&&(this.contact=this.isRecon?Math.floor(this.scout*Math.sqrt(this.slot)):0,this.selectRate=getContactSelectRate(this)),b=[101,-101,105].includes(this.type),this.fuel=Math.ceil(this.slot*(b?1.5:1)),this.ammo=b?Math.floor(.7*this.slot):Math.ceil(.6*this.slot),this.bauxite=this.cost*(this.isRecon?4:105===this.type?9:18),this.fullAirPower=this.airPower)};
Plane.prototype.updateAirPower=function(){this.isRecon||0>=this.slot||0===this.id?(this.airPower=0,0>this.slot&&(this.slot=0)):this.airPower=Math.floor(this.antiAir*Math.sqrt(this.slot)+this.bonusAirPower)};
Plane.prototype.calcBonusAirPower=function(){if(0===this.id||0===this.slot)return 0;var a=this.type,b=this.level,c=0;if(this.isFighter)switch(b){case 7:c+=22;break;case 2:c+=2;break;case 3:c+=5;break;case 4:c+=9;break;case 5:c+=14;break;case 6:c+=14}else if(6===a)switch(b){case 2:c+=1;break;case 3:c+=1;break;case 4:c+=1;break;case 5:c+=3;break;case 6:c+=3;break;case 7:c+=6}this.bonusAirPower=c+=Math.sqrt(getInnerProficiency(b,a)/10)};
Plane.getBonusAntiAir=function(a,b,c,d){var e=0;FIGHTERS.includes(b)?e=.2*c:3===b&&2<d&&316!==a?e=.25*c:101===b&&(e=.5*Math.sqrt(c));return e};Plane.prototype.validateSlot=function(a){a=castInt(a);this.fullSlot=a>MAX_SLOT?this.slot=MAX_SLOT:this.slot=a};var ShipPlane=function(a,b,c,d){Plane.call(this,a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d);this.results=[0,0,0,0,0,0,0,0,0,0]};$jscomp.inherits(ShipPlane,Plane);
var LandBasePlane=function(a,b,c,d){Plane.call(this,a,void 0===b?0:b,void 0===c?0:c,void 0===d?0:d);this.defenseAirPower=0;this.updateDefenseAirPower()};$jscomp.inherits(LandBasePlane,Plane);
LandBasePlane.prototype.updateAirPower=function(){if(0>=this.slot)this.slot=this.airPower=0;else{var a=this.bonusAirPower;a=this.isFighter?a+(this.antiAir+1.5*this.interception)*Math.sqrt(this.slot):104===this.type?a+(this.antiAir*Math.sqrt(this.slot)+(2<=this.remodel&&4===this.slot?1:0)):138===this.id?a+(this.antiAir*Math.sqrt(this.slot)+(4<=this.remodel&&4===this.slot?1:0)):a+this.antiAir*Math.sqrt(this.slot);this.airPower=Math.floor(a)}};
LandBasePlane.prototype.updateDefenseAirPower=function(){if(0===this.id||0>=this.slot)this.slot=this.defenseAirPower=0;else{var a=this.bonusAirPower;a=this.isFighter?a+(this.antiAir+this.interception+2*this.antiBomber)*Math.sqrt(this.slot):104===this.type?a+(this.antiAir*Math.sqrt(this.slot)+(2<=this.remodel&&4===this.slot?1:0)):138===this.id?a+(this.antiAir*Math.sqrt(this.slot)+(4<=this.remodel&&4===this.slot?1:0)):a+this.antiAir*Math.sqrt(this.slot);this.defenseAirPower=Math.floor(a)}};
LandBasePlane.prototype.validateSlot=function(a){a=castInt(a);this.fullSlot=0===a?this.slot=0:this.isRecon&&4<a?this.slot=4:105===this.type&&9<a?this.slot=9:18<a?this.slot=18:this.slot=a};var AirStatusResult=function(){this.mainAirPower=[0,0];this.enemyAirPower=[0,0];this.airStatusIndex=[[0,0,0,0,0,0],[0,0,0,0,0,0]]};
function isContain(a,b){for(var c=$jscomp.makeIterator(a),d=c.next();!d.done;d=c.next()){d=d.value;for(var e=$jscomp.makeIterator(b),f=e.next();!f.done;f=e.next())if(d===f.value)return!0}return!1}function shuffleArray(a){for(var b=a.length-1;0<b;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}}function copyInputTextToClipboard(a){try{if(!a.attr("id"))return!1;document.getElementById(a.attr("id")).select();return document.execCommand("copy")}catch(b){return!1}}
function getArraySum(a){for(var b=0,c=a.length;c--;)b+=a[c];return b}function getArrayMax(a){for(var b=-Infinity,c=a.length;c--;)a[c]>b&&(b=a[c]);return b}function getArrayMin(a){for(var b=Infinity,c=a.length;c--;)a[c]<b&&(b=a[c]);return b}function hexToRGB(a){"#"==a.slice(0,1)&&(a=a.slice(1));3==a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,2)+a.slice(1,2)+a.slice(2,3)+a.slice(2,3));return[a.slice(0,2),a.slice(2,4),a.slice(4,6)].map(function(b){return parseInt(b,16)})}
function setPreCalculateTable(){if(!AIR_STATUS_TABLE){AIR_STATUS_TABLE=[];for(var a=0;1E3>=a;a++){for(var b=new Uint16Array(Math.max(3*a+1,2)),c=0;c<=b.length;c++)if(0===a&&0===c)b[c]=5;else if(a>=3*c)b[c]=0;else if(2*a>=3*c)b[c]=1;else if(3*a>2*c)b[c]=2;else if(3*a>c)b[c]=3;else{b[c]=4;break}AIR_STATUS_TABLE.push(b)}}if(!SHOOT_DOWN_TABLE)for(SHOOT_DOWN_TABLE=[],a=[1,3,5,7,10],b=0;b<=MAX_SLOT;b++){c=[];for(var d=$jscomp.makeIterator(a),e=d.next();!e.done;e=d.next()){e=e.value;for(var f=e/3,g=[],h=
0;h<=f;h+=.01)g.push(b*(h+e/4)/10);-1===g.findIndex(function(k){return 1<=k})?g=[0]:shuffleArray(g);c.push(g)}SHOOT_DOWN_TABLE.push(c)}if(!SHOOT_DOWN_TABLE_ENEMY){SHOOT_DOWN_TABLE_ENEMY=[];a=0;b=ENEMY_DATA.length;for(c=0;c<b;c++)for(d=ENEMY_DATA[c].slot.length,e=0;e<d;e++)a<ENEMY_DATA[c].slot[e]&&(a=ENEMY_DATA[c].slot[e]);for(b=0;b<=a;b++){c=[];d=AIR_STATUS.length;for(e=0;e<d;e++){f=[];for(h=g=AIR_STATUS[e].rate;0<=h;h--)for(var l=0;l<=g;l++)f.push(Math.floor(b*(.65*h+.35*l)/10));-1===f.findIndex(function(k){return 1<=
k})?f=[0]:shuffleArray(f);c.push(f)}SHOOT_DOWN_TABLE_ENEMY.push(c)}}window.clearTimeout(releaseTimer);releaseTimer=setTimeout(function(){SHOOT_DOWN_TABLE_ENEMY=SHOOT_DOWN_TABLE=AIR_STATUS_TABLE=null},18E4)}function getPlanes(a){var b=[];return b=0===a?basicSortedPlanes.concat():PLANE_DATA.filter(function(c){return Math.abs(c.type)===Math.abs(castInt(a))})}
function getPlanesForIcon(a){var b=[];return b=0===a?basicSortedPlanes.concat():3===a?PLANE_DATA.filter(function(c){return 3===c.type||9===c.type}):4===a?PLANE_DATA.filter(function(c){return 4===c.type||104===c.type}):5===a?PLANE_DATA.filter(function(c){return[5,6,7,8].includes(c.type)}):101===a?PLANE_DATA.filter(function(c){return[101,-101,105].includes(c.type)}):PLANE_DATA.filter(function(c){return Math.abs(c.type)===Math.abs(castInt(a))})}
function getPlaneCss(a){var b=PLANE_TYPE.find(function(c){return c.id===castInt(a)});return b?b.css:""}function getProfString(a){switch(a){case 1:return"|";case 2:return"||";case 3:return"|||";case 4:return"/";case 5:return"//";case 6:return"///";case 7:return">>"}return""}
function replaceKnji(a){a&&(a=a.replace("601","\u516d\u3007\u4e00"),a=a.replace("634","\u516d\u4e09\u56db"),a=a.replace("931","\u4e5d\u4e09\u4e00"),a=a.replace("22","\u4e8c\u4e8c"),a=a.replace("34","\u4e09\u56db"),a=a.replace("96","\u4e5d\u516d"),a=a.replace("97","\u4e5d\u4e03"),a=a.replace("99","\u4e5d\u4e5d"));return a}
function checkInvalidPlane(a,b){if(-1===a)return!0;if(0===a&&100<Math.abs(b.type))return!1;if(0===a)return!0;var c=SHIP_DATA.find(function(h){return h.id===a}),d=LINK_SHIP_EQUIPMENT.find(function(h){return h.type===c.type}),e=SPECIAL_LINK_SHIP_EQUIPMENT.find(function(h){return h.shipId===c.id}),f=[];if(d){d=$jscomp.makeIterator(d.e_type);for(var g=d.next();!g.done;g=d.next())f.push(g.value);if(e)for(d=$jscomp.makeIterator(e.equipmentTypes),g=d.next();!g.done;g=d.next())f.push(g.value)}return f.includes(Math.abs(b.type))?
151===b.id?e?e.equipmentIds.includes(b.id):!1:!0:e&&e.equipmentIds.includes(b.id)}function validateInputNumber(a,b,c){c=void 0===c?0:c;return(new RegExp(/^[0-9]+$/)).test(a)?a>b?b:a<c?c:castInt(a):c}function validateInputNumberFloat(a,b,c){c=void 0===c?0:c;var d=new RegExp(/^\d+(\.\d+)?$/);5<a.length?a=a.slice(0,5):0===a.length&&(a="0");return d.test(a)?a>b?b:a<c?c:castFloat(a):c}
function initialize(a){var b="";for(b=0;b<PLANE_TYPE.length;b++){var c=new Image,d=PLANE_TYPE[b].id;c.src="../img/type/type"+d+".png";IMAGES["type"+d]=c}if(c=loadLocalStorage("manual_enemies"))for(c=c.filter(function(k){return UNKNOWN_ENEMY.includes(k.id)}),saveLocalStorage("manual_enemies",c),b={},c=$jscomp.makeIterator(c),d=c.next();!d.done;b={$jscomp$loop$prop$enemy$304:b.$jscomp$loop$prop$enemy$304},d=c.next())b.$jscomp$loop$prop$enemy$304=d.value,UNKNOWN_ENEMY.includes(b.$jscomp$loop$prop$enemy$304.id)&&
(d=ENEMY_DATA.findIndex(function(k){return function(m){return m.id===k.$jscomp$loop$prop$enemy$304.id}}(b)),ENEMY_DATA[d]=b.$jscomp$loop$prop$enemy$304);b=PLANE_TYPE.filter(function(k){return 0<k.id}).map(function(k){return k.id});setPlaneTypeIconSelect(document.getElementById("plane_type_select"),b);setPlaneType(document.getElementById("stock_type_select"),b);setPlaneTypeIconSelect(document.getElementById("draggable_plane_type_select"),b,!0);$("#plane_filter_key_select").val("radius");$("#plane_filter_value").val(0);
b=document.getElementById("stock_type_select").getElementsByTagName("option");c={};b=$jscomp.makeIterator(b);for(d=b.next();!d.done;c={$jscomp$loop$prop$option$306:c.$jscomp$loop$prop$option$306},d=b.next())c.$jscomp$loop$prop$option$306=d.value,basicSortedPlanes=basicSortedPlanes.concat(PLANE_DATA.filter(function(k){return function(m){return Math.abs(m.type)===castInt(k.$jscomp$loop$prop$option$306.value)}}(c)));setShipType(SHIP_TYPE.map(function(k){return k.id}));setEnemyType(ENEMY_TYPE.filter(function(k){return 0<
k.id}).map(function(k){return k.id}));document.getElementById("display_final").checked=setting.visibleFinal;document.getElementById("frequent_ship").checked=setting.orderByFrequency;b=document.getElementById("lb_info_table").getElementsByTagName("tbody")[0].innerHTML;for(c=0;2>c;c++)document.getElementById("lb_info_table").getElementsByTagName("tbody")[0].innerHTML+=b;b=document.getElementsByClassName("lb_info_tr");for(c=0;c<b.length;c++)d=b[c],d.classList.add("lb_info_lb_"+(Math.floor(c/4)+1)),d=
d.getElementsByClassName("info_name"),d.length&&(d[0].textContent="\u7b2c"+(Math.floor(c/4)+1)+"\u57fa\u5730\u822a\u7a7a\u968a");b=document.getElementsByClassName("display_ship_count");b=$jscomp.makeIterator(b);for(c=b.next();!c.done;c=b.next())c.value.value=2;b=$("#battle_container").html();for(c=1;10>c;c++)$("#battle_container").append(b);$(".battle_content").each(function(k,m){$(m).find(".battle_no").text(k+1);0<k&&$(m).addClass("d-none");$(m).find(".custom-control-input").attr("id","grand_"+k);
$(m).find(".custom-control-label").attr("for","grand_"+k)});$("#battle_count").val(1);$("#display_bar").prop("checked",!0);$("#display_land_base_result").prop("checked",!0);$("#display_fleet_result").prop("checked",!0);$("#display_enemy_table").prop("checked",!0);$(".remodel_select").prop("disabled",!0);$(".progress_area").html($(".progress_area:first").html());$(".progress_area").each(function(k,m){$(m).find(".result_bar").attr("id","result_bar_"+(k+1));6>k&&$(m).find(".progress_label").text("\u57fa\u5730"+
(Math.floor(k/2)+1)+" "+(k%2+1)+"\u6ce2\u76ee");6===k&&$(m).find(".progress_label").text("\u672c\u968a");7===k&&$(m).find(".progress_label").text("\u9632\u7a7a")});for(var e=d=c=b="",f=1;10>=f;f++)b+='<td class="td_battle battle'+f+'">'+f+"\u6226\u76ee</td>",c+='<td class="td_battle battle'+f+' fap"></td>',d+='<td class="td_battle battle'+f+' eap"></td>',e+='<td class="td_battle battle'+f+' cond"></td>';$("#shoot_down_table").find(".tr_header").append(b+'<td class="td_battle battle_end">\u51fa\u6483\u5f8c</td><td class="td_battle battle_death">\u5168\u6ec5\u7387</td>');
$(".tr_fap").append(c+'<td class="td_battle battle_end fap font_size_11" colspan="2"></td>');$(".tr_eap").append(d+'<td class="td_battle battle_end eap" rowspan="2" colspan="2"></td>');$(".tr_cond").append(e);b="";for(c=1;10>=c;c++)b+='\n\t\t\t<li class="nav-item '+(1===c?"":"d-none")+'">\n\t\t\t\t<a class="nav-link '+("#000000"===mainColor?"":"nav-link-dark")+" "+(1===c?"active":"")+'" data-toggle="tab" data-disp="'+c+'" href="#">'+c+"\u6226\u76ee</a>\n\t\t\t</li>";$("#display_battle_tab").html(b);
b=$("#rate_table").find("thead").html();for(c=0;7>=c;c++)$("#rate_table tbody").append(b);$("#rate_table tbody").find("tr").each(function(k,m){var n=Math.floor(k/2)+1,r=k%2+1;$(m).attr("id","rate_row_"+(k+1));6>k?($(m).find(".rate_td_name").html('<span class="mr-1">\u57fa\u5730'+n+'</span><span class="text-nowrap">'+r+"\u6ce2\u76ee</span>"),$(m)[0].dataset.base_no=n-1,$(m).addClass("cur_pointer land_base_detail")):6===k?$(m).find(".rate_td_name").text("\u672c\u968a"):7===k&&$(m).find(".rate_td_name").text("\u9632\u7a7a");
0===k%2?$(m).addClass("rate_tr_border_top"):6<=k&&$(m).addClass("rate_tr_border_top rate_tr_border_bottom")});b=$("#init_prof_parent").html();c=PLANE_TYPE.filter(function(k){return 0<k.id&&104!==k.id});c=$jscomp.makeIterator(c);for(d=c.next();!d.done;d=c.next())d=d.value,$("#init_prof_parent").append(b),e=$("#init_prof_parent").find(".type_name:last"),e.text(d.abbr),e.closest(".init_prof")[0].dataset.typeid=d.id;$("#init_prof_parent").find(".init_prof:first").remove();b=$jscomp.makeIterator(setting.defaultProf);
for(c=b.next();!c.done;c=b.next())c=c.value,proficiency_Changed($('.init_prof[data-typeid="'+c.id+'"').find('.prof_opt[data-prof="'+c.prof+'"]').parent(),!0);if(setting.contentsOrder.length){b=$("#main");var g=[];c=[];var h=[];e=$("#main_footer");b.find(".contents").each(function(k,m){g.push($(m).attr("id"));h.push($(m))});b.empty();f={};var l=$jscomp.makeIterator(setting.contentsOrder);for(d=l.next();!d.done;f={$jscomp$loop$prop$id$129$308:f.$jscomp$loop$prop$id$129$308},d=l.next())f.$jscomp$loop$prop$id$129$308=
d.value,g.includes(f.$jscomp$loop$prop$id$129$308)&&(d=h.find(function(k){return function(m){return m.attr("id")===k.$jscomp$loop$prop$id$129$308}}(f)),b.append(d),c.push(f.$jscomp$loop$prop$id$129$308));b.append(e);if(g.length!==c.length){e={};f=$jscomp.makeIterator(g);for(d=f.next();!d.done;e={$jscomp$loop$prop$id$130$310:e.$jscomp$loop$prop$id$130$310},d=f.next())e.$jscomp$loop$prop$id$130$310=d.value,c.includes(e.$jscomp$loop$prop$id$130$310)||(d=h.find(function(k){return function(m){return m.attr("id")===
k.$jscomp$loop$prop$id$130$310}}(e)),b.append(d),c.push(e.$jscomp$loop$prop$id$130$310));setting.contentsOrder=c.concat();saveSetting()}}$("#stage2_detail_slot").val(18);$("#stage2_detail_avoid").val(0);setting.simulateCount?$("#calculate_count").val(setting.simulateCount):$("#calculate_count").val(5E3);setting.initialProf120&&(initialProf120Plane=setting.initialProf120);b=$jscomp.makeIterator(initialProf120Plane);for(d=b.next();!d.done;d=b.next())$("#prof120_"+d.value).prop("checked",!0);setting.displayMode?
Object.keys(setting.displayMode).forEach(function(k){$("#"+k+' .toggle_display_type[data-mode="'+setting.displayMode[k]+'"]').addClass("selected")}):$('.toggle_display_type[data-mode="single"]').addClass("selected");b='<option value="0">\u4e0d\u767a</option>';c=$jscomp.makeIterator(ANTIAIR_CUTIN);for(d=c.next();!d.done;d=c.next())d=d.value,b+='<option value="'+d.id+'">'+d.name+"\uff08\u5909\u52d5: "+d.adj[0]+" \u56fa\u5b9a: "+d.adj[1]+")</option>";$(".select_antiair_cutin_td").html(b);$("#union_fleet").prop("checked",
setting.isUnion);$("#clipboard_mode").prop("checked",setting.copyToClipboard);$("#air_raid_max").prop("checked",setting.airRaidMax);$("#empty_slot_invisible").prop("checked",setting.emptySlotInvisible);$("#fav_only").prop("checked",setting.favoriteOnly);$("#fav_only_ship").prop("checked",setting.favoriteOnlyShip);$("#disp_in_stock").prop("checked",setting.inStockOnly);$("#divide_stock").prop("checked",setting.isDivideStock);$("#disp_in_stock_ship").prop("checked",setting.inStockOnlyShip);$("#disp_equipped").prop("checked",
setting.visibleEquipped);$("#disp_equipped_ship").prop("checked",setting.visibleEquippedShip);$("#enemy_display_image").prop("checked",setting.enemyDisplayImage);$("#enemy_display_text").prop("checked",!setting.enemyDisplayImage);$("#enemy_fleet_display_image").prop("checked",setting.enemyFleetDisplayImage);$("#enemy_fleet_display_text").prop("checked",!setting.enemyFleetDisplayImage);$("#select_difficulty").val(4);$("#plane_word").val("");$("#ship_word").val("");$("#enemy_word").val("");$("#stock_word").val("");
$("#modal_auto_expand").find(".custom-control-input").prop("checked",!1);$("#btn_start_auto_expand").prop("disabled",!0);$("#mode_1").prop("checked",!0);$("#dest_ap").val(100);$("#dest_range").val(6);"none"===$("#lb_tab_select").css("display")||$("#lb_item1").attr("class").includes("tab-pane")||($(".lb_tab").addClass("tab-pane fade"),$(".baseNo").removeClass("cur_move sortable_handle"),$(".lb_tab:first").addClass("show active"),$("#lb_item1").addClass("active"));$('[data-toggle="tooltip"]').tooltip();
Chart.plugins.unregister(ChartDataLabels);a()}
function setPlaneType(a,b,c){a.innerHTML="";void 0!==c&&c||(c=document.createElement("option"),c.value="0",c.textContent="\u5168\u3066",a.appendChild(c));isContain(b,[100,101,102,103,104,105])&&(c=document.createElement("optgroup"),c.label="\u9678\u4e0a\u6a5f",c.className="optg_lb",a.appendChild(c));isContain(b,[1,2,3,4,9])&&(c=document.createElement("optgroup"),c.label="\u8266\u4e0a\u6a5f",c.className="optg_cb",a.appendChild(c));isContain(b,[5,6,7,8])&&(c=document.createElement("optgroup"),c.label=
"\u6c34\u4e0a\u6a5f",c.className="optg_sp",a.appendChild(c));c=$jscomp.makeIterator(PLANE_TYPE);for(var d=c.next();!d.done;d=c.next())if(d=d.value,b.includes(d.id)){var e=document.createElement("option");e.value=d.id;e.textContent=d.name;[1,2,3,4,9].includes(d.id)?a.getElementsByClassName("optg_cb")[0].appendChild(e):[5,6,7,8].includes(d.id)?a.getElementsByClassName("optg_sp")[0].appendChild(e):a.getElementsByClassName("optg_lb")[0].appendChild(e)}}
function setPlaneTypeIconSelect(a,b,c){a.innerHTML=(void 0===c?0:c)?"":'\n\t\t<li class="nav-item">\n\t\t\t<a class="nav-link active" data-toggle="tab" data-type="0" href="#">\n\t\t\t\t<img src="../img/type/all.png" class="img-size-25" alt="\u5168\u3066">\n\t\t\t</a>\n\t\t</li>';c=document.createDocumentFragment();var d=PLANE_TYPE.filter(function(l){return![6,7,8,9,104,105].includes(l.id)});document.createElement("li").className="nav-item";d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())if(e=
e.value,b.includes(e.id)){var f=document.createElement("li");f.className="nav-item";var g=document.createElement("a");g.href="#";g.className="nav-link";g.dataset.toggle="tab";g.dataset.type=e.id;var h=document.createElement("img");h.classList="img-size-25";h.src="../img/type/type"+e.id+".png";h.alt=e.name;g.appendChild(h);f.appendChild(g);c.appendChild(f)}a.appendChild(c)}
function setShipType(a){for(var b=$jscomp.makeIterator(SHIP_TYPE),c=b.next();!c.done;c=b.next())if(c=c.value,a.includes(c.id)){var d=document.createElement("option");d.value=c.id;d.textContent=c.name;document.getElementById("ship_type_select").appendChild(d);d=document.createElement("option");d.value=c.id;d.textContent=c.name;document.getElementById("ship_stock_type_select").appendChild(d)}}
function setEnemyType(a){for(var b=document.getElementById("enemy_type_select"),c=$jscomp.makeIterator(ENEMY_TYPE),d=c.next();!d.done;d=c.next())if(d=d.value,a.includes(d.id)){var e=document.createElement("option");e.value=d.id;e.textContent=d.name;b.appendChild(e.cloneNode(!0))}b.options[2].selected=!0}
function clearPlaneDiv(a){a.removeClass(getPlaneCss(a[0].dataset.type));a[0].dataset.planeid="";a[0].dataset.type="";a.find(".plane_img").attr("src","../img/type/undefined.png").attr("alt","");a.find(".cur_move").removeClass("cur_move");a.find(".drag_handle").removeClass("drag_handle");a.find(".plane_name_span").text("\u6a5f\u4f53\u3092\u9078\u629e");a.find(".remodel_select").prop("disabled",!0).addClass("remodel_disabled");a.find(".remodel_value").text(0);a.find(".btn_remove_plane").addClass("opacity0");
a=a.find(".prof_select");a.attr("src","../img/util/prof0.png").attr("alt","");a[0].dataset.prof=0}function clearPlaneDivAll(a){"landBase"===a.attr("id")?($(".lb_plane").each(function(b,c){return setLBPlaneDiv($(c))}),$("#modal_collectively_setting").modal("hide")):"friendFleet"===a.attr("id")&&$(".ship_plane").each(function(b,c){return clearPlaneDiv($(c))})}
function setLBPlaneDiv(a,b){b=void 0===b?{id:0,slot:0,remodel:0}:b;var c=castInt(b.id),d=PLANE_DATA.find(function(g){return g.id===c}),e=setPlaneDiv(a,b);b.hasOwnProperty("slot")||(b.slot=0);var f=18;e&&d&&(RECONNAISSANCES.includes(d.type)?f=4:105===d.type&&(f=9));a.find(".slot_input").attr("max",f);a.find(".slot_range").attr("max",f);d=b.slot;if(0===d||d>f)d=f;e||(d=0);a.find(".slot").text(d)}
function setPlaneDiv(a,b,c){b=void 0===b?{id:0,remodel:0,prof:-1}:b;c=void 0===c?!1:c;if(!b.id)return clearPlaneDiv(a),!1;var d=PLANE_DATA.find(function(g){return g.id===b.id});if(!d)return clearPlaneDiv(a),!1;b.hasOwnProperty("remodel")||(b.remodel=0);b.hasOwnProperty("prof")||(b.prof=-1);if(0<a.closest(".ship_tab").length){var e=castInt(a.closest(".ship_tab")[0].dataset.shipid);if(!checkInvalidPlane(e,d))return clearPlaneDiv(a),!1;8!==d.type||1490!==e&&386!==e||(b.hasOwnProperty("slot"),b.slot=
1,c=!0)}a.removeClass(getPlaneCss(a[0].dataset.type)).addClass(getPlaneCss(d.type));a[0].dataset.planeid=d.id;a[0].dataset.type=d.type;a.find(".plane_name_span").text(d.abbr?d.abbr:d.name).attr("title",d.abbr?d.name:"");a.find(".plane_img").attr("src","../img/type/type"+d.type+".png").attr("alt",d.type);a.find(".plane_img").parent().addClass("cur_move drag_handle");a.find(".plane_name").addClass("drag_handle");a.find(".btn_remove_plane").removeClass("opacity0");e=a.find(".remodel_select");e.prop("disabled",
!d.canRemodel);d.canRemodel?(e.removeClass("remodel_disabled"),e.find(".remodel_value").text(Math.min(b.remodel,10))):(e.addClass("remodel_disabled"),e.find(".remodel_value").text(0));e=0;var f=setting.defaultProf.find(function(g){return g.id===Math.abs(d.type)});f&&(e=f.prof);312===d.id&&(e=2);0<=b.prof&&(e=b.prof);f=a.find(".prof_select");f.attr("src","../img/util/prof"+e+".png");f[0].dataset.prof=e;c&&(b.hasOwnProperty("slot")||(b.slot=0),a.find(".slot").text(b.slot));return!0}
function setShipDiv(a,b){var c=SHIP_DATA.find(function(d){return d.id===b});c&&(a[0].dataset.shipid=c.id,a.find(".ship_img").attr("src","../img/ship/"+b+".png"),a.find(".sortable_handle").removeClass("d-none"),a.find(".ship_name_span").text(c.name),a.find(".ship_plane").each(function(d,e){var f=$(e),g={id:castInt(f[0].dataset.planeid),remodel:castInt(f.find(".remodel_value").text()),prof:castInt(f.find(".prof_select")[0].dataset.prof)};a[0].dataset.shipid&&setPlaneDiv(f,g);d<c.slot.length?(f.removeClass("d-none").addClass("d-flex"),
f.find(".slot").text(c.slot[d]),f.find(".slot_select_parent").data("ini",c.slot[d])):(clearPlaneDiv(f),f.removeClass("d-flex").addClass("d-none"),f.find(".slot").text(0),f.find(".slot_select_parent").data("ini",0))}))}
function clearShipDiv(a){a[0].dataset.shipid="";a.find(".sortable_handle").addClass("d-none");a.find(".ship_img").attr("src","../img/ship/0.png");a.find(".ship_name_span").text("\u8266\u5a18\u3092\u9078\u629e");a.find(".ship_plane").each(function(b,c){var d=$(c);clearPlaneDiv(d);d.find(".slot").text(0);d.find(".slot_input").attr("max",99);d.find(".slot_range").attr("max",99);4>b?d.removeClass("d-none").addClass("d-flex"):d.removeClass("d-flex").addClass("d-none")})}
function clearShipDivAll(a){a=void 0===a?2:a;$(".ship_tab").each(function(b,c){return clearShipDiv($(c))});$(".display_ship_count").each(function(b,c){$(c).val(a);display_ship_count_Changed($(c),!0)})}
function setEnemyDiv(a,b,c){c=void 0===c?0:c;if(a){var d=createEnemyObject(b),e=!setting.enemyFleetDisplayImage;0!==d.id&&(a[0].dataset.enemyid=d.id,a.removeClass("d-none no_enemy").addClass("d-flex"),a.find(".enemy_name_text").html(drawEnemyGradeColor(d.name)),a.find(".enemy_name_img").attr("src","../img/enemy/"+d.id+".png"),e?(a.addClass("py-0_5").removeClass("pb-0_1 min-h-31px"),a.find(".enemy_name_img_parent").addClass("d-none").removeClass("d-flex"),a.find(".enemy_name_text").removeClass("d-none")):
(a.removeClass("py-0_5").addClass("pb-0_1 min-h-31px"),a.find(".enemy_name_img_parent").addClass("d-flex").removeClass("d-none"),a.find(".enemy_name_text").addClass("d-none")),e=0,-1===b&&0<c?e=c:0<d.ap?e=d.ap:0<d.lbAp&&(e="("+d.lbAp+")"),a.find(".enemy_ap").text(e))}}
function clearEnemyDiv(a){a[0].dataset.enemyid=0;a.addClass("no_enemy");a.addClass("py-0_5").removeClass("pb-0_1 min-h-31px");a.find(".enemy_name_img_parent").addClass("d-none").removeClass("d-flex");a.find(".enemy_name_img").attr("src","../img/enemy/-1.png");a.find(".enemy_name_text").removeClass("d-none");a.find(".enemy_name_text").text("\u6575\u8266\u3092\u9078\u629e");a.find(".enemy_ap").text(0)}
function clearEnemyDivAll(a){a=void 0===a?1:a;$(".battle_content").each(function(b,c){$(c)[0].dataset.celldata="";$(c).find(".enemy_content").each(function(d,e){return clearEnemyDiv($(e))})});$("#battle_count").val(a);createEnemyInput(a);clearEnemyDiv($("#air_raid_enemies").find(".enemy_content"))}
function drawChangeValue(a,b,c,d){d=void 0===d?!1:d;castInt(b)!==castInt(c)?(a=$(a),a.text(c).stop(),d?a.css("color",c<b?"#0c5":c>b?"#f00":mainColor):a.css("color",c>b?"#0c5":c<b?"#f00":mainColor),a.delay(500).animate({color:mainColor},1E3)):$(a).css("color",mainColor)}
function drawEnemyGradeColor(a){a.includes("elite")?a=a.replace("elite",'<span class="text-danger">elite</span>'):a.includes("\u6539flagship")?a=a.replace("flagship",'<span class="text-primary">flagship</span>'):a.includes("flagship")&&(a=a.replace("flagship",'<span class="text-warning">flagship</span>'));return a}
function createPlaneTable(a){var b=$("#modal_plane_select").find(".modal-dialog"),c=$("#plane_tbody"),d=document.getElementById("plane_tbody"),e=document.createDocumentFragment(),f=b.find(".toggle_display_type.selected").data("mode"),g=loadPlaneStock(),h=setting.inStockOnly,l=setting.isDivideStock,k=setting.visibleEquipped,m=setting.favoriteOnly,n=$("#plane_sort_select").val(),r=usedPlane.concat();"multi"===f?(b.addClass("modal-xl"),c.addClass("multi_mode"),c.prev().addClass("d-none").removeClass("d-flex")):
(b.removeClass("modal-xl"),c.removeClass("multi_mode"),c.prev().addClass("d-flex").removeClass("d-none"));h?($("#divide_stock").closest("div").removeClass("d-none"),$("#disp_equipped").closest("div").removeClass("d-none"),$("#disp_in_stock").prop("checked",!0)):($("#divide_stock").closest("div").addClass("d-none"),$("#disp_equipped").closest("div").addClass("d-none"),$("#disp_in_stock").prop("checked",!1));b=a.length;var p=0;c=0;for(var q=-1,t=0,u={},x=0;x<b;u={$jscomp$loop$prop$plane$314:u.$jscomp$loop$prop$plane$314},
x++){u.$jscomp$loop$prop$plane$314=a[x];var w=u.$jscomp$loop$prop$plane$314.antiAir+1.5*u.$jscomp$loop$prop$plane$314.interception,v=u.$jscomp$loop$prop$plane$314.antiAir+u.$jscomp$loop$prop$plane$314.interception+2*u.$jscomp$loop$prop$plane$314.antiBomber;if(!m||setting.favoritePlane.includes(u.$jscomp$loop$prop$plane$314.id)){if(h&&g){var y=r.find(function(C){return function(E){return E.id===C.$jscomp$loop$prop$plane$314.id}}(u));if(l){q=u.$jscomp$loop$prop$plane$314.count-(y?y.num[u.$jscomp$loop$prop$plane$314.remodel]:
0);if(!k&&1>q)continue;c=u.$jscomp$loop$prop$plane$314.remodel}else{var A=g.find(function(C){return function(E){return E.id===C.$jscomp$loop$prop$plane$314.id}}(u)),B=y?getArraySum(y.num):0;t=A?getArraySum(A.num):0;if(0>=t||!k&&B>=t)continue;q=t-B;for(t=10;0<=t;t--)if(y&&(A.num[t]-=y.num[t]),0<A.num[t]){c=t;break}}}y=document.createElement("div");y.className="plane plane_tr general_tr d-flex py-2 py-lg-1"+("multi"===f?" tr_multi":"");y.dataset.planeid=u.$jscomp$loop$prop$plane$314.id;y.dataset.type=
u.$jscomp$loop$prop$plane$314.type;y.dataset.remodel=c;h&&k&&0>=q&&(y.classList.remove("plane_tr","plane","general_tr"),y.classList.add("plane_tr_disabled"));A=document.createElement("div");A.className="align-self-center size-25";t=document.createElement("canvas");B=t.getContext("2d");t.width=25;t.height=25;B.drawImage(IMAGES["type"+u.$jscomp$loop$prop$plane$314.type],0,0,25,25);var z=document.createElement("div");z.className="pl-1 plane_td_name align-self-center";z.textContent=u.$jscomp$loop$prop$plane$314.name;
B=document.createElement("div");B.className="ml-1 plane_td_stock align-self-center";B.textContent="\u00d7"+(0<q?q:0);var D=document.createElement("div");D.className="ml-auto plane_td_basic align-self-center";switch(n){case "battle_anti_air":D.textContent=w%1?w.toFixed(1):w;break;case "defense_anti_air":D.textContent=v%1?v.toFixed(1):v;break;default:D.textContent=u.$jscomp$loop$prop$plane$314.antiAir%1?u.$jscomp$loop$prop$plane$314.antiAir.toFixed(1):u.$jscomp$loop$prop$plane$314.antiAir}w=document.createElement("div");
w.className="plane_td_basic align-self-center";w.textContent=u.$jscomp$loop$prop$plane$314.radius;if("multi"===f&&p!==u.$jscomp$loop$prop$plane$314.type&&"default"===n){p=document.createElement("div");p.className="type_divider mt-3 mb-1";v=document.createElement("div");v.className="font_size_12 font_color_half align-self-center";v.textContent=PLANE_TYPE.find(function(C){return function(E){return E.id===C.$jscomp$loop$prop$plane$314.type}}(u)).name;var F=document.createElement("div");F.className="flex-grow-1 border-bottom align-self-center mx-2";
p.appendChild(v);p.appendChild(F);e.appendChild(p)}A.appendChild(t);y.appendChild(A);y.appendChild(z);l&&0<u.$jscomp$loop$prop$plane$314.remodel&&(p=document.createElement("div"),p.className="ml-1 plane_td_remodel align-self-center",p.dataset.remodel=u.$jscomp$loop$prop$plane$314.remodel,p.textContent=10>u.$jscomp$loop$prop$plane$314.remodel?"\u2605+"+u.$jscomp$loop$prop$plane$314.remodel:"\u2605MAX",y.appendChild(p),y.appendChild(B));0<q&&y.appendChild(B);"single"===f&&(y.appendChild(D),y.appendChild(w));
e.appendChild(y);p=u.$jscomp$loop$prop$plane$314.type}}d.innerHTML="";d.appendChild(e)}
function createDraggablePlaneTable(a){(a=void 0===a?null:a)||(a=$("#draggable_plane_type_select").find(".active"));a.length||$("#draggable_plane_type_select").find(".nav-link:first").addClass("active");var b=castInt(a.length?a[0].dataset.type:1),c=PLANE_DATA.filter(function(C){return Math.abs(C.type)===b});a=document.getElementById("draggable_plane_tbody");var d=document.createDocumentFragment(),e=loadPlaneStock(),f=setting.inStockOnly,g=setting.isDivideStock,h=setting.visibleEquipped,l=setting.favoriteOnly,
k=c.length,m=usedPlane.concat(),n=0,r=-1,p=0;if(setting.inStockOnly&&setting.isDivideStock){var q=loadPlaneStock(),t=[],u={};c=$jscomp.makeIterator(c);for(var x=c.next();!x.done;u={$jscomp$loop$prop$o$316:u.$jscomp$loop$prop$o$316},x=c.next()){u.$jscomp$loop$prop$o$316=x.value;x=q.find(function(C){return function(E){return E.id===C.$jscomp$loop$prop$o$316.id}}(u));for(var w=0;10>=w;w++){var v=x.num[w];0!==v&&(v=Object.assign({remodel:w,count:v},u.$jscomp$loop$prop$o$316),v.antiAir=Plane.getBonusAntiAir(v.id,
v.type,v.remodel,v.antiAir),t.push(v))}}c=t.concat()}var y=$("#draggable_plane_sort_select").val();switch(y){case "battle_anti_air":c.sort(function(C,E){return E.antiAir+1.5*E.interception-(C.antiAir+1.5*C.interception)});break;case "defense_anti_air":c.sort(function(C,E){return E.antiAir+E.interception+2*E.antiBomber-(C.antiAir+C.interception+2*C.antiBomber)});break;case "land_base_power":c.sort(function(C,E){return getLandBasePower(E.id,18,0)-getLandBasePower(C.id,18,0)});break;case "radius":c.sort(function(C,
E){return E.radius-C.radius});break;case "history":if(setting.selectedHistory[0]){var A=setting.selectedHistory[0];c.sort(function(C,E){return A.filter(function(G){return G===E.id}).length-A.filter(function(G){return G===C.id}).length})}case "default":break;default:c.sort(function(C,E){return E[y]-C[y]})}q={};for(t=0;t<k;q={$jscomp$loop$prop$plane$138$319:q.$jscomp$loop$prop$plane$138$319},t++)if(q.$jscomp$loop$prop$plane$138$319=c[t],u=q.$jscomp$loop$prop$plane$138$319.antiAir+1.5*q.$jscomp$loop$prop$plane$138$319.interception,
x=q.$jscomp$loop$prop$plane$138$319.antiAir+q.$jscomp$loop$prop$plane$138$319.interception+2*q.$jscomp$loop$prop$plane$138$319.antiBomber,w=0<q.$jscomp$loop$prop$plane$138$319.antiBomber||0<q.$jscomp$loop$prop$plane$138$319.interception,!l||setting.favoritePlane.includes(q.$jscomp$loop$prop$plane$138$319.id)){if(f&&e)if(v=m.find(function(C){return function(E){return E.id===C.$jscomp$loop$prop$plane$138$319.id}}(q)),g){r=q.$jscomp$loop$prop$plane$138$319.count-(v?v.num[q.$jscomp$loop$prop$plane$138$319.remodel]:
0);if(1>r)continue;n=q.$jscomp$loop$prop$plane$138$319.remodel}else{var B=e.find(function(C){return function(E){return E.id===C.$jscomp$loop$prop$plane$138$319.id}}(q)),z=v?getArraySum(v.num):0;p=B?getArraySum(B.num):0;if(0>=p||!h&&z>=p)continue;r=p-z;for(p=10;0<=p;p--)if(v&&(B.num[p]-=v.num[p]),0<B.num[p]){n=p;break}}v=document.createElement("div");v.className="plane plane_tr_draggable d-flex py-2 py-lg-1";v.dataset.planeid=q.$jscomp$loop$prop$plane$138$319.id;v.dataset.type=q.$jscomp$loop$prop$plane$138$319.type;
v.dataset.abbr=q.$jscomp$loop$prop$plane$138$319.name;v.dataset.remodel=n;f&&h&&0>=r&&(v.classList.remove("plane_tr_draggable","plane"),v.classList.add("plane_tr_disabled"));B=document.createElement("div");B.className="align-self-center size-25";p=document.createElement("canvas");z=p.getContext("2d");p.width=25;p.height=25;z.drawImage(IMAGES["type"+q.$jscomp$loop$prop$plane$138$319.type],0,0,25,25);var D=document.createElement("div");D.className="pl-1 plane_td_name align-self-center";D.textContent=
q.$jscomp$loop$prop$plane$138$319.name;z=document.createElement("div");z.className="ml-1 plane_td_stock align-self-center";z.textContent="\u00d7"+(0<=r?r:0);var F=document.createElement("div");F.className="ml-auto plane_td_basic align-self-center "+(w?"text_existTooltip":"");w&&(F.dataset.toggle="tooltip",F.title="\u51fa\u6483\u6642:"+u+" , \u9632\u7a7a\u6642:"+x);switch(y){case "battle_anti_air":F.textContent=u%1?u.toFixed(1):u;break;case "defense_anti_air":F.textContent=x%1?x.toFixed(1):x;break;
default:F.textContent=q.$jscomp$loop$prop$plane$138$319.antiAir%1?q.$jscomp$loop$prop$plane$138$319.antiAir.toFixed(1):q.$jscomp$loop$prop$plane$138$319.antiAir}u=document.createElement("div");u.className="plane_td_basic align-self-center";u.textContent=q.$jscomp$loop$prop$plane$138$319.radius;B.appendChild(p);v.appendChild(B);v.appendChild(D);g&&0<q.$jscomp$loop$prop$plane$138$319.remodel&&(x=document.createElement("div"),x.className="ml-1 plane_td_remodel align-self-center",x.dataset.remodel=q.$jscomp$loop$prop$plane$138$319.remodel,
x.textContent=10>q.$jscomp$loop$prop$plane$138$319.remodel?"\u2605+"+q.$jscomp$loop$prop$plane$138$319.remodel:"\u2605MAX",v.appendChild(x));0<r&&v.appendChild(z);v.appendChild(F);v.appendChild(u);d.appendChild(v)}a.innerHTML="";a.appendChild(d);$(".plane_tr_draggable").draggable({helper:"clone",zIndex:1E3,start:function(C,E){var G='\n\t\t\t<div>\n\t\t\t\t<img src="../img/type/type'+$(this)[0].dataset.type+'.png" width="25", height="25">\n\t\t\t\t<span class="ml-1">'+$(this)[0].dataset.abbr+"</span>\n\t\t\t</div>";
$(E.helper).css("width","380px");$(E.helper).html(G)}});$(a).find(".text_existTooltip").tooltip();$("#draggable_plane_box").removeClass("d-none")}
function setShipStockTable(){for(var a=document.getElementById("ship_stock_tbody"),b=document.createDocumentFragment(),c=SHIP_DATA.filter(function(p){return 0<p.id}),d=loadShipStock(),e=c.length,f={},g=0;g<e;f={$jscomp$loop$prop$ship$321:f.$jscomp$loop$prop$ship$321},g++){f.$jscomp$loop$prop$ship$321=c[g];var h=d.find(function(p){return function(q){return q.id===p.$jscomp$loop$prop$ship$321.id}}(f)),l=document.createElement("div");l.className="stock_tr general_tr py-1 d-flex type_"+f.$jscomp$loop$prop$ship$321.type;
l.dataset.shipid=f.$jscomp$loop$prop$ship$321.id;var k=document.createElement("div");k.className="stock_td_id font_size_14 align-self-center font_size_12";k.textContent=f.$jscomp$loop$prop$ship$321.id;var m=document.createElement("div");m.className="stock_td_name align-self-center flex-grow-1 text-left";var n=document.createElement("img");n.width=100;n.height=25;n.src="../img/ship/"+f.$jscomp$loop$prop$ship$321.id+".png";m.appendChild(n);n=document.createElement("span");n.className="ml-1 stock_td_name font_size_14";
n.textContent=f.$jscomp$loop$prop$ship$321.name;m.appendChild(n);n=document.createElement("div");n.className="stock_td_fav font_size_18 align-self-center "+(setting.favoriteShip.includes(f.$jscomp$loop$prop$ship$321.id)?"stock_fav":"stock_unfav");var r=document.createElement("i");r.className="fas fa-heart";n.appendChild(r);r=document.createElement("input");r.type="number";r.min=0;r.max=99;r.className="form-control form-control-sm stock_td_stock align-self-center";r.value=h?h.num:0;l.appendChild(k);
l.appendChild(m);l.appendChild(n);l.appendChild(r);b.appendChild(l)}a.innerHTML="";a.appendChild(b);$("#ship_stock_type_select").change()}
function setPlaneStockTable(){for(var a=document.getElementById("plane_stock_tbody"),b=document.createDocumentFragment(),c=PLANE_DATA.filter(function(q){return 0<q.id}),d=loadPlaneStock(),e=c.length,f={},g=0;g<e;f={$jscomp$loop$prop$plane$323:f.$jscomp$loop$prop$plane$323},g++){f.$jscomp$loop$prop$plane$323=c[g];var h=d.find(function(q){return function(t){return t.id===q.$jscomp$loop$prop$plane$323.id}}(f)),l=document.createElement("div");l.className="stock_tr general_tr py-1 d-flex type_"+Math.abs(f.$jscomp$loop$prop$plane$323.type);
l.dataset.planeid=f.$jscomp$loop$prop$plane$323.id;var k=document.createElement("div");k.className="stock_td_type align-self-center";var m=document.createElement("canvas"),n=m.getContext("2d");m.width=24;m.height=24;n.drawImage(IMAGES["type"+f.$jscomp$loop$prop$plane$323.type],0,0,24,24);n=document.createElement("div");n.className="stock_td_name font_size_14 text-left align-self-center";n.textContent=f.$jscomp$loop$prop$plane$323.name;var r=document.createElement("div");r.className="stock_td_fav font_size_18 align-self-center "+
(setting.favoritePlane.includes(f.$jscomp$loop$prop$plane$323.id)?"stock_fav":"stock_unfav");var p=document.createElement("i");p.className="fas fa-heart";r.appendChild(p);p=document.createElement("div");p.className="stock_td_stock align-self-center px-2";p.textContent=h?getArraySum(h.num):0;k.appendChild(m);l.appendChild(k);l.appendChild(n);l.appendChild(r);l.appendChild(p);b.appendChild(l)}a.innerHTML="";a.appendChild(b);$("#stock_type_select").change()}
function initializeShipTable(){var a=$("#modal_ship_select").find(".modal-dialog"),b=document.getElementById("ship_tbody"),c=document.createDocumentFragment();a=a.find(".toggle_display_type.selected").data("mode");for(var d=$jscomp.makeIterator(SHIP_DATA),e=d.next();!e.done;e=d.next()){e=e.value;var f=document.createElement("div");f.className="ship_tr general_tr d-flex "+("multi"===a?"tr_multi":"py-1");f.dataset.shipid=e.id;f.id="ship_tr_"+e.id;var g=document.createElement("div");g.className="ml-1 align-self-center pt-1";
var h=document.createElement("img");h.width=120;h.height=30;h.src="../img/ship/"+e.id+".png";g.appendChild(h);h=document.createElement("div");h.className="ml-1 align-self-center";var l=document.createElement("div");l.className="text-primary font_size_11";l.textContent="ID : "+(1E3<e.id?e.orig+"b":e.id);var k=document.createElement("div");k.className="d-flex";k.textContent=e.name;var m=document.createElement("div");m.className="ml-1 ship_td_stock align-self-center d-none";m.textContent="";k.appendChild(m);
h.appendChild(l);h.appendChild(k);f.appendChild(g);f.appendChild(h);for(g=0;5>g;g++)h=document.createElement("div"),h.className="ship_td_slot font_size_12 align-self-center "+(0===g?"ml-auto":""),h.textContent=g<e.slot.length?e.slot[g]:"",f.appendChild(h);c.appendChild(f)}b.innerHTML="";b.appendChild(c)}
function createShipTable(a){var b=document.getElementById("modal_ship_select").getElementsByClassName("modal-dialog")[0],c=document.getElementById("ship_tbody"),d=b.querySelector(".toggle_display_type.selected").dataset.mode,e=document.getElementById("display_final").checked,f=document.getElementById("ship_word").value.trim(),g=document.getElementById("frequent_ship").checked,h=document.getElementById("disp_in_stock_ship").checked,l=document.getElementById("disp_equipped_ship").checked,k=document.getElementById("fav_only_ship").checked,
m=loadShipStock();c.childElementCount||initializeShipTable();setting.visibleFinal=e;setting.orderByFrequency=g;setting.inStockOnlyShip=h;setting.visibleEquippedShip=l;setting.favoriteOnlyShip=k;saveSetting();h?$("#disp_equipped_ship").closest("div").removeClass("d-none"):$("#disp_equipped_ship").closest("div").addClass("d-none");var n=c.getElementsByClassName("ship_tr");n=Array.prototype.slice.call(n).map(function(x){return{mst:SHIP_DATA.find(function(w){return w.id===castInt(x.dataset.shipid)}),
dom:x}});c.innerHTML="";n.sort(function(x,w){return x.mst.sort1!==w.mst.sort1?x.mst.sort1-w.mst.sort1:x.mst.sort2-w.mst.sort2});if(g&&setting.selectedHistory[1]){var r=setting.selectedHistory[1];n.sort(function(x,w){return r.filter(function(v){return v===w.mst.id}).length-r.filter(function(v){return v===x.mst.id}).length})}var p=-1;g={};n=$jscomp.makeIterator(n);for(var q=n.next();!q.done;g={$jscomp$loop$prop$e$325:g.$jscomp$loop$prop$e$325},q=n.next()){g.$jscomp$loop$prop$e$325=q.value;if(0===a&&
p!==g.$jscomp$loop$prop$e$325.mst.type&&0<g.$jscomp$loop$prop$e$325.mst.valid){q=document.createDocumentFragment();p=document.createElement("div");p.className="type_divider mt-3 type_line";var t=document.createElement("div");t.className="font_size_12 font_color_half align-self-center";t.textContent=SHIP_TYPE.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$e$325.mst.type}}(g)).name;var u=document.createElement("div");u.className="flex-grow-1 border-bottom align-self-center mx-2";
p.appendChild(t);p.appendChild(u);q.appendChild(p);c.appendChild(q);p=g.$jscomp$loop$prop$e$325.mst.type}c.appendChild(g.$jscomp$loop$prop$e$325.dom)}"multi"===d?(b.classList.add("modal-xl"),c.classList.add("multi_mode"),b=b.getElementsByClassName("scroll_thead")[0],b.classList.add("d-none"),b.classList.remove("d-flex")):(b.classList.remove("modal-xl"),c.classList.remove("multi_mode"),b=b.getElementsByClassName("scroll_thead")[0],b.classList.add("d-flex"),b.classList.remove("d-none"));b={};g=$jscomp.makeIterator(SHIP_DATA);
for(n=g.next();!n.done;b={$jscomp$loop$prop$ship$328:b.$jscomp$loop$prop$ship$328},n=g.next())b.$jscomp$loop$prop$ship$328=n.value,n=document.getElementById("ship_tr_"+b.$jscomp$loop$prop$ship$328.id),q=n.getElementsByClassName("ship_td_stock")[0],q.classList.add("d-none"),"multi"===d?n.classList.add("tr_multi"):n.classList.remove("tr_multi"),0!==a&&a!==b.$jscomp$loop$prop$ship$328.type||e&&!b.$jscomp$loop$prop$ship$328["final"]||f&&!b.$jscomp$loop$prop$ship$328.name.includes(f)?(n.classList.add("d-none"),
n.classList.remove("d-flex")):k&&!setting.favoriteShip.includes(b.$jscomp$loop$prop$ship$328.id)?(n.classList.add("d-none"),n.classList.remove("d-flex")):0===a&&1!==b.$jscomp$loop$prop$ship$328.valid?(n.classList.add("d-none"),n.classList.remove("d-flex")):h&&m?(t=m.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$ship$328.id}}(b)),p=usedShip.filter(function(x){return function(w){return w===x.$jscomp$loop$prop$ship$328.id}}(b)).length,t=t?t.num:0,p=0<t-p?t-p:0,0>=t||!l&&!p?(n.classList.add("d-none"),
n.classList.remove("d-flex")):(q.textContent="\u00d7"+p,l&&!p?(n.classList.remove("general_tr"),n.classList.add("ship_tr_disabled")):(n.classList.add("general_tr"),n.classList.remove("ship_tr_disabled")),q.classList.remove("d-none"),n.classList.add("d-flex"),n.classList.remove("d-none"))):(n.classList.add("d-flex","general_tr"),n.classList.remove("d-none","ship_tr_disabled"));if("multi"===d)for(a=$jscomp.makeIterator(c.getElementsByClassName("ship_td_slot")),q=a.next();!q.done;q=a.next())q.value.classList.add("d-none");
else for(a=$jscomp.makeIterator(c.getElementsByClassName("ship_td_slot")),q=a.next();!q.done;q=a.next())q.value.classList.remove("d-none")}
function createEnemyInput(a){battleCount=a;$(".battle_content").each(function(b,c){b<battleCount?$(c).removeClass("d-none"):$(c).addClass("d-none")});$("#battle_count").val(a);$("#land_base_target_buttons").find(".btn-group").each(function(b,c){$(c).find(".btn").each(function(d,e){d<battleCount?$(e).removeClass("disabled btn-outline-secondary").addClass("btn-outline-info"):$(e).addClass("disabled btn-outline-secondary").removeClass("btn-outline-info")})});$("#display_battle_tab").find(".nav-link").each(function(b,
c){$(c).removeClass("active");b<battleCount?$(c).parent().removeClass("d-none"):$(c).parent().addClass("d-none")});$("#display_battle_tab").find('[data-disp="'+battleCount+'"]').addClass("active");displayBattle=battleCount}
function initializeEnemyTable(){for(var a=document.createDocumentFragment(),b=[],c=0,d={},e=$jscomp.makeIterator(ENEMY_TYPE),f=e.next();!f.done;d={$jscomp$loop$prop$typeObject$330:d.$jscomp$loop$prop$typeObject$330},f=e.next())d.$jscomp$loop$prop$typeObject$330=f.value,1!==d.$jscomp$loop$prop$typeObject$330.id&&(f=ENEMY_DATA.filter(function(n){return function(r){return r.type[0]===n.$jscomp$loop$prop$typeObject$330.id}}(d)),b=b.concat(f.sort(function(n,r){return n.orig>r.orig?1:n.orig<r.orig?-1:n.id-
r.id})));d=ENEMY_DATA.filter(function(n){return 1===n.type[0]});b=b.concat(d.sort(function(n,r){return n.id>r.id?1:-1}));d={};b=$jscomp.makeIterator(b);for(e=b.next();!e.done;d={$jscomp$loop$prop$enemy$335:d.$jscomp$loop$prop$enemy$335},e=b.next()){d.$jscomp$loop$prop$enemy$335=e.value;f=e=0;for(var g=d.$jscomp$loop$prop$enemy$335.slot.length,h={$jscomp$loop$prop$i$334:0};h.$jscomp$loop$prop$i$334<g;h={$jscomp$loop$prop$i$334:h.$jscomp$loop$prop$i$334},h.$jscomp$loop$prop$i$334++){var l=ENEMY_PLANE_DATA.find(function(n,
r){return function(p){return p.id===n.$jscomp$loop$prop$enemy$335.eqp[r.$jscomp$loop$prop$i$334]}}(d,h));l&&(5!==l.type?e+=Math.floor(l.antiAir*Math.sqrt(d.$jscomp$loop$prop$enemy$335.slot[h.$jscomp$loop$prop$i$334])):f+=Math.floor(l.antiAir*Math.sqrt(d.$jscomp$loop$prop$enemy$335.slot[h.$jscomp$loop$prop$i$334])))}f+=e;g=document.createElement("div");g.className="enemy enemy_tr general_tr d-flex";g.dataset.enemyid=d.$jscomp$loop$prop$enemy$335.id;g.id="enemy_tr_"+d.$jscomp$loop$prop$enemy$335.id;
h=document.createElement("div");h.className="ml-1 align-self-center";l=document.createElement("img");l.width=128;l.height=32;l.src="../img/enemy/"+d.$jscomp$loop$prop$enemy$335.id+".png";h.appendChild(l);l=document.createElement("div");l.className="ml-1 align-self-center";var k=document.createElement("div");k.className="text-primary font_size_11";k.textContent="ID : "+(d.$jscomp$loop$prop$enemy$335.id+1500);var m=document.createElement("div");m.className="font_size_12";m.innerHTML=drawEnemyGradeColor(d.$jscomp$loop$prop$enemy$335.name);
l.appendChild(k);l.appendChild(m);c!==d.$jscomp$loop$prop$enemy$335.type[0]&&-1!==d.$jscomp$loop$prop$enemy$335.id&&(c=document.createElement("div"),c.className="w-100 d-flex mt-3 divide_line",k=document.createElement("div"),k.className="font_size_12 font_color_half align-self-center",k.textContent=ENEMY_TYPE.find(function(n){return function(r){return r.id===n.$jscomp$loop$prop$enemy$335.type[0]}}(d)).name,m=document.createElement("div"),m.className="flex-grow-1 border-bottom align-self-center mx-2",
c.appendChild(k),c.appendChild(m),a.appendChild(c),c=d.$jscomp$loop$prop$enemy$335.type[0]);g.appendChild(h);g.appendChild(l);h=document.createElement("div");h.className="ml-auto align-self-center enemy_td_ap";h.textContent=f>e?e+" ("+f+")":e;g.appendChild(h);a.appendChild(g)}document.getElementById("enemy_tbody").appendChild(a)}
function createEnemyTable(a){var b=document.getElementById("modal_enemy_select").getElementsByClassName("modal-dialog")[0],c=document.getElementById("enemy_tbody"),d=b.querySelector(".toggle_display_type.selected").dataset.mode,e=$("#enemy_word").val().trim();c.childElementCount||initializeEnemyTable();"multi"===d?(b.classList.add("modal-xl"),c.classList.add("d-flex","flex-wrap"),b=b.getElementsByClassName("scroll_thead")[0],b.classList.add("d-none"),b.classList.remove("d-flex")):(b.classList.remove("modal-xl"),
c.classList.remove("d-flex","flex-wrap"),b=b.getElementsByClassName("scroll_thead")[0],b.classList.add("d-flex"),b.classList.remove("d-none"));b=$jscomp.makeIterator(ENEMY_DATA);for(var f=b.next();!f.done;f=b.next()){f=f.value;var g=document.getElementById("enemy_tr_"+f.id);"multi"===d?g.classList.add("enemy_tr_multi"):g.classList.remove("enemy_tr_multi");0!==a[0]&&!isContain(a,f.type)||e&&!f.name.includes(e)?(g.classList.add("d-none"),g.classList.remove("d-flex")):(g.classList.add("d-flex"),g.classList.remove("d-none"))}if("multi"===
d){if(0===a[0])for(d=$jscomp.makeIterator(c.getElementsByClassName("divide_line")),a=d.next();!a.done;a=d.next())a=a.value,a.classList.add("d-flex"),a.classList.remove("d-none");else for(d=$jscomp.makeIterator(c.getElementsByClassName("divide_line")),a=d.next();!a.done;a=d.next())a=a.value,a.classList.remove("d-flex"),a.classList.add("d-none");c=$jscomp.makeIterator(c.getElementsByClassName("enemy_td_ap"));for(a=c.next();!a.done;a=c.next())a.value.classList.add("d-none")}else{d=$jscomp.makeIterator(c.getElementsByClassName("divide_line"));
for(a=d.next();!a.done;a=d.next())a=a.value,a.classList.add("d-none"),a.classList.remove("d-flex");c=$jscomp.makeIterator(c.getElementsByClassName("enemy_td_ap"));for(a=c.next();!a.done;a=c.next())a.value.classList.remove("d-none")}$("#modal_enemy_select").find(".btn_remove").prop("disabled",!0)}
function loadPlanePreset(){var a=$("#modal_plane_preset");(planePreset=loadLocalStorage("planePreset"))||(planePreset=DEFAULT_PLANE_PRESET.concat());for(var b=castInt($("#modal_plane_preset").data("parentid")),c="",d=planePreset.length,e=0;e<d;e++){for(var f=planePreset[e],g='\n\t\t\t<div class="preset_td preset_td_info text-danger cur_help ml-auto" data-toggle="tooltip" data-boundary="window"\n\t\t\t\ttitle="\u5168\u3066\u306e\u88c5\u5099\u304c\u5c55\u958b\u3067\u304d\u307e\u305b\u3093\u3002">\n\t\t\t\t<i class="fas fa-exclamation-triangle"></i>\n\t\t\t</div>\n\t\t',
h=0,l={},k=$jscomp.makeIterator(f.planes),m=k.next();!m.done;l={$jscomp$loop$prop$plane$337:l.$jscomp$loop$prop$plane$337},m=k.next())l.$jscomp$loop$prop$plane$337=m.value,checkInvalidPlane(b,PLANE_DATA.find(function(n){return function(r){return r.id===n.$jscomp$loop$prop$plane$337.id}}(l)))&&(g='\n\t\t\t\t<div class="preset_td preset_td_info text-warning cur_help ml-auto" data-toggle="tooltip" data-boundary="window"\n\t\t\t\t\ttitle="\u5c55\u958b\u3067\u304d\u306a\u3044\u88c5\u5099\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002">\n\t\t\t\t\t<i class="fas fa-exclamation-triangle"></i>\n\t\t\t\t</div>\n\t\t\t',
h++),h===f.planes.length&&(g="");c+='\n\t\t\t<div class="preset_tr general_tr d-flex px-1 py-1_5 my-1 w-100 cur_pointer" data-presetid="'+f.id+'">\n\t\t\t\t<div class="preset_td text-primary">'+(e+1)+'.</div>\n\t\t\t\t<div class="preset_td ml-2">'+f.name+"</div>\n\t\t\t\t\t"+g+"\n\t\t\t</div>\n\t\t"}a.find(".alert").addClass("d-none");a.find(".preset_tr").removeClass("preset_selected");a.find(".preset_tbody").html(c);a.find(".preset_name").val("\u5de6\u306e\u30d7\u30ea\u30bb\u30c3\u30c8\u4e00\u89a7\u3092\u30af\u30ea\u30c3\u30af").prop("disabled",
!0);a.find(".is-invalid").removeClass("is-invalid");a.find(".is-valid").removeClass("is-valid");a.find(".preset_preview_tbody").html("");a.find(".btn:not(.btn_cancel)").prop("disabled",!0);$(".preset_td_info").tooltip()}
function drawPlanePresetPreview(a){var b="",c=[],d=$("#modal_plane_preset"),e=castInt($("#modal_plane_preset").data("parentid"));d.find(".alert").addClass("d-none");if(a){d.find(".preset_name").val(a.name);for(var f={},g=$jscomp.makeIterator(a.planes),h=g.next();!h.done;f={$jscomp$loop$prop$plane$339:f.$jscomp$loop$prop$plane$339},h=g.next())f.$jscomp$loop$prop$plane$339=h.value,h=PLANE_DATA.find(function(l){return function(k){return k.id===l.$jscomp$loop$prop$plane$339.id}}(f)),c.push({id:f.$jscomp$loop$prop$plane$339.id,
type:h.type,name:h.name,remodel:f.$jscomp$loop$prop$plane$339.remodel})}else d.find(".preset_name").val(""),$target.find("."+($target.attr("class").includes("lb_tab")?"lb_plane":"ship_plane")).each(function(l,k){if(!$(k).hasClass("d-none")){var m=PLANE_DATA.find(function(n){return n.id===castInt($(k)[0].dataset.planeid)});m&&(m={id:m.id,type:m.type,name:m.name,remodel:castInt($(k).find(".remodel_value").text())},c.push(m))}}),0===c.length&&d.find(".alert").removeClass("d-none");f=$jscomp.makeIterator(c);
for(h=f.next();!h.done;h=f.next())g=h.value,h=!checkInvalidPlane(e,g),b+='\n\t\t<div class="preset_preview_tr d-flex justify-content-start border-bottom" data-planeid="'+g.id+'" data-remodel="'+g.remodel+'">\n\t\t\t<div class="preset_preview_td_type"><img class="img-size-25" src="../img/type/type'+g.type+'.png"></div>\n\t\t\t<div class="preset_preview_td_name ml-1 py-2">'+g.name+'</div>\n\t\t\t<div class="preset_preview_td_remodel">'+(g.remodel?"\u2605"+g.remodel:"")+"</div>\n\t\t\t"+(h?'\n\t\t<div class="preset_preview_td_info ml-2 text-warning cur_help" data-toggle="tooltip" title="\u5c55\u958b\u5148\u306b\u4e0d\u9069\u5408\u306a\u88c5\u5099\u3067\u3059">\n\t\t\t<i class="fas fa-exclamation-triangle"></i>\n\t\t</div>\n\t':
"")+"\n\t\t</div>\n\t\t";d.find(".btn_expand_preset").prop("disabled",!a);d.find(".btn_delete_preset").prop("disabled",!a);d.find(".btn_commit_preset").prop("disabled",!0);d.find(".preset_name").prop("disabled",0===c.length);d.find(".is-invalid").removeClass("is-invalid");d.find(".is-valid").removeClass("is-valid");d.find(".preset_preview_tbody").html(b);d.find(".preset_preview_td_info").tooltip()}
function updatePlanePreset(){var a=castInt($(".preset_selected").data("presetid")),b=[];$(".preset_preview_tr").each(function(f,g){b.push({id:castInt($(g)[0].dataset.planeid),remodel:castInt($(g)[0].dataset.remodel)})});for(var c=0,d=$jscomp.makeIterator(planePreset),e=d.next();!e.done;e=d.next())e=e.value,c<e.id&&(c=e.id);c={id:-1===a?c+1:a,name:$("#modal_plane_preset").find(".preset_name").val().replace(/^\s+|\s+$/g,""),planes:b};planePreset=planePreset.filter(function(f){return f.id!==a});planePreset.push(c);
planePreset.sort(function(f,g){return f.id-g.id});saveLocalStorage("planePreset",planePreset)}function deletePlanePreset(){var a=castInt($(".preset_selected").data("presetid"));planePreset=planePreset.filter(function(b){return b.id!==a});planePreset.sort(function(b,c){return b.id-c.id});saveLocalStorage("planePreset",planePreset)}
function loadMapData(){fetch("../js/map_data.json",{method:"GET"}).then(function(a){a.ok?a.json().then(function(b){ENEMY_PATTERN=b.ENEMY_PATTERN;createMapSelect();createNodeSelect()}):inform_danger(a.statusText)})["catch"](function(a){sendErrorLog(a)})}function modal_enemy_pattern_Shown(){$("#map_select").html()||($("#map_select").html('<option value="1">\u6d77\u57df\u30c7\u30fc\u30bf\u8aad\u8fbc\u4e2d</option>'),loadMapData())}
function createMapSelect(){for(var a="",b={},c=$jscomp.makeIterator(WORLD_DATA),d=c.next();!d.done;b={$jscomp$loop$prop$world$341:b.$jscomp$loop$prop$world$341},d=c.next()){d=d.value;b.$jscomp$loop$prop$world$341=d.world;var e=MAP_DATA.filter(function(f){return function(g){return Math.floor(g.area/10)===f.$jscomp$loop$prop$world$341}}(b));a+='<optgroup label="'+d.name+'">';d=$jscomp.makeIterator(e);for(e=d.next();!e.done;e=d.next())e=e.value,a+='<option value="'+e.area+'">'+(20<b.$jscomp$loop$prop$world$341?
"E":b.$jscomp$loop$prop$world$341)+"-"+e.area%10+" : "+e.name+"</option>"}$("#map_select").html(a);$("#select_preset_category").html(a)}
function createNodeSelect(){var a=castInt($("#map_select").val()),b=0;200>a?$("#select_difficulty_div").addClass("d-none"):($("#select_difficulty_div").removeClass("d-none"),b=castInt($("#select_difficulty").val()));$("#map_img").attr("src","../img/map/"+a+".png");var c=ENEMY_PATTERN.filter(function(k){return k.a===a&&k.l===b});c=c.filter(function(k,m,n){return n.findIndex(function(r){return r.n===k.n})===m});c.sort(function(k,m){return"\u7a7a\u8972"==k.n&&"\u7a7a\u8972"==m.n?0:"\u7a7a\u8972"==k.n?
-1:"\u7a7a\u8972"==m.n?1:0});for(var d=c.length,e="",f="",g=0;g<d;g++){var h=c[g].n,l=c[g].c;e+='\n\t\t<div class="d-flex node_tr general_tr justify-content-center py-1 w-100 cur_pointer" data-node="'+h+'">\n\t\t\t<div class="align-self-center">'+h+"</div>\n\t\t</div>\n\t";""!==l&&(f+='<area class="node" title="'+h+'" coords="'+l+'" shape="rect">')}$("#node_tbody").html(e);$("#clickable_nodes").html(f);$("#enemy_pattern_tbody").html("");$("#enemy_pattern_select").html('<li class="nav-item"><a class="nav-link '+
("#000000"===mainColor?"":"nav-link-dark")+' active" data-toggle="tab" href="#">\u7de8\u62101</a></li>');$("#enemy_pattern_air_power").text("0");$("#enemy_display_mode_parent").addClass("d-none").removeClass("d-flex");$("#btn_expand_enemies").prop("disabled",!0);$("#btn_continue_expand").prop("disabled",!0)}
function createEnemyPattern(a){a=void 0===a?0:a;var b=castInt($("#map_select").val()),c=$(".node_selected").data("node"),d=0;100>b?$("#select_difficulty_div").addClass("d-none"):($("#select_difficulty_div").removeClass("d-none"),d=castInt($("#select_difficulty").val()));for(var e="",f=0,g=0,h=ENEMY_PATTERN.filter(function(q){return q.a===b&&q.n===c&&q.l===d}),l=h[a],k=l.e,m=k.length,n={$jscomp$loop$prop$index$343:0};n.$jscomp$loop$prop$index$343<m;n={$jscomp$loop$prop$index$343:n.$jscomp$loop$prop$index$343},
n.$jscomp$loop$prop$index$343++){var r=ENEMY_DATA.find(function(q){return function(t){return t.id===k[q.$jscomp$loop$prop$index$343]}}(n)),p=createEnemyObject(r.id);f+=p.ap;g+=p.aabo;e+='\n\t\t<div class="enemy_pattern_tr mx-1 d-flex border-bottom" data-enemyid="'+r.id+'">\n\t\t\t<div class="enemy_pattern_tr_image mr-1">\n\t\t\t\t<img src="../img/enemy/'+r.id+'.png" class="enemy_img">\n\t\t\t</div>\n\t\t\t<div class="enemy_pattern_tr_text">\n\t\t\t\t<div class="font_size_11 text-primary">ID: '+(r.id+
1500)+"</div>\n\t\t\t\t<div>"+drawEnemyGradeColor(r.name)+"</div>\n\t\t\t</div>\n\t\t</div>\n\t\t"}n=FORMATION.find(function(q){return q.id===l.f});g=2*Math.floor(n.correction*g);$("#enemy_pattern_anti_air").text(g);$("#enemy_pattern_formation").text(n.name);if(0===a){a="";for(g=0;g<h.length;g++)a+='\n\t\t\t<li class="nav-item font_size_12">\n\t\t\t\t<a class="nav-link '+("#000000"===mainColor?"":"nav-link-dark")+" "+(0===g?"active":"")+'" data-toggle="tab" data-disp="'+g+'" href="#">\n\t\t\t\t\t'+
(h[g].d?h[g].d:"\u7de8\u6210"+(g+1))+"\n\t\t\t\t</a>\n\t\t\t</li>\n\t\t\t";$("#enemy_pattern_select").html(a)}h=getAirStatusBorder(f);$("#enemy_pattern_tbody").html(e);$("#enemy_pattern_air_power").text(f);$("#enemy_pattern_status0").text(h[0]);$("#enemy_pattern_status1").text(h[1]);$("#enemy_pattern_status2").text(h[2]);$("#enemy_pattern_status3").text(h[3]);$("#btn_expand_enemies").prop("disabled",!1);$("#btn_continue_expand").prop("disabled",!1);6<m?($("#enemy_display_mode_parent").removeClass("d-none").addClass("d-flex"),
setting.enemyDisplayImage?$("#enemy_pattern_tbody").find(".enemy_pattern_tr_text").addClass("d-none"):$("#enemy_pattern_tbody").find(".enemy_pattern_tr_image").addClass("d-none")):$("#enemy_display_mode_parent").addClass("d-none").removeClass("d-flex")}
function expandEnemy(){var a=castInt($("#map_select").val()),b=$(".node_selected").data("node"),c=castInt($("#enemy_pattern_select").find(".nav-link.active").data("disp")),d=0;200<=a&&(d=castInt($("#select_difficulty").val()));var e=ENEMY_PATTERN.filter(function(f){return f.a===a&&f.n===b&&f.l===d})[c];isDefMode||"\u7a7a\u8972"!==b?isDefMode&&"\u7a7a\u8972"!==b&&(toggleDefenseMode(!1),$(".ohuda_select").each(function(f,g){0===castInt($(g).val())&&$(g).val(-1)}),$target=$(".battle_content:first")):
(toggleDefenseMode(!0),$(".ohuda_select").each(function(f,g){$(g).val(0)}),$target=$("#air_raid_enemies"));c=isDefMode&&5!==e.t?3:e.t;$target.find(".cell_type").val(c);cell_type_Changed($target.find(".cell_type"),!1);$target.find(".formation").val(e.f);$target.find(".enemy_content").each(function(f,g){f<e.e.length?setEnemyDiv($(g),e.e[f]):clearEnemyDiv($(g))});$target.find(".enemy_range").text(e.r);$target[0].dataset.celldata=a+"_"+e.n+(e.d?"("+e.d+")":"")}
function modal_main_preset_Shown(){$("#select_preset_category").html()||($("#select_preset_category").html('<option value="1">\u6d77\u57df\u30c7\u30fc\u30bf\u8aad\u8fbc\u4e2d</option>'),loadMapData())}
function updateMainPreset(a){a=void 0===a?!1:a;var b=encodePreset(),c=getActivePreset();c.id||(c.id=getUniqueId());c.history.histories.length||(c.history.histories[0]=b);c.name=document.getElementById("input_preset_name").value.trim();b=[c.id,c.name,b,document.getElementById("preset_remarks").value.trim(),formatDate(new Date,"yyyy/MM/dd HH:mm:ss")];$("#allow_upload_preset").prop("checked")&&uploadMainPreset(b);if(!a){a=!1;if($("#modal_main_preset").find(".btn_commit_preset").hasClass("rename")){var d=
getUniqueId();b[0]=d;c.id=d}(d=loadLocalStorage("presets"))||(d=[]);for(var e=0;e<d.length;e++)if(d[e][0]===b[0]){d[e]=b;a=!0;break}a?inform_success("\u30d7\u30ea\u30bb\u30c3\u30c8\u300c"+b[1]+"\u300d\u306e\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"):(d.push(b),inform_success("\u30d7\u30ea\u30bb\u30c3\u30c8\u300c"+b[1]+"\u300d\u306e\u65b0\u898f\u767b\u9332\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"));saveLocalStorage("presets",d);updateActivePreset(c);
setTab()}$("#modal_main_preset").modal("hide")}
function uploadMainPreset(a){var b=castInt($("#select_preset_category").val()),c=$("#upload_user").val().trim();setting.uploadUserName=c;saveSetting();var d={id:a[0],name:a[1],data:a[2],memo:a[3],createdAt:firebase.firestore.FieldValue.serverTimestamp(),map:b,level:400<b?castInt($("#select_preset_level").val()):0,user:c};fb||initializeFB();fb?fb.runTransaction(function(e){var f=fb.collection("presets").doc();return e.get(f).then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){return 1==g.nextAddress?
g.yield(e.set(f,d),2):g["return"](d)})})}).then(function(e){inform_success("\u30d7\u30ea\u30bb\u30c3\u30c8\u300c"+a[1]+"\u300d\u306e\u7de8\u6210\u30c7\u30fc\u30bf\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002")})["catch"](function(e){console.error(e);inform_danger("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}):inform_danger("\u8b0e\u306e\u7406\u7531\u306b\u3088\u308a\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}
function expandMainPreset(a,b,c,d){b=void 0===b?!0:b;c=void 0===c?!0:c;d=void 0===d?!0:d;if(a)try{var e=a[0];$(".lb_plane").each(function(k,m){if(e&&0!==e.length){var n=e[0].find(function(r){return r[4]===k});n&&0!==n.length?(n={id:n[0],prof:n[1],remodel:n[2],slot:n[3]},setLBPlaneDiv($(m),n)):b&&setLBPlaneDiv($(m))}});$(".ohuda_select").each(function(k,m){$(m).find("option").prop("disabled",!1);if(e&&2<=e.length){var n=castInt(e[1][k],-1);$(m).val(1===n?2:n)}else $(m).val(-1)});if(e&&3<=e.length)for(var f=
0;2>=f;f++)document.getElementById("lb"+(f+1)+"_target_1").value=e[2][2*f],document.getElementById("lb"+(f+1)+"_target_2").value=e[2][2*f+1];5<=a.length?toggleDefenseMode(a[4]):toggleDefenseMode(!1);if(c){clearShipDivAll(6);var g=0,h=0;$(".ship_tab").each(function(k,m){var n=a[1].find(function(q){return q[2]===k});if(n){var r=$(m);setShipDiv(r,n[0]);r.find(".ship_plane").each(function(q,t){var u=$(t),x=n[1].find(function(w){return w[4]===q});x&&!u.hasClass("d-none")&&(setPlaneDiv(u,{id:x[0],prof:x[1],
remodel:x[2],slot:x[3]},!0),6<=x.length&&x[5]&&plane_unlock_Clicked(u.find(".plane_unlock")))});if(4<=n.length){var p=r.find(".ship_disabled");n[3]?(p.addClass("disabled"),p.children().addClass("fa-eye-slash").removeClass("fa-eye no_capture"),r.addClass("opacity4")):(p.removeClass("disabled"),p.children().removeClass("fa-eye-slash").addClass("fa-eye no_capture"),r.removeClass("opacity4"))}6>k?g++:h++}});$("#friendFleet_item1").find(".display_ship_count").val(Math.max(g,1));display_ship_count_Changed($("#friendFleet_item1").find(".display_ship_count"),
!0);$("#friendFleet_item2").find(".display_ship_count").val(Math.max(h,1));display_ship_count_Changed($("#friendFleet_item2").find(".display_ship_count"),!0)}c=1;for(f=0;f<a[2].length;f++)c<a[2][f][0]+1&&(c=a[2][f][0]+1);c=Math.min(c,10);if(0!==a[2].length||d)clearEnemyDivAll(c),$("#battle_count").val(c);$(isDefMode?"#air_raid_enemies":".battle_content").each(function(k,m){var n=a[2].find(function(t){return t[0]===k});if(n){3<=n.length?$(m)[0].dataset.celldata=n[2]:$(m)[0].dataset.celldata="";if(4<=
n.length){var r=castInt(n[3]);isDefMode?$(m).find(".cell_type").val([0,5].includes(r)?5:3):$(m).find(".cell_type").val(r);cell_type_Changed($(m).find(".cell_type"),!1)}else $(m).find(".cell_type").val(1);5<=n.length?$(m).find(".formation").val(n[4]):$(m).find(".formation").val(1);6<=n.length?$(m).find(".enemy_range").text(n[5]):$(m).find(".enemy_range").text(0);r=0;n=$jscomp.makeIterator(n[1]);for(var p=n.next();!p.done;p=n.next()){p=p.value;var q=$(m).find(".enemy_content").eq(r++);0<p?setEnemyDiv(q,
p):0>p?setEnemyDiv(q,-1,-p):clearEnemyDiv(q);q.addClass("d-flex").removeClass("d-none")}}});if(4<=a.length){var l=a[3];fleetStage2Table=l[0]&&0<l[0].length?l[0]:[];document.getElementById("fleet_antiair_base").value=l[1];document.getElementById("antiair_grand").checked=l[3];l[3]&&document.getElementById("antiair_air_raid").parentElement.classList.remove("d-none");document.getElementById("antiair_air_raid").checked=l[4];inputAntiAirWeights=l[5];document.getElementById("fleet_antiair_formation").value=
l[6]}else fleetStage2Table=[],inputAntiAirWeights=[]}catch(k){$(".ohuda_select").val(-1),$(".lb_plane").each(function(m,n){setLBPlaneDiv($(n))}),clearShipDivAll(6),clearEnemyDivAll(1),$("#battle_count").val(1),sendErrorLog(k)}}
function encodePreset(){try{var a=[createLandBasePreset(),createFriendFleetPreset(),createEnemyFleetPreset(),createAntiAirTablePreset(),isDefMode],b=JSON.stringify(a),c=utf8_to_b64(b),d=b64_to_utf8(c);JSON.parse(d);return c}catch(e){return utf8_to_b64(JSON.stringify([[],[],[]]))}}
function createLandBasePreset(){var a=[[],[],[]];$(".lb_plane:not(.ui-draggable-dragging)").each(function(e,f){var g=$(f);g=[castInt(g[0].dataset.planeid),castInt(g.find(".prof_select")[0].dataset.prof),castInt(g.find(".remodel_value").text()),castInt(g.find(".slot").text()),e];0!==g[0]&&a[0].push(g)});$(".ohuda_select").each(function(e,f){a[1].push(castInt($(f).val()))});for(var b=1;3>=b;b++)if(2!==a[1][b-1])a[2].push(-1),a[2].push(-1);else{var c=castInt(document.getElementById("lb"+b+"_target_1").value),
d=castInt(document.getElementById("lb"+b+"_target_2").value);a[2].push(c);a[2].push(d)}return a}
function createFriendFleetPreset(){var a=[],b=0;$(".ship_tab").each(function(c,d){6===c&&(b=6);if(!$(d).attr("class").includes("d-none")){var e=[castInt($(d)[0].dataset.shipid),[],b,$(d).find(".ship_disabled").hasClass("disabled")?1:0];$(d).find(".ship_plane:not(.ui-draggable-dragging)").each(function(f,g){var h=$(g);h=[castInt(h[0].dataset.planeid),castInt(h.find(".prof_select")[0].dataset.prof),castInt(h.find(".remodel_value").text()),castInt(h.find(".slot").text()),f,h.find(".plane_unlock").hasClass("d-none")?
1:0];0!==h[0]&&e[1].push(h)});if(0!==e[0]||0!==e[1].length)a.push(e),b++}});return a}
function createEnemyFleetPreset(){var a=[];$(isDefMode?"#air_raid_enemies":".battle_content").each(function(b,c){if(!$(c).attr("class").includes("d-none")){var d=[b,[],$(c)[0].dataset.celldata,castInt($(c).find(".cell_type").val()),castInt($(c).find(".formation").val()),castInt($(c).find(".enemy_range").text())];$(c).find(".enemy_content").each(function(e,f){var g=castInt($(f)[0].dataset.enemyid),h=castInt($(f).find(".enemy_ap").text());d[3]!==CELL_TYPE.grand&&6<=e||(0===g?d[1].push(0):0<g?d[1].push(g):
0<h&&d[1].push(-h))});0!==d[1].length&&a.push(d)}});return a}function createAntiAirTablePreset(){return[fleetStage2Table,castFloat(document.getElementById("fleet_antiair_base").value),0,document.getElementById("antiair_grand").checked,document.getElementById("antiair_air_raid").checked,inputAntiAirWeights,castInt(document.getElementById("fleet_antiair_formation").value)]}
function convertToDeckBuilder(){try{for(var a=createFriendFleetPreset(),b=createLandBasePreset(),c={version:4,f1:{},f2:{},a1:{mode:0,items:{}},a2:{mode:0,items:{}},a3:{mode:0,items:{}}},d=$jscomp.makeIterator(b[0]),e=d.next();!e.done;e=d.next()){var f=e.value;c["a"+(Math.floor(f[4]/4)+1)].items["i"+(Math.floor(f[4]%4)+1)]={id:f[0],rf:f[2],mas:f[1]}}for(d=0;d<b[1].length;d++){var g=b[1][d];c["a"+(d+1)].mode=0<g?1:0===g?2:0}b={};for(g=0;g<a.length;b={$jscomp$loop$prop$ship$345:b.$jscomp$loop$prop$ship$345},
g++){b.$jscomp$loop$prop$ship$345=a[g];var h=SHIP_DATA.find(function(p){return function(q){return q.id===p.$jscomp$loop$prop$ship$345[0]}}(b));if(h){d={i1:null,i2:null,i3:null,i4:null,i5:null};var l=$jscomp.makeIterator(b.$jscomp$loop$prop$ship$345[1]);for(e=l.next();!e.done;e=l.next()){var k=e.value,m={id:k[0],rf:k[2],mas:k[1]};d["i"+castInt(k[4]+1)]=m}var n={id:""+h.api,lv:99,luck:-1,items:d},r=b.$jscomp$loop$prop$ship$345[2];6>r?c.f1["s"+(r%6+1)]=n:c.f2["s"+(r%6+1)]=n}}return JSON.stringify(c)}catch(p){return""}}
function convertToDeckBuilder_j(){try{for(var a=createFriendFleetPreset(),b=createLandBasePreset(),c={version:1,name:getActivePreset().name,hqLevel:120,side:"Player",fleetType:$("#union_fleet").prop("checked")?"CarrierTaskForce":"Single",fleets:[{ships:[]},{ships:[]}],landBase:[{slots:[],equipments:[null,null,null,null]},{slots:[],equipments:[null,null,null,null]},{slots:[],equipments:[null,null,null,null]}]},d={},e=0;e<b[0].length;d={$jscomp$loop$prop$plane$347:d.$jscomp$loop$prop$plane$347},e++){d.$jscomp$loop$prop$plane$347=
b[0][e];var f=c.landBase[Math.floor(d.$jscomp$loop$prop$plane$347[4]/4)],g=Math.floor(d.$jscomp$loop$prop$plane$347[4]%4);f.slots[g]=d.$jscomp$loop$prop$plane$347[3];f.equipments[g]={masterId:d.$jscomp$loop$prop$plane$347[0],improvement:d.$jscomp$loop$prop$plane$347[2],proficiency:getInnerProficiency(d.$jscomp$loop$prop$plane$347[1],PLANE_DATA.find(function(n){return function(r){return r.id===n.$jscomp$loop$prop$plane$347[0]}}(d)).type)}}b={};for(d=0;d<a.length;b={$jscomp$loop$prop$ship$349:b.$jscomp$loop$prop$ship$349},
d++){b.$jscomp$loop$prop$ship$349=a[d];var h=SHIP_DATA.find(function(n){return function(r){return r.id===n.$jscomp$loop$prop$ship$349[0]}}(b));if(h){var l=c.fleets[6>b.$jscomp$loop$prop$ship$349[2]?0:1];e=[];var k={masterId:h.api,level:99,slots:[],equipments:e};for(f={$jscomp$loop$prop$j$353:0};f.$jscomp$loop$prop$j$353<h.slot.length;f={$jscomp$loop$prop$j$353:f.$jscomp$loop$prop$j$353,$jscomp$loop$prop$plane$154$354:f.$jscomp$loop$prop$plane$154$354},f.$jscomp$loop$prop$j$353++){var m=h.slot[f.$jscomp$loop$prop$j$353];
b.$jscomp$loop$prop$ship$349[1].find(function(n){return function(r){return r[4]===n.$jscomp$loop$prop$j$353}}(f))&&(m=b.$jscomp$loop$prop$ship$349[1].find(function(n){return function(r){return r[4]===n.$jscomp$loop$prop$j$353}}(f))[3]);k.slots.push(m);f.$jscomp$loop$prop$plane$154$354=b.$jscomp$loop$prop$ship$349[1].find(function(n){return function(r){return r[4]===n.$jscomp$loop$prop$j$353}}(f));f.$jscomp$loop$prop$plane$154$354?e.push({masterId:f.$jscomp$loop$prop$plane$154$354[0],improvement:f.$jscomp$loop$prop$plane$154$354[2],
proficiency:getInnerProficiency(f.$jscomp$loop$prop$plane$154$354[1],PLANE_DATA.find(function(n){return function(r){return r.id===n.$jscomp$loop$prop$plane$154$354[0]}}(f)).type)}):e.push(null)}l.ships.push(k)}}return JSON.stringify(c)}catch(n){return""}}function updatePlaneSelectedHistory(a){setting.selectedHistory[0].unshift(a);setting.selectedHistory[0]=setting.selectedHistory[0].splice(0,100);saveSetting()}
function updateShipSelectedHistory(a){setting.selectedHistory[1].unshift(a);setting.selectedHistory[1]=setting.selectedHistory[1].splice(0,100);saveSetting()}
function drawResult(a){$("#rate_table tbody").find(".rate_tr").addClass("d-none disabled_tr");$(".progress_area").addClass("d-none disabled_bar").removeClass("d-flex");$(".simple_lb_progress").addClass("d-none").removeClass("d-flex");$("#fleet_simple_bar").addClass("d-none");var b=isDefMode?1:6,c=[],d=[],e=[];isDefMode?(c.push(resultData.defenseAirPower),d.push(resultData.enemyAirPowers[6])):(c=resultData.landBaseAirPowers,c.push(resultData.fleetAirPower),d=resultData.enemyAirPowers,e=resultData.landBaseAirStatus);
e.push(resultData.fleetAirStatus);for(var f={},g=0;g<=b;f={$jscomp$loop$prop$abbr$356:f.$jscomp$loop$prop$abbr$356,$jscomp$loop$prop$ap$357:f.$jscomp$loop$prop$ap$357,$jscomp$loop$prop$status$359:f.$jscomp$loop$prop$status$359},g++){var h=isDefMode?8:g+1,l=$("#result_bar_"+h),k=$("#rate_row_"+h);f.$jscomp$loop$prop$ap$357=c[g];var m=d[g],n=e[g],r=getAirStatusBorder(m);f.$jscomp$loop$prop$status$359=isDefMode?getAirStatusIndex(f.$jscomp$loop$prop$ap$357,m):n.indexOf(getArrayMax(n));var p=0,q=!1;4===
f.$jscomp$loop$prop$status$359?p=f.$jscomp$loop$prop$ap$357/r[3]*10:3===f.$jscomp$loop$prop$status$359?p=f.$jscomp$loop$prop$ap$357/r[2]*20:2===f.$jscomp$loop$prop$status$359?p=f.$jscomp$loop$prop$ap$357/r[1]*45:1>=f.$jscomp$loop$prop$status$359&&(p=f.$jscomp$loop$prop$ap$357/r[0]*90);if(5===f.$jscomp$loop$prop$status$359&&7!==h)f.$jscomp$loop$prop$status$359=0,p=100;else if(5===f.$jscomp$loop$prop$status$359){f.$jscomp$loop$prop$abbr$356=$("#shoot_down_table").find(".cond.battle"+displayBattle).text();
var t=AIR_STATUS.find(function(x){return function(w){return w.abbr===x.$jscomp$loop$prop$abbr$356}}(f));t&&(f.$jscomp$loop$prop$status$359=t.id);0===f.$jscomp$loop$prop$status$359&&(p=100)}var u=l.data("airstatus");t="bar_status"+f.$jscomp$loop$prop$status$359;l.removeClass("bar_status"+u).addClass(t).css({width:(100<p?100:p)+"%"}).data("airstatus",f.$jscomp$loop$prop$status$359);k.find(".rate_td_ap").text(f.$jscomp$loop$prop$ap$357);u=k.find(".rate_td_eap");u.find(".avg_eap").text(m);u.find(".eap_border").html("( "+
r.slice(0,4).map(function(x){return function(w){return w<=x.$jscomp$loop$prop$ap$357?"<b>"+w+"</b>":w.toString()}}(f)).join(" / ")+" )");for(u=0;u<n.length;u++)k.find(".rate_td_status"+u).text("-"),isDefMode?k.find(".rate_td_status"+f.$jscomp$loop$prop$status$359).text("100 %"):0<n[u]&&(q=100*n[u],k.find(".rate_td_status"+u).text((100===q?100:q.toFixed(2))+" %"),q=!0);if(q||isDefMode&&8===h)k.removeClass("d-none disabled_tr"),l.closest(".progress_area").addClass("d-flex").removeClass("d-none disabled_bar");
l="bar_ex_status"+f.$jscomp$loop$prop$status$359;isDefMode&&(k=$("#simple_lb_def_bar"),m=k.find(".result_bar"),u=m.data("airstatus"),m.removeClass("bar_status"+u+" bar_ex_status"+u).addClass(t+" "+l).css({width:(100<p?100:p)+"%"}).data("airstatus",f.$jscomp$loop$prop$status$359),k.find(".simple_label").text(AIR_STATUS.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$status$359}}(f)).abbr),k.removeClass("d-none"));7===h&&q&&-1<f.$jscomp$loop$prop$status$359&&(h=$("#fleet_simple_bar"),
q=h.find(".result_bar"),u=q.data("airstatus"),q.removeClass("bar_status"+u+" bar_ex_status"+u).addClass(t+" "+l).css({width:(100<p?100:p)+"%"}).data("airstatus",f.$jscomp$loop$prop$status$359),n=AIR_STATUS.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$status$359}}(f)).abbr+"("+Math.floor(100*n[f.$jscomp$loop$prop$status$359])+"%)",h.find(".simple_label").text(n),h.removeClass("d-none"));if(isDefMode)break}e=d=c=0;b=castInt($("#calculate_count").val());for(f=0;f<resultData.fleetSlots.length;f++)if(g=
resultData.fleetSlots[f],n=100*g.deathRate,p=document.getElementsByClassName("slot"+g.slot+" shipNo"+g.shipNo)[0])if(t=castInt(p.getElementsByClassName("battle1")[0].textContent))p.getElementsByClassName("battle_end")[0].textContent=Math.round(g.avg),p.getElementsByClassName("battle_death")[0].textContent=0===g.deathRate?"-":10<=n?n.toFixed(1)+" %":n.toFixed(2)+" %",0<t&&(c+=5*(t-g.avg),d+=5*(t-g.max),e+=5*(t-g.min));resultData.usedSteels?(d=resultData.usedSteels/b,$(".battle_end.fap").html()||$(".battle_end.fap").html("\u6d88\u8cbb\u4e88\u6e2c"),
$(".battle_end.eap").html('\n\t\t<div><img src="../img/util/bauxite.png" class="img-size-18" alt="\u30dc\u30fc\u30ad\u30b5\u30a4\u30c8">: '+c.toFixed(1)+'</div>\n\t\t<div><img src="../img/util/steel.png" class="img-size-18" alt="\u92fc\u6750">: '+d.toFixed(1)+"</div>\n\t\t")):($(".battle_end.fap").html()||$(".battle_end.fap").html('<img src="../img/util/bauxite.png" class="img-size-18" alt="\u30dc\u30fc\u30ad\u30b5\u30a4\u30c8">\u6d88\u8cbb\u4e88\u6e2c'),$(".battle_end.eap").html(d+" ~ "+e+" ( "+
c.toFixed(1)+" )"));for(c=0;c<resultData.enemySlots.length;c++)d=resultData.enemySlots[c],e=document.getElementsByClassName("enemy_no_"+d[0]+" slot_"+d[1])[0],f=Math.floor(d[2]/b*10),e.getElementsByClassName("td_avg_slot")[0].textContent=0===f?"0":f/10,e.getElementsByClassName("td_max_slot")[0].textContent=d[3],e.getElementsByClassName("td_min_slot")[0].textContent=d[4];if(!isDefMode&&!document.getElementById("ignore_stage2").checked&&0<fleetStage2Table.length){for(c=0;c<resultData.enemySlotAllDead.length;c++)d=
Math.floor(resultData.enemySlotAllDead[c]/b*1E3)/10,document.getElementsByClassName("enemy_no_"+c+" slot_0")[0].getElementsByClassName("td_all_dead")[0].textContent=d+"%";document.getElementById("enemy_slot_result_mode").textContent="\uff08\u822a\u7a7a\u6226 stage2 \u5f8c\uff09"}else document.getElementById("enemy_slot_result_mode").textContent="\uff08\u822a\u7a7a\u6226 stage1 \u5f8c\uff09";d=resultData.enemyAirPowerResults[0];c=resultData.enemyAirPowerResults[1];if(d.length)for(d=getEnemyApDistribution(d),
e=document.getElementById("enemy_ap_bf_dist_min"),f=$jscomp.makeIterator(d),d=f.next();!d.done;d=f.next())e.textContent=d.value,e=e.nextElementSibling;if(c.length)for(d=getEnemyApDistribution(c),c=document.getElementById("enemy_ap_af_dist_min"),e=$jscomp.makeIterator(d),d=e.next();!d.done;d=e.next())c.textContent=d.value,c=c.nextElementSibling;a=$jscomp.makeIterator(a.landBaseData.landBases);for(c=a.next();!c.done;c=a.next())if(c=c.value,e=c.target[0],f=c.target[1],-1!==e&&-1!==f&&!isDefMode)for(d=
e<=f?[e,f]:[f,e],e=e<=f?[0,1]:[1,0],f={},g=0;1>=g;f={$jscomp$loop$prop$status$165$361:f.$jscomp$loop$prop$status$165$361},g++)n=c.results[d[g]].airStatusIndex[e[g]],t=c.results[d[g]].mainAirPower[e[g]]/b,h=c.results[d[g]].enemyAirPower[e[g]]/b,f.$jscomp$loop$prop$status$165$361=n.indexOf(getArrayMax(n)),p=0,h=getAirStatusBorder(h),4===f.$jscomp$loop$prop$status$165$361?p=t/h[3]*10:3===f.$jscomp$loop$prop$status$165$361?p=t/h[2]*20:2===f.$jscomp$loop$prop$status$165$361?p=t/h[1]*45:1>=f.$jscomp$loop$prop$status$165$361&&
(p=t/h[0]*90),5===f.$jscomp$loop$prop$status$165$361&&(f.$jscomp$loop$prop$status$165$361=0,p=100),h="bar_status"+f.$jscomp$loop$prop$status$165$361,q="bar_ex_status"+f.$jscomp$loop$prop$status$165$361,t=$("#simple_lb_bar_"+c.baseNo+"_"+(g+1)),u=t.find(".result_bar"),l=u.data("airstatus"),u.removeClass("bar_status"+l+" bar_ex_status"+l).addClass(h+" "+q).css({width:(100<p?100:p)+"%"}).data("airstatus",f.$jscomp$loop$prop$status$165$361),n=AIR_STATUS.find(function(x){return function(w){return w.id===
x.$jscomp$loop$prop$status$165$361}}(f)).abbr+"("+Math.floor(getArrayMax(n)/b*100)+"%)",t.find(".simple_label").text(n),t.removeClass("d-none");display_result_Changed();resultData.enemyAirPowerResults=null;resultData.fleetSlots=null}
function getEnemyApDistribution(a){a.sort(function(r,p){return r-p});for(var b=a.length,c=a[0],d=a[a.length-1],e=0,f=0,g=0,h=0,l=0,k=0,m=c;m<d;m++){for(var n=0;a.length&&a[0]===m;)a.shift(),n++;n&&(k+=100*n/b,!e&&50<=k&&(e=m),!f&&75<=k&&(f=m),!g&&90<=k&&(g=m),!h&&95<=k&&(h=m),!l&&99<=k&&(l=m))}return[c,e?e:d,f?f:d,g?g:d,h?h:d,l?l:d,d]}
function getAirStatusIndex(a,b){if(1E3>=a)return b<AIR_STATUS_TABLE[a].length-1?AIR_STATUS_TABLE[a][b]:4;for(var c=getAirStatusBorder(b),d=c.length,e=0;e<d;e++)if(a>=c[e])return 0!==a?e:4}function getAirStatusBorder(a){return 0===a?[0,0,0,0,0]:[3*a,Math.ceil(1.5*a),Math.floor(a/1.5)+1,Math.floor(a/3)+1,0]}function calculate(){var a={landBaseData:new LandBaseAll,friendFleetData:new Fleet,battleData:[]};try{calculateInit(a),rateCalculate(a),drawResult(a)}catch(b){sendErrorLog(b)}}
function sendErrorLog(a){var b={name:a.name,message:a.message,stack:a.stack,data:encodePreset(),createdAt:firebase.firestore.FieldValue.serverTimestamp(),remarks:"",version:"1.11.0"};fb||initializeFB();fb&&fb.runTransaction(function(c){var d=fb.collection("errors").doc();return c.get(d).then(function(){return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){return e.yield(c.set(d,b),0)})})}).then(function(c){})["catch"](function(c){});a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div class="px-2">\n\t\t\t<div class="h6">\u8a08\u7b97\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002</div>\n\t\t\t<div class="my-1">\n\t\t\t\t<div class="pl-2">\n\t\t\t\t\t\u3000\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u60aa\u3055\u3092\u3057\u3066\u3044\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u4e00\u5ea6\u3001\u3053\u306e\u307e\u307e\u672c\u8a08\u7b97\u753b\u9762\u306b\u3066\u30d6\u30e9\u30a6\u30b6\u306e\u30b9\u30fc\u30d1\u30fc\u30ea\u30ed\u30fc\u30c9\u3092\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002\n\t\t\t\t</div>\n\t\t\t\t<div class="pl-2 mt-3">\n\t\t\t\t\t\u3000\u305d\u308c\u3067\u3082\u6539\u5584\u3057\u306a\u3044\u5834\u5408\u3001\u304a\u624b\u6570\u3067\u3059\u304c\u3001\u76f4\u524d\u306b\u3069\u306e\u3088\u3046\u306a\u57fa\u5730\u3084\u8266\u5a18\u306e\u88c5\u5099\u306a\u3069\u306e\u64cd\u4f5c\u3092\u3057\u3088\u3046\u3068\u3057\u305f\u304b\u3092\n\t\t\t\t\t<a href="https://odaibako.net/u/noro_006" target="_blank">\u3053\u3061\u3089</a>\u307e\u3067\u3054\u5831\u544a\u3044\u305f\u3060\u3051\u308b\u3068\u5e78\u3044\u3067\u3059\u3002\n\t\t\t\t\t\u5831\u544a\u3092\u9802\u304d\u6b21\u7b2c\u3001\u53ef\u80fd\u306a\u9650\u308a\u65e9\u671f\u306e\u8abf\u67fb\u3001\u4fee\u6b63\u3092\u884c\u3044\u307e\u3059\u3002\u3054\u4e0d\u4fbf\u3092\u304a\u304b\u3051\u3057\u3066\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u3002\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t');
confirmType="Error";a.modal("show")}
function calculateInit(a){document.getElementById("draggable_plane_box").classList.add("d-none");document.getElementById("ship_info_table").getElementsByTagName("tbody")[0].innerHTML="";document.getElementById("shoot_down_table").getElementsByTagName("tbody")[0].innerHTML="";document.getElementById("enemy_shoot_down_table").getElementsByTagName("tbody")[0].innerHTML="";document.getElementById("input_summary").value="";document.getElementsByClassName("info_defApEx")[0]&&(document.getElementsByClassName("info_defApEx")[0].textContent=
"");for(var b=$jscomp.makeIterator(document.getElementById("shoot_down_table").getElementsByTagName("tfoot")[0].getElementsByClassName("td_battle")),c=b.next();!c.done;c=b.next())c.value.innerHTML="";b=$jscomp.makeIterator(document.getElementById("shoot_down_table").getElementsByTagName("td"));for(c=b.next();!c.done;c=b.next())c.value.classList.remove("airStatus0","airStatus1","airStatus2","airStatus3","airStatus4");isDefMode?(document.getElementById("ship_info").classList.add("d-none"),document.getElementById("shoot_down_table_content").classList.add("d-none"),
document.getElementById("friendFleet").classList.add("d-none"),document.getElementById("normal_enemies").classList.add("d-none"),document.getElementById("display_battle_tab").classList.add("d-none"),document.getElementById("air_raid_enemies").classList.remove("d-none"),b=document.getElementById("battle_count_content"),b.classList.add("d-none"),b.classList.remove("d-flex")):(document.getElementById("ship_info").classList.remove("d-none"),document.getElementById("shoot_down_table_content").classList.remove("d-none"),
document.getElementById("friendFleet").classList.remove("d-none"),document.getElementById("normal_enemies").classList.remove("d-none"),document.getElementById("display_battle_tab").classList.remove("d-none"),document.getElementById("air_raid_enemies").classList.add("d-none"),b=document.getElementById("battle_count_content"),b.classList.add("d-flex"),b.classList.remove("d-none"));usedPlane=[];usedShip=[];updateLandBaseInfo(a.landBaseData);updateFriendFleetInfo(a.friendFleetData);updateEnemyFleetInfo(a.battleData);
var d=encodePreset();a=getActivePreset();b=a.history;var e=b.histories;(c=""!==a.id)&&a.id&&e[b.index]!==d&&(0!==b.index&&e.splice(0,b.index),e.unshift(d),b.histories=e.splice(0,20),b.index=0,d=$("#fleet_tab_container .active:not(.unsaved)"),d.find(".fleet_tab_icon").html("&#8727;"),d.addClass("unsaved"),updateActivePreset(a));c&&b.index<b.histories.length-1?document.getElementById("btn_undo").classList.remove("disabled"):document.getElementById("btn_undo").classList.add("disabled");c&&0<b.index?
document.getElementById("btn_redo").classList.remove("disabled"):document.getElementById("btn_redo").classList.add("disabled");setting.emptySlotInvisible!==document.getElementById("empty_slot_invisible").checked&&(setting.emptySlotInvisible=document.getElementById("empty_slot_invisible").checked,saveSetting());resultData={enemyAirPowers:[],enemyAirPowerResults:[],enemySlots:[],enemySlotAllDead:[],landBaseAirPowers:[],landBaseAirStatus:[],fleetAirPower:0,fleetAirStatus:[],fleetSlots:[],defenseAirPower:0,
usedSteels:0};setPreCalculateTable()}
function updateLandBaseInfo(a,b){b=void 0===b?!0:b;for(var c="",d="",e=document.getElementsByClassName("lb_tab"),f=0;f<e.length;f++){var g=e[f],h=f+1,l=new LandBase(h,-1);d="\u7b2c"+h+"\u57fa\u5730\u822a\u7a7a\u968a\uff1a";for(var k=g.getElementsByClassName("lb_plane"),m={},n=0;n<k.length;m={$jscomp$loop$prop$plane$363:m.$jscomp$loop$prop$plane$363},n++){var r=k[n],p=n+1;if(4<=n)break;var q=castInt(r.dataset.planeid),t=castInt(r.getElementsByClassName("remodel_value")[0].textContent),u=castInt(r.getElementsByClassName("prof_select")[0].dataset.prof);
r=r.getElementsByClassName("slot")[0];m.$jscomp$loop$prop$plane$363=new LandBasePlane(q,castInt(r.textContent),t,u);r.textContent=m.$jscomp$loop$prop$plane$363.slot;m.$jscomp$loop$prop$plane$363.slotNo=p;0<m.$jscomp$loop$prop$plane$363.id&&l.planes.push(m.$jscomp$loop$prop$plane$363);b&&((q=usedPlane.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$plane$363.id}}(m)))?q.num[m.$jscomp$loop$prop$plane$363.remodel]++:(q={id:m.$jscomp$loop$prop$plane$363.id,num:[0,0,0,0,0,0,0,0,0,
0,0]},q.num[m.$jscomp$loop$prop$plane$363.remodel]++,usedPlane.push(q)),p=document.getElementsByClassName("lb_info_lb_"+h+" slot"+p)[0],q=p.getElementsByClassName("info_plane")[0],t=m.$jscomp$loop$prop$plane$363.name+(0!==m.$jscomp$loop$prop$plane$363.remodel?"\u2605"+m.$jscomp$loop$prop$plane$363.remodel:""),q.className="info_plane "+getPlaneCss(m.$jscomp$loop$prop$plane$363.type).replace("css","shoot_table"),q.innerHTML=t?t+" "+getProfString(m.$jscomp$loop$prop$plane$363.level):"-",p.getElementsByClassName("info_slot")[0].textContent=
t?m.$jscomp$loop$prop$plane$363.slot.toString():"",p.getElementsByClassName("info_ap")[0].textContent=t?m.$jscomp$loop$prop$plane$363.airPower.toString():"",d+=" "+(m.$jscomp$loop$prop$plane$363.name?m.$jscomp$loop$prop$plane$363.name+" "+getProfString(m.$jscomp$loop$prop$plane$363.level):"\u672a\u88c5\u5099")+",")}d=d.slice(0,-1)+"\n";-1===l.planes.findIndex(function(x){return 0<x.id})&&(l.mode=-1,g.getElementsByClassName("ohuda_select")[0].value=-1);l.mode=castInt(g.getElementsByClassName("ohuda_select")[0].value);
2===l.mode&&(k=castInt(document.getElementById("lb"+h+"_target_1").value),m=castInt(document.getElementById("lb"+h+"_target_2").value),n=battleCount-1,l.target[0]=k<=n?0<=k?k:n:n,l.target[1]=m<=n?0<=m?m:n:n);0===l.mode?l.updateDefenseAirPower():(l.updateAirPower(),l.fullAirPower=l.airPower);a.landBases.push(l);if(b){isDefMode&&0!==l.mode||!isDefMode&&2!==l.mode?g.classList.add("opacity6"):g.classList.remove("opacity6");n=g.getElementsByClassName("resource")[0];k=n.getElementsByClassName("bauxite")[0];
m=n.getElementsByClassName("fuel")[0];n=n.getElementsByClassName("ammo")[0];drawChangeValue(m,castInt(m.textContent),l.getSumFuel(),!0);drawChangeValue(n,castInt(n.textContent),l.getSumAmmo,!0);drawChangeValue(k,castInt(k.textContent),l.getSumBauxite,!0);k=0===l.mode?l.defenseAirPower:l.airPower;h=document.getElementsByClassName("lb_info_lb_"+h);m=h[0].getElementsByClassName("info_sumAp")[0];drawChangeValue(m,castInt(m.textContent),k);m=g.getElementsByClassName("ap")[0];drawChangeValue(m,castInt(m.textContent),
k);k=0===l.mode?l.planes.map(function(x){return x.defenseAirPower}):l.planes.map(function(x){return x.airPower});1<l.reconCorr?g.getElementsByClassName("ap_detail")[0].textContent="( "+k.join(" / ")+" ) \u00d7 "+l.reconCorr:g.getElementsByClassName("ap_detail")[0].textContent="( "+k.join(" / ")+" )";k=l.getRange();m=h[0].getElementsByClassName("info_range")[0];drawChangeValue(m,castInt(m.textContent),k);m=g.getElementsByClassName("range")[0];drawChangeValue(m,castInt(m.textContent),k);0<l.mode&&(g=
document.getElementById("battle_container").getElementsByClassName("enemy_range"),g.length>=l.target[0]&&castInt(g[l.target[0]].textContent)>k?c+=(c.length?",":"")+(f+1):g.length>=l.target[1]&&castInt(g[l.target[1]].textContent)>k&&(c+=(c.length?",":"")+(f+1)));h=$jscomp.makeIterator(h);for(g=h.next();!g.done;g=h.next())g=g.value,isDefMode&&0===l.mode||!isDefMode&&2===l.mode?g.classList.remove("d-none"):g.classList.add("d-none");if(isDefMode&&0===l.mode||!isDefMode&&2===l.mode&&l.planes.length)document.getElementById("input_summary").value+=
d.trim()+"\n"}}if(b){d=0;e=document.getElementById("lb_info_table").getElementsByTagName("tbody")[0].getElementsByClassName("lb_info_tr");f=$jscomp.makeIterator(e);for(e=f.next();!e.done;e=f.next())e.value.classList.contains("d-none")||d++;document.getElementById("lb_info").classList.remove("col-lg-8","col-xl-7");document.getElementById("lb_info").classList.add("col-lg-6");if(0<d){$("#lb_info_table tbody").find(".info_defAp").remove();e=$jscomp.makeIterator(document.getElementById("lb_info_table").getElementsByTagName("tbody")[0].getElementsByClassName("info_defAp"));
for(f=e.next();!f.done;f=e.next())f.value.remove();if(isDefMode){a.updateDefenseAirPower();f=a.defenseAirPower;l=a.defense2AirPower;document.getElementById("def_sum_ap_all").textContent=f;document.getElementById("def_sum_ex_ap_all").textContent=l;document.getElementById("rocket_c").textContent=a.rocketBonus;document.getElementById("lb_info").classList.add("col-lg-8","col-xl-7");document.getElementById("lb_info").classList.remove("col-lg-6");g=document.getElementById("lb_info_table");h=$jscomp.makeIterator(g.getElementsByClassName("info_range"));
for(e=h.next();!e.done;e=h.next())e.value.classList.add("d-none");h=$jscomp.makeIterator(g.getElementsByClassName("info_defAp"));for(e=h.next();!e.done;e=h.next())e.value.classList.remove("d-none");e=$jscomp.makeIterator(g.getElementsByClassName("lb_info_tr"));for(g=e.next();!g.done;g=e.next())if(g=g.value,!g.classList.contains("d-none")){e=document.createElement("td");e.className="info_defAp";e.rowSpan=d;e.textContent=f;g.appendChild(e);e=document.createElement("td");e.className="info_defAp info_defApEx";
e.rowSpan=d;e.textContent=l;g.appendChild(e);break}}else{d=document.getElementById("lb_info_table");f=$jscomp.makeIterator(d.getElementsByClassName("info_range"));for(e=f.next();!e.done;e=f.next())e.value.classList.remove("d-none");d=$jscomp.makeIterator(d.getElementsByClassName("info_defAp"));for(e=d.next();!e.done;e=d.next())e.value.classList.add("d-none")}document.getElementById("ng_range").textContent=c;document.getElementById("lb_info_table").getElementsByClassName("info_warning")[0].classList.add("d-none");
c.length?(document.getElementById("lb_range_warning").classList.remove("d-none"),inform_warning("\u7b2c"+c+"\u57fa\u5730\u822a\u7a7a\u968a\u306e\u534a\u5f84\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002")):document.getElementById("lb_range_warning").classList.add("d-none");document.getElementById("input_summary").value+="\n"}else document.getElementById("lb_info_table").getElementsByClassName("info_warning")[0].classList.remove("d-none"),document.getElementById("lb_range_warning").classList.add("d-none");
c=$jscomp.makeIterator(document.getElementsByClassName("battle_only"));for(d=c.next();!d.done;d=c.next())d=d.value,isDefMode?d.classList.add("d-none"):d.classList.remove("d-none");isDefMode?(document.getElementById("defense_summary").classList.remove("d-none"),document.getElementById("defense_summary").classList.add("d-flex")):(document.getElementById("defense_summary").classList.remove("d-flex"),document.getElementById("defense_summary").classList.add("d-none"))}}
function getInnerProficiency(a,b){switch(a){case 7:return initialProf120Plane.includes(Math.abs(b))?120:100;case 0:return 0;case 1:return 10;case 2:return 25;case 3:return 40;case 4:return 55;case 5:return 70;case 6:return 85;default:return 0}}
function getReconnaissancesAdjust(a,b){b=void 0===b?!1:b;if(!b&&104===a.type)return 9===a.scout?1.18:8===a.scout?1.15:1;if(b){if(104===a.type)return 9===a.scout?1.24:1.18;if(4===a.type)return 8<a.scout?1.3:1.2;if([5,8].includes(a.type))return 8<a.scout?1.16:8===a.scout?1.13:1.1}return 1}
function getContactSelectRate(a){if([2,-2,4,5,8,104].includes(a.type)){var b=a.scout,c=a.remodel;switch(a.id){case 102:b=Math.ceil(b+.1*c);break;case 25:case 163:case 304:case 370:case 239:b=Math.ceil(b+.14*c);break;case 59:b=Math.ceil(b+.2*c);break;case 61:b=Math.ceil(b+.25*c);break;case 151:b=Math.ceil(b+.4*c)}return[b/14,b/16,b/18]}return[]}
function updateFriendFleetInfo(a,b){b=void 0===b?!0:b;var c="",d=null,e=$("#union_fleet").prop("checked");d=e?document.getElementsByClassName("ship_tab"):$(".friendFleet_tab.show.active")[0].getElementsByClassName("ship_tab");setting.isUnion=e;saveSetting();for(var f={},g=0;g<d.length;f={$jscomp$loop$prop$shipId$186$367:f.$jscomp$loop$prop$shipId$186$367},g++){var h=d[g],l=g+1,k=castInt(h.dataset.shipid);k&&usedShip.push(k);if(!h.classList.contains("d-none")&&!h.getElementsByClassName("ship_disabled")[0].classList.contains("disabled")){k=
new Ship(l);var m=0;c={};for(var n=$jscomp.makeIterator(h.getElementsByClassName("ship_plane")),r=n.next();!r.done;c={$jscomp$loop$prop$plane$365:c.$jscomp$loop$prop$plane$365},r=n.next()){var p=r.value;if(!p.classList.contains("ui-draggable")){r=castInt(p.dataset.planeid);var q=castInt(p.getElementsByClassName("remodel_value")[0].textContent),t=castInt(p.getElementsByClassName("prof_select")[0].dataset.prof);p=p.getElementsByClassName("slot")[0];c.$jscomp$loop$prop$plane$365=new ShipPlane(r,castInt(p.textContent),
q,t);p.textContent=c.$jscomp$loop$prop$plane$365.slot;c.$jscomp$loop$prop$plane$365.slotNo=m++;k.planes.push(c.$jscomp$loop$prop$plane$365);(r=usedPlane.find(function(F){return function(C){return C.id===F.$jscomp$loop$prop$plane$365.id}}(c)))?r.num[c.$jscomp$loop$prop$plane$365.remodel]++:(r={id:c.$jscomp$loop$prop$plane$365.id,num:[0,0,0,0,0,0,0,0,0,0,0]},r.num[c.$jscomp$loop$prop$plane$365.remodel]++,usedPlane.push(r))}}k.isEscort=e&&6<l;-1<k.planes.findIndex(function(F){return 0<F.id})&&a.ships.push(k);
k.updateAirPower();k.initFullAirPower();if(b){m=0;c=$jscomp.makeIterator(k.planes);for(n=c.next();!n.done;n=c.next())n=n.value,0<n.id&&0<n.slot&&m++;c=h.getElementsByClassName("ap")[0];n=castInt(c.textContent);drawChangeValue(c,n,k.airPower);if(0<m){f.$jscomp$loop$prop$shipId$186$367=castInt(h.dataset.shipid);r=f.$jscomp$loop$prop$shipId$186$367?SHIP_DATA.find(function(F){return function(C){return C.id===F.$jscomp$loop$prop$shipId$186$367}}(f)):null;q=document.createDocumentFragment();n=document.createDocumentFragment();
var u=!0;t=document.getElementById("empty_slot_invisible").checked;r&&!t&&(m=r.slot.length);c=(r?r.name:"\u672a\u6307\u5b9a")+"\uff1a";p=document.createElement("tr");for(var x=document.createElement("tr"),w=0;w<k.planes.length;w++){var v=k.planes[w],y=v.name;if(r||0!==v.id&&0!==v.slot){if(r&&w===r.slot.length)break;c+=" "+(y?y+" "+getProfString(v.level):"\u672a\u88c5\u5099")+",";if(!r||!t||0!==v.id&&0!==v.slot){var A=getPlaneCss(v.type).replace("css","shoot_table");if(u){var B=document.createElement("tr");
B.className="slot"+w+" shipNo"+l;B.dataset.shipid=r?r.id:0;B.dataset.shipindex=a.ships.length-1;B.dataset.slotindex=w;B.dataset.css=A+"_hover";var z=document.createElement("td");z.rowSpan=m;z.className="td_name align-middle";z.textContent=r?r.name:"\u672a\u6307\u5b9a";B.appendChild(z);z=document.createElement("td");z.className="pl-1 td_plane_name align-middle "+A;z.textContent=y;B.appendChild(z);p.appendChild(z.cloneNode(!1));for(z=1;10>=z;z++){var D=document.createElement("td");D.className="td_battle battle"+
z+" align-middle";B.appendChild(D);p.appendChild(D.cloneNode(!1))}z=document.createElement("td");z.className="td_battle battle_end align-middle";B.appendChild(z);p.appendChild(z.cloneNode(!1));z=document.createElement("td");z.className="td_battle battle_death align-middle";B.appendChild(z);p.appendChild(z.cloneNode(!1));q.appendChild(B)}else B=p.cloneNode(!0),B.className="slot"+w+" shipNo"+l,B.dataset.shipid=r?r.id:0,B.dataset.shipindex=a.ships.length-1,B.dataset.slotindex=w,B.dataset.css=A+"_hover",
z=B.getElementsByClassName("td_plane_name")[0],z.className="pl-1 td_plane_name align-middle "+A,z.textContent=y,q.appendChild(B);y+=0!==v.remodel?"\u2605"+v.remodel:"";u?(u=document.createElement("tr"),u.className="ship_info_tr slot"+(w+1),B=document.createElement("td"),B.rowSpan=m,B.className="info_name",B.textContent=r?r.name:"\u672a\u6307\u5b9a",u.appendChild(B),B=document.createElement("td"),B.className="info_plane "+A,B.innerHTML=y+" "+getProfString(v.level),u.appendChild(B),x.appendChild(B.cloneNode(!1)),
A=document.createElement("td"),A.className="info_slot",A.textContent=v.slot,u.appendChild(A),x.appendChild(A.cloneNode(!1)),A=document.createElement("td"),A.className="info_ap",A.textContent=v.airPower,u.appendChild(A),x.appendChild(A.cloneNode(!1)),v=document.createElement("td"),v.rowSpan=m,v.className="info_sumAp",v.textContent=k.airPower,u.appendChild(v),n.appendChild(u)):(u=x.cloneNode(!0),u.className="ship_info_tr slot"+(w+1),B=u.getElementsByClassName("info_plane")[0],B.className="info_plane "+
A,B.innerHTML=y+" "+getProfString(v.level),u.getElementsByClassName("info_slot")[0].textContent=v.slot,u.getElementsByClassName("info_ap")[0].textContent=v.airPower,n.appendChild(u));u=!1}}}document.getElementById("shoot_down_table_tbody").appendChild(q);l=document.getElementById("ship_info_table").getElementsByTagName("tbody")[0];l.appendChild(n);l=l.getElementsByTagName("tr");if(0<l.length)for(l=$jscomp.makeIterator(l[l.length-1].getElementsByTagName("td")),m=l.next();!m.done;m=l.next())m.value.classList.add("last_slot");
document.getElementById("input_summary").value+=c.slice(0,-1)+"\n"}else if(0===document.getElementById("shoot_down_table_tbody").getElementsByTagName("tr").length){l=document.createElement("tr");l.className="slot0 shipNo0";m=document.createElement("td");m.className="td_name align-middle";m.textContent="\u672a\u9078\u629e";l.appendChild(m);m=document.createElement("td");m.className="td_plane_name text-nowrap align-middle text-center";m.textContent="-";l.appendChild(m);for(m=1;10>=m;m++)c=document.createElement("td"),
c.className="td_battle battle"+m+" align-middle",l.appendChild(c);m=document.createElement("td");m.className="td_battle battle_end align-middle";m.textContent=k.airPower;l.appendChild(m);document.getElementById("shoot_down_table_tbody").appendChild(l)}k.planes.length?h.getElementsByClassName("ap_detail")[0].textContent="( "+k.planes.map(function(F){return F.airPower}).join(" / ")+" )":h.getElementsByClassName("ap_detail")[0].textContent=""}}}a.updateAirPower();a.initFullAirPower();if(b){d=[];f=$jscomp.makeIterator(a.ships);
for(g=f.next();!g.done;g=f.next())d=d.concat(g.value.planes);d=createContactTable(d)[0][4];e?(document.getElementsByClassName("fleet_ap")[0].textContent=a.airPower,document.getElementsByClassName("contact_start_rate")[0].textContent=d.toFixed(1)+"%",document.getElementsByClassName("fleet_ap")[1].textContent=a.escortAirPower,document.getElementsByClassName("contact_start_rate")[1].textContent=d.toFixed(1)+"%"):($(".friendFleet_tab.show.active")[0].getElementsByClassName("fleet_ap")[0].textContent=
a.airPower,$(".friendFleet_tab.show.active")[0].getElementsByClassName("contact_start_rate")[0].textContent=d.toFixed(2)+"%");e=document.getElementById("ship_info_table").getElementsByTagName("tbody")[0];(d=e.getElementsByTagName("tr").length)?(f=document.createElement("td"),f.className="info_fleetAp",f.rowSpan=d,f.textContent=a.airPower,e.getElementsByClassName("ship_info_tr")[0].appendChild(f),$("#ship_info_table").find(".info_warning").addClass("d-none"),document.getElementById("ship_info_table").getElementsByClassName("info_warning")[0].classList.add("d-none")):
document.getElementById("ship_info_table").getElementsByClassName("info_warning")[0].classList.remove("d-none");e=$("#input_summary");d=(e.val()+"\n").match(/\n/g).length;e.height(castInt(e.css("lineHeight"))*d+2);e.val(e.val().trim())}}
function createContactTable(a){var b=0,c=[[],[],[]],d=[[],[],[]],e=[[],[],[]];a=$jscomp.makeIterator(a);for(var f=a.next();!f.done;f=a.next())if(f=f.value,0!==f.id&&f.selectRate.length){b+=f.contact;for(var g=0;3>g;g++)3<=f.accuracy?c[g].push(f.selectRate[g]):2===f.accuracy?d[g].push(f.selectRate[g]):e[g].push(f.selectRate[g])}b=Math.floor(b)+1;b=[Math.min(b/25,1),Math.min(b/40,1),Math.min(b/55,1)];a=[[],[],[]];var h=1;for(f=0;3>f;f++){g=b[f];if(c[f].length){h=1;for(var l=$jscomp.makeIterator(c[f]),
k=l.next();!k.done;k=l.next())h*=1-k.value;h=g*(1-h);a[f].push(h);g-=h}else a[f].push(0);if(d[f].length){h=1;l=$jscomp.makeIterator(d[f]);for(k=l.next();!k.done;k=l.next())h*=1-k.value;h=g*(1-h);a[f].push(h);g-=h}else a[f].push(0);if(e[f].length){h=1;l=$jscomp.makeIterator(e[f]);for(k=l.next();!k.done;k=l.next())h*=1-k.value;a[f].push(g*(1-h))}else a[f].push(0)}c=[[],[],[]];for(d=0;3>d;d++)c[d].push(100*b[d]),c[d]=c[d].concat(a[d].map(function(m){return 100*m})),c[d].push(Math.min(100*getArraySum(a[d]),
100));return c}
function updateEnemyFleetInfo(a,b){b=void 0===b?!0:b;var c=null,d=0,e=0,f=0,g="999-1",h="",l=!1,k=!0,m=!1,n={},r=$jscomp.makeIterator(document.getElementsByClassName("battle_content"));for(d=r.next();!d.done;n={$jscomp$loop$prop$formationId$369:n.$jscomp$loop$prop$formationId$369},d=r.next()){var p=d.value;isDefMode&&(p=document.getElementById("air_raid_enemies"));if(isDefMode&&0<a.length)break;if(!p.classList.contains("d-none")){c={enemies:[],cellType:0,stage2:[],isAllSubmarine:!1};f=e=d=0;k=!0;
c.cellType=castInt(p.getElementsByClassName("cell_type")[0].value);for(var q=$jscomp.makeIterator(p.getElementsByClassName("enemy_content")),t=q.next();!t.done;t=q.next()){var u=t.value,x=castInt(u.dataset.enemyid);t=createEnemyObject(x);if(!u.classList.contains("d-none")){if(c.cellType!==CELL_TYPE.grand&&6===c.enemies.length)break;-1===x&&(u=u.getElementsByClassName("enemy_ap")[0],u=castInt(u.textContent),t.ap=u,t.lbAp=u,t.origAp=u,t.origLbAp=u);k&&!t.type.includes(18)&&0<t.id&&(k=!1);!m&&ANTIAIR_CUTIN_ENEMY.includes(t.id)&&
(m=!0);c.enemies.push(t);d+=t.ap;e+=t.lbAp;f+=t.aabo}}c.enemies.length&&(c.isAllSubmarine=k);n.$jscomp$loop$prop$formationId$369=castInt(p.getElementsByClassName("formation")[0].value);k=(k=FORMATION.find(function(w){return function(v){return v.id===w.$jscomp$loop$prop$formationId$369}}(n)))?k.correction:1;c.stage2=createStage2Table(c.enemies,c.cellType,n.$jscomp$loop$prop$formationId$369);a.push(c);b&&(c=p.getElementsByClassName("enemy_sum_ap")[0],c.textContent=d,c=p.getElementsByClassName("enemy_sum_lbap")[0],
c.textContent=e,c=p.getElementsByClassName("enemy_range")[0],castInt(c.textContent)?c.parentNode.classList.remove("d-none"):c.parentNode.classList.add("d-none"),c=p.getElementsByClassName("fleet_AA")[0],c.textContent=2*Math.floor(k*f),d=p.dataset.celldata?p.dataset.celldata:g.replace("-","")+"_\u624b\u52d5",e=d.split("_")[0].slice(0,-1),e=20<e?"E-":e+"-",e+=d.split("_")[0].slice(-1),d=d.split("_")[1],"999-1"===g?g=e:l||g===e||(l=!0),h+=h?" \u2192 "+d:d)}}if(b){isDefMode||(g.includes("999-")?document.getElementById("route").value=
"\u6d77\u57df\u672a\u6307\u5b9a":document.getElementById("route").value=l?"\u5225\u6d77\u57df\u306e\u30bb\u30eb\u304c\u6df7\u5728\u3057\u3066\u3044\u307e\u3059\u3002":g+"\uff1a"+h);document.getElementById("enemy_cutin_contain")&&(m?document.getElementById("enemy_cutin_contain").classList.remove("d-none"):document.getElementById("enemy_cutin_contain").classList.add("d-none"));g=a[isDefMode?0:displayBattle-1].enemies.filter(function(w){return 0<w.slots.length});h=[];l=0;m={};for(n=0;n<g.length;m={$jscomp$loop$prop$enemy$371:m.$jscomp$loop$prop$enemy$371},
n++)if(m.$jscomp$loop$prop$enemy$371=g[n],!m.$jscomp$loop$prop$enemy$371.isSpR&&m.$jscomp$loop$prop$enemy$371.slots.length){d=r="";e=!0;for(f={$jscomp$loop$prop$j$373:0};f.$jscomp$loop$prop$j$373<m.$jscomp$loop$prop$enemy$371.slots.length;f={$jscomp$loop$prop$j$373:f.$jscomp$loop$prop$j$373},f.$jscomp$loop$prop$j$373++)if(p=ENEMY_PLANE_DATA.find(function(w,v){return function(y){return y.id===w.$jscomp$loop$prop$enemy$371.eqp[v.$jscomp$loop$prop$j$373]}}(m,f)))c=m.$jscomp$loop$prop$enemy$371.slots[f.$jscomp$loop$prop$j$373],
k=getPlaneCss(p.type).replace("css","shoot_table"),q=f.$jscomp$loop$prop$j$373===m.$jscomp$loop$prop$enemy$371.slots.length-1?" last_slot":"",x=u=t="",r+='<img src="../img/plane/'+p.id+'.png" class="img-size-36" data-planeid="'+p.id+'">',e&&(t='\n\t\t\t\t<td class="td_name align-middle last_slot" rowspan="'+m.$jscomp$loop$prop$enemy$371.slots.length+'">\n\t\t\t\t\t<div>'+drawEnemyGradeColor(m.$jscomp$loop$prop$enemy$371.name)+"</div>\n\t\t\t\t\t<div>xxPxx</div>\n\t\t\t\t</td>",x='<td class="td_all_dead align-middle last_slot" rowspan="'+
m.$jscomp$loop$prop$enemy$371.slots.length+'"></td>',u='<td class="td_detail_slot align-middle last_slot" rowspan="'+m.$jscomp$loop$prop$enemy$371.slots.length+'"><i class="fas fa-file-text"></i></td>',e=!1),d+='\n\t\t\t<tr class="enemy_no_'+l+" slot_"+f.$jscomp$loop$prop$j$373+'" data-rowindex="'+m.$jscomp$loop$prop$enemy$371+'" data-slotindex="'+f.$jscomp$loop$prop$j$373+'" data-css="'+k+'_hover">\n\t\t\t\t'+t+'\n\t\t\t\t<td class="pl-1 td_plane_name align-middle '+(k+q)+'">'+p.name+'</td>\n\t\t\t\t<td class="td_init_slot align-middle'+
q+'">'+c+'</td>\n\t\t\t\t<td class="td_avg_slot align-middle'+q+'">'+c+'</td>\n\t\t\t\t<td class="td_max_slot align-middle'+q+'">'+c+'</td>\n\t\t\t\t<td class="td_min_slot align-middle'+q+'">'+c+"</td>\n\t\t\t\t"+(isDefMode?"":x)+"\n\t\t\t\t"+(isDefMode?"":u)+"\n\t\t\t</tr>";h.push(d.replace("xxPxx",r));l++}h.length||h.push('<tr><td colspan="8">\u6226\u95d8\u6a5f\u3001\u653b\u6483\u6a5f\u3092\u642d\u8f09\u3057\u305f\u6575\u8266\u304c\u3044\u306a\u3044\u6226\u95d8\u3067\u3059\u3002</td></tr>');document.getElementById("enemy_shoot_down_tbody").innerHTML=
h.join("\r\n");!isDefMode&&!document.getElementById("ignore_stage2").checked&&0<fleetStage2Table.length?$(".td_all_dead").removeClass("d-none"):$(".td_all_dead").addClass("d-none");isDefMode?$(".td_detail_slot").addClass("d-none"):$(".td_detail_slot").removeClass("d-none")}}
function createStage2Table(a,b,c){var d=[[[],[]],[[],[]],[[],[]],[[],[]],[[],[]],[[],[]]],e=a.length,f=[],g=0;AVOID_TYPE[5].adj[0]=castFloat($("#free_anti_air_weight").val());AVOID_TYPE[5].adj[1]=castFloat($("#free_anti_air_bornus").val());for(var h=0;h<e;h++){var l=a[h];if(0!==l.id){f.push(l.aaw);for(var k=0;k<AVOID_TYPE.length;k++){var m=Math.floor(l.aaw*AVOID_TYPE[k].adj[0]);b===CELL_TYPE.grand?6>h?d[k][0].push(.8*m/400):d[k][0].push(.48*m/400):d[k][0].push(m/400)}g+=l.aabo}}h=FORMATION.find(function(r){return r.id===
c});g=Math.floor((h?h.correction:1)*g);for(h=0;h<e;h++)if(0!==a[h].id)for(l=f.shift(),k=0;k<AVOID_TYPE.length;k++){m=Math.floor(l*AVOID_TYPE[k].adj[0]);var n=2*Math.floor(g*AVOID_TYPE[k].adj[1]);b===CELL_TYPE.grand?6>h?d[k][1].push(Math.floor(.8*(m+n)*.09375)):d[k][1].push(Math.floor(.045*(m+n))):d[k][1].push(Math.floor(.09375*(m+n)))}return d}
function createEnemyObject(a){var b=ENEMY_DATA.find(function(g){return g.id===a}),c={id:0,type:[0],name:"",slots:[],antiAir:[],eqp:[],attackers:[],orgSlots:[],isSpR:!1,ap:0,lbAp:0,origAp:0,origLbAp:0,aaw:0,aabo:0};if(0!==a&&b){for(var d={},e=$jscomp.makeIterator(b.eqp),f=e.next();!f.done;d={$jscomp$loop$prop$id$207$375:d.$jscomp$loop$prop$id$207$375},f=e.next())d.$jscomp$loop$prop$id$207$375=f.value,(f=ENEMY_PLANE_DATA.find(function(g){return function(h){return h.id===g.$jscomp$loop$prop$id$207$375}}(d)))?
(c.antiAir.push(f.antiAir),c.attackers.push(ATTACKERS.includes(f.type)),5!==f.type||c.isSpR||(c.isSpR=!0)):c.attackers.push(!1);c.id=b.id;c.type=b.type;c.name=b.name;c.eqp=b.eqp.concat();c.slots=b.slot.concat();c.orgSlots=b.slot.concat();c.aaw=b.aaw;c.aabo=b.aabo;c.ap=0;c.lbAp=0;updateEnemyAp(c);c.origAp=c.ap;c.origLbAp=c.lbAp}return c}function getEnemyFleetLBAP(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=a[d].lbAp;return b}
function getEnemyFleetAP(a){for(var b=0,c=a.length,d=0;d<c;d++)b+=a[d].ap;return b}
function shootDownEnemy(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?[]:d;var e=b.length,f=100*Math.random(),g=d.findIndex(function(q){return q.border>f});d=0<=g?d[g].table:[];g=d.length;for(var h=0;h<e;h++){var l=b[h],k=l.slots.length;l.ap=0;for(var m=l.lbAp=0,n=0;n<k;n++){var r=l.slots[n];l.slots[n]-=getShootDownSlot(a,r);if(c&&0<g&&l.attackers[n]){r=l.slots[n];var p=d[Math.floor(Math.random()*g)];Math.floor(2*Math.random())&&(r-=Math.floor(p[0]*r));Math.floor(2*Math.random())&&(r-=p[1]);r-=p[2];l.slots[n]=
0<r?r:0}m+=Math.floor(l.antiAir[n]*Math.sqrt(Math.floor(l.slots[n])))}l.lbAp=m;l.isSpR||(l.ap=m)}}function getShootDownSlot(a,b){return SHOOT_DOWN_TABLE_ENEMY[b][a][Math.floor(Math.random()*SHOOT_DOWN_TABLE_ENEMY[b][a].length)]}function updateEnemyAp(a){if(-1!==a.id){a.ap=0;a.lbAp=0;for(var b=a.antiAir.length,c=0,d=0;d<b;d++)c+=Math.floor(a.antiAir[d]*Math.sqrt(Math.floor(a.slots[d])));a.lbAp=c;a.isSpR||(a.ap=c)}}
function doJetPhase(a,b){var c=b.stage2[0][0].length;if(!c||b.cellType>CELL_TYPE.grand||b.isAllSubmarine)return 0;for(var d=0,e=0;e<a.ships.length;e++)for(var f=a.ships[e],g=0;g<f.planes.length;g++){var h=f.planes[g];if(9===h.type){d+=Math.round(h.slot*h.cost*.2);h.slot-=Math.floor(.6*getShootDownSlotFF(0,Math.round(h.slot)));var l=Math.floor(Math.random()*c);Math.floor(2*Math.random())&&(h.slot-=Math.floor(b.stage2[h.avoid][0][l]*h.slot));Math.floor(2*Math.random())&&(h.slot-=b.stage2[h.avoid][1][l]);
h.updateAirPower()}}return d}
function shootDownFriend(a,b,c,d){var e=c.stage2[0][0].length;5===a&&(a=0);for(var f=SHOOT_DOWN_TABLE,g=c.cellType<=CELL_TYPE.normal,h=c.cellType<=CELL_TYPE.grand,l=b.ships.length,k=0;k<l;k++){for(var m=b.ships[k],n=g&&m.isEscort,r=m.planes.length,p=0;p<r;p++){var q=m.planes[p];q.results[d]+=q.slot;if(!(0>=q.slot||!q.canBattle||n)&&e){var t=f[q.slot][a];t=t[Math.floor(Math.random()*t.length)];q.slot-=Math.floor(9===q.type?.6*t:t);if(q.isAttacker&&h){t=Math.floor(Math.random()*e);var u=c.stage2[q.avoid];
Math.floor(2*Math.random())&&(q.slot-=Math.floor(u[0][t]*q.slot));Math.floor(2*Math.random())&&(q.slot-=u[1][t])}q.canBattle&&0<q.slot?q.airPower=Math.floor(q.antiAir*Math.sqrt(q.slot)+q.bonusAirPower):(0>=q.slot&&(q.slot=0),q.airPower=0)}}m.updateAirPower()}b.updateAirPower()}
function shootDownLandBase(a,b,c){var d=c.stage2[0][0].length;if(d){5===a&&(a=0);for(var e=SHOOT_DOWN_TABLE,f=b.planes.length,g=0;g<f;g++){var h=b.planes[g];if(!(0>=h.slot)){var l=e[h.slot][a];l=l[Math.floor(Math.random()*l.length)];h.slot-=Math.floor(9===h.type?.6*l:l);if(h.isAttacker){l=Math.floor(Math.random()*d);var k=c.stage2[h.avoid];Math.floor(2*Math.random())&&(h.slot-=Math.floor(k[0][l]*h.slot));Math.floor(2*Math.random())&&(h.slot-=k[1][l])}h.updateAirPower()}}b.updateAirPower()}}
function getShootDownSlotFF(a,b){var c=SHOOT_DOWN_TABLE[b][a];return c[Math.floor(Math.random()*c.length)]}
function getLandBasePower(a,b,c){var d=PLANE_DATA.find(function(h){return h.id===a});if(!d)return 0;var e=Math.abs(d.type),f=0,g=0;switch(e){case 2:f=.2*c+d.torpedo;g=1;break;case 3:f=0*c+d.bomber;g=1;break;case 6:f=.2*c+d.bomber;g=1;break;case 9:f=0*c+d.bomber;g=.7071;break;case 101:case -101:case 105:f=.7*c+d.torpedo,g=.8}b=Math.floor(g*(f*Math.sqrt(1.8*b)+25));return 101===e||105===e?1.8*b:1*b}
function rateCalculate(a){var b=a.landBaseData,c=a.friendFleetData,d=a.battleData,e=castInt($("#calculate_count").val());e=0>=e?1:e;$("#calculate_count").val(e);var f=c.ships.length,g=d.concat();a=isDefMode?0:displayBattle-1;for(var h=[0,0,0,0,0,0],l=[],k=[],m=[],n=[],r=[[],[]],p=isDefMode?1:battleCount,q=0,t=fleetStage2Table.concat(),u=!isDefMode&&!document.getElementById("ignore_stage2").checked&&0<t.length,x=[],w=$jscomp.makeIterator(g),v=w.next();!v.done;v=w.next())v=v.value,v.enemies=v.enemies.filter(function(H){return-1===
H.id||0<H.slots.length});a=a<d.length?a:d.length-1;for(d=0;d<p;d++)l.push(0),k.push(0);for(d=0;d<f;d++)for(w=0;w<c.ships[d].planes.length;w++)m.push(Array(e));for(d=0;d<g[a].enemies.length;d++)if(w=g[a].enemies[d],!(w.isSpR||0>w.id)){v=0===n.length?0:n[n.length-1][0]+1;for(var y=0;y<w.slots.length;y++)n.push([v,y,0,0,999]);x.push(0)}d=g[0].cellType===CELL_TYPE.highAirRaid?b.defense2AirPower:b.defenseAirPower;resultData.defenseAirPower=d;for(w=0;w<e;w++){for(v=0;v<p;v++){var A=g[v];y=A.enemies;calculateLandBase(b,
A,v);q+=doJetPhase(c,A);var B=isDefMode?d:A.cellType!==CELL_TYPE.grand?c.airPower:c.unionAirPower,z=getEnemyFleetAP(y),D=getAirStatusIndex(B,z);v===a&&h[D]++;l[v]+=B;k[v]+=z;shootDownFriend(D,c,A,v);if(v===a){shootDownEnemy(D,y,u,t);for(var F=D=B=A=0;F<y.length;F++){var C=y[F];if(!(C.isSpR||0>C.id)){for(var E=C.slots,G=C.attackers.concat(),I=0;I<E.length;I++){var J=E[I],K=n[A++];K[2]+=J;K[3]<J&&(K[3]=J);K[4]>J&&(K[4]=J);0===J&&(G[I]=!1)}0>G.indexOf(!0)&&x[B]++;B++;D+=C.ap}}r[0].push(z);r[1].push(D)}y=
$jscomp.makeIterator(y);for(z=y.next();!z.done;z=y.next())z=z.value,z.slots=z.orgSlots.concat(),z.ap=z.origAp,z.lbAp=z.origLbAp}for(v=0;3>v;v++)if(y=b.landBases[v],0!==y.mode){for(z=0;z<y.planes.length;z++)A=y.planes[z],A.slot=A.fullSlot,A.airPower=A.fullAirPower;y.airPower=y.fullAirPower}for(y=v=0;y<f;y++){z=c.ships[y];A=z.planes.length;for(B=z.airPower=0;B<A;B++)D=z.planes[B],m[v++][w]=D.slot,D.slot=D.fullSlot,D.airPower=D.fullAirPower,z.airPower+=D.airPower;z.airPower=z.fullAirPower}c.airPower=
c.fullAirPower;c.escortAirPower=c.fullEscortAirPower;c.unionAirPower=c.fullUnionAirPower}for(t=g=0;t<f;t++)for(u=c.ships[t],d=0;d<u.planes.length;d++)w=m[g],v={shipNo:u.fleetNo,slot:u.planes[d].slotNo,max:getArrayMax(w),min:getArrayMin(w),avg:w.reduce(function(H,L){return H+L})/e,death:w.filter(function(H){return 0===H}).length,deathRate:0},v.deathRate=v.death/w.length,resultData.fleetSlots.push(v),g++;for(f=0;f<p;f++)for(m=Math.round(l[f]/e),g=Math.round(k[f]/e),t=getAirStatusIndex(m,g),$("#shoot_down_table").find(".fap.battle"+
(f+1)).text(m),$("#shoot_down_table").find(".eap.battle"+(f+1)).text(g),$("#shoot_down_table").find(".cond.battle"+(f+1)).text(AIR_STATUS[t].abbr).addClass("airStatus"+t),m=$jscomp.makeIterator(c.ships),g=m.next();!g.done;g=m.next())for(g=g.value,t=$jscomp.makeIterator(g.planes),u=t.next();!u.done;u=t.next())u=u.value,u.id&&(d=u.results[f],$("#shoot_down_table .shipNo"+g.fleetNo+".slot"+u.slotNo+" .battle"+(f+1)).text(Math.round(d/e)));$("#shoot_down_table").find("td").removeClass("d-none");for(c=
battleCount+1;10>=c;c++)$("#shoot_down_table").find(".battle"+c).addClass("d-none");isDefMode||(resultData.fleetAirPower=Math.round(l[a]/e));c=[];l=$jscomp.makeIterator(b.landBases);for(p=l.next();!p.done;p=l.next())for(p=p.value,f=0;2>f;f++)c.push(p.results[displayBattle-1].airStatusIndex[f].map(function(H){return H/e}));b=$jscomp.makeIterator(b.landBases);for(p=b.next();!p.done;p=b.next())l=p.value,resultData.landBaseAirPowers.push(Math.round(l.results[a].mainAirPower[0]/e)),resultData.landBaseAirPowers.push(Math.round(l.results[a].mainAirPower[1]/
e)),resultData.enemyAirPowers.push(Math.round(l.results[a].enemyAirPower[0]/e)),resultData.enemyAirPowers.push(Math.round(l.results[a].enemyAirPower[1]/e));resultData.enemyAirPowers.push(Math.round(k[a]/e));resultData.landBaseAirStatus=c;resultData.fleetAirStatus=h.map(function(H){return H/e});resultData.enemySlots=n;resultData.enemyAirPowerResults=r;resultData.enemySlotAllDead=x;resultData.usedSteels=q;return null}
function calculateLandBase(a,b,c){for(var d=b.enemies,e=0;3>e;e++){var f=a.landBases[e],g=f.target[0],h=f.target[1];if(g===c||h===c){var l=f.airPower,k=f.results[c];if(g===c){var m=getEnemyFleetLBAP(d),n=0===l&&0===m?0:getAirStatusIndex(l,m);k.airStatusIndex[0][n]++;k.mainAirPower[0]+=l;k.enemyAirPower[0]+=m;shootDownEnemy(n,d);g!==h&&shootDownLandBase(n,f,b)}h===c&&(m=getEnemyFleetLBAP(d),n=0===l&&0===m?0:getAirStatusIndex(l,m),k.airStatusIndex[1][n]++,k.mainAirPower[1]+=l,k.enemyAirPower[1]+=m,
shootDownEnemy(n,d),g!==h&&shootDownLandBase(n,f,b))}}}function detailCalculate(){var a=castInt($("#detail_info").data("base_no")),b=castInt($("#detail_info").data("slot_no"));switch($("#detail_info").data("mode")){case "enemy_slot_detail":enemySlotDetailCalculate(a,b);break;case "fleet_slot_detail":fleetSlotDetailCalculate(a,b,castInt($("#detail_info").data("ship_id")));break;case "land_base_detail":landBaseDetailCalculate(a,b)}}
function fleetSlotDetailCalculate(a,b,c){c=void 0===c?0:c;setPreCalculateTable();var d=new LandBaseAll,e=new Fleet,f=[];updateLandBaseInfo(d,!1);updateFriendFleetInfo(e,!1);updateEnemyFleetInfo(f,!1);var g=castInt($("#detail_calculate_count").val()),h=[],l=e.ships[a],k=PLANE_DATA.find(function(x){return x.id===l.planes[b].id}),m=2===Math.abs(k.type)?[.8,1.5]:ATTACKERS.includes(k.type)?[1]:[0],n=.2*(3===Math.abs(k.type)?0:k.remodel)+(2===Math.abs(k.type)?k.torpedo:k.bomber);k=$jscomp.makeIterator(f);
for(var r=k.next();!r.done;r=k.next())r=r.value,r.enemies=r.enemies.filter(function(x){return 0<x.slots.length});for(k=0;k<g;k++){for(r=0;r<battleCount;r++){var p=f[r],q=p.enemies;calculateLandBase(d,p,r);doJetPhase(e,p);var t=p.cellType;t=isDefMode?defAp:t!==CELL_TYPE.grand?e.airPower:e.unionAirPower;var u=getEnemyFleetAP(q);t=getAirStatusIndex(t,u);shootDownFriend(t,e,p,r);p=$jscomp.makeIterator(q);for(q=p.next();!q.done;q=p.next())q=q.value,q.slots=q.orgSlots.concat(),q.ap=q.origAp,q.lbAp=q.origLbAp}for(r=
0;3>r;r++){p=d.landBases[r];for(q=0;q<p.planes.length;q++)t=p.planes[q],t.slot=t.fullSlot,t.updateAirPower();p.updateAirPower()}for(r=0;r<e.ships.length;r++)for(p=e.ships[r],q=p.planes.length,t=p.airPower=0;t<q;t++)u=p.planes[t],r===a&&u.slotNo===b&&h.push(u.slot),u.slot=u.fullSlot,u.updateAirPower(),p.airPower+=u.airPower;e.updateAirPower()}updateDetailChart(h,"\u6b8b\u6a5f\u6570 [\u6a5f]",{mode:"index",callbacks:{title:function(x,w){var v=x[0].xLabel;if(!v)return"\u6b8b\u6a5f\u6570\uff1a"+v+" \u6a5f\n\u822a\u7a7a\u6226\u706b\u529b\uff1a0";
var y=2===m.length?Math.floor(m[1]*(n*Math.sqrt(v)+25)):0;return"\u6b8b\u6a5f\u6570\uff1a"+v+" \u6a5f\n\u822a\u7a7a\u6226\u706b\u529b\uff1a"+(Math.floor(m[0]*(n*Math.sqrt(v)+25))+(y?" or "+y:""))},label:function(x,w){return[x.yLabel+" %"]}}});e=SHIP_DATA.find(function(x){return x.id===c});d="";f=0;$("#land_base_detail_table").addClass("d-none");$(".detail_fire").addClass("d-none").removeClass("d-flex");$(".detail_wave").addClass("d-none").removeClass("d-flex");$("#detail_info").data("mode","fleet_slot_detail");
$("#detail_info").data("ship_id",c);$("#detail_info").data("base_no",a);$("#detail_info").data("slot_no",b);$("#detail_warning").html("\n\t\t<div>\u203b \u822a\u7a7a\u6226\u706b\u529b\u306f\u30ad\u30e3\u30c3\u30d7\u524d\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u88dc\u6b63\u3001\u89e6\u63a5\u88dc\u6b63\u306a\u3057\u3002\u5c0f\u6570\u5207\u6368\u3066</div>\n\t\t<div>\u203b \u6700\u7d42\u6226\u95d8\u306e\u822a\u7a7a\u6226\u7d42\u4e86\u6642\u70b9\u3067\u306e\u6b8b\u6570\u306e\u5206\u5e03\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002</div>");
a={};g=$jscomp.makeIterator(l.planes);for(h=g.next();!h.done;a={$jscomp$loop$prop$pl$377:a.$jscomp$loop$prop$pl$377},h=g.next()){a.$jscomp$loop$prop$pl$377=h.value;h=PLANE_DATA.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$pl$377.id}}(a));if(f===(e?e.slot.length:4))break;d+='\n\t\t<div class="row mx-1 py-0_5 '+(b===f?"selected":"")+" "+(h?"general_tr btn_show_detail":"")+'" data-slot_no="'+f+'">\n\t\t\t<div class="col-1 align-self-center font_size_11 text-left">'+(f+1)+'</div>\n\t\t\t<div class="col d-flex align-self-center font_size_12 pl-0">\n\t\t\t\t<img src="../img/type/'+
(h?"type"+h.type:"undefined")+'.png" class="plane_img_sm align-self-center">\n\t\t\t\t<div class="align-self-center">'+(h?h.abbr?h.abbr:h.name:"-")+'</div>\n\t\t\t</div>\n\t\t\t<div class="col font_size_11 align-self-center">\n\t\t\t\t'+(h?"(\u642d\u8f09: "+a.$jscomp$loop$prop$pl$377.slot+"\u6a5f"+(h.torpedo?"\u3000\u96f7\u88c5: "+h.torpedo:"")+(h.bomber?"\u3000\u7206\u88c5: "+h.bomber:"")+")":"")+"\n\t\t\t</div>\n\t\t</div>";f++}a='\n\t\t<img src="../img/ship/'+c+'.png" class="ship_img align-self-center '+
(c?"":"d-none")+'">\n\t\t<span class="ml-1 align-self-center legend_name" data-shipid="'+c+'">'+(e?e.name:"\u672a\u6307\u5b9a")+"</span>\n\t";$("#detail_legend").html(a);$("#detail_info").html(d)}
function landBaseDetailCalculate(a,b){setPreCalculateTable();var c=new LandBaseAll,d=[];updateLandBaseInfo(c,!1);updateEnemyFleetInfo(d,!1);for(var e=castInt($("#detail_calculate_count").val()),f=[],g=isDefMode?0:displayBattle-1,h=c.landBases[a].planes,l=0,k=0;k<h.length;k++){var m=h[k];0===h[b].id&&0!==m.id&&(b=k);l+=m.fullSlot}k=[];for(m=0;m<e;m++){for(var n=0;n<=g;n++){for(var r=d[n],p=r.enemies,q=0;3>q;q++){var t=c.landBases[q],u=t.target[0],x=t.target[1];if(u===n||x===n){var w=t.airPower;if(u===
n){var v=getEnemyFleetLBAP(p);v=0===w&&0===v?0:getAirStatusIndex(w,v);shootDownEnemy(v,p);u!==x&&shootDownLandBase(v,t,r)}x===n&&(u=getEnemyFleetLBAP(p),w=0===w&&0===u?0:getAirStatusIndex(w,u),shootDownEnemy(w,p),shootDownLandBase(w,t,r))}}r=$jscomp.makeIterator(p);for(p=r.next();!p.done;p=r.next())p=p.value,p.slots=p.orgSlots.concat(),p.ap=p.origAp,p.lbAp=p.origLbAp}for(n=0;3>n;n++){r=c.landBases[n];for(q=p=0;q<r.planes.length;q++)t=r.planes[q],a+1===r.baseNo&&b+1===t.slotNo&&f.push(t.slot),p+=t.slot,
t.slot=t.fullSlot,t.updateAirPower();a+1===r.baseNo&&k.push(p);r.updateAirPower()}}var y=h[b].id,A=h[b].remodel,B=h.find(function(D){return 312===D.id})?1.15:h.find(function(D){return 311===D.id})?1.125:1,z=d.cellType===CELL_TYPE.grand?1.1:1;updateDetailChart(f,"\u6b8b\u6a5f\u6570 [\u6a5f]",{mode:"index",callbacks:{title:function(D,F){var C=D[0].xLabel,E="\u822a\u7a7a\u6226\u706b\u529b\uff1a"+(getLandBasePower(y,C,A)*B*z).toFixed(1);return C?"\u6b8b\u6a5f\u6570\uff1a"+C+" \u6a5f\n"+E:"\u6b8b\u6a5f\u6570\uff1a0 \u6a5f\n\u822a\u7a7a\u6226\u706b\u529b\uff1a0"},
label:function(D,F){return[D.yLabel+" %"]}}});g=f=d=0;k=$jscomp.makeIterator(k);for(h=k.next();!h.done;h=k.next())h=h.value,m=h/l,0===h?g++:.25>m?f++:.4>m&&d++;$("#status_s").text(100*d/e+" %");$("#status_m").text(100*f/e+" %");$("#status_l").text(100*g/e+" %");e="";l=0;$("#land_base_detail_table").removeClass("d-none");$(".detail_fire").addClass("d-none").removeClass("d-flex");$(".detail_wave").removeClass("d-none").addClass("d-flex");$("#detail_info").data("mode","land_base_detail");$("#detail_info").data("base_no",
a);$("#detail_info").data("slot_no",b);$("#detail_warning").html("\n\t\t<div>\u203b \u822a\u7a7a\u6226\u706b\u529b\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u88dc\u6b63\u3001\u89e6\u63a5\u88dc\u6b63\u306a\u3057\u3067\u5bfe\u6c34\u4e0a\u8266\u306e\u5834\u5408</div>\n\t\t<div>\u203b \u5bfe\u6575\u9023\u5408\u88dc\u6b63\u3001\u9678\u5075\u88dc\u6b63\u306b\u3064\u3044\u3066\u306f\u3001\u8a72\u5f53\u3059\u308b\u6226\u95d8\u3001\u88c5\u5099\u3067\u3042\u308c\u3070\u6709\u52b9</div>");k={};c=$jscomp.makeIterator(c.landBases[a].planes);
for(d=c.next();!d.done;k={$jscomp$loop$prop$pl$379:k.$jscomp$loop$prop$pl$379},d=c.next())k.$jscomp$loop$prop$pl$379=d.value,d=PLANE_DATA.find(function(D){return function(F){return F.id===D.$jscomp$loop$prop$pl$379.id}}(k)),e+='\n\t\t<div class="row mx-1 py-0_5 '+(b===l?"selected":"")+" "+(d?"general_tr btn_show_detail":"")+'" data-slot_no="'+l+'">\n\t\t\t<div class="col-1 align-self-center font_size_11 text-left">'+(l+1)+'</div>\n\t\t\t<div class="col d-flex align-self-center font_size_12 pl-0">\n\t\t\t\t<img src="../img/type/'+
(d?"type"+d.type:"undefined")+'.png" class="plane_img_sm align-self-center">\n\t\t\t\t<div class="align-self-center">'+(d?d.abbr?d.abbr:d.name:"-")+'</div>\n\t\t\t</div>\n\t\t\t<div class="col font_size_11 align-self-center">\n\t\t\t\t'+(d?"(\u642d\u8f09: "+k.$jscomp$loop$prop$pl$379.slot+"\u6a5f"+(d.torpedo?"\u3000\u96f7\u88c5: "+d.torpedo:"")+(d.bomber?"\u3000\u7206\u88c5: "+d.bomber:"")+")":"")+"\n\t\t\t</div>\n\t\t</div>",l++;$("#detail_legend").html("<span>\u7b2c"+(a+1)+"\u57fa\u5730\u822a\u7a7a\u968a</span>");
$("#detail_info").html(e)}
function enemySlotDetailCalculate(a,b){setPreCalculateTable();var c=new LandBaseAll,d=new Fleet,e=[];updateLandBaseInfo(c,!1);updateFriendFleetInfo(d,!1);updateEnemyFleetInfo(e,!1);var f=castInt($("#calculate_count").val()),g=isDefMode?0:displayBattle-1;g=g<e.length?g:e.length-1;var h=[],l=e[g].enemies.filter(function(A){return 0<A.slots.length&&!A.isSpR})[a],k=ENEMY_DATA.find(function(A){return A.id===l.id}),m=ENEMY_PLANE_DATA.find(function(A){return A.id===k.eqp[b]}),n=2===Math.abs(m.type)?[.8,
1.5]:1===Math.abs(m.type)?[0]:[1],r=2===Math.abs(m.type)?m.torpedo:m.bomber;m=$("#slot_detail").prop("checked");for(var p=fleetStage2Table.concat(),q=!document.getElementById("ignore_stage2").checked&&0<p.length,t=$jscomp.makeIterator(e),u=t.next();!u.done;u=t.next())u=u.value,u.enemies=u.enemies.filter(function(A){return 0<A.slots.length});for(t=0;t<f;t++){for(u=0;u<=g;u++){var x=e[u],w=x.enemies;calculateLandBase(c,x,u);doJetPhase(d,x);var v=x.cellType;v=isDefMode?defAp:v!==CELL_TYPE.grand?d.airPower:
d.unionAirPower;var y=getEnemyFleetAP(w);v=getAirStatusIndex(v,y);shootDownFriend(v,d,x,u);u===g&&(shootDownEnemy(v,w,q,p),m?h.push(l.slots[b]):l.slots[b]?h.push(Math.floor(n[Math.floor(Math.random()*n.length)]*(r*Math.sqrt(l.slots[b])+25))):h.push(0));for(x=0;x<w.length;x++)v=w[x],v.isSpR||(v.slots=v.orgSlots.concat(),v.ap=v.origAp,v.lbAp=v.origLbAp)}for(u=0;3>u;u++){w=c.landBases[u];for(x=0;x<w.planes.length;x++)v=w.planes[x],v.slot=v.fullSlot,v.updateAirPower();w.updateAirPower()}for(u=0;u<d.ships.length;u++)for(w=
d.ships[u],x=w.planes.length,v=w.airPower=0;v<x;v++)y=w.planes[v],y.slot=y.fullSlot,y.updateAirPower(),w.airPower+=y.airPower;d.updateAirPower()}updateDetailChart(h,m?"\u6b8b\u6a5f\u6570 [\u6a5f]":"\u822a\u7a7a\u6226\u706b\u529b",{mode:"index",callbacks:{title:function(A,B){var z=A[0].xLabel;if($("#slot_detail").prop("checked")){if(!z)return"\u6b8b\u6a5f\u6570\uff1a"+z+" \u6a5f\n\u822a\u7a7a\u6226\u706b\u529b\uff1a0";var D=2===n.length?Math.floor(n[1]*(r*Math.sqrt(z)+25)):0;return"\u6b8b\u6a5f\u6570\uff1a"+
z+" \u6a5f\n\u822a\u7a7a\u6226\u706b\u529b\uff1a"+(Math.floor(n[0]*(r*Math.sqrt(z)+25))+(D?" or "+D:""))}return"\u822a\u7a7a\u6226\u706b\u529b\uff1a"+z},label:function(A,B){return[A.yLabel+" %"]}}});$("#land_base_detail_table").addClass("d-none");$(".detail_fire").removeClass("d-none").addClass("d-flex");$(".detail_wave").addClass("d-none").removeClass("d-flex");$("#detail_info").data("mode","enemy_slot_detail");$("#detail_info").data("base_no",a);$("#detail_info").data("slot_no",b);$("#detail_info").data("battle_no",
g);$("#detail_warning").text("\u203b \u822a\u7a7a\u6226\u706b\u529b\u306f\u30ad\u30e3\u30c3\u30d7\u524d\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3001\u89e6\u63a5\u88dc\u6b63\u306a\u3057\u5c0f\u6570\u5207\u6368\u3066");c="";d=0;e={};f=$jscomp.makeIterator(k.eqp);for(g=f.next();!g.done;e={$jscomp$loop$prop$id$381:e.$jscomp$loop$prop$id$381},g=f.next())e.$jscomp$loop$prop$id$381=g.value,g=ENEMY_PLANE_DATA.find(function(A){return function(B){return B.id===A.$jscomp$loop$prop$id$381}}(e)),c+='\n\t\t<div class="row mx-1 py-0_5 '+
(b===d?"selected":"")+" "+(g?"general_tr btn_show_detail":"")+'" data-slot_no="'+d+'">\n\t\t\t<div class="col-1 align-self-center font_size_11 text-left">'+(d+1)+'</div>\n\t\t\t<div class="col d-flex align-self-center">\n\t\t\t\t<img src="../img/type/type'+g.type+'.png" class="plane_img_sm align-self-center">\n\t\t\t\t<div class="align-self-center">'+g.name+'</div>\n\t\t\t</div>\n\t\t\t<div class="col font_size_12 align-self-center">\n\t\t\t\t(\u642d\u8f09: '+l.slots[d++]+"\u6a5f"+(g.torpedo?"\u3000\u96f7\u88c5: "+
g.torpedo:"")+(g.bomber?"\u3000\u7206\u88c5: "+g.bomber:"")+")</span>\n\t\t\t</div>\n\t\t</div>";d='\n\t\t<img src="../img/enemy/'+k.id+'.png" class="ship_img align-self-center">\n\t\t<span class="ml-1 text-primary font_size_11 align-self-center">ID: '+(k.id+1500)+'</span>\n\t\t<span class="ml-1 align-self-center legend_name" data-enemyid="'+k.id+'">'+k.name+"</span>\n\t";$("#detail_legend").html(d);$("#detail_info").html(c)}
function updateDetailChart(a,b,c){for(var d=[],e=[],f=[],g=getArrayMax(a),h=getArrayMin(a),l=a.length,k=0,m=0,n=0,r=0,p=0,q={$jscomp$loop$prop$i$383:h};q.$jscomp$loop$prop$i$383<=g;q={$jscomp$loop$prop$i$383:q.$jscomp$loop$prop$i$383},q.$jscomp$loop$prop$i$383++){var t=a.filter(function(u){return function(x){return x===u.$jscomp$loop$prop$i$383}}(q)).length;t&&(d.push(q.$jscomp$loop$prop$i$383),e.push((100*t/l).toFixed(1E5<=l?5:1E4<=l?4:1E3<=l?3:2)),p+=100*t/l,f.push(p.toFixed(1)),!k&&50<=p&&(k=q.$jscomp$loop$prop$i$383),
!m&&90<=p&&(m=q.$jscomp$loop$prop$i$383),!n&&95<=p&&(n=q.$jscomp$loop$prop$i$383),!r&&99<=p&&(r=q.$jscomp$loop$prop$i$383))}$("#detail_max").text(g);$("#detail_min").text(h);$("#detail_50").text(k);$("#detail_90").text(m);$("#detail_95").text(n);$("#detail_99").text(r);chartInstance?(chartInstance.data.labels=d,chartInstance.data.datasets[0].data=e,chartInstance.data.datasets[1].data=f,chartInstance.options.scales.xAxes[0].scaleLabel.labelString=b,chartInstance.options.tooltips=c,chartInstance.update()):
(a=document.getElementById("detailChart"),g="rgba("+hexToRGB(mainColor).join(",")+", 0.8)",chartInstance=new Chart(a,{type:"bar",data:{labels:d,datasets:[{label:"\u78ba\u7387\u5206\u5e03",data:e,borderColor:"rgb(255, 70, 100)",backgroundColor:"rgba(255, 120, 180, 0.4)",yAxisID:"y-axis-1"},{label:"\u7d2f\u7a4d\u78ba\u7387",data:f,type:"line",fill:!1,borderColor:"rgb(54, 162, 255)",yAxisID:"y-axis-2"}]},options:{responsive:!0,scales:{xAxes:[{scaleLabel:{display:!0,labelString:b,fontColor:g},gridLines:{display:!1},
ticks:{fontSize:10,fontColor:g}}],yAxes:[{id:"y-axis-1",type:"linear",position:"left",gridLines:{display:!0,color:"rgba(128, 128, 128, 0.2)"},scaleLabel:{display:!0,labelString:"\u78ba\u7387\u5206\u5e03 [\uff05]",fontColor:g},ticks:{min:0,fontColor:g}},{id:"y-axis-2",type:"linear",position:"right",gridLines:{display:!0,color:"rgba(128, 128, 128, 0.2)"},scaleLabel:{display:!0,labelString:"\u7d2f\u7a4d\u78ba\u7387 [\uff05]",fontColor:g},ticks:{max:100,min:0,stepSize:25,fontColor:g}}]},legend:{display:!0,
labels:{fontColor:g}},tooltips:c}}))}function autoExpand(){if($("#mode_1").prop("checked"))toggleDefenseMode(!1),autoExpandNormal();else if($("#mode_2").prop("checked")||$("#mode_3").prop("checked"))toggleDefenseMode(!0),autoExpandDefense();calculate()}
function autoExpandNormal(){var a=loadPlaneStock(),b=$("#allow_fighter").prop("checked"),c=$("#auto_land_base_1").prop("checked"),d=$("#auto_land_base_2").prop("checked"),e=$("#auto_land_base_3").prop("checked"),f=$("#auto_fleet").prop("checked");c||$("#lb_item1").find(".lb_plane").each(function(x,w){var v=a.find(function(A){return A.id===castInt($(w)[0].dataset.planeid)}),y=castInt($(w).find(".remodel_value").text());v&&v.num[y]--});d||$("#lb_item2").find(".lb_plane").each(function(x,w){var v=a.find(function(A){return A.id===
castInt($(w)[0].dataset.planeid)}),y=castInt($(w).find(".remodel_value").text());v&&v.num[y]--});e||$("#lb_item3").find(".lb_plane").each(function(x,w){var v=a.find(function(A){return A.id===castInt($(w)[0].dataset.planeid)}),y=castInt($(w).find(".remodel_value").text());v&&v.num[y]--});f&&autoFleetExpand(a);$(".ship_tab").find(".ship_plane").each(function(x,w){var v=a.find(function(A){return A.id===castInt($(w)[0].dataset.planeid)}),y=castInt($(w).find(".remodel_value").text());v&&v.num[y]--});if(c||
d||e){var g=[];f=castInt($("#dest_range").val());for(var h={},l=$jscomp.makeIterator(a),k=l.next();!k.done;h={$jscomp$loop$prop$stock$385:h.$jscomp$loop$prop$stock$385},k=l.next())if(h.$jscomp$loop$prop$stock$385=k.value,!(0>=getArraySum(h.$jscomp$loop$prop$stock$385.num)||(k=PLANE_DATA.find(function(x){return function(w){return w.id===x.$jscomp$loop$prop$stock$385.id}}(h)),k.radius<f||-101===k.type||105===k.type||!b&&1===Math.abs(k.type)))){var m="type"+Math.abs(FIGHTERS.includes(k.type)?1:k.type);
g.hasOwnProperty(m)||(g[m]=[]);for(var n=0;n<h.$jscomp$loop$prop$stock$385.num.length;n++)for(var r=0;r<h.$jscomp$loop$prop$stock$385.num[n];r++){var p={id:k.id,type:k.type,antiAir:k.antiAir+1.5*k.interception,torpedo:k.torpedo,bomber:k.bomber,remodel:n};p.antiAir=Plane.getBonusAntiAir(k.id,k.type,n,k.antiAir);g[m].push(p)}}Object.keys(g).forEach(function(x){"type1"===x?g[x].sort(function(w,v){return w.antiAir===v.antiAir?v.radius-w.radius:v.antiAir-w.antiAir}):"type2"===x?g[x].sort(function(w,v){return w.torpedo===
v.torpedo?v.radius-w.radius:v.torpedo-w.torpedo}):"type101"===x?g[x].sort(function(w,v){return 186===w.id&&186===v.id?v.antiAir-w.antiAir:186===w.id?-1:186===v.id?1:w.torpedo===v.torpedo?v.radius-w.radius:v.torpedo-w.torpedo}):["type3","type6"].includes(x)?g[x].sort(function(w,v){return w.bomber===v.bomber?v.antiAir-w.antiAir:v.bomber-w.bomber}):["type4","type5","type8","type104"].includes(x)&&g[x].sort(function(w,v){return w.scout===v.scout?v.antiAir-w.antiAir:v.scout-w.scout})});if(c){var q=autoLandBaseExpand(g);
$("#lb_item1").find(".lb_plane").each(function(x,w){setLBPlaneDiv($(w),q[x])});$("#lb_item1").find(".ohuda_select").val(0<q.length?2:-1)}if(d){var t=autoLandBaseExpand(g);$("#lb_item2").find(".lb_plane").each(function(x,w){setLBPlaneDiv($(w),t[x])});$("#lb_item2").find(".ohuda_select").val(0<t.length?2:-1)}if(e){var u=autoLandBaseExpand(g);$("#lb_item3").find(".lb_plane").each(function(x,w){setLBPlaneDiv($(w),u[x])});$("#lb_item3").find(".ohuda_select").val(0<u.length?2:-1)}}}
function autoFleetExpand(a){var b=castInt($("#dest_ap").val()),c=$('.ship_tab[data-shipid!=""]'),d=!$("#no_FBA").prop("checked"),e=[],f={};a=$jscomp.makeIterator(a);for(var g=a.next();!g.done;f={$jscomp$loop$prop$stock$387:f.$jscomp$loop$prop$stock$387},g=a.next())if(f.$jscomp$loop$prop$stock$387=g.value,[16,19,23,26].includes(f.$jscomp$loop$prop$stock$387.id)&&(f.$jscomp$loop$prop$stock$387.num=[60,0,0,0,0,0,0,0,0,0,0]),!(0>=getArraySum(f.$jscomp$loop$prop$stock$387.num)||(g=PLANE_DATA.find(function(w){return function(v){return v.id===
w.$jscomp$loop$prop$stock$387.id}}(f)),100<g.type))){var h="type"+Math.abs(FIGHTERS.includes(g.type)?1:g.type);e.hasOwnProperty(h)||(e[h]=[]);for(var l=0;l<f.$jscomp$loop$prop$stock$387.num.length;l++)for(var k=0;k<f.$jscomp$loop$prop$stock$387.num[l];k++){var m={id:g.id,type:g.type,antiAir:g.antiAir+1.5*g.interception,torpedo:g.torpedo,bomber:g.bomber,avoid:g.avoid,remodel:l,stock:1};m.antiAir+=Plane.getBonusAntiAir(g.id,g.type,l,m.antiAir);e[h].push(m)}}Object.keys(e).forEach(function(w){"type1"===
w?e[w].sort(function(v,y){return y.antiAir-v.antiAir}):"type2"===w?e[w].sort(function(v,y){return v.torpedo===y.torpedo?y.antiAir-v.antiAir:y.torpedo-v.torpedo}):["type3","type6"].includes(w)&&e[w].sort(function(v,y){return v.avoid===y.avoid?y.bomber-v.bomber:y.avoid-v.avoid})});var n=[],r=0;c.each(function(w,v){var y=SHIP_DATA.find(function(B){return B.id===castInt($(v)[0].dataset.shipid)});if(y){var A=[];$(v).find(".ship_plane:not(.d-none)").each(function(B,z){var D=castInt($(z).find(".slot").text()),
F=$(z).find(".plane_unlock").hasClass("d-none"),C={shipId:y.id,shipType:y.type,slotNo:B,num:D,plane:new ShipPlane(0),order:r++,num_:D,slotId:"ship"+w+"_slot"+B,isLock:F,lockedPlane:null};if(F){var E=PLANE_DATA.find(function(I){return I.id===castInt($(z)[0].dataset.planeid)});if(E){var G=castInt($(z).find(".remodel_value").text());C.lockedPlane={id:E.id,remodel:G};Object.keys(e).forEach(function(I){var J=e[I].findIndex(function(K){return K.id===E.id&&K.remodel===G});-1<J&&e[I].splice(J,1)})}}else 0===
D&&(C.isLock=!0);[1,2,3].includes(y.type)?10>D&&(C.num_=D-100):C.num_=D-100;A.push(C)});n=n.concat(A)}});g=[2,6];f=0;n.sort(function(w,v){return v.num_-w.num_});h=$jscomp.makeIterator(n);for(a=h.next();!a.done;a=h.next())for(l=a.value,m=!1,k=$jscomp.makeIterator(g),a=k.next();!a.done;a=k.next()){a=a.value;if(l.isLock){l.lockedPlane&&(a=getShipPlaneObject(l.num,l.lockedPlane),l.plane=a,f+=a.airPower);m=!0;break}var p=l.shipType;d&&[1,2,3].includes(p)&&1===l.slotNo&&(a=3);p={};var q=$jscomp.makeIterator(e["type"+
a]);for(a=q.next();!a.done;p={$jscomp$loop$prop$plane$252$389:p.$jscomp$loop$prop$plane$252$389},a=q.next())if(p.$jscomp$loop$prop$plane$252$389=a.value,!(0>=p.$jscomp$loop$prop$plane$252$389.stock)){checkInvalidPlane(l.shipId,PLANE_DATA.find(function(w){return function(v){return v.id===w.$jscomp$loop$prop$plane$252$389.id}}(p)))&&(a=getShipPlaneObject(l.num,p.$jscomp$loop$prop$plane$252$389),l.plane=a,f+=a.airPower,p.$jscomp$loop$prop$plane$252$389.stock--,m=!0);break}if(m)break}n.sort(function(w,
v){return w.num_===v.num_?v.slotNo-w.slotNo:w.num_-v.num_});g=f;h=[];d=[];l=[];for(k=0;k<n.length&&!(f>=b);k++)if(!n[k].isLock){d=[];l=[];f=$jscomp.makeIterator(e.type1);for(a=f.next();!a.done;a=f.next())a=a.value,l.push({id:a.id,remodel:a.remodel,antiAir:a.antiAir,stock:a.stock});f=g;h.push(n[k]);for(m=h.length-1;0<=m;m--){p=h[m];q=!1;var t={},u=$jscomp.makeIterator(l);for(a=u.next();!a.done;t={$jscomp$loop$prop$plane$259$391:t.$jscomp$loop$prop$plane$259$391},a=u.next())if(t.$jscomp$loop$prop$plane$259$391=
a.value,!(0>=t.$jscomp$loop$prop$plane$259$391.stock)){if(checkInvalidPlane(p.shipId,PLANE_DATA.find(function(w){return function(v){return v.id===w.$jscomp$loop$prop$plane$259$391.id}}(t)))){a=getShipPlaneObject(p.num,t.$jscomp$loop$prop$plane$259$391);var x=p.plane.airPower;if(x<a.airPower){d.push(a);f+=a.airPower-x;t.$jscomp$loop$prop$plane$259$391.stock--;q=!0;break}}if(q)break}q||d.push(p.plane)}}b=0;f=d.length;for(a=0;a<n.length;a++)if(!n[a].isLock){if(b>=f)break;n[a].plane=d[f-1-b++]}n.sort(function(w,
v){return w.order-v.order});r=0;c.each(function(w,v){$(v).find(".ship_plane:not(.d-none)").each(function(y,A){var B=n.find(function(z){return z.slotId==="ship"+w+"_slot"+y});B?(setPlaneDiv($(A),B.plane),r++):setPlaneDiv($(A))})})}
function autoLandBaseExpand(a){for(var b=castInt($("#dest_ap").val()),c=[new LandBasePlane(0),new LandBasePlane(0),new LandBasePlane(0),new LandBasePlane(0)],d=c.length,e=0,f=!1,g=[],h=$jscomp.makeIterator([101,105,2,3,6,9]),l=h.next();!l.done;l=h.next())if((l=a["type"+l.value])&&0!==l.length){for(var k=0;k<l.length&&!(g.push(l[k]),f=g.length===d);k++);if(f)break}for(h=0;h<g.length;h++)l=getLandBasePlaneObject(g[h]),c[c.length-1-h]=l,e+=l.airPower;if(f&&e>=b){b=[];e=$jscomp.makeIterator(c);for(c=
e.next();!c.done;c=e.next())for(c=c.value,b.push({id:c.id,remodel:c.remodel}),d={},f=$jscomp.makeIterator(b),c=f.next();!c.done;d={$jscomp$loop$prop$plane$266$393:d.$jscomp$loop$prop$plane$266$393},c=f.next())d.$jscomp$loop$prop$plane$266$393=c.value,Object.keys(a).forEach(function(m){return function(n){var r=a[n].findIndex(function(p){return p.id===m.$jscomp$loop$prop$plane$266$393.id&&p.remodel===m.$jscomp$loop$prop$plane$266$393.remodel});-1<r&&a[n].splice(r,1)}}(d));return b}g=[];f=!1;if(h=a.type1)for(l=
0;l<h.length&&!(g.push(h[l]),f=g.length===d);l++);for(d=0;d<g.length&&!(f=c[d].airPower,h=getLandBasePlaneObject(g[d]),f<h.airPower&&(c[d]=h,e+=c[d].airPower-f),e>=b);d++);b=[];e=$jscomp.makeIterator(c);for(c=e.next();!c.done;c=e.next())(c=c.value)&&b.push({id:c.id,remodel:c.remodel});e={};d=$jscomp.makeIterator(b);for(c=d.next();!c.done;e={$jscomp$loop$prop$plane$271$395:e.$jscomp$loop$prop$plane$271$395},c=d.next())e.$jscomp$loop$prop$plane$271$395=c.value,Object.keys(a).forEach(function(m){return function(n){var r=
a[n].findIndex(function(p){return p.id===m.$jscomp$loop$prop$plane$271$395.id&&p.remodel===m.$jscomp$loop$prop$plane$271$395.remodel});-1<r&&a[n].splice(r,1)}}(e));return b}function getLandBasePlaneObject(a){var b=PLANE_DATA.find(function(d){return d.id===a.id}),c=setting.defaultProf.find(function(d){return d.id===Math.abs(b.type)}).prof;return new LandBasePlane(a.id,18,a.remodel,c)}
function getShipPlaneObject(a,b){var c=PLANE_DATA.find(function(e){return e.id===b.id}),d=setting.defaultProf.find(function(e){return e.id===Math.abs(c.type)}).prof;return new ShipPlane(b.id,a,b.remodel,d)}
function autoExpandDefense(){var a=$("#auto_land_base_1").prop("checked"),b=$("#auto_land_base_2").prop("checked"),c=$("#auto_land_base_3").prop("checked");$(".lb_plane").each(function(h,l){setLBPlaneDiv($(l))});var d=0;a&&d++;b&&d++;c&&d++;if(0<d){d=autoLandBaseExpandDef(d);if(a){var e=d[0].planes;$("#lb_item1").find(".lb_plane").each(function(h,l){setLBPlaneDiv($(l),e[h])});$("#lb_item1").find(".ohuda_select").val(0)}if(b){var f=d[a?1:0].planes;$("#lb_item2").find(".lb_plane").each(function(h,l){setLBPlaneDiv($(l),
f[h])});$("#lb_item2").find(".ohuda_select").val(0)}if(c){var g=d[a&&b?2:a||b?1:0].planes;$("#lb_item3").find(".lb_plane").each(function(h,l){setLBPlaneDiv($(l),g[h])});$("#lb_item3").find(".ohuda_select").val(0)}}}
function autoLandBaseExpandDef(a){var b=castInt($("#dest_ap").val()),c=loadPlaneStock(),d=$("#mode_3").prop("checked"),e=[],f=[],g=4*a,h={};c=$jscomp.makeIterator(c);for(var l=c.next();!l.done;h={$jscomp$loop$prop$stock$397:h.$jscomp$loop$prop$stock$397},l=c.next()){h.$jscomp$loop$prop$stock$397=l.value;if(25===h.$jscomp$loop$prop$stock$397.id||19===h.$jscomp$loop$prop$stock$397.id)h.$jscomp$loop$prop$stock$397.num=[g,0,0,0,0,0,0,0,0,0,0];if(!(0>=getArraySum(h.$jscomp$loop$prop$stock$397.num)))if(l=
PLANE_DATA.find(function(q){return function(t){return t.id===q.$jscomp$loop$prop$stock$397.id}}(h)),RECONNAISSANCES.includes(l.type))for(var k=10;0<=k;k--){if(!(1>h.$jscomp$loop$prop$stock$397.num[k])){var m={id:l.id,antiAir:l.antiAir,type:l.type,adjust:1,scout:l.scout,remodel:k};m.adjust=getReconnaissancesAdjust(m,!0);for(var n=0;n<h.$jscomp$loop$prop$stock$397.num[k];n++)f.push(m)}}else for(k=10;0<=k;k--)if(!(1>h.$jscomp$loop$prop$stock$397.num[k])&&(m={id:l.id,type:l.type,remodel:k,antiAir:l.antiAir+
l.interception+2*l.antiBomber,interception:l.interception,antiBomber:l.antiBomber,isRocket:0},m.antiAir+=Plane.getBonusAntiAir(m.id,m.type,m.remodel,m.antiAir),0!==m.antiAir))for(n=0;n<h.$jscomp$loop$prop$stock$397.num[k];n++)e.push(Object.assign({},m))}if(d){e.sort(function(q,t){return t.antiAir-q.antiAir});for(g=0;3>g;g++)h=e.findIndex(function(q){return 0===q.isRocket&&ROCKETS.includes(q.id)}),-1<h&&(e[h].isRocket=1);e.sort(function(q,t){return t.isRocket-q.isRocket})}else e.sort(function(q,t){return q.antiAir===
t.antiAir?t.radius-q.radius:t.antiAir-q.antiAir});f.sort(function(q,t){return t.adjust===q.adjust?t.scout-q.scout:t.adjust-q.adjust});e=e.filter(function(q,t){return t<4*a});g=[];for(h=0;h<a;h++){c={ap:0,planes:[]};for(l=0;4>l;l++)c.planes.push({id:0});g.push(c)}for(l=c=h=0;l<a;l++){k=new LandBase(0,0);m=new LandBase(0,0);for(n=0;4>n;n++){var r=e[n],p=getLandBasePlaneObject(r);k.planes.push(p);k.defenseAirPower+=p.defenseAirPower;m.planes.push(p);m.defenseAirPower+=p.defenseAirPower;h+=p.defenseAirPower;
if(d){if(ROCKETS.includes(r.id)&&c++,Math.floor((0===c?.5:1===c?.8:2===c?1.1:1.2)*h)>=b)break}else if(h>=b)break}f.length>l&&!(3>m.planes.length&&h>=b)&&(n=getLandBasePlaneObject(f[l]),r=Math.min(m.planes.length,3),(p=m.planes[r])||(p=new LandBasePlane(0)),p=p.defenseAirPower,m.planes[r]=n,m.defenseAirPower+=n.defenseAirPower-p,m.updateDefenseAirPower());if(m.defenseAirPower>=k.defenseAirPower||m.defenseAirPower>=b)n=k.defenseAirPower,k=m,h+=m.defenseAirPower-n;m=k.planes.length;if(4!==m)for(n=0;n<
4-m;n++)k.planes.push(new LandBasePlane(0));g[l]=k;m={};k=$jscomp.makeIterator(k.planes);for(n=k.next();!n.done;m={$jscomp$loop$prop$isFirst$399:m.$jscomp$loop$prop$isFirst$399,$jscomp$loop$prop$plane$287$400:m.$jscomp$loop$prop$plane$287$400},n=k.next())m.$jscomp$loop$prop$plane$287$400=n.value,m.$jscomp$loop$prop$isFirst$399=!0,e=e.filter(function(q){return function(t){return q.$jscomp$loop$prop$isFirst$399&&t.id===q.$jscomp$loop$prop$plane$287$400.id?q.$jscomp$loop$prop$isFirst$399=!1:!0}}(m));
if(d){if(Math.floor((0===c?.5:1===c?.8:2===c?1.1:1.2)*h)>=b)break}else if(h>=b)break}return g}
function modal_Closed(a){switch(a.attr("id")){case "modal_share":case "modal_ship_select":case "modal_plane_select":case "modal_enemy_select":case "modal_enemy_pattern":case "modal_collectively_setting":case "modal_lb_target":$target=null;calculate();break;case "modal_plane_preset":planePreset=$target=null;calculate();break;case "modal_fleet_antiair_input":calculate();inform_success("\u5bfe\u7a7a\u7832\u706b\u8a2d\u5b9a\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002");break;case "modal_result_detail":setTimeout(function(){chartInstance.destroy();
chartInstance=null},80);break;case "modal_contact_detail":setTimeout(function(){chartInstance.destroy();chartInstance=null;subChartInstance&&(subChartInstance.destroy(),subChartInstance=null)},80);break;case "modal_main_preset":$("#modal_main_preset").find(".btn_commit_preset").text("\u7de8\u6210\u4fdd\u5b58");$("#modal_main_preset").find(".btn_commit_preset").removeClass("rename");$("#allow_upload_preset").prop("checked",!1);$("#btn_upload_preset").addClass("d-none");break;case "modal_confirm":"Error"===
confirmType&&(window.location.href="../list/"),confirmType=null}}function btn_content_trade_Clicked(a){$("body,html").animate({scrollTop:0},200,"swing");$(".btn_commit_trade").addClass("d-flex").removeClass("d-none");$(".r_btn:not(.btn_commit_trade)").addClass("d-none").removeClass("d-lg-flex");$("#main").find(".collapse_content").each(function(){$(this).parent().addClass("trade_enabled");$(this).attr("class").includes("show")&&$(this).addClass("tmpHide").collapse("hide")});a.blur()}
function main_contents_Sortable_End(){setting.contentsOrder=[];$("#main > div:not(#main_footer)").each(function(a,b){var c=$(b).attr("id");setting.contentsOrder.push(c)});saveSetting()}
function commit_content_order(){if($("#landBase_content").hasClass("collapsing"))return!1;$(".tmpHide").collapse("show");$(".trade_enabled").removeClass("trade_enabled");$(".btn_commit_trade").addClass("d-none").removeClass("d-flex");$(".r_btn:not(.btn_commit_trade)").removeClass("d-none");$(".btn_show_plane_box").addClass("d-lg-flex d-none")}
function btn_ex_setting_Clicked(a){a=a.closest(".contents").attr("id");var b=$("#modal_collectively_setting");b.find(".btn").removeClass("d-none");b.data("target",a);switch(a){case "landBase":b.find(".modal-title").text("\u4e00\u62ec\u8a2d\u5b9a\u3000-\u57fa\u5730\u822a\u7a7a\u968a-");b.find(".btn_remove_ship_all").addClass("d-none");b.find(".btn_remove_enemy_all").addClass("d-none");b.find(".btn_slot_default").addClass("d-none");b.find(".coll_slot_range").attr("max",18).data("target",a);break;case "friendFleet":b.find(".modal-title").text("\u4e00\u62ec\u8a2d\u5b9a\u3000-\u8266\u5a18-"),
b.find(".btn_remove_enemy_all").addClass("d-none"),b.find(".coll_slot_range").attr("max",99).data("target",a)}b.modal("show")}
function btn_show_plane_box_Clicked(a){"landBase"===a.closest(".contents").attr("id")?101>castInt($("#draggable_plane_type_select").val())&&$("#draggable_plane_type_select").val(101):101<=castInt($("#draggable_plane_type_select").val())&&$("#draggable_plane_type_select").val(1);createDraggablePlaneTable();var b=document.getElementById("draggable_plane_box");b.classList.remove("d-none");b.style.position="fixed";b.style.top=a[0].getBoundingClientRect().top+"px";b.style.left=a[0].getBoundingClientRect().left-
220+"px"}function btn_air_raid_Clicked(){$(".lb_tab").each(function(a,b){var c=!1,d=setting.airRaidMax?4:Math.ceil(4*Math.random());$(b).find(".lb_plane").each(function(e,f){if(!c&&0<castInt($(f)[0].dataset.planeid)){var g=castInt($(f).find(".slot").text());g>d?($(f).find(".slot").text(g-d),c=!0):($(f).find(".slot").text(1),d-=g-1)}})});calculate()}
function btn_supply_Clicked(){$(".lb_tab").each(function(a,b){$(b).find(".lb_plane").each(function(c,d){0<castInt($(d)[0].dataset.planeid)&&$(d).find(".slot").text(18)})});calculate()}
function btn_capture_Clicked(a){var b=a.closest(".contents");b.addClass("capturing");document.body.classList.contains("dark-theme")?(b.addClass("capture_dark"),document.body.classList.contains("deep_blue_theme")&&b.addClass("capture_deep_blue")):b.addClass("capture_nomal");b.find(".lb_tab").removeClass("tab-pane fade");var c=b.find(".no_capture:not(.d-none)");c.addClass("d-none");b.find(".btn_remove_plane").addClass("btn_remove_plane_capture");b.find(".r_btn").addClass("d-none");b.find(".d-lg-flex").addClass("d-none_lg").removeClass("d-lg-flex");
b.find(".custom-checkbox").addClass("d-none");b.find(".battle_only").removeClass("ml-auto").addClass("ml-2");b.find('.plane_name_span:contains("\u6a5f\u4f53\u3092\u9078\u629e")').text("-");b.find(".custom-select").addClass("pt-0");b.find(".custom-select option").addClass("d-none");b.find(".form-control").addClass("pt-0");b.find(".general_box").addClass("general_box_capture");var d=window.pageYOffset;html2canvas(b[0],{onrendered:function(e){var f=e.toDataURL();if($("#clipboard_mode").prop("checked")&&
"function"===typeof ClipboardItem)try{e.toBlob(function(g){var h={};navigator.clipboard.write([new ClipboardItem((h[g.type]=g,h))])})}catch(g){downloadImage(f)}else downloadImage(f);b.removeClass("capture_nomal capture_dark capture_deep_blue");b.find(".custom-checkbox").removeClass("d-none");b.find(".r_btn:not(.btn_commit_trade)").removeClass("d-none");b.find(".d-none_lg").addClass("d-none d-lg-flex").removeClass("d-none_lg");b.find(".btn_remove_plane").removeClass("btn_remove_plane_capture");b.find(".battle_only").addClass("ml-auto").removeClass("ml-2");
b.find('.plane_name_span:contains("-")').text("\u6a5f\u4f53\u3092\u9078\u629e");c.removeClass("d-none");b.find(".custom-select").removeClass("pt-0");b.find(".custom-select option").removeClass("d-none");b.find(".form-control").removeClass("pt-0");b.find(".general_box").removeClass("general_box_capture");b.removeClass("capturing");"none"===$("#lb_tab_select").css("display")||$("#lb_item1").attr("class").includes("tab-pane")||($(".lb_tab").addClass("tab-pane fade"),$(".lb_tab:first").tab("show"));window.scrollTo(0,
d)}})}function downloadImage(a){var b="screenshot_"+formatDate(new Date,"yyyyMMdd_HHmmss")+".jpg";if(window.navigator.msSaveBlob){a=atob(a.replace(/^.*,/,""));for(var c=new Uint8Array(a.length),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);a=new Blob([c],["image/png"]);window.navigator.msSaveOrOpenBlob(a,b)}else c=document.getElementById("getImage"),c.href=a,c.download=b,c.click()}
function btn_reset_content_Clicked(a){switch(a.closest(".contents").attr("id")){case "landBase":$(".lb_plane").each(function(b,c){return setLBPlaneDiv($(c))});break;case "friendFleet":clearShipDivAll();resetFleetAntiairInput();break;case "enemyFleet":clearEnemyDivAll()}calculate()}function btn_remove_plane_all_Clicked(a){a=$("#"+$("#modal_collectively_setting").data("target"));clearPlaneDivAll(a)}
function btn_remove_ship_all_Clicked(){clearShipDivAll();$("#modal_collectively_setting").modal("hide")}function btn_slot_max_Clicked(a){a=$("#"+$("#modal_collectively_setting").data("target"));"landBase"===a.attr("id")?$(".coll_slot_range").val(18):"friendFleet"===a.attr("id")&&$(".coll_slot_range").val(99);coll_slot_range_Changed($(".coll_slot_range"))}
function btn_slot_default_Clicked(a){a=$("#"+$("#modal_collectively_setting").data("target"));"friendFleet"===a.attr("id")&&a.find(".ship_plane").each(function(b,c){$(c).find(".slot").text($(c).find(".slot_select_parent").data("ini"))})}function btn_slot_min_Clicked(){$(".coll_slot_range").val(0);coll_slot_range_Changed($(".coll_slot_range"))}
function coll_slot_range_Changed(a){var b=$("#"+$("#modal_collectively_setting").data("target")),c=castInt(a.val());c=c>castInt(a.attr("max"))?castInt(a.attr("max")):c;"landBase"===b.attr("id")?b.find(".lb_plane").each(function(d,e){return $(e).find(".slot").text(c)}):"friendFleet"===b.attr("id")&&b.find(".ship_plane").each(function(d,e){return $(e).find(".slot").text(c)});$(".coll_slot_input").val(c)}
function coll_slot_input_Changed(a){var b=validateInputNumber(a.val(),castInt($(".coll_slot_range").attr("max")));a.val(b);$(".coll_slot_range").val(b);coll_slot_range_Changed($(".coll_slot_range"))}
function btn_remodel_Clicked(a){var b=$("#"+$("#modal_collectively_setting").data("target")),c=castInt(a[0].dataset.remodel);"landBase"===b.attr("id")?b.find(".lb_plane").each(function(d,e){return $(e).find(".remodel_select:not(.remodel_disabled)").find(".remodel_value").text(c)}):"friendFleet"===b.attr("id")&&b.find(".ship_plane").each(function(d,e){return $(e).find(".remodel_select:not(.remodel_disabled)").find(".remodel_value").text(c)})}
function btn_fighter_prof_max_Clicked(){var a=$("#"+$("#modal_collectively_setting").data("target"));"landBase"===a.attr("id")?a.find(".lb_plane").each(function(b,c){FIGHTERS.includes(castInt($(c)[0].dataset.type))&&setProficiency($(c).find(".prof_select"),7)}):"friendFleet"===a.attr("id")&&a.find(".ship_plane").each(function(b,c){FIGHTERS.includes(castInt($(c)[0].dataset.type))&&setProficiency($(c).find(".prof_select"),7)})}
function btn_prof_Clicked(a){var b=$("#"+$("#modal_collectively_setting").data("target")),c=a[0].dataset.prof;"landBase"===b.attr("id")?b.find(".lb_plane").each(function(d,e){2<c&&312===castInt($(e)[0].dataset.planeid)?setProficiency($(e).find(".prof_select"),2):311!==castInt($(e)[0].dataset.planeid)&&setProficiency($(e).find(".prof_select"),c)}):"friendFleet"===b.attr("id")&&b.find(".ship_plane").each(function(d,e){setProficiency($(e).find(".prof_select"),c)})}
function plane_lock_Clicked(a){a.addClass("d-none");a.closest(".ship_plane").find(".plane_unlock").removeClass("d-none")}function plane_unlock_Clicked(a){a.addClass("d-none");a.closest(".ship_plane").find(".plane_lock").removeClass("d-none")}
function remodelSelect_Shown(a){if(a.find(".dropdown-menu").html().trim())a.find(".remodel_item_selected").removeClass("remodel_item_selected");else{for(var b="",c=0;10>c;c++)b+='<div class="remodel_item" data-remodel="'+c+'"><i class="fas fa-star"></i>+'+c+"</div>";b+='<div class="remodel_item" data-remodel="10"><i class="fas fa-star"></i>max</div>';a.find(".dropdown-menu").append(b)}}
function remodelSelect_Changed(a){if(a.find(".remodel_item_selected").length){var b=Math.min(castInt(a.find(".remodel_item_selected").data("remodel")),10);a.removeClass("remodel_item_selected");a.find(".remodel_value").text(b);calculate()}}
function profSelect_Shown(a){if(!a.find(".dropdown-menu").html().trim()){for(var b="",c=7;0<=c;c--)b+='<a class="dropdown-item prof_item"><img class="prof_opt" alt="'+getProfString(c)+'" data-prof="'+c+'" src="../img/util/prof'+c+'.png"></a>';a.find(".dropdown-menu").append(b)}}function proficiency_Changed(a,b){b=void 0===b?!1:b;var c=a.find(".prof_opt"),d=a.parent().prev(),e=c[0].dataset.prof;d.attr("src",c.attr("src")).attr("alt",c.attr("alt"));d[0].dataset.prof=e;b||calculate()}
function setProficiency(a,b){a.attr("src","../img/util/prof"+b+".png").attr("alt",getProfString(b));a[0].dataset.prof=b}function init_proficiency_Changed(a){proficiency_Changed(a,!0);var b=castInt(a.find(".prof_opt")[0].dataset.prof),c=setting.defaultProf.find(function(d){return d.id===castInt(a.closest(".init_prof")[0].dataset.typeid)});c?c.prof=b:setting.defaultProf.push({id:castInt(a.closest(".init_prof")[0].dataset.typeid),prof:b});saveSetting()}
function slot_select_parent_Show(a){a.find(".dropdown-menu").html().trim()||a.find(".dropdown-menu").append('\n\t\t<span class="dropdown-header py-1 px-1 font_size_12">\u642d\u8f09\u6570\u3092\u5165\u529b</span>\n\t\t\t<div class="d-flex mb-2 justify-content-between">\n\t\t\t\t<div class="align-self-center flex-grow-1">\n\t\t\t\t\t<input type="number" class="form-control form-control-sm slot_input" value="0" min="0" max="99">\n\t\t\t\t</div>\n\t\t\t\t<div class="ml-1 align-self-center">\n\t\t\t\t\t<button type="button" data-ini="0" class="btn btn-sm btn-primary slot_ini">\n\t\t\t\t\t\t<span class="text-nowrap">\u521d\u671f\u5024</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<input type="range" class="custom-range slot_range" value="0" min="0" max="99">\n\t\t');
var b=castInt(a.find(".slot").text());a.find(".slot_input").val(b);a.find(".slot_range").val(b)}function slot_range_Changed(a){var b=a.closest(".slot_select_parent");b.find(".slot").text(a.val());b.find(".slot_input").val(a.val())}function slot_input_Changed(a){var b=validateInputNumber(a.val(),castInt(a.attr("max")));a.val(b);a.closest(".slot_select_parent").find(".slot").text(b);a.next().val(b)}
function slot_ini_Clicked(a){a=a.closest(".slot_select_parent");var b=a.data("ini");a.find(".slot").text(b);a.find(".slot_input").val(b);a.find(".slot_range").val(b)}function slot_select_parent_Close(a){var b=castInt(a.find(".slot_input").val()),c=castInt(a.find(".slot_input").attr("max"));a.find(".slot").text(b>c?c:b);calculate()}
function showPlaneToolTip(a,b){var c=a.closest((void 0===b?0:b)?".lb_plane":".ship_plane");if(c.length&&c[0].dataset.planeid&&!c.hasClass("ui-draggable-dragging")){var d=castInt(c[0].dataset.planeid),e=castInt(c[0].getElementsByClassName("slot")[0].textContent),f=castInt(c[0].getElementsByClassName("remodel_value")[0].textContent),g=castInt(c[0].getElementsByClassName("prof_select")[0].dataset.prof),h=null;h=c[0].classList.contains("lb_plane")?new LandBasePlane(d,e,f,g):new ShipPlane(d,e,f,g);if(c=
PLANE_DATA.find(function(l){return l.id===h.id}))d=[],h.selectRate.length&&(d=h.selectRate.map(function(l){return(100*l).toFixed(0)+"%"})),e=null,0<h.avoid&&(e=AVOID_TYPE.find(function(l){return l.id===h.avoid})),c='<div class="text-left">\n\t\t\t<div>\n\t\t\t\t<img src="../img/type/type'+h.type+'.png" alt="'+h.type+'" class="img-size-25">\n\t\t\t\t<span>'+h.name+"</span>\n\t\t\t\t"+(h.remodel?'<span class="text_remodel">\u2605'+h.remodel+"</span>":"")+'\n\t\t\t</div>\n\t\t\t<div class="my-1">\u5236\u7a7a\u5024: '+
h.airPower+'</div>\n\t\t\t<div class="font_size_12 d-flex flex-wrap plane_status_box">\n\t\t\t\t'+(h.antiAir?'<div class="col_half">\n\t\t\t\t\t<span>\u5bfe\u7a7a: '+(h.antiAir-h.bonusAntiAir)+"</span>\n\t\t\t\t\t"+(h.bonusAntiAir?'<span class="text_remodel">(+'+h.bonusAntiAir.toFixed(1)+")</span>":"")+"\n\t\t\t\t</div>":"")+"\n\t\t\t\t"+(c.fire?'<div class="col_half">\u706b\u529b: '+c.fire+"</div>":"")+"\n\t\t\t\t"+(c.torpedo?'<div class="col_half">\u96f7\u88c5: '+c.torpedo+"</div>":"")+"\n\t\t\t\t"+
(c.bomber?'<div class="col_half">\u7206\u88c5: '+c.bomber+"</div>":"")+"\n\t\t\t\t"+(c.asw?'<div class="col_half">\u5bfe\u6f5c: '+c.asw+"</div>":"")+"\n\t\t\t\t"+(c.armor?'<div class="col_half">\u88c5\u7532: '+c.armor+"</div>":"")+"\n\t\t\t\t"+(h.scout?'<div class="col_half">\u7d22\u6575: '+h.scout+"</div>":"")+"\n\t\t\t\t"+(h.accuracy?'<div class="col_half">\u547d\u4e2d: '+h.accuracy+"</div>":"")+"\n\t\t\t\t"+(c.avoid2?'<div class="col_half">\u56de\u907f: '+c.avoid2+"</div>":"")+"\n\t\t\t\t"+(h.antiBomber?
'<div class="col_half">\u5bfe\u7206: '+h.antiBomber+"</div>":"")+"\n\t\t\t\t"+(h.interception?'<div class="col_half">\u8fce\u6483: '+h.interception+"</div>":"")+"\n\t\t\t\t"+(h.radius?'<div class="col_half">\u534a\u5f84: '+h.radius+"</div>":"")+"\n\t\t\t</div>\n\t\t\t"+(e?'<div class="font_size_12">\u5c04\u6483\u56de\u907f: '+e.name+" (\u52a0\u91cd: "+e.adj[0]+" \u8266\u9632: "+e.adj[1].toFixed(1)+")</div>":"")+"\n\t\t\t"+(9===c.type?'<div class="font_size_12">\u92fc\u6750\u6d88\u8cbb (\u5674\u5f0f\u5f37\u8972\u767a\u751f\u6642): '+
Math.round(h.slot*h.cost*.2):"")+"\n\t\t\t"+(d.length?'<div class="font_size_12">\u89e6\u63a5\u9078\u629e\u7387(\u78ba\u4fdd\u6642): '+d[0]+"</div>":"")+"\n\t\t</div>",showTooltip(a[0],c,"right")}}
function showPlaneBasicToolTip(a){var b=PLANE_DATA.find(function(h){return h.id===castInt(a[0].dataset.planeid)});if(b){var c=0;a.find(".plane_td_remodel").length&&(c=Object.assign({remodel:castInt(a.find(".plane_td_remodel")[0].dataset.remodel)},b),c=Plane.getBonusAntiAir(c.id,c.type,c.remodel,c.antiAir));var d=b.antiAir+c,e=d+1.5*b.interception,f=d+b.interception+2*b.antiBomber,g=b.avoid?AVOID_TYPE.find(function(h){return h.id===b.avoid}):null;c='<div class="text-left">\n\t\t\t<div>\n\t\t\t\t<img src="../img/type/type'+
b.type+'.png" alt="'+b.type+'" class="img-size-25">\n\t\t\t\t<span>'+b.name+'</span>\n\t\t\t</div>\n\t\t\t<div class="font_size_12 d-flex flex-wrap plane_status_box">\n\t\t\t\t'+(e!=d?'<div class="col_half"><span>\u51fa\u6483\u5bfe\u7a7a: '+e+"</span></div>":"")+"\n\t\t\t\t"+(f!=d?'<div class="col_half"><span>\u9632\u7a7a\u5bfe\u7a7a: '+f+"</span></div>":"")+"\n\t\t\t\t"+(b.antiAir?'<div class="col_half">\n\t\t\t\t\t<span>\u5bfe\u7a7a: '+b.antiAir+"</span>\n\t\t\t\t\t"+(c?'<span class="text_remodel">(+'+
c.toFixed(1)+")</span>":"")+"\n\t\t\t\t</div>":"")+"\n\t\t\t\t"+(b.fire?'<div class="col_half">\u706b\u529b: '+b.fire+"</div>":"")+"\n\t\t\t\t"+(b.torpedo?'<div class="col_half">\u96f7\u88c5: '+b.torpedo+"</div>":"")+"\n\t\t\t\t"+(b.bomber?'<div class="col_half">\u7206\u88c5: '+b.bomber+"</div>":"")+"\n\t\t\t\t"+(b.asw?'<div class="col_half">\u5bfe\u6f5c: '+b.asw+"</div>":"")+"\n\t\t\t\t"+(b.armor?'<div class="col_half">\u88c5\u7532: '+b.armor+"</div>":"")+"\n\t\t\t\t"+(b.scout?'<div class="col_half">\u7d22\u6575: '+
b.scout+"</div>":"")+"\n\t\t\t\t"+(b.accuracy?'<div class="col_half">\u547d\u4e2d: '+b.accuracy+"</div>":"")+"\n\t\t\t\t"+(b.avoid2?'<div class="col_half">\u56de\u907f: '+b.avoid2+"</div>":"")+"\n\t\t\t\t"+(b.antiBomber?'<div class="col_half">\u5bfe\u7206: '+b.antiBomber+"</div>":"")+"\n\t\t\t\t"+(b.interception?'<div class="col_half">\u8fce\u6483: '+b.interception+"</div>":"")+"\n\t\t\t\t"+(b.radius?'<div class="col_half">\u534a\u5f84: '+b.radius+"</div>":"")+"\n\t\t\t</div>\n\t\t\t"+(g?'<div class="font_size_12">\u5c04\u6483\u56de\u907f: '+
g.name+" ( \u52a0\u91cd: "+g.adj[0]+" \u8266\u9632: "+g.adj[1].toFixed(1)+" )</div>":"")+"\n\t\t\t</div>";showTooltip(a[0],c,"bottom","window")}}
function showEnemyPlaneToolTip(a){if(a.length&&a[0].dataset.planeid){var b=ENEMY_PLANE_DATA.find(function(c){return c.id===castInt(a[0].dataset.planeid)});b&&showTooltip(a[0],'<div class="text-left">\n\t\t\t<div>\n\t\t\t\t<img src="../img/type/type'+b.type+'.png" alt="'+b.type+'" class="img-size-25">\n\t\t\t\t<span>'+b.name+'</span>\n\t\t\t</div>\n\t\t\t<div class="font_size_12 d-flex flex-wrap plane_status_box">\n\t\t\t\t'+(b.antiAir?'<div class="col_half">\u5bfe\u7a7a: '+b.antiAir+"</div>":"")+
"\n\t\t\t\t"+(b.fire?'<div class="col_half">\u706b\u529b: '+b.fire+"</div>":"")+"\n\t\t\t\t"+(b.torpedo?'<div class="col_half">\u96f7\u88c5: '+b.torpedo+"</div>":"")+"\n\t\t\t\t"+(b.bomber?'<div class="col_half">\u7206\u88c5: '+b.bomber+"</div>":"")+"\n\t\t\t\t"+(b.asw?'<div class="col_half">\u5bfe\u6f5c: '+b.asw+"</div>":"")+"\n\t\t\t\t"+(b.armor?'<div class="col_half">\u88c5\u7532: '+b.armor+"</div>":"")+"\n\t\t\t\t"+(b.scout?'<div class="col_half">\u7d22\u6575: '+b.scout+"</div>":"")+"\n\t\t\t\t"+
(b.accuracy?'<div class="col_half">\u547d\u4e2d: '+b.accuracy+"</div>":"")+"\n\t\t\t\t"+(b.avoid2?'<div class="col_half">\u56de\u907f: '+b.avoid2+"</div>":"")+"\n\t\t\t</div>\n\t\t</div>")}}function showTooltip(a,b,c,d){c=void 0===c?"":c;d=void 0===d?"":d;$(a).tooltip("dispose");a.title=b;a.dataset.toggle="tooltip";a.dataset.html=!0;a.dataset.trigger="manual";c&&(a.dataset.placement=c);d&&(a.dataset.boundary=d);$(a).tooltip("show")}
function hideTooltip(a){$(a).tooltip("hide");a.removeAttribute("title");delete a.dataset.originalTitle;delete a.dataset.html;delete a.dataset.toggle;delete a.dataset.placement;delete a.dataset.boundary;delete a.dataset.trigger;$(a).tooltip("dispose")}function contact_detail_redraw(){var a=castInt($("#modal_contact_detail").data("dispIndex"));-1<a?btn_show_contact_rate_lb_Clicked(null,a):btn_show_contact_rate_Clicked()}
function btn_show_contact_rate_lb_Clicked(a,b){b=void 0===b?0:b;var c=a?castInt(a[0].dataset.lb)-1:b,d=new LandBaseAll;updateLandBaseInfo(d,!1);d=createContactTable(d.landBases[c].planes);var e=document.getElementById("nomal_contact_table");document.getElementsByClassName("detail_contact_chart_parent")[0].classList.add("w-75");document.getElementsByClassName("detail_contact_chart_parent")[1].classList.add("d-none");document.getElementById("grand_contact_table").classList.add("d-none");document.getElementById("land_base_contact_tips").classList.remove("d-none");
for(var f=0;3>f;f++){var g=e.getElementsByClassName("contact_status_"+f)[0];g.getElementsByClassName("td_start_contact_rate")[0].textContent=d[f][0].toFixed(1)+"%";g.getElementsByClassName("td_120_contact_rate")[0].textContent=d[f][1].toFixed(1)+"%";g.getElementsByClassName("td_117_contact_rate")[0].textContent=d[f][2].toFixed(1)+"%";g.getElementsByClassName("td_112_contact_rate")[0].textContent=d[f][3].toFixed(1)+"%";g.getElementsByClassName("td_sum_contact_rate")[0].textContent=d[f][4].toFixed(1)+
"%"}e=$("#contact_detail_0").prop("checked")?0:$("#contact_detail_1").prop("checked")?1:2;f=[d[e][1],d[e][2],d[e][3],100-d[e][4]];g=["120%\u89e6\u63a5","117%\u89e6\u63a5","112%\u89e6\u63a5","\u4e0d\u767a"];var h=["rgb(100, 180, 255, 0.7)","rgba(80, 220, 120, 0.7)","rgba(255, 160, 100, 0.7)","rgba(128, 128, 128, 0.5)"],l=document.getElementById("detail_contact_chart"),k="#000000"===mainColor?"#fff":"#333",m="rgba("+hexToRGB(mainColor).join(",")+", 0.8)";document.getElementById("detail_contact_rate_sum").textContent=
d[e][4].toFixed(1);chartInstance?(chartInstance.data.datasets[0].data=f,chartInstance.update()):chartInstance=new Chart(l,{type:"doughnut",data:{labels:g,datasets:[{backgroundColor:h,data:f,borderColor:k}]},plugins:[ChartDataLabels],options:{legend:{display:!1},title:{display:!0,text:"\u7b2c"+(c+1)+"\u57fa\u5730\u822a\u7a7a\u968a \u89e6\u63a5\u7387",fontColor:m},tooltips:{callbacks:{label:function(n,r){return r.labels[n.index]+": "+r.datasets[0].data[n.index].toFixed(1)+" %"}}},plugins:{datalabels:{color:mainColor,
formatter:function(n,r){return 0<n?n.toFixed(1)+"%":""}}}}});$("#modal_contact_detail").data("dispIndex",c);$("#modal_contact_detail").modal("show")}
function btn_show_contact_rate_Clicked(){var a=new Fleet;updateFriendFleetInfo(a,!1);var b=[],c=[];a=$jscomp.makeIterator(a.ships);for(var d=a.next();!d.done;d=a.next())d=d.value,c=b.concat(d.planes),d.isEscort||(b=b.concat(d.planes));b=createContactTable(b);c=createContactTable(c);d=document.getElementById("nomal_contact_table");a=document.getElementById("grand_contact_table");document.getElementsByClassName("detail_contact_chart_parent")[0].classList.remove("w-75");document.getElementsByClassName("detail_contact_chart_parent")[1].classList.remove("d-none");
document.getElementById("grand_contact_table").classList.remove("d-none");document.getElementById("land_base_contact_tips").classList.add("d-none");for(var e=0;3>e;e++){var f=d.getElementsByClassName("contact_status_"+e)[0];f.getElementsByClassName("td_start_contact_rate")[0].textContent=b[e][0].toFixed(1)+"%";f.getElementsByClassName("td_120_contact_rate")[0].textContent=b[e][1].toFixed(1)+"%";f.getElementsByClassName("td_117_contact_rate")[0].textContent=b[e][2].toFixed(1)+"%";f.getElementsByClassName("td_112_contact_rate")[0].textContent=
b[e][3].toFixed(1)+"%";f.getElementsByClassName("td_sum_contact_rate")[0].textContent=b[e][4].toFixed(1)+"%"}for(d=0;3>d;d++)e=a.getElementsByClassName("contact_status_"+d)[0],e.getElementsByClassName("td_start_contact_rate")[0].textContent=c[d][0].toFixed(1)+"%",e.getElementsByClassName("td_120_contact_rate")[0].textContent=c[d][1].toFixed(1)+"%",e.getElementsByClassName("td_117_contact_rate")[0].textContent=c[d][2].toFixed(1)+"%",e.getElementsByClassName("td_112_contact_rate")[0].textContent=c[d][3].toFixed(1)+
"%",e.getElementsByClassName("td_sum_contact_rate")[0].textContent=c[d][4].toFixed(1)+"%";a=$("#contact_detail_0").prop("checked")?0:$("#contact_detail_1").prop("checked")?1:2;d=[b[a][1],b[a][2],b[a][3],100-b[a][4]];e=[c[a][1],c[a][2],c[a][3],100-c[a][4]];f=["120%\u89e6\u63a5","117%\u89e6\u63a5","112%\u89e6\u63a5","\u4e0d\u767a"];var g=["rgb(100, 180, 255, 0.7)","rgba(80, 220, 120, 0.7)","rgba(255, 160, 100, 0.7)","rgba(128, 128, 128, 0.5)"],h=document.getElementById("detail_contact_chart"),l=document.getElementById("detail_contact_chart_2"),
k="#000000"===mainColor?"#fff":"#333",m="rgba("+hexToRGB(mainColor).join(",")+", 0.8)";document.getElementById("detail_contact_rate_sum").textContent=b[a][4].toFixed(1);document.getElementById("detail_contact_rate_sum_2").textContent=c[a][4].toFixed(1);chartInstance?(chartInstance.data.datasets[0].data=d,chartInstance.update()):chartInstance=new Chart(h,{type:"doughnut",data:{labels:f,datasets:[{backgroundColor:g,data:d,borderColor:k}]},plugins:[ChartDataLabels],options:{legend:{display:!1},title:{display:!0,
text:"\u5bfe\u6575\u901a\u5e38\u8266\u968a",fontColor:m},tooltips:{callbacks:{label:function(n,r){return r.labels[n.index]+": "+r.datasets[0].data[n.index].toFixed(1)+" %"}}},plugins:{datalabels:{color:mainColor,formatter:function(n,r){return 0<n?n.toFixed(1)+"%":""}}}}});subChartInstance?(subChartInstance.data.datasets[0].data=e,subChartInstance.update()):subChartInstance=new Chart(l,{type:"doughnut",data:{labels:f,datasets:[{backgroundColor:g,data:e,borderColor:k}]},plugins:[ChartDataLabels],options:{legend:{display:!1},
title:{display:!0,text:"\u5bfe\u6575\u9023\u5408\u8266\u968a",fontColor:m},tooltips:{callbacks:{label:function(n,r){return r.labels[n.index]+": "+r.datasets[0].data[n.index].toFixed(1)+" %"}}},plugins:{datalabels:{color:mainColor,formatter:function(n,r){return 0<n?n.toFixed(1)+"%":""}}}}});$("#modal_contact_detail").data("dispIndex",-1);$("#modal_contact_detail").modal("show")}
function btn_antiair_input_Clicked(){for(var a="",b=0;12>b;b++)a+='\n\t\t\t<tr class="'+(6<b+1?"d-none escort_fleet":"main_fleet")+'">\n\t\t\t\t<td class="font_size_11 '+(6>=b+1?"text-primary":"text-success")+'">'+(b+1)+'</td>\n\t\t\t\t<td><input type="number" class="form-control form-control-sm antiair_weight" value="'+(b<inputAntiAirWeights.length?inputAntiAirWeights[b]:0)+'"></td>\n\t\t\t\t<td class="rate_shoot_down">-</td>\n\t\t\t\t<td class="fixed_shoot_down">-</td>\n\t\t\t\t<td class="minimum_shoot_down">-</td>\n\t\t\t</tr>';
$("#antiair_input_table tbody").html(a);for(a=0;a<fleetStage2Table.length;a++)if(b=fleetStage2Table[a],0<b.rate){var c=$("#antiair_cutin_inputs tr:eq("+a+")");c.find(".select_antiair_cutin_td").val(b.cutinId);c.find(".cutin_rate").val(b.rate);0<b.cutinId&&antiAirCutinChanged(c.find(".cutin_rate"),!1)}antiair_grand_Changed();updateFleetStage2Table();$("#modal_fleet_antiair_input").modal("show")}
function updateFleetStage2Table(){var a=castInt($("#fleet_antiair_formation").val()),b=castFloat($("#fleet_antiair_base").val()),c=$("#antiair_grand").prop("checked"),d=c&&$("#antiair_air_raid").prop("checked"),e=[],f=[],g=0,h=9999,l=FORMATION.find(function(n){return n.id===a});b*=l?l.correction:1;$("#fleet_antiair").val(b);fleetStage2Table=[];inputAntiAirWeights=[];$("#antiair_weight_inputs").find("tr:not(.d-none)").each(function(n,r){var p=validateInputNumber($(r).find(".antiair_weight").val(),
999);p!==$(r).find(".antiair_weight").val()&&$(r).find(".antiair_weight").val(p);var q=1;c&&(q=6>n?d?.78:.8:.48);p=castInt(p);var t=p*q/400;q=Math.floor((p+b)*q/10);inputAntiAirWeights.push(p);0===p?($(r).find(".rate_shoot_down").text("-"),$(r).find(".fixed_shoot_down").text("-"),$(r).find(".minimum_shoot_down").text("-")):($(r).find(".rate_shoot_down").text((100*t).toFixed(1)+"%"),$(r).find(".fixed_shoot_down").text(q+"\u6a5f"),$(r).find(".minimum_shoot_down").text("1\u6a5f"));e.push(0);f.push(9999)});
$("#antiair_cutin_inputs").find("tr").each(function(n,r){var p=castFloat($(r).find(".cutin_rate").val());if(!(0>=p)){for(var q=ANTIAIR_CUTIN.find(function(A){return A.id===castInt($(r).find(".select_antiair_cutin_td").val())}),t=[],u=0;u<inputAntiAirWeights.length;u++){var x=inputAntiAirWeights[u];if(0!==x){var w=1;c&&(w=6>u?d?.78:.8:.48);var v=Math.floor((x+b)*w*(q?q.adj[0]:1)/10),y=1+(q?q.adj[1]:0);t.push([x*w/400,v,y]);e[u]<v&&(e[u]=v);f[u]>v&&(f[u]=v);g<y&&(g=y);h>y&&(h=y)}}fleetStage2Table.push({cutinId:q?
q.id:0,rate:p,table:t,border:0})}});$("#antiair_weight_inputs").find("tr:not(.d-none)").each(function(n,r){if(0<inputAntiAirWeights[n])if(f[n]===e[n]?$(r).find(".fixed_shoot_down").text(f[n]+"\u6a5f"):$(r).find(".fixed_shoot_down").text(f[n]+"~"+e[n]+"\u6a5f"),h===g)$(r).find(".minimum_shoot_down").text(h+"\u6a5f");else{var p=getArraySum(fleetStage2Table.map(function(q){return q.table[0][2]}))/fleetStage2Table.length;$(r).find(".minimum_shoot_down").text(h+"~"+g+"\u6a5f("+p.toFixed(1)+"\u6a5f)")}});
l=0;for(var k=$jscomp.makeIterator(fleetStage2Table),m=k.next();!m.done;m=k.next())m=m.value,l+=m.rate,m.border=l}function fleet_antiair_base_TextChanged(){var a=validateInputNumberFloat($("#fleet_antiair_base").val(),999.9,0);a!==$("#fleet_antiair_base").val()&&$("#fleet_antiair_base").val(a);10<castInt($("#fleet_antiair_formation").val())?$("#fleet_antiair_formation").val(11):$("#fleet_antiair_formation").val(1);updateFleetStage2Table()}
function fleet_antiair_TextChanged(){var a=validateInputNumberFloat($("#fleet_antiair").val(),999.9,0);a!==$("#fleet_antiair").val()&&$("#fleet_antiair").val(a);$("#fleet_antiair_base").val(a);10<castInt($("#fleet_antiair_formation").val())?$("#fleet_antiair_formation").val(11):$("#fleet_antiair_formation").val(1);updateFleetStage2Table()}
function import_antiair_Changed(){var a=document.getElementById("import_antiair").value;a=a.replace("\u3001",",");a=a.replace(/\s/g,",");a=a.replace(/\t/g,",");a=a.replace(/\n/g,",");document.getElementById("import_antiair").value=a}
function btn_import_antiair_Clicked(){var a=document.getElementById("import_antiair").value.trim().split(","),b=0;a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())if(c=c.value){if(b>=document.getElementsByClassName("antiair_weight").length)break;document.getElementsByClassName("antiair_weight")[b++].value=castInt(c)}if(11>b)for(;12>b;b++)document.getElementsByClassName("antiair_weight")[b].value=0;document.getElementById("import_antiair").value="";updateFleetStage2Table()}
function antiAirCutinChanged(a,b){b=void 0===b?!0:b;var c=a.closest("tr");if(!c.hasClass("added")){var d=c.html(),e=document.createElement("tr");e.innerHTML=d;e.getElementsByClassName("cutin_rate")[0].value=0;a.closest("tbody")[0].appendChild(e);c.find(".cutin_rate").prop("readonly",!1);c.find(".btn_remove_cutin").html('<i class="fas fa-trash-o"></i>');c.find(".btn_remove_cutin").addClass("cur_pointer");c.addClass("added")}b&&updateFleetStage2Table()}
function updateAntiAirCutinRate(a){var b=validateInputNumberFloat(a.val(),100,0);b!=a.val()&&a.val(b);0==b&&a.val(0);b=100*castFloat(a.val());for(var c=0,d=document.getElementsByClassName("cutin_rate"),e=document.getElementsByClassName("cutin_rate")[d.length-1].value=0;e<d.length;e++)c+=Math.round(100*d[e].value);1E4<c?a.val((b-(c-1E4))/100):document.getElementsByClassName("cutin_rate")[d.length-1].value=Math.round(1E4-c)/100;updateFleetStage2Table()}
function btn_remove_cutin_Clicked(a){var b=castFloat(a.closest("tr").find(".cutin_rate").val());a.closest("tr").remove();a=$("#antiair_cutin_inputs tr:last()").find(".cutin_rate");a.val(castFloat(a.val())+b);1===$("#antiair_cutin_inputs tr").length&&a.val(100);updateFleetStage2Table()}
function resetFleetAntiairInput(){$("#modal_fleet_antiair_input input").val(0);$("#fleet_antiair_formation").val($("#antiair_grand").prop("checked")?11:1);$("#antiair_cutin_inputs tr:last()").find(".cutin_rate").val(100);updateFleetStage2Table()}
function antiair_grand_Changed(){var a=castInt($("#fleet_antiair_formation").val());$("#antiair_grand").prop("checked")?($("#modal_fleet_antiair_input").find(".escort_fleet").removeClass("d-none"),$("#antiair_air_raid").parent().removeClass("d-none"),$(".hidden_text").removeClass("d-none"),$("#fleet_antiair_formation").find("option").each(function(b,c){10<castInt($(c).val())?$(c).removeClass("d-none"):$(c).addClass("d-none")}),[1,2,3,5].includes(a)?$("#fleet_antiair_formation").val(a+10):10>a&&$("#fleet_antiair_formation").val(11)):
($("#modal_fleet_antiair_input").find(".escort_fleet").addClass("d-none"),$("#antiair_air_raid").parent().addClass("d-none"),$(".hidden_text").addClass("d-none"),$("#fleet_antiair_formation").find("option").each(function(b,c){10<castInt($(c).val())?$(c).addClass("d-none"):$(c).removeClass("d-none")}),[11,12,13,15].includes(a)?$("#fleet_antiair_formation").val(a-10):10<a&&$("#fleet_antiair_formation").val(11));updateFleetStage2Table()}
function btn_reset_landBase_Clicked(a){a.closest(".lb_tab").find(".lb_plane").each(function(b,c){$(c).find(".slot").text(0);setLBPlaneDiv($(c))});a.blur();calculate()}function lb_plane_DragEnd(a){a=a.closest(".lb_plane");isOut&&(clearPlaneDiv(a),a.css("opacity","0.0"),isOut=!1);a.animate({opacity:"1.0"},500);calculate()}
function lb_plane_Drop(a,b){var c=b.draggable;if(c.attr("class").includes("plane_tr_draggable"))c={id:castInt(c[0].dataset.planeid),remodel:castInt(c[0].dataset.remodel)},setLBPlaneDiv(a,c),(c=a.closest(".lb_tab").find(".ohuda_select"))&&0>castInt(c.val())&&c.val(isDefMode?0:2),calculate(),createDraggablePlaneTable();else{var d={id:castInt(c[0].dataset.planeid),remodel:castInt(c.find(".remodel_value")[0].textContent),prof:castInt(c.find(".prof_select")[0].dataset.prof),slot:castInt(c.find(".slot").text())},
e={id:castInt(a[0].dataset.planeid),remodel:castInt(a.find(".remodel_value")[0].textContent),prof:castInt(a.find(".prof_select")[0].dataset.prof),slot:castInt(a.find(".slot").text())};setLBPlaneDiv(a,d);isCtrlPress||$("#drag_drop_copy").prop("checked")||setLBPlaneDiv(c,e)}}
function btn_toggle_lb_info_Clicked(a){var b=a.closest(".lb_infomation");a.hasClass("show_resource")?(a.removeClass("show_resource"),isDefMode&&a.addClass("ml-auto"),b.find(".battle_only").addClass("ml-auto").removeClass("ml-2"),b.find(".btn_show_contact_rate_lb").removeClass("d-none"),b.find(".ap_detail").removeClass("d-none"),b.find(".resource").addClass("d-none")):(a.addClass("show_resource").removeClass("ml-auto"),b.find(".battle_only").removeClass("ml-auto").addClass("ml-2"),b.find(".btn_show_contact_rate_lb").addClass("d-none"),
b.find(".ap_detail").addClass("d-none"),b.find(".resource").removeClass("d-none"))}function toggle_def_mode_Checked(){isDefMode=document.getElementById("toggle_def_mode").checked;calculate()}function toggleDefenseMode(a){isDefMode=document.getElementById("toggle_def_mode").checked=a}function btn_reset_ship_plane_Clicked(a){a.closest(".ship_tab").find(".ship_plane").each(function(b,c){clearPlaneDiv($(c))});calculate()}
function ship_plane_DragStart(a){$(a.helper).addClass("ship_plane "+getPlaneCss(castInt($(a.helper).find(".plane_img").attr("alt")))).css("width",320);$(a.helper).find(".slot_select_parent").remove();$(a.helper).find(".btn_remove_plane").remove();$(a.helper).find(".plane_lock").remove();$(a.helper).find(".plane_unlock").remove();$(a.helper).find(".prof_select_parent").addClass("mr-2")}
function ship_plane_DragEnd(a){a=a.closest(".ship_plane");isOut&&(clearPlaneDiv(a),a.css("opacity","0.0"),isOut=!1);a.animate({opacity:"1.0"},500);calculate()}
function ship_plane_DragOver(a,b){var c=b.draggable.hasClass("plane_tr_draggable")?b.draggable:b.draggable.closest(".ship_plane"),d=castInt(a.closest(".ship_tab")[0].dataset.shipid),e=castInt(c[0].dataset.planeid);c=castInt(c[0].dataset.type);checkInvalidPlane(d,getPlanes(c).find(function(f){return f.id===e}))?(b.helper.stop().animate({opacity:"1.0"},100),isOut=!1):(b.helper.stop().animate({opacity:"0.2"},100),a.removeClass("plane_draggable_hover"),isOut=!0)}
function ship_plane_Drop(a,b){var c=b.draggable;if(c.attr("class").includes("plane_tr_draggable")){var d={id:castInt(c[0].dataset.planeid),remodel:castInt(c[0].dataset.remodel)};c=castInt(a.closest(".ship_tab")[0].dataset.shipid);checkInvalidPlane(c,PLANE_DATA.find(function(h){return h.id===d.id}))&&(setPlaneDiv(a,d),calculate(),createDraggablePlaneTable())}else if(b.draggable.closest(".ship_plane")[0].dataset.planeid){c=b.draggable.closest(".ship_plane");var e={id:castInt(c[0].dataset.planeid),remodel:castInt(c.find(".remodel_value")[0].textContent),
prof:castInt(c.find(".prof_select")[0].dataset.prof)},f={id:castInt(a[0].dataset.planeid),remodel:castInt(a.find(".remodel_value")[0].textContent),prof:castInt(a.find(".prof_select")[0].dataset.prof)},g=castInt(a.closest(".ship_tab")[0].dataset.shipid);checkInvalidPlane(g,PLANE_DATA.find(function(h){return h.id===e.id}))&&(setPlaneDiv(a,e),isCtrlPress||$("#drag_drop_copy").prop("checked")||setPlaneDiv(c,f))}}
function cell_type_Changed(a,b){b=void 0===b?!0:b;var c=a.closest(".battle_content"),d=castInt(a.val());c.find(".enemy_content").each(function(e,f){d!==CELL_TYPE.grand&&5<e?$(f).addClass("d-none").removeClass("d-flex"):$(f).removeClass("d-none").addClass("d-flex")});c=c.find(".formation");changeFormationSelectOption(c,d);b&&calculate()}
function changeFormationSelectOption(a,b){var c=castInt(a.val());a.find("option").each(function(d,e){b!==CELL_TYPE.grand&&(10>$(e).val()&&$(e).removeClass("d-none"),10<$(e).val()&&$(e).addClass("d-none"),10<c&&a.val(c-10));b===CELL_TYPE.grand&&(10>$(e).val()&&$(e).addClass("d-none"),10<$(e).val()&&$(e).removeClass("d-none"),4===c?a.val(11):a.val(c+10))})}
function plane_type_select_Changed(a){(a=void 0===a?null:a)||(a=$("#plane_type_select").find(".active"));var b=castInt(a.length?a[0].dataset.type:0);a=getPlanesForIcon(b);var c=$("#plane_word").val().trim(),d=[];$("#plane_type_select").find(".nav-link:not(.disabled)").each(function(t,u){var x=castInt($(u)[0].dataset.type);d.push(x);3===x?d.push(9):4===x?d.push(104):5===x&&(d=d.concat([6,7,8]))});if($target&&$target.attr("class").includes("ship_plane")&&$target.closest(".ship_tab")[0].dataset.shipid){var e=
SHIP_DATA.find(function(t){return t.id===castInt($target.closest(".ship_tab")[0].dataset.shipid)}),f=LINK_SHIP_EQUIPMENT.find(function(t){return t.type===e.type}),g=SPECIAL_LINK_SHIP_EQUIPMENT.find(function(t){return t.shipId===e.id});d=f.e_type.concat();g&&(d=d.concat(g.equipmentTypes));d&&d.includes(b)||(b=0,a=getPlanesForIcon(b));a=a.filter(function(t){return 151!==t.id});g&&0<g.equipmentTypes.length&&(d=d.concat(g.equipmentTypes));d=d.filter(function(t,u,x){return x.indexOf(t)===u});d.sort(function(t,
u){return t-u});a=a.filter(function(t){return d.includes(Math.abs(t.type))});if(g&&0<g.equipmentIds.length){f={};g=$jscomp.makeIterator(g.equipmentIds);for(var h=g.next();!h.done;f={$jscomp$loop$prop$id$403:f.$jscomp$loop$prop$id$403},h=g.next())f.$jscomp$loop$prop$id$403=h.value,h=PLANE_DATA.find(function(t){return function(u){return u.id===t.$jscomp$loop$prop$id$403}}(f)),d.push(h.type),a.find(function(t){return function(u){return u.id===t.$jscomp$loop$prop$id$403}}(f))||0!==b&&b!==h.type||a.push(h)}$("#plane_type_select").find(".nav-link").each(function(t,
u){var x=castInt($(u)[0].dataset.type);x===b?$(u).addClass("active"):$(u).removeClass("active");0===x||d.includes(x)||$(u).addClass("disabled d-none")})}else $target&&$target.attr("class").includes("ship_plane")&&(a=a.filter(function(t){return 104!==t.type}),a=a.filter(function(t){return d.includes(Math.abs(t.type))}));c&&(c=replaceKnji(c),a=a.filter(function(t){return t.name.includes(c)||t.abbr.includes(c)}));if(setting.inStockOnly&&setting.isDivideStock){f=loadPlaneStock();g=[];h={};a=$jscomp.makeIterator(a);
for(var l=a.next();!l.done;h={$jscomp$loop$prop$o$405:h.$jscomp$loop$prop$o$405},l=a.next()){h.$jscomp$loop$prop$o$405=l.value;l=f.find(function(t){return function(u){return u.id===t.$jscomp$loop$prop$o$405.id}}(h));for(var k=0;10>=k;k++){var m=l.num[k];0!==m&&(m=Object.assign({remodel:k,count:m},h.$jscomp$loop$prop$o$405),m.antiAir+=Plane.getBonusAntiAir(m.id,m.type,m.remodel,m.antiAir),g.push(m))}}a=g.concat()}var n=$("#plane_sort_select").val();switch(n){case "battle_anti_air":a.sort(function(t,
u){return u.antiAir+1.5*u.interception-(t.antiAir+1.5*t.interception)});break;case "defense_anti_air":a.sort(function(t,u){return u.antiAir+u.interception+2*u.antiBomber-(t.antiAir+t.interception+2*t.antiBomber)});break;case "land_base_power":a.sort(function(t,u){return getLandBasePower(u.id,18,0)-getLandBasePower(t.id,18,0)});break;case "radius":a.sort(function(t,u){return u.radius-t.radius});break;case "history":if(setting.selectedHistory[0]){var r=setting.selectedHistory[0];a.sort(function(t,u){return r.filter(function(x){return x===
u.id}).length-r.filter(function(x){return x===t.id}).length})}case "id":case "cost":a.sort(function(t,u){return t[n]-u[n]});break;case "default":break;default:a.sort(function(t,u){return u[n]-t[n]})}var p=$("#plane_filter_key_select").val(),q=castInt($("#plane_filter_value").val());switch(p){case "battle_anti_air":a=a.filter(function(t){return t.antiAir+1.5*t.interception>=q});break;case "defense_anti_air":a=a.filter(function(t){return t.antiAir+t.interception+2*t.antiBomber>=q});break;default:a=
a.filter(function(t){return t[p]>=q})}createPlaneTable(a)}function plane_word_TextChanged(){!1!==timer&&clearTimeout(timer);timer=setTimeout(function(){plane_type_select_Changed()},250)}function fav_only_Checked_Chenged(){setting.favoriteOnly=$("#fav_only").prop("checked");saveSetting();plane_type_select_Changed()}function disp_in_stock_Checked_Chenged(){setting.inStockOnly=$("#disp_in_stock").prop("checked");saveSetting();plane_type_select_Changed()}
function divide_stock_Checked_Chenged(){setting.isDivideStock=$("#divide_stock").prop("checked");saveSetting();plane_type_select_Changed()}function disp_equipped_Checked_Chenged(){setting.visibleEquipped=$("#disp_equipped").prop("checked");saveSetting();plane_type_select_Changed()}function btn_remove_lb_plane_Clicked(a){a=a.closest(".lb_plane");clearPlaneDiv(a);a.find(".slot").text(0);a.find(".slot_input").attr("max",0);a.find(".slot_range").attr("max",0);calculate()}
function toggle_display_type_Clicked(a){var b=a.closest(".modal");b.find(".toggle_display_type").removeClass("selected");a.addClass("selected");setting.displayMode[b.attr("id")]=a.data("mode");saveSetting();b.find("select").change()}function sort_Changed(a){a=a.closest(".modal");var b=a.find(".sort_select").val(),c=$target.closest(".contents").attr("id");c&&(setting.orderBy[c]=b,saveSetting());"modal_plane_select"===a.attr("id")&&plane_type_select_Changed()}
function plane_filter_Changed(){var a=$("#plane_filter_key_select").val(),b=castInt($("#plane_filter_value").val()),c=$target.closest(".contents").attr("id");c&&(setting.planeFilter[c]=[a,b],saveSetting());plane_type_select_Changed()}
function plane_name_Clicked(a){$target=a.closest(".lb_plane");$target.attr("class")||($target=a.closest(".ship_plane"));a=castInt($target[0].dataset.planeid);var b=castInt($("#plane_type_select").find(".active")[0].dataset.type);$("#plane_type_select").find(".nav-link").each(function(d,e){$(e).removeClass("disabled d-none")});$target.attr("class").includes("ship_plane")&&(100<b&&(b=0),$("#plane_type_select").find(".nav-link").each(function(d,e){var f=castInt($(e)[0].dataset.type);100<f&&$(e).addClass("disabled d-none");
f===b?$(e).addClass("active"):$(e).removeClass("active")}));var c=$target.closest(".contents").attr("id");c&&($("#modal_plane_select").find(".sort_select").val(setting.orderBy[c]),$("#plane_filter_key_select").val(setting.planeFilter[c][0]),$("#plane_filter_value").val(setting.planeFilter[c][1]));plane_type_select_Changed();$("#modal_plane_select").find(".btn_remove").prop("disabled",0===a);$("#modal_plane_select").modal("show")}
function modal_plane_Selected(a){a={id:castInt(a[0].dataset.planeid),remodel:castInt(a[0].dataset.remodel)};if($target.attr("class").includes("lb_plane")){setLBPlaneDiv($target,a);var b=$target.closest(".lb_tab").find(".ohuda_select");b&&0>castInt(b.val(),-1)&&b.val(isDefMode?0:2)}else $target.attr("class").includes("ship_plane")&&setPlaneDiv($target,a);a.id&&updatePlaneSelectedHistory(a.id);$("#modal_plane_select").modal("hide")}
function modal_plane_select_btn_remove_Clicked(a){if(a.prop("disabled"))return!1;clearPlaneDiv($target);$("#modal_plane_select").modal("hide")}function btn_plane_preset_Clicked(a){var b=-1;$target=a.closest(".lb_tab");$target.attr("class")||($target=a.closest(".ship_tab"),b=castInt($target[0].dataset.shipid));$("#modal_plane_preset").data("parentid",b);loadPlanePreset();$("#modal_plane_preset").modal("show");a.blur()}
function plane_preset_tr_Clicked(a){var b=planePreset.find(function(c){return c.id===castInt(a.data("presetid"))});$(".preset_tr").removeClass("preset_selected");a.addClass("preset_selected");drawPlanePresetPreview(b)}
function preset_name_Changed(a){var b=a.val().trim(),c=a.closest(".modal").find(".btn_commit_preset");50<b.length?(a.addClass("is-invalid"),c.prop("disabled",!0)):0===b.length?(a.addClass("is-invalid"),c.prop("disabled",!0)):(a.removeClass("is-invalid"),a.addClass("is-valid"),c.prop("disabled",!1))}function btn_commit_plane_preset_Clicked(a){a.prop("disabled",!0);updatePlanePreset();loadPlanePreset()}
function btn_delete_plane_preset_Clicked(a){a.prop("disabled",!0);deletePlanePreset();loadPlanePreset()}
function btn_expand_plane_preset_Clicked(){var a=castInt($(".preset_selected").data("presetid")),b=planePreset.find(function(c){return c.id===a});b&&($target.attr("class").includes("lb_tab")?($target.find(".lb_plane").each(function(c,d){var e={id:0,remodel:0};b.planes.length>c&&(e.id=b.planes[c].id,e.remodel=b.planes[c].remodel,setLBPlaneDiv($(d),e))}),$target.find(".ohuda_select").val(isDefMode?0:2)):$target.find(".ship_plane").each(function(c,d){var e={id:0,remodel:0};b.planes.length>c&&(e.id=b.planes[c].id,
e.remodel=b.planes[c].remodel,setPlaneDiv($(d),e))}));$("#modal_plane_preset").modal("hide")}function display_ship_count_Changed(a,b){b=void 0===b?!1:b;var c=a.val();a.closest(".friendFleet_tab").find(".ship_tab").each(function(d,e){d<c?$(e).removeClass("d-none"):$(e).addClass("d-none")});b||calculate()}function btn_remove_ship_plane_Clicked(a){clearPlaneDiv(a.closest(".ship_plane"));calculate()}function fleet_select_tab_Clicked(){$("#union_fleet").prop("checked")||calculate()}
function ship_disabled_Changed(a){a.hasClass("disabled")?(a.closest(".ship_tab").removeClass("opacity4"),a.removeClass("disabled"),a.children().removeClass("fa-eye-slash").addClass("fa-eye no_capture")):(a.closest(".ship_tab").addClass("opacity4"),a.addClass("disabled"),a.children().removeClass("fa-eye no_capture").addClass("fa-eye-slash"));calculate()}
function ship_name_span_Clicked(a){$target=a.closest(".ship_tab");castInt($target[0].dataset.shipid)?$("#modal_ship_select").find(".btn_remove").prop("disabled",!1):$("#modal_ship_select").find(".btn_remove").prop("disabled",!0);$("#ship_type_select").change();$("#modal_ship_select").modal("show")}function btn_remove_ship_Clicked(a){clearShipDiv(a.closest(".ship_tab"));calculate()}
function ship_word_TextChanged(){!1!==timer&&clearTimeout(timer);timer=setTimeout(function(){createShipTable(castInt($("#ship_type_select").val()))},250)}function modal_ship_Selected(a){a=castFloat(a[0].dataset.shipid);setShipDiv($target,a);updateShipSelectedHistory(a);$("#modal_ship_select").modal("hide")}function modal_ship_select_btn_remove_Clicked(a){if(a.prop("disabled"))return!1;clearShipDiv($target);$("#modal_ship_select").modal("hide")}
function battle_count_Changed(a){createEnemyInput(castInt(a.val()));$("#lb_tab_parent").find(".ohuda_select").each(function(b,c){2===castInt($(c).val())&&($("#btn_lb_target").removeClass("btn-outline-success"),$("#btn_lb_target").addClass("btn-outline-danger"),$("#lb_target_alert").removeClass("d-none"))});inform_warning("\u6575\u8266\u3068\u306e\u4ea4\u6226\u56de\u6570\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002\u57fa\u5730\u822a\u7a7a\u968a\u306e\u6d3e\u9063\u5148\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");
calculate()}
function btn_lb_target_Clicked(){var a=new LandBaseAll;updateLandBaseInfo(a,!1);var b=document.getElementById("land_base_target_buttons").getElementsByClassName("btn-sm"),c=$jscomp.makeIterator(b);for(b=c.next();!b.done;b=c.next())b=b.value,b.classList.remove("active"),b.getElementsByTagName("input")[0].checked=!1,b.classList.contains("btn-outline-secondary")||b.classList.remove("disabled");a=$jscomp.makeIterator(a.landBases);for(b=a.next();!b.done;b=a.next())if(c=b.value,2===c.mode){if(b=document.getElementsByName("lb"+
c.baseNo+"_target")[c.target[0]])b.parentElement.classList.add("active"),b.checked=!0;if(b=document.getElementsByName("lb"+c.baseNo+"_target2")[c.target[1]])b.parentElement.classList.add("active"),b.checked=!0}else{var d=$jscomp.makeIterator(document.getElementsByName("lb"+c.baseNo+"_target"));for(b=d.next();!b.done;b=d.next())b.value.parentElement.classList.add("disabled");c=$jscomp.makeIterator(document.getElementsByName("lb"+c.baseNo+"_target2"));for(b=c.next();!b.done;b=c.next())b.value.parentElement.classList.add("disabled")}$("#btn_lb_target").removeClass("btn-outline-danger");
$("#btn_lb_target").addClass("btn-outline-success");$("#lb_target_alert").addClass("d-none");$("#modal_lb_target").modal("show")}
function enemy_fleet_display_mode_Changed(){var a=$("#enemy_fleet_display_image").prop("checked");$(".enemy_content").each(function(b,c){a?($(c).removeClass("py-0_5").addClass("pb-0_1 min-h-31px"),$(c).find(".enemy_name_img_parent").removeClass("d-none").addClass("d-flex"),$(c).find(".enemy_name_text").addClass("d-none")):($(c).removeClass("pb-0_1 min-h-31px").addClass("py-0_5"),$(c).find(".enemy_name_img_parent").addClass("d-none").removeClass("d-flex"),$(c).find(".enemy_name_text").removeClass("d-none"))});
setting.enemyFleetDisplayImage=a;saveSetting()}function btn_reset_battle_Clicked(a){var b=isDefMode?$("#air_raid_enemies"):a.closest(".battle_content");b[0].dataset.celldata="";b.find(".enemy_content").each(function(c,d){return clearEnemyDiv($(d))});a.blur();calculate()}function enemy_word_TextChanged(){!1!==timer&&clearTimeout(timer);timer=setTimeout(function(){createEnemyTable([castInt($("#enemy_type_select").val())])},250)}
function enemy_name_Clicked(a){$target=a;a=castInt($target[0].dataset.enemyid);$("#enemy_type_select").change();0!==a?$("#modal_enemy_select").find(".btn_remove").prop("disabled",!1):$("#modal_enemy_select").find(".btn_remove").prop("disabled",!0);$("#modal_enemy_select").modal("show")}function modal_enemy_Selected(a){setEnemyDiv($target,castInt(a[0].dataset.enemyid));$("#modal_enemy_select").modal("hide")}
function modal_enemy_select_btn_remove(a){if(a.prop("disabled"))return!1;clearEnemyDiv($target);$("#modal_enemy_select").modal("hide")}function btn_world_expand_Clicked(){$target=$(".battle_content:first");$("#expand_target").text(1);$("#btn_expand_enemies").addClass("d-none");$("#btn_continue_expand").prop("disabled",!0);$("#btn_continue_expand").removeClass("d-none");$("#expand_target_parent").removeClass("d-none");$("#enemy_pattern_tbody").html("");$("#modal_enemy_pattern").modal("show")}
function btn_enemy_preset_Clicked(a){$target=a.closest(".battle_content");isDefMode&&($target=$("#air_raid_enemies"));$("#btn_expand_enemies").removeClass("d-none");$("#btn_expand_enemies").prop("disabled",!0);$("#btn_continue_expand").addClass("d-none");$("#expand_target_parent").addClass("d-none");$("#modal_enemy_pattern").modal("show")}
function btn_stage2_Clicked(a){var b=a.closest(".battle_content");a=castInt(b.find(".battle_no").text())-1;b=castInt(b.find(".formation").val());$("#modal_stage2_detail").data("battleno",a);$("#modal_stage2_detail").data("formationid",b);calculateStage2Detail();$("#modal_stage2_detail").modal("show")}function stage2_slot_input_Changed(){var a=$("#stage2_detail_slot"),b=validateInputNumber(a.val(),castInt(a.attr("max")));a.val(b);calculateStage2Detail()}
function free_modify_input_Changed(a){var b=validateInputNumberFloat(a.val(),castFloat(a.attr("max")));a.val()!==b&&a.val(b);calculateStage2Detail()}
function calculateStage2Detail(){var a=castInt($("#modal_stage2_detail").data("battleno")),b=castInt($("#modal_stage2_detail").data("formationid")),c=[];updateEnemyFleetInfo(c,!1);a=c[a];var d=castInt($("#stage2_detail_slot").val()),e=castInt($("#stage2_detail_avoid").val()),f=0;c="";var g=!1,h=[166,167,409,410,411,412,413,414];$("#free_modify").find("input").prop("readonly",5!==e);5>e&&($("#free_anti_air_weight").val(AVOID_TYPE[e].adj[0]),$("#free_anti_air_bornus").val(AVOID_TYPE[e].adj[1]));for(var l=
0,k=0;k<a.enemies.length;k++){var m=a.enemies[k];if(0!==m.id){var n=Math.floor(d*a.stage2[e][0][l]),r=a.stage2[e][1][l],p=n+r;h.includes(m.id)&&(g=!0);f+=m.aabo;c+='\n\t\t<tr class="'+(p>=d?"stage2_table_death":p>=d/2?"stage2_table_half":"")+'">\n\t\t\t<td class="font_size_12 text-left td_enm_name" data-toggle="tooltip" data-html="true"\n\t\t\t\tdata-title="<div><div>\u52a0\u91cd\u5bfe\u7a7a\u5024\uff1a'+m.aaw+"</div><div>\u9632\u7a7a\u30dc\u30fc\u30ca\u30b9\uff1a"+m.aabo+'</div></div>">\n\t\t\t\t<span class="ml-2">\n\t\t\t\t\t'+
drawEnemyGradeColor(m.name)+'\n\t\t\t\t</span>\n\t\t\t</td>\n\t\t\t<td>\n\t\t\t\t<span class="text-right">\n\t\t\t\t\t'+(100*a.stage2[e][0][l++]).toFixed(1)+"% ("+n+"\u6a5f)</span>\n\t\t\t</td>\n\t\t\t<td>"+r+"\u6a5f</td>\n\t\t\t<td>"+p+"\u6a5f</td>\n\t\t</tr>\n\t\t"}}d=FORMATION.find(function(q){return q.id===b});f=2*Math.floor((d?d.correction:1)*f);a.cellType<=CELL_TYPE.grand?$("#is_air_raid").addClass("d-none"):$("#is_air_raid").removeClass("d-none");a.cellType<=CELL_TYPE.grand&&g?$("#stage2_warning").removeClass("d-none"):
$("#stage2_warning").addClass("d-none");$("#stage2_table tbody").html(c);$(".td_enm_name").tooltip();$("#stage2_detail_formation").text(d.name);$("#sumfleetAntiAir").text(f)}function node_tr_Clicked(a){$(".node_tr").removeClass("node_selected");a.addClass("node_selected");createEnemyPattern()}function pattern_Changed(a){a=castInt(a.data("disp"),-1);0>a||createEnemyPattern(a)}
function enemy_display_mode_Changed(a){setting.enemyDisplayImage=a.attr("id").includes("enemy_display_image");saveSetting();a=castInt($("#enemy_pattern_select").find(".nav-link.active").data("disp"));0<a?createEnemyPattern(a):createEnemyPattern()}function node_Clicked(a){$(".node_tr").removeClass("node_selected");$('.node_tr[data-node="'+a.attr("title")+'"').addClass("node_selected");createEnemyPattern()}
function node_DoubleClicked(){$(".node_tr").hasClass("node_selected")&&($("#btn_expand_enemies").hasClass("d-none")?(btn_continue_expand_Clicked(),$(".node_tr").removeClass("node_selected")):btn_expand_enemies())}function btn_expand_enemies(){expandEnemy();$("#modal_enemy_pattern").modal("hide")}
function btn_continue_expand_Clicked(){var a=castInt($("#expand_target").text());1===a&&clearEnemyDivAll();createEnemyInput(a);$("#expand_target").text(a+1);$target=$(document.getElementsByClassName("battle_content")[a-1]);expandEnemy();$("#enemy_pattern_tbody").html("<div>"+a+" \u6226\u76ee\u306e\u6575\u8266\u968a\u304c\u633f\u5165\u3055\u308c\u307e\u3057\u305f\u3002</div><div>\u7d9a\u3051\u308b\u5834\u5408\u306f\u518d\u5ea6\u6226\u95d8\u30de\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002<div>");
$("#enemy_pattern_select").html('<li class="nav-item"><a class="nav-link '+("#000000"===mainColor?"":"nav-link-dark")+' active" data-toggle="tab" href="#">\u7de8\u62101</a></li>');$("#enemy_pattern_air_power").text("0");$("#enemy_display_mode_parent").addClass("d-none").removeClass("d-flex");$(".node_selected").removeClass("node_selected");$("#btn_continue_expand").prop("disabled",!0);$("#lb_tab_parent").find(".ohuda_select").each(function(b,c){2===castInt($(c).val())&&($("#btn_lb_target").removeClass("btn-outline-success"),
$("#btn_lb_target").addClass("btn-outline-danger"),$("#lb_target_alert").removeClass("d-none"))});if(isDefMode||10===a)$("#modal_enemy_pattern").modal("hide"),10===a&&inform_warning("\u6575\u8266\u3068\u306e\u4ea4\u6226\u56de\u6570\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002\u57fa\u5730\u822a\u7a7a\u968a\u306e\u6d3e\u9063\u5148\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}
function shoot_down_table_tbody_MouseEnter(a){a=a.closest("tr");var b=castInt(a[0].dataset.shipindex),c=a[0].dataset.css;a.addClass("bg-hover");a.find(".td_plane_name").addClass(c);$("#shoot_down_table_tbody").find('tr[data-shipindex="'+b+'"]:first').find(".td_name").addClass("bg-hover")}
function shoot_down_table_tbody_MouseLeave(a){a=a.closest("tr");var b=castInt(a[0].dataset.shipindex),c=a[0].dataset.css;a.removeClass("bg-hover");a.find(".td_plane_name").removeClass(c);$("#shoot_down_table_tbody").find('tr[data-shipindex="'+b+'"]:first').find(".td_name").removeClass("bg-hover")}
function progress_area_MouseEnter(a){a=a.find(".result_bar");var b=castInt(a.data("airstatus")),c=castInt(a.attr("id").replace("result_bar_",""));a.addClass("bar_ex_status"+b);$("#rate_row_"+c).addClass("bg_status"+b)}function progress_area_MouseLeave(a){a=a.find(".result_bar");var b=castInt(a.data("airstatus")),c=castInt(a.attr("id").replace("result_bar_",""));a.removeClass("bar_ex_status"+b);$("#rate_row_"+c).removeClass("bg_status"+b)}
function rate_table_MouseEnter(a){a=castInt(a.closest("tr").attr("id").replace("rate_row_",""));var b=$("#result_bar_"+a),c=castInt(b.data("airstatus"));b.addClass("bar_ex_status"+c);$("#rate_row_"+a).addClass("bg_status"+c)}function rate_table_MouseLeave(a){a=castInt(a.closest("tr").attr("id").replace("rate_row_",""));var b=$("#result_bar_"+a),c=castInt(b.data("airstatus"));b.removeClass("bar_ex_status"+c);$("#rate_row_"+a).removeClass("bg_status"+c)}
function enemy_shoot_down_table_tbody_MouseEnter(a){a=a.closest("tr");var b=castInt(a[0].dataset.rowindex),c=a[0].dataset.css;a.addClass("bg-hover");a.find(".td_plane_name").addClass(c);$("#enemy_shoot_down_tbody").find(".enemy_no_"+b+":first").find(".td_name").addClass("bg-hover")}
function enemy_shoot_down_table_tbody_MouseLeave(a){a=a.closest("tr");var b=castInt(a[0].dataset.rowindex),c=a[0].dataset.css;a.removeClass("bg-hover");a.find(".td_plane_name").removeClass(c);$("#enemy_shoot_down_tbody").find(".enemy_no_"+b+":first").find(".td_name").removeClass("bg-hover")}function display_battle_tab_Changed(a){displayBattle=castInt(a.find(".nav-link").data("disp"));calculate()}
function display_result_Changed(){if($("#display_land_base_result").prop("checked"))for(var a=1;7>a;a++)$("#rate_row_"+a+":not(.disabled_tr)").removeClass("d-none"),$("#result_bar_"+a).closest(".progress_area:not(.disabled_bar)").removeClass("d-none").addClass("d-flex");else for(a=1;7>a;a++)$("#rate_row_"+a).addClass("d-none"),$("#result_bar_"+a).closest(".progress_area").addClass("d-none").removeClass("d-flex");$("#display_fleet_result").prop("checked")?($("#rate_row_7:not(.disabled_tr)").removeClass("d-none"),
$("#result_bar_7").closest(".progress_area:not(.disabled_bar)").removeClass("d-none").addClass("d-flex")):($("#rate_row_7").addClass("d-none"),$("#result_bar_7").closest(".progress_area").addClass("d-none").removeClass("d-flex"));$("#display_bar").prop("checked")?$("#result_bar_parent").removeClass("d-none"):$("#result_bar_parent").addClass("d-none");$("#display_enemy_table").prop("checked")?$("#enemy_shoot_down_table_parent").removeClass("d-none"):$("#enemy_shoot_down_table_parent").addClass("d-none")}
function land_base_detail_Clicked(a){landBaseDetailCalculate(castInt(a.data("base_no")),0);$("#modal_result_detail").modal("show")}function fleet_slot_Clicked(a){var b=castInt(a[0].dataset.shipid),c=castInt(a[0].dataset.shipindex),d=castInt(a[0].dataset.slotindex);"-"!==a.find(".td_plane_name").text()&&""!==a.find(".td_plane_name").text()&&(fleetSlotDetailCalculate(c,d,b),$("#modal_result_detail").modal("show"))}
function enemy_slot_Clicked(a){var b=castInt(a.closest("tr")[0].dataset.rowindex);a=castInt(a.closest("tr")[0].dataset.slotindex);enemySlotDetailCalculate(b,a);$("#modal_result_detail").modal("show")}
function innerProfSetting_Clicked(a){var b=castInt(a.attr("id").replace("prof120_",""));a.prop("checked")&&!initialProf120Plane.includes(b)?initialProf120Plane.push(b):!a.prop("checked")&&initialProf120Plane.includes(b)&&(initialProf120Plane=initialProf120Plane.filter(function(c){return c!==b}));setting.initialProf120=initialProf120Plane.sort(function(c,d){return c-d});saveSetting();calculate()}
function calculate_count_Changed(a){var b=validateInputNumber(a.val(),1E5);a.val(b);setting.simulateCount=b;saveSetting()}function clipboard_mode_Clicked(){"function"!==typeof ClipboardItem&&($("#clipboard_mode").prop("checked",!1),$("#cant_use_clipboard").removeClass("d-none"));setting.copyToClipboard=$("#clipboard_mode").prop("checked");saveSetting()}function air_raid_max_Clicked(){setting.airRaidMax=$("#air_raid_max").prop("checked");saveSetting()}
function btn_reset_selected_plane_history_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u3088\u304f\u4f7f\u3046\u3068\u3057\u3066\u767b\u9332\u3055\u308c\u305f\u6a5f\u4f53\u60c5\u5831\u3092\u524a\u9664\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType="deleteSelectedPlaneHistory";a.modal("show")}
function btn_reset_selected_ship_history_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u3088\u304f\u4f7f\u3046\u3068\u3057\u3066\u767b\u9332\u3055\u308c\u305f\u8266\u5a18\u60c5\u5831\u3092\u524a\u9664\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType="deleteSelectedShipHistory";a.modal("show")}
function stock_type_select_Changed(){var a=Math.abs(castInt($("#stock_type_select").val())),b=$("#stock_word").val().trim();b&&(b=replaceKnji(b));$("#plane_stock").find(".stock_tr").each(function(c,d){0<a&&!$(d).hasClass("type_"+a)?$(d).addClass("d-none").removeClass("d-flex"):b&&!$(d).find(".stock_td_name").text().includes(b)?$(d).addClass("d-none").removeClass("d-flex"):$(d).addClass("d-flex").removeClass("d-none")})}
function ship_stock_type_select_Changed(){var a=castInt($("#ship_stock_type_select").val()),b=$("#ship_stock_word").val().trim();b&&(b=replaceKnji(b));$("#ship_stock").find(".stock_tr").each(function(c,d){0<a&&!$(d).hasClass("type_"+a)?$(d).addClass("d-none").removeClass("d-flex"):b&&!$(d).find(".stock_td_name").text().includes(b)?$(d).addClass("d-none").removeClass("d-flex"):$(d).addClass("d-flex").removeClass("d-none")})}
function btn_load_equipment_json_Clicked(){var a=$("#input_equipment_json").val().trim();readEquipmentJson(a)?(setPlaneStockTable(),$("#input_equipment_json").val(""),$("#input_equipment_json").removeClass("is-invalid").addClass("is-valid"),inform_success("\u6240\u6301\u88c5\u5099\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002")):($("#input_equipment_json").addClass("is-invalid").removeClass("is-valid"),inform_danger("\u88c5\u5099\u60c5\u5831\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u5165\u529b\u3055\u308c\u305f\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u6b63\u3057\u304f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"))}
function btn_load_ship_json_Clicked(){var a=$("#input_ship_json").val().trim();readShipJson(a)?(setShipStockTable(),$("#input_ship_json").val(""),$("#input_ship_json").removeClass("is-invalid").addClass("is-valid"),inform_success("\u6240\u6301\u8266\u5a18\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002")):($("#input_ship_json").addClass("is-invalid").removeClass("is-valid"),inform_danger("\u8266\u5a18\u60c5\u5831\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u5165\u529b\u3055\u308c\u305f\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u6b63\u3057\u304f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"))}
function input_equipment_json_Changed(a){var b=a.val().trim(),c=$("#btn_load_equipment_json");0===b.length?(a.addClass("is-invalid").removeClass("is-valid"),a.nextAll(".invalid-feedback").text("\u30c7\u30fc\u30bf\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"),c.prop("disabled",!0)):(a.removeClass("is-invalid"),c.prop("disabled",!1))}
function input_ship_json_Changed(a){var b=a.val().trim(),c=$("#btn_load_ship_json");0===b.length?(a.addClass("is-invalid").removeClass("is-valid"),a.nextAll(".invalid-feedback").text("\u30c7\u30fc\u30bf\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"),c.prop("disabled",!0)):(a.removeClass("is-invalid"),c.prop("disabled",!1))}
function btn_fav_clear_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u304a\u6c17\u306b\u5165\u308a\u6a5f\u4f53\u60c5\u5831\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType="resetFavoritePlane";a.modal("show")}
function btn_fav_ship_clear_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u304a\u6c17\u306b\u5165\u308a\u8266\u5a18\u60c5\u5831\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType="resetFavoriteShip";a.modal("show")}
function btn_stock_all_clear_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u6240\u6301\u6a5f\u4f53\u60c5\u5831\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u73fe\u5728\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u6240\u6301\u88c5\u5099\u60c5\u5831\u304c\u524a\u9664\u3055\u308c\u3001\u5168\u3066\u306e\u6a5f\u4f53\u306e\u6240\u6301\u6570\u304c0\u3068\u306a\u308a\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType=
"resetPlaneStock";a.modal("show")}
function btn_ship_stock_all_clear_Clicked(){var a=$("#modal_confirm");a.find(".modal-body").html('\n\t\t<div>\u6240\u6301\u8266\u5a18\u60c5\u5831\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u73fe\u5728\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u6240\u6301\u8266\u5a18\u60c5\u5831\u304c\u524a\u9664\u3055\u308c\u3001\u5168\u3066\u306e\u8266\u5a18\u306e\u6240\u6301\u6570\u304c0\u3068\u306a\u308a\u307e\u3059\u3002</div>\n\t\t<div class="mt-3">\u3088\u308d\u3057\u3051\u308c\u3070\u3001OK\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002</div>\n\t');confirmType=
"resetShipStock";a.modal("show")}function stock_word_TextChanged(){!1!==timer&&clearTimeout(timer);timer=setTimeout(function(){stock_type_select_Changed()},250)}function ship_stock_word_TextChanged(){!1!==timer&&clearTimeout(timer);timer=setTimeout(function(){ship_stock_type_select_Changed()},250)}
function stock_td_fav_Clicked(a){var b=castInt(a.closest(".stock_tr").data("planeid"));a.hasClass("stock_fav")?(setting.favoritePlane=setting.favoritePlane.filter(function(c){return c!==b}),a.addClass("stock_unfav unfav_clicked").removeClass("stock_fav"),setTimeout(function(){a.removeClass("unfav_clicked")},500)):(setting.favoritePlane.push(b),a.addClass("stock_fav fav_clicked").removeClass("stock_unfav"),setTimeout(function(){a.removeClass("fav_clicked")},500));saveSetting()}
function ship_stock_td_fav_Clicked(a){var b=castInt(a.parent()[0].dataset.shipid);a.hasClass("stock_fav")?(setting.favoriteShip=setting.favoriteShip.filter(function(c){return c!==b}),a.addClass("stock_unfav unfav_clicked").removeClass("stock_fav"),setTimeout(function(){a.removeClass("unfav_clicked")},500)):(setting.favoriteShip.push(b),a.addClass("stock_fav fav_clicked").removeClass("stock_unfav"),setTimeout(function(){a.removeClass("fav_clicked")},500));saveSetting()}
function stock_tr_Clicked(a){var b=$("#modal_plane_stock"),c=b.find(".plane_status_tr"),d=PLANE_DATA.find(function(g){return g.id===castInt(a.data("planeid"))}),e=loadPlaneStock().find(function(g){return g.id===d.id});b.find(".stock_num").each(function(g,h){$(h).val(e.num[g]);0<g&&$(h).prop("disabled",!d.canRemodel)});c.find(".plane_status_anti_air").text(d.antiAir);c.find(".plane_status_torpedo").text(d.torpedo);c.find(".plane_status_bomber").text(d.bomber);c.find(".plane_status_radius").text(d.radius);
c.find(".plane_status_interception").text(d.interception);c.find(".plane_status_anti_bomber").text(d.antiBomber);c=c.find(".plane_status_avoid");var f=AVOID_TYPE.find(function(g){return g.id===d.avoid});f?(c.text(f.name),c.attr("title","\u5272\u5408\u6483\u589c\u88dc\u6b63\uff1a"+f.adj[0]+", \u56fa\u5b9a\u6483\u589c\u88dc\u6b63\uff1a"+f.adj[1])):(c.text("\u306a\u3057"),c.attr("title","\u5272\u5408\u6483\u589c\u88dc\u6b63\uff1a1.0, \u56fa\u5b9a\u6483\u589c\u88dc\u6b63\uff1a1.0"));b.find("#edit_id").text(d.id);
b.find(".plane_status_name").text(d.name);b.find("#stock_sum").val(getArraySum(e.num));b.find(".img_plane_card").attr("src","../img/plane/"+d.id+".png");b.modal("show")}function stock_Changed(a){var b=castInt(a.val()),c=0;$(".stock_num").each(function(d,e){c+=castInt($(e).val())});99<c&&(b-=c-99,c=99);a.val(validateInputNumber(b,99));$("#stock_sum").val(c)}
function btn_save_stock_Clicked(){var a=loadPlaneStock(),b=castInt($("#edit_id").text()),c=[0,0,0,0,0,0,0,0,0,0,0];$(".stock_num").each(function(d,e){c[d]=castInt($(e).val())});a.find(function(d){return d.id===b}).num=c;saveLocalStorage("planeStock",a);inform_success("\u6240\u6301\u6570\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002");$("#modal_plane_stock").modal("hide");setPlaneStockTable()}
function btn_stock_reset_Clicked(){$("#modal_plane_stock").find(".stock_num").val("0");$("#modal_plane_stock").find("#stock_sum").val("0")}function stock_td_stock_Changed(a){var b=validateInputNumber(castInt(a.val()),99);a.val(b);var c=castInt(a.parent()[0].dataset.shipid);a=loadShipStock();a.find(function(d){return d.id===c}).num=b;saveLocalStorage("shipStock",a);inform_success("\u8266\u5a18\u4fdd\u6709\u6570\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002")}
function manage_manual_enemu_content_Shown(){document.getElementById("created_manual_enemies").innerHTML.trim()||drawManualEnemies()}
function drawManualEnemies(){var a=document.getElementById("created_manual_enemies");a.innerHTML="";for(var b={},c=0;c<ENEMY_DATA.length;b={$jscomp$loop$prop$enemy$407:b.$jscomp$loop$prop$enemy$407},c++)if(b.$jscomp$loop$prop$enemy$407=ENEMY_DATA[c],UNKNOWN_ENEMY.includes(b.$jscomp$loop$prop$enemy$407.id)){for(var d=0,e=0,f=b.$jscomp$loop$prop$enemy$407.slot.length,g={$jscomp$loop$prop$i$298$409:0};g.$jscomp$loop$prop$i$298$409<f;g={$jscomp$loop$prop$i$298$409:g.$jscomp$loop$prop$i$298$409},g.$jscomp$loop$prop$i$298$409++){var h=
ENEMY_PLANE_DATA.find(function(q,t){return function(u){return u.id===q.$jscomp$loop$prop$enemy$407.eqp[t.$jscomp$loop$prop$i$298$409]}}(b,g));h&&(5!==h.type?d+=Math.floor(h.antiAir*Math.sqrt(b.$jscomp$loop$prop$enemy$407.slot[g.$jscomp$loop$prop$i$298$409])):e+=Math.floor(h.antiAir*Math.sqrt(b.$jscomp$loop$prop$enemy$407.slot[g.$jscomp$loop$prop$i$298$409])))}e+=d;f=document.createElement("div");f.className="manual_enemy_tr general_tr d-flex px-3 py-2";f.dataset.virtualid=b.$jscomp$loop$prop$enemy$407.id;
g=document.createElement("div");g.className="d-flex manual_enemy_head";h=document.createElement("img");h.className="enemy_name_img d-none d-md-block";h.src="../img/enemy/"+b.$jscomp$loop$prop$enemy$407.id+".png";g.appendChild(h);h=document.createElement("div");h.className="ml-1 manual_enemy_name_td";var l=document.createElement("div");l.className="text-primary font_size_11";l.textContent="ID : "+(b.$jscomp$loop$prop$enemy$407.id+1500);var k=document.createElement("div");k.textContent=b.$jscomp$loop$prop$enemy$407.name;
h.appendChild(l);h.appendChild(k);g.appendChild(h);f.appendChild(g);g=document.createElement("div");g.className="manual_enemy_slots";h={};for(l=0;l<b.$jscomp$loop$prop$enemy$407.slot.length;h={$jscomp$loop$prop$planeId$411:h.$jscomp$loop$prop$planeId$411},l++){var m=b.$jscomp$loop$prop$enemy$407.slot[l];h.$jscomp$loop$prop$planeId$411=b.$jscomp$loop$prop$enemy$407.eqp[l];if(m&&h.$jscomp$loop$prop$planeId$411&&(k=ENEMY_PLANE_DATA.find(function(q){return function(t){return t.id===q.$jscomp$loop$prop$planeId$411}}(h)))){var n=
document.createElement("div");n.className="manual_enemy_slot d-flex";var r=document.createElement("div");r.className="mr-2 d-none d-md-inline manual_enemy_slot_count";r.textContent=m;m=document.createElement("img");m.className="img-size-25";m.src="../img/plane/"+k.id+".png";var p=document.createElement("div");p.className="ml-1";p.textContent=k.name;n.appendChild(r);n.appendChild(m);n.appendChild(p);g.appendChild(n)}}f.appendChild(g);g=document.createElement("div");g.className="manual_enemy_ap_td";
g.textContent=0===d&&e?"("+e+")":d;f.appendChild(g);d=document.createElement("div");d.className="manual_enemy_aaw_td";d.textContent=b.$jscomp$loop$prop$enemy$407.aaw;f.appendChild(d);d=document.createElement("div");d.className="manual_enemy_aabo_td";d.textContent=b.$jscomp$loop$prop$enemy$407.aabo;f.appendChild(d);a.appendChild(f)}}
function manul_enemy_Clicked(a){for(var b=0;4>b;b++)document.getElementsByClassName("enemy_slot")[b].value=-1,document.getElementsByClassName("enemy_slot")[b].value=0;if(b=ENEMY_DATA.find(function(d){return d.id===castInt(a[0].dataset.virtualid)})){document.getElementById("manual_enemy_img").src="../img/enemy/"+b.id+".png";document.getElementById("manual_enemy_id").textContent=b.id;document.getElementById("manual_enemy_name").textContent=b.name;setEnemyPlaneCombobox(b);for(var c=0;c<b.slot.length;c++)document.getElementsByClassName("enemy_slot")[c].value=
b.slot[c],document.getElementsByClassName("enemy_planes")[c].value=b.eqp[c];document.getElementById("manual_aa_weight").value=b.aaw;document.getElementById("manual_aa_bonus").value=b.aabo;calculateVirtualEnemy();$("#modal_manual_enemy").modal("show")}else inform_warning("\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}function manual_enemy_input_Changed(a){var b=validateInputNumber(a.val(),castInt(a.attr("max")));a.val(b);calculateVirtualEnemy()}
function setEnemyPlaneCombobox(a){var b=null,c=-1,d=document.createElement("div");d.innerHTML="";var e=document.createElement("option");e.textContent="-";e.value=-1;d.appendChild(e);e=null;e=isContain(a.type,[11,12,20,21,2])?ENEMY_PLANE_DATA.filter(function(h){return 5!==h.type}):ENEMY_PLANE_DATA.filter(function(h){return 5===h.type});a={};e=$jscomp.makeIterator(e);for(var f=e.next();!f.done;a={$jscomp$loop$prop$type$413:a.$jscomp$loop$prop$type$413},f=e.next()){f=f.value;a.$jscomp$loop$prop$type$413=
Math.abs(f.type);c!==a.$jscomp$loop$prop$type$413&&(null!==b&&d.appendChild(b),c=a.$jscomp$loop$prop$type$413,b=document.createElement("optgroup"),b.label=PLANE_TYPE.find(function(h){return function(l){return l.id===h.$jscomp$loop$prop$type$413}}(a)).name);var g=document.createElement("option");g.textContent=f.id+": "+f.name;g.value=f.id;b.appendChild(g)}d.appendChild(b);b=$jscomp.makeIterator(document.getElementsByClassName("enemy_planes"));for(c=b.next();!c.done;c=b.next())c=c.value,c.innerHTML=
d.innerHTML,c.options[0].selected=!0}
function calculateVirtualEnemy(){for(var a=0,b={},c=0;4>c;b={$jscomp$loop$prop$planeId$415:b.$jscomp$loop$prop$planeId$415},c++){var d=castInt(document.getElementsByClassName("enemy_slot")[c].value);b.$jscomp$loop$prop$planeId$415=castInt(document.getElementsByClassName("enemy_planes")[c].value);var e=document.getElementsByClassName("manual_enemy_ap")[c];if(500>b.$jscomp$loop$prop$planeId$415||0>=d)e.textContent=0;else{var f=ENEMY_PLANE_DATA.find(function(g){return function(h){return h.id===g.$jscomp$loop$prop$planeId$415}}(b));
f?(d=Math.floor(f.antiAir*Math.sqrt(d)),e.textContent=d,a+=d):(e.textContent=0,document.getElementsByClassName("enemy_planes")[c].options[0].selected=!0)}}document.getElementById("manual_enemy_sumAP").textContent=a}
function commit_enemy_Clicked(){var a=castInt(document.getElementById("manual_enemy_id").textContent);if(UNKNOWN_ENEMY.includes(a)){var b=ENEMY_DATA.find(function(g){return g.id===a}),c={id:a,type:b.type,name:b.name,slot:[],eqp:[],orig:b.orig,aaw:0,aabo:0};c.aaw=castInt(document.getElementById("manual_aa_weight").value);c.aabo=castInt(document.getElementById("manual_aa_bonus").value);b=document.getElementById("enemy_slot_info");for(var d=0;4>d;d++){var e=castInt(b.getElementsByClassName("enemy_slot")[d].value),
f=castInt(b.getElementsByClassName("enemy_planes")[d].value);e&&f&&(c.slot.push(e),c.eqp.push(f))}(b=loadLocalStorage("manual_enemies"))||(b=[]);d=b.findIndex(function(g){return g.id===c.id});0>d?b.push(c):b[d]=c;d=ENEMY_DATA.findIndex(function(g){return g.id===c.id});ENEMY_DATA[d]=c;saveLocalStorage("manual_enemies",b);drawManualEnemies();inform_success("\u6575\u8266\u60c5\u5831\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002");calculate();$("#modal_manual_enemy").modal("hide")}}
function rollback_enemy_Clicked(){var a=loadLocalStorage("manual_enemies"),b=castInt(document.getElementById("manual_enemy_id").textContent);a&&(a=a.filter(function(c){return c.id!==b}),saveLocalStorage("manual_enemies",a),location.reload())}function btn_target_Clicked(a){var b=castInt(a[0].dataset.target)-1;a.parent().find('input[type="hidden"]').val(b)}
function btn_calculate_detail(){var a=$("#calculate_count").val();$("#calculate_count").val($("#detail_calculate_count").val());detailCalculate();$("#btn_calculate_detail").prop("disabled",!0);$("#calculate_count").val(a)}function detail_slot_tab_Changed(a){a.find(".nav-link").hasClass("disabled")||($("#detail_info").data("slot_no",castInt(a.data("slot_no"))),detailCalculate())}function btn_show_detail_Clicked(a){$("#detail_info").data("slot_no",castInt(a[0].dataset.slot_no));detailCalculate()}
function btn_output_slot_dist_Clicked(){try{var a=chartInstance.data.labels,b=chartInstance.data.datasets[0].data,c=getArrayMax(a.map(function(k){return castInt(k)})),d=$("#detail_info").data("mode");if("land_base_detail"===d)c=18;else if($("#slot_detail").prop("checked")){var e=$("#detail_legend").find(".legend_name"),f=castInt($("#detail_info").data("slot_no"));if("enemy_slot_detail"===d){var g=ENEMY_DATA.find(function(k){return k.id===castInt(e.data("enemyid"))});g&&(c=g.slot[f])}else if("fleet_slot_detail"===
d){var h=SHIP_DATA.find(function(k){return k.id===castInt(e.data("shipid"))});h&&(c=h.slot[f])}}d=[];if(0<a.length)for(;0<=c;c--){var l=a.indexOf(c);-1<l?d.push({slot:c,rate:b[l]/100}):d.push({slot:c,rate:0})}$("#dist_text").removeClass("d-none");$("#dist_text").val(JSON.stringify(d));copyInputTextToClipboard($("#dist_text"));$("#dist_text").addClass("d-none")}catch(k){inform_danger("\u51fa\u529b\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}}
function btn_output_slot_dist_table_Clicked(){try{var a=chartInstance.data.labels,b=chartInstance.data.datasets[0].data,c=getArrayMax(a.map(function(k){return castInt(k)})),d=$("#detail_info").data("mode");if("land_base_detail"===d)c=18;else if($("#slot_detail").prop("checked")){var e=$("#detail_legend").find(".legend_name"),f=castInt($("#detail_info").data("slot_no"));if("enemy_slot_detail"===d){var g=ENEMY_DATA.find(function(k){return k.id===castInt(e.data("enemyid"))});g&&(c=g.slot[f])}else if("fleet_slot_detail"===
d){var h=SHIP_DATA.find(function(k){return k.id===castInt(e.data("shipid"))});h&&(c=h.slot[f])}}d="";if(0<a.length)for(f=c;0<=f;f--){var l=a.indexOf(f);f!==c&&(d+="\r\n");d=-1<l?d+(f+"\t"+b[l]/100):d+(f+"\t0")}$("#dist_text").removeClass("d-none");$("#dist_text").val(d);copyInputTextToClipboard($("#dist_text"));$("#dist_text").addClass("d-none")}catch(k){inform_danger("\u51fa\u529b\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}}
function modal_confirm_ok_Clicked(){switch(confirmType){case "deleteLocalStorageAll":window.localStorage.clear();break;case "resetPlaneStock":deleteLocalStorage("planeStock");setPlaneStockTable();break;case "resetShipStock":deleteLocalStorage("shipStock");setShipStockTable();break;case "resetFavoritePlane":setting.favoritePlane=[];setting.favoriteOnly=!1;$("#fav_only").prop("checked",!1);saveSetting();setPlaneStockTable();break;case "resetFavoriteShip":setting.favoriteShip=[];setting.favoriteOnlyShip=
!1;$("#fav_only_ship").prop("checked",!1);saveSetting();setShipStockTable();break;case "deleteSelectedPlaneHistory":setting.selectedHistory[0]=[];saveSetting();break;case "deleteSelectedShipHistory":setting.selectedHistory[1]=[],saveSetting()}$("#modal_confirm").modal("hide")}
function btn_save_preset_Clicked(){$("#allow_upload_preset").prop("checked",!1);$("#upload_option").addClass("d-none");$("#btn_upload_preset").addClass("d-none");var a=loadLocalStorage("presets");if(a&&(a=a.find(function(b){return b[0]===getActivePreset().id}))){document.getElementById("input_preset_name").value=a[1];document.getElementById("preset_remarks").value=a[3];updateMainPreset();inform_success("\u7de8\u6210\u306e\u4e0a\u66f8\u304d\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002");
return}document.getElementById("input_preset_name").value="";document.getElementById("preset_remarks").value="";$("#modal_main_preset").find(".btn_commit_preset").prop("disabled",!0);$("#modal_main_preset").modal("show")}
function btn_save_preset_sub_Clicked(){$("#allow_upload_preset").prop("checked",!1);$("#upload_option").addClass("d-none");$("#btn_upload_preset").addClass("d-none");var a=loadLocalStorage("presets");if(a&&(a=a.find(function(b){return b[0]===getActivePreset().id}))){document.getElementById("input_preset_name").value=a[1];document.getElementById("preset_remarks").value=a[3];a=$("#modal_main_preset").find(".btn_commit_preset");a.text("\u5225\u540d\u3067\u4fdd\u5b58");a.addClass("rename");a.prop("disabled",
!0);$("#modal_main_preset").modal("show");return}btn_save_preset_Clicked()}function btn_auto_expand_Clicked(){$("#alert_auto_expand").addClass("d-none");$("#modal_auto_expand").modal("show")}
function btn_twitter_Clicked(){var a,b;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return b=a="https://noro6.github.io/kcTools/?d="+encodePreset(),c.yield(postURLData(a).then(function(d){d.error||!d.shortLink?console.log(d):b=d.shortLink})["catch"](function(d){return console.error(d)}),2);window.open("https://twitter.com/share?url="+b);c.jumpToEnd()})}
function btn_undo_Clicked(){var a=getActivePreset(),b=a.history,c=b.index+1;if(!(c>=b.histories.length||document.getElementById("btn_undo").classList.contains("disabled"))){var d=b.histories.concat();expandMainPreset(decodePreset(b.histories[c]));calculate();b.index=c;b.histories=d;updateActivePreset(a);c+1===b.histories.length&&document.getElementById("btn_undo").classList.add("disabled");document.getElementById("btn_redo").classList.remove("disabled")}}
function btn_redo_Clicked(){var a=getActivePreset(),b=a.history,c=b.index-1;if(!(0>c||document.getElementById("btn_redo").classList.contains("disabled"))){var d=b.histories.concat();expandMainPreset(decodePreset(b.histories[b.index-1]));calculate();b.index=c;b.histories=d;updateActivePreset(a);0>c-1?document.getElementById("btn_redo").classList.add("disabled"):document.getElementById("btn_redo").classList.remove("disabled")}}
function btn_url_shorten_Clicked(){var a,b,c,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(e){if(1==e.nextAddress){a=document.getElementById("btn_url_shorten");b=document.getElementById("input_url");c=b.value.trim();if(a.classList.contains("shortening"))return e["return"]();a.classList.add("shortening");a.textContent="\u77ed\u7e2e\u4e2d";return c?c.match(/^(https?|ftp)(:\/\/[-_.!~*'()a-zA-Z0-9;\/?:@&=+\$,%#]+)$/)?c.match(/^(https:\/\/aircalc.page.link\/)([.!~*'()a-zA-Z0-9;\/?:@&=+\$,%#]+)$/)?
e.jumpTo(2):e.yield(postURLData(c).then(function(f){f.error||!f.shortLink?(b.value="",inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")):(b.value=f.shortLink,inform_success("URL\u306e\u77ed\u7e2e\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002"))})["catch"](function(f){b.value="";inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}),2):(b.value="",(d=readDeckBuilder(c))?
(expandMainPreset(d,0<d[0][0].length,!0,!1),calculate(),inform_success("\u7de8\u6210\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002")):readEquipmentJson(c)?(setPlaneStockTable(),inform_success("\u6240\u6301\u88c5\u5099\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002")):readShipJson(c)?(setShipStockTable(),inform_success("\u6240\u6301\u8266\u5a18\u306e\u53cd\u6620\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002")):inform_danger("\u5165\u529b\u3055\u308c\u305fURL\u306e\u77ed\u7e2e\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"),
e.jumpTo(2)):(b.value="",inform_warning("URL\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),e.jumpTo(2))}a.textContent="URL\u77ed\u7e2e";a.classList.remove("shortening");e.jumpToEnd()})}function preset_remarks_Changed(a){400<a.val().trim().length?a.addClass("is-invalid"):(a.removeClass("is-invalid"),a.addClass("is-valid"))}
function input_deck_Changed(a){var b=a.val().trim(),c=a.closest(".modal-body").find(".btn_load_deck");0===b.length?(a.addClass("is-invalid").removeClass("is-valid"),a.nextAll(".invalid-feedback").text("\u30c7\u30fc\u30bf\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"),c.prop("disabled",!0)):(a.removeClass("is-invalid"),c.prop("disabled",!1))}
function output_data_Clicked(a){a.hasClass("is-valid")&&copyInputTextToClipboard(a)&&inform_success("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002")}function output_data_Changed(a){a.removeClass("is-valid")}
function btn_commit_main_preset_Clicked(){var a=$("#upload_user").val().trim(),b=document.getElementById("input_preset_name").value.trim();$("#allow_upload_preset").prop("checked")&&20<a.length?inform_warning("\u6295\u7a3f\u8005\u540d\u306f20\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):$("#allow_upload_preset").prop("checked")&&!b?inform_warning("\u7de8\u6210\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):updateMainPreset()}
function select_preset_category_Changed(){400<castInt($("#select_preset_category").val())?($("#select_preset_level").parent().removeClass("d-none"),$("#select_preset_level").val(4)):$("#select_preset_level").parent().addClass("d-none")}
function allow_upload_preset_Clicked(){$("#allow_upload_preset").prop("checked")?($("#upload_option").removeClass("d-none"),$("#modal_main_preset").find(".btn_commit_preset").hasClass("rename")?$("#btn_upload_preset").removeClass("d-none"):$("#btn_upload_preset").addClass("d-none"),$("#upload_user").val(setting.uploadUserName)):($("#upload_option").addClass("d-none"),$("#btn_upload_preset").addClass("d-none"))}
function btn_upload_preset_Clicked(){var a=$("#upload_user").val().trim(),b=document.getElementById("input_preset_name").value.trim();20<a.length?inform_warning("\u6295\u7a3f\u8005\u540d\u306f20\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):b?updateMainPreset(!0):inform_warning("\u7de8\u6210\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}
function btn_load_deck_Clicked(){var a=$("#input_deck").val().trim();(a=readDeckBuilder(a))?(expandMainPreset(a,0<a[0][0].length,!0,!1),$("#input_deck").removeClass("is-invalid").addClass("is-valid"),inform_success("\u7de8\u6210\u306e\u8aad\u307f\u8fbc\u307f\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002")):($("#input_deck").addClass("is-invalid").removeClass("is-valid"),inform_danger("\u7de8\u6210\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u5165\u529b\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e\u5f62\u5f0f\u304c\u6b63\u3057\u304f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"))}
function btn_output_url_Clicked(){var a,b,c;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress)return d.setCatchFinallyBlocks(2),a=$("#output_url"),c=b="https://noro6.github.io/kcTools/?d="+encodePreset(),d.yield(postURLData(b).then(function(e){e.error||!e.shortLink?console.log(e):c=e.shortLink})["catch"](function(e){return console.error(e)}),4);if(2!=d.nextAddress)return a.val(c),a.nextAll(".valid-feedback").text("\u751f\u6210\u3057\u307e\u3057\u305f\u3002\u4e0a\u8a18URL\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3055\u308c\u307e\u3059\u3002"),
a.removeClass("is-invalid").addClass("is-valid"),d.leaveTryBlock(0);d.enterCatchBlock();$("#output_url").addClass("is-invalid").removeClass("is-valid");return d["return"]()})}
function btn_output_deck_Clicked(){var a=convertToDeckBuilder(),b=$("#output_deck");$("#output_deck").val(a);a?(b.nextAll(".valid-feedback").text("\u751f\u6210\u3057\u307e\u3057\u305f\u3002\u4e0a\u8a18\u6587\u5b57\u5217\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3055\u308c\u307e\u3059\u3002"),b.removeClass("is-invalid").addClass("is-valid")):b.addClass("is-invalid").removeClass("is-valid")}
function open_deckBuilder(){window.open("http://kancolle-calc.net/deckbuilder.html?predeck="+convertToDeckBuilder())}function open_Jervis(){window.open("https://kcjervis.github.io/jervis/?operation-json="+convertToDeckBuilder_j())}
function btn_start_auto_expand_Clicked(){$("#auto_land_base_1").prop("checked")||$("#auto_land_base_2").prop("checked")||$("#auto_land_base_3").prop("checked")||$("#auto_fleet").prop("checked")?(autoExpand(),$("#alert_auto_expand").text("\u304a\u307e\u304b\u305b\u8266\u8f09\u6a5f\u914d\u5099\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002"),$("#alert_auto_expand").addClass("alert-success").removeClass("alert-danger d-none")):($("#alert_auto_expand").text("\u914d\u5099\u5bfe\u8c61\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),
$("#alert_auto_expand").removeClass("alert-success d-none").addClass("alert-danger"))}function battle_mode_Clicked(){$("#mode_1").prop("checked")?($("#auto_fleet").closest("div").removeClass("d-none"),$("#dest_range_parent").removeClass("d-none"),$("#details_parent").removeClass("d-none")):($("#auto_fleet").prop("checked",!1),$("#auto_fleet").closest("div").addClass("d-none"),$("#dest_range_parent").addClass("d-none"),$("#details_parent").addClass("d-none"))}
function expand_target_Clicked(){$("#alert_auto_expand").addClass("d-none");$("#btn_start_auto_expand").prop("disabled",!1);$("#auto_land_base_1").prop("checked")||$("#auto_land_base_2").prop("checked")||$("#auto_land_base_3").prop("checked")?$("#dest_range").prop("disabled",!1):($("#dest_range").prop("disabled",!0),$("#auto_fleet").prop("checked")||$("#btn_start_auto_expand").prop("disabled",!0))}function dest_ap_Changed(a){a.val(validateInputNumber(a.val(),castInt(a.attr("max"))))}
function simple_enemy_ap_Changed(a){var b=validateInputNumber(a.val(),castInt(a.attr("max")));a.val(b);a=getAirStatusBorder(b);for(b=0;b<a.length;b++)$("#border_"+b).text(a[b])}
function simulatorTab_Clicked(a){if(a[0].dataset.presetid){var b=loadLocalStorage("activePresets").presets.find(function(d){return d.id===a[0].dataset.presetid});b&&(expandMainPreset(decodePreset(b.history.histories[b.history.index])),calculate())}else{b={id:getUniqueId(),name:getMaxUntitled(),history:{index:0,histories:["Noi6BpgWgRnX41BYLgAZKe-H6IBEB4cSaA3gQMYCuALgJYB2AkgCYEBcmBATgIZ0AplxjoedfgCMANiM6pwBKQHtebIb1HiAvhBwAzfjIDOQ8EdPnFZIA"]}};var c=loadLocalStorage("activePresets");c||(c={activeId:"",
presets:[]});c.presets.push(b);c.activeId=b.id;saveLocalStorage("activePresets",c);setTab();expandMainPreset(decodePreset(b.history.histories[0]));calculate()}}function simulatorActiveTab_Clicked(a){a[0].dataset.presetid&&loadLocalStorage("activePresets").presets.find(function(b){return b.id===a[0].dataset.presetid})&&(a.addClass("editting"),a.find(".fleet_name").addClass("d-none"),a.find(".fleet_name_input").removeClass("d-none"),a.find(".fleet_name_input").select())}
function fleet_name_input_Changed(a){var b=a.closest(".fleet_tab"),c=b[0].dataset.presetid,d=loadLocalStorage("presets");d||(d=[]);b.removeClass("editting");b.find(".fleet_name").removeClass("d-none");b.find(".fleet_name_input").addClass("d-none");var e=d.findIndex(function(g){return g[0]===c});if(0<=e){var f=a.val().trim();f&&d[e][1]!==f&&(50<f.length&&(f=f.slice(0,50),a.val(f)),d[e][1]=f,b.find(".fleet_name").text(f),saveLocalStorage("presets",d),inform_success("\u7de8\u6210\u540d\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002"))}else inform_warning("\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u306e\u540d\u79f0\u5909\u66f4\u306f\u3067\u304d\u307e\u305b\u3093\u3002")}
document.addEventListener("DOMContentLoaded",function(){initialize(function(){var a=getUrlParams(),b=!1;if(a.hasOwnProperty("d"))expandMainPreset(decodePreset(a.d)),b=!0;else if(a.hasOwnProperty("predeck")||a.hasOwnProperty("lb")){a.hasOwnProperty("predeck")&&(b=readDeckBuilder(a.predeck))&&expandMainPreset(b,0<b[0][0].length,!0,!1);if(a.hasOwnProperty("lb"))try{var c=JSON.parse(decodeURIComponent(a.lb));2<=c.length&&expandMainPreset([c,[],[]],!0,!1,!1)}catch(d){}b=!0}else if(a.hasOwnProperty("p"))expandMainPreset(decodePreset(a.p));
else if(c=getActivePreset(),c.id)try{expandMainPreset(decodePreset(c.history.histories[c.history.index]))}catch(d){deleteLocalStorage("activePresets");window.location.href="../list/";return}else{window.location.href="../list/";return}b&&(b="\u5916\u90e8\u30c7\u30fc\u30bf",a.hasOwnProperty("name")&&(b=decodeURIComponent(a.name)),a={id:getUniqueId(),name:b,history:{index:0,histories:[]}},(b=loadLocalStorage("activePresets"))||(b={activeId:"",presets:[]}),b.presets.push(a),b.activeId=a.id,saveLocalStorage("activePresets",
b),setTab());calculate()});$(document).keyup(function(a){isCtrlPress&&17===a.keyCode&&(isCtrlPress=!1)});$(document).keydown(function(a){isCtrlPress||17!==a.keyCode||(isCtrlPress=!0);isCtrlPress&&"z"===a.key?btn_undo_Clicked():isCtrlPress&&"y"===a.key&&btn_redo_Clicked()});document.getElementById("btn_top").addEventListener("click",function(){window.location.href="../list/"});$("#header").on("click",".fleet_tab:not(.active)",function(){simulatorTab_Clicked($(this))});$("#header").on("click",".fleet_tab.active:not(.editting)",
function(){simulatorActiveTab_Clicked($(this))});$("#header").on("blur",".fleet_name_input",function(){fleet_name_input_Changed($(this))});$(".modal").on("hide.bs.modal",function(){modal_Closed($(this))});$(".modal").on("show.bs.modal",function(){$(".btn_preset").tooltip("hide")});$(".modal").on("click",".toggle_display_type",function(){toggle_display_type_Clicked($(this))});$(".modal").on("input",".preset_name",function(){preset_name_Changed($(this))});$(".modal").on("blur",".preset_name",function(){preset_name_Changed($(this))});
$(".slot_select_parent").on("show.bs.dropdown",function(){slot_select_parent_Show($(this))});$(".slot_select_parent").on("hide.bs.dropdown",function(){slot_select_parent_Close($(this))});$(".remodel_select_parent").on("hide.bs.dropdown",function(){remodelSelect_Changed($(this))});$(".remodel_select_parent").on("show.bs.dropdown",function(){remodelSelect_Shown($(this))});$(".prof_select_parent").on("show.bs.dropdown",function(){profSelect_Shown($(this))});$("#main").on("show.bs.collapse",".collapse",
function(){$(this).prev().find(".fa-chevron-up").removeClass("fa-chevron-up").addClass("fa-chevron-down")});$("#main").on("hide.bs.collapse",".collapse",function(){$(this).prev().find(".fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-up")});$("#main").on("shown.bs.collapse",".collapse",function(){$(this).removeClass("tmpHide")});$("#main").on("focus",".slot_input",function(){$(this).select()});$("#main").on("input",".slot_input",function(){slot_input_Changed($(this))});$("#main").on("input",
".slot_range",function(){slot_range_Changed($(this))});$("#main").on("click",".remodel_item",function(){$(this).addClass("remodel_item_selected")});$("#main").on("click",".plane_name",function(){plane_name_Clicked($(this))});$("#main").on("click",".btn_plane_preset",function(){btn_plane_preset_Clicked($(this))});$("#main").on("click",".btn_capture",function(){btn_capture_Clicked($(this))});$("#main").on("click",".btn_reset_content",function(){btn_reset_content_Clicked($(this))});$("#main").on("click",
".btn_content_trade",function(){btn_content_trade_Clicked($(this))});$("#main").on("click",".btn_commit_trade",commit_content_order);$("#main").on("click",".btn_ex_setting",function(){btn_ex_setting_Clicked($(this))});$("#main").on("click",".btn_show_plane_box",function(){btn_show_plane_box_Clicked($(this))});$("#site_warning").on("click",".cur_pointer",function(){$("#site_warning").removeClass("d-flex").addClass("d-none")});$("#landBase").on("click",".btn_air_raid",function(){btn_air_raid_Clicked($(this))});
$("#landBase").on("click",".btn_supply",function(){btn_supply_Clicked($(this))});$("#landBase_content").on("change",".ohuda_select",calculate);$("#landBase_content").on("click",".btn_remove_plane",function(){btn_remove_lb_plane_Clicked($(this))});$("#landBase_content").on("click",".btn_reset_landBase",function(){btn_reset_landBase_Clicked($(this))});$("#landBase_content").on("click",".prof_item",function(){proficiency_Changed($(this))});$("#landBase_content").on("click",".btn_show_contact_rate_lb",
function(){btn_show_contact_rate_lb_Clicked($(this))});$("#landBase_content").on("click",".btn_toggle_lb_info",function(){btn_toggle_lb_info_Clicked($(this))});$("#landBase_content").on("click","#toggle_def_mode",toggle_def_mode_Checked);$("#friendFleet_content").on("click","#read_duck_read_warning",function(){$("#duck_read_warning").addClass("d-none")});$("#friendFleet_content").on("change",".display_ship_count",function(){display_ship_count_Changed($(this))});$("#friendFleet_content").on("click",
".btn_reset_ship_plane",function(){btn_reset_ship_plane_Clicked($(this))});$("#friendFleet_content").on("click",".ship_name_span",function(){ship_name_span_Clicked($(this))});$("#friendFleet_content").on("click",".btn_remove_ship",function(){btn_remove_ship_Clicked($(this))});$("#friendFleet_content").on("click",".btn_remove_plane",function(){btn_remove_ship_plane_Clicked($(this))});$("#friendFleet_content").on({mouseenter:function(){$(this).closest(".ship_tab").find(".remove_line").addClass("ready")},
mouseleave:function(){$(this).closest(".ship_tab").find(".remove_line").removeClass("ready")}},".btn_reset_ship_plane");$("#friendFleet_content").on("click",".prof_item",function(){proficiency_Changed($(this))});$("#friendFleet_content").on("click",".ship_disabled",function(){ship_disabled_Changed($(this))});$("#friendFleet_content").on("click","#union_fleet",calculate);$('#friendFleet_content .nav-link[data-toggle="tab"]').on("shown.bs.tab",fleet_select_tab_Clicked);$("#friendFleet_content").on("click",
".plane_lock",function(){plane_lock_Clicked($(this))});$("#friendFleet_content").on("click",".plane_unlock",function(){plane_unlock_Clicked($(this))});$("#friendFleet_content").on("click",".slot_ini",function(){slot_ini_Clicked($(this))});$("#friendFleet_content").on("click",".btn_show_contact_rate",function(){btn_show_contact_rate_Clicked()});$("#friendFleet_content").on("click",".btn_antiair_input",btn_antiair_input_Clicked);$("#enemyFleet_content").on("change",".cell_type",function(){cell_type_Changed($(this))});
$("#enemyFleet_content").on("change",".formation",calculate);$("#enemyFleet_content").on("click",".enemy_content",function(){enemy_name_Clicked($(this))});$("#enemyFleet_content").on("click",".btn_reset_battle",function(){btn_reset_battle_Clicked($(this))});$("#enemyFleet_content").on("click","#btn_world_expand",btn_world_expand_Clicked);$("#enemyFleet_content").on("click",".btn_enemy_preset",function(){btn_enemy_preset_Clicked($(this))});$("#enemyFleet_content").on("click",".btn_stage2",function(){btn_stage2_Clicked($(this))});
$("#enemyFleet_content").on("change","#battle_count",function(){battle_count_Changed($(this))});$("#enemyFleet_content").on("click","#btn_lb_target",btn_lb_target_Clicked);$("#enemyFleet_content").on("click",'input[name="enemy_fleet_display_mode"]',function(){enemy_fleet_display_mode_Changed($(this))});$("#result").on("click","#btn_calculate",calculate);$("#result_content").on("click","#display_battle_tab .nav-item",function(){display_battle_tab_Changed($(this))});$("#result_content").on("click",
"#empty_slot_invisible",calculate);$("#result_content").on("click","#display_setting .custom-control-input",display_result_Changed);$("#result_content").on("click","#shoot_down_table_tbody tr",function(){fleet_slot_Clicked($(this))});$("#result_content").on("click","#rate_table .land_base_detail",function(){land_base_detail_Clicked($(this))});$("#result_content").on("click","#enemy_shoot_down_tbody .td_detail_slot",function(){enemy_slot_Clicked($(this))});$("#result_content").on("click",".btn_antiair_input",
btn_antiair_input_Clicked);$("#result_content").on("click","#ignore_stage2",calculate);$("#config_content").on("focus","#calculate_count",function(){$(this).select()});$("#config_content").on("input","#calculate_count",function(){calculate_count_Changed($(this))});$("#config_content").on("click","#innerProfSetting .custom-control-input",function(){innerProfSetting_Clicked($(this))});$("#config_content").on("click","#clipboard_mode",clipboard_mode_Clicked);$("#config_content").on("click","#air_raid_max",
air_raid_max_Clicked);$("#config_content").on("click",".dropdown-item",function(){init_proficiency_Changed($(this))});$("#config_content").on("click","#btn_reset_selected_plane_history",btn_reset_selected_plane_history_Clicked);$("#config_content").on("click","#btn_reset_selected_ship_history",btn_reset_selected_ship_history_Clicked);$("#stock_management").on("show.bs.collapse",".collapse",function(){setPlaneStockTable();setShipStockTable()});$("#ship_stock").on("change","#ship_stock_type_select",
ship_stock_type_select_Changed);$("#ship_stock").on("input",".stock_td_stock",function(){stock_td_stock_Changed($(this))});$("#ship_stock").on("click",".stock_td_fav",function(a){ship_stock_td_fav_Clicked($(this));a.stopPropagation()});$("#ship_stock").on("input","#input_ship_json",function(){input_ship_json_Changed($(this))});$("#ship_stock").on("focus","#input_ship_json",function(){$(this).select()});$("#ship_stock").on("click","#btn_fav_ship_clear",btn_fav_ship_clear_Clicked);$("#ship_stock").on("click",
"#btn_ship_stock_all_clear",btn_ship_stock_all_clear_Clicked);$("#ship_stock").on("input","#ship_stock_word",ship_stock_word_TextChanged);$("#ship_stock").on("click","#btn_load_ship_json",btn_load_ship_json_Clicked);$("#plane_stock").on("change","#stock_type_select",stock_type_select_Changed);$("#plane_stock").on("click",".stock_td_fav",function(a){stock_td_fav_Clicked($(this));a.stopPropagation()});$("#plane_stock").on("click",".stock_tr",function(){stock_tr_Clicked($(this))});$("#plane_stock").on("click",
"#btn_load_equipment_json",btn_load_equipment_json_Clicked);$("#plane_stock").on("input","#input_equipment_json",function(){input_equipment_json_Changed($(this))});$("#plane_stock").on("focus","#input_equipment_json",function(){$(this).select()});$("#plane_stock").on("click","#btn_fav_clear",btn_fav_clear_Clicked);$("#plane_stock").on("click","#btn_stock_all_clear",btn_stock_all_clear_Clicked);$("#plane_stock").on("input","#stock_word",stock_word_TextChanged);$("#manage_manual_data").on("show.bs.collapse",
".collapse",manage_manual_enemu_content_Shown);$("#manage_manual_data").on("click",".manual_enemy_tr",function(){manul_enemy_Clicked($(this))});$("#modal_plane_select").on("click",".plane",function(){modal_plane_Selected($(this))});$("#modal_plane_select").on("click",".btn_remove",function(){modal_plane_select_btn_remove_Clicked($(this))});$("#modal_plane_select").on("click","#plane_type_select .nav-link",function(){plane_type_select_Changed($(this))});$("#modal_plane_select").on("click","#fav_only",
fav_only_Checked_Chenged);$("#modal_plane_select").on("click","#disp_in_stock",disp_in_stock_Checked_Chenged);$("#modal_plane_select").on("click","#divide_stock",divide_stock_Checked_Chenged);$("#modal_plane_select").on("click","#disp_equipped",disp_equipped_Checked_Chenged);$("#modal_plane_select").on("input","#plane_word",plane_word_TextChanged);$("#modal_plane_select").on("change","#plane_sort_select",function(){sort_Changed($(this))});$("#modal_plane_select").on("change","#plane_filter_key_select",
plane_filter_Changed);$("#modal_plane_select").on("change","#plane_filter_value",plane_filter_Changed);$("#modal_plane_preset").on("click",".preset_tr",function(){plane_preset_tr_Clicked($(this))});$("#modal_plane_preset").on("click",".btn_commit_preset",function(){btn_commit_plane_preset_Clicked($(this))});$("#modal_plane_preset").on("click",".btn_delete_preset",function(){btn_delete_plane_preset_Clicked($(this))});$("#modal_plane_preset").on("click",".btn_expand_preset",btn_expand_plane_preset_Clicked);
$("#modal_ship_select").on("change","#ship_type_select",function(){createShipTable(castInt($(this).val()))});$("#modal_ship_select").on("click",".ship_tr:not(.ship_tr_disabled)",function(){modal_ship_Selected($(this))});$("#modal_ship_select").on("click",".btn_remove",function(){modal_ship_select_btn_remove_Clicked($(this))});$("#modal_ship_select").on("click","#display_final",function(){createShipTable(castInt($("#ship_type_select").val()))});$("#modal_ship_select").on("click","#frequent_ship",function(){createShipTable(castInt($("#ship_type_select").val()))});
$("#modal_ship_select").on("click","#fav_only_ship",function(){createShipTable(castInt($("#ship_type_select").val()))});$("#modal_ship_select").on("click","#disp_in_stock_ship",function(){createShipTable(castInt($("#ship_type_select").val()))});$("#modal_ship_select").on("click","#disp_equipped_ship",function(){createShipTable(castInt($("#ship_type_select").val()))});$("#modal_ship_select").on("input","#ship_word",ship_word_TextChanged);$("#modal_enemy_select").on("click",".modal-body .enemy",function(){modal_enemy_Selected($(this))});
$("#modal_enemy_select").on("click",".btn_remove",function(){modal_enemy_select_btn_remove($(this))});$("#modal_enemy_select").on("change","#enemy_type_select",function(){createEnemyTable([castInt($(this).val())])});$("#modal_enemy_select").on("input","#enemy_word",enemy_word_TextChanged);$("#modal_enemy_pattern").on("show.bs.modal",modal_enemy_pattern_Shown);$("#modal_enemy_pattern").on("click",".node_tr",function(){node_tr_Clicked($(this))});$("#modal_enemy_pattern").on("change","#map_select",createNodeSelect);
$("#modal_enemy_pattern").on("change","#node_select",createEnemyPattern);$("#modal_enemy_pattern").on("change","#select_difficulty",createNodeSelect);$("#modal_enemy_pattern").on("click","#btn_expand_enemies",btn_expand_enemies);$("#modal_enemy_pattern").on("click","#btn_continue_expand",btn_continue_expand_Clicked);$("#modal_enemy_pattern").on("click",".node",function(){node_Clicked($(this))});$("#modal_enemy_pattern").on("click","#enemy_pattern_select .nav-link:not(.active)",function(){pattern_Changed($(this))});
$("#modal_enemy_pattern").on("click",'input[name="enemy_display_mode"]',function(){enemy_display_mode_Changed($(this))});$("#modal_enemy_pattern").on("dblclick",".node",node_DoubleClicked);$("#modal_enemy_pattern").on("dblclick",".node_tr",node_DoubleClicked);$("#modal_enemy_pattern").on("dblclick","#enemy_pattern_select .nav-link.active",node_DoubleClicked);$("#modal_main_preset").on("show.bs.modal",modal_main_preset_Shown);$("#modal_main_preset").on("change","#select_preset_category",select_preset_category_Changed);
$("#modal_main_preset").on("click",".btn_commit_preset",btn_commit_main_preset_Clicked);$("#modal_main_preset").on("click","#allow_upload_preset",allow_upload_preset_Clicked);$("#modal_main_preset").on("click","#btn_upload_preset",btn_upload_preset_Clicked);$("#modal_main_preset").on("input","#input_preset_name",function(){preset_name_Changed($(this))});$("#modal_main_preset").on("input","#preset_remarks",function(){preset_remarks_Changed($(this))});$("#modal_share").on("click",".btn_load_deck",btn_load_deck_Clicked);
$("#modal_share").on("input","#input_deck",function(){input_deck_Changed($(this))});$("#modal_share").on("focus","#input_deck",function(){$(this).select()});$("#modal_share").on("click",".btn_output_url",btn_output_url_Clicked);$("#modal_share").on("click",".btn_output_deck",btn_output_deck_Clicked);$("#modal_share").on("focus","#output_url",function(){$(this).select()});$("#modal_share").on("focus","#output_deck",function(){$(this).select()});$("#modal_share").on("input","#output_url",function(){output_data_Changed($(this))});
$("#modal_share").on("input","#output_deck",function(){output_data_Changed($(this))});$("#modal_share").on("click","#output_url",function(){output_data_Clicked($(this))});$("#modal_share").on("click","#output_deck",function(){output_data_Clicked($(this))});$("#modal_share").on("click","#open_deckBuilder",open_deckBuilder);$("#modal_share").on("click","#open_jervis",open_Jervis);$("#modal_auto_expand").on("click","#btn_start_auto_expand",btn_start_auto_expand_Clicked);$("#modal_auto_expand").on("click",
"#expand_target .custom-control-input",expand_target_Clicked);$("#modal_auto_expand").on("click","#auto_battle_mode .custom-control-input",battle_mode_Clicked);$("#modal_auto_expand").on("input","#simple_enemy_ap",function(){simple_enemy_ap_Changed($(this))});$("#modal_auto_expand").on("input","#dest_ap",function(){dest_ap_Changed($(this))});$("#modal_auto_expand").on("input","#dest_range",function(){dest_ap_Changed($(this))});$("#modal_plane_stock").on("input",".stock_num",function(){stock_Changed($(this))});
$("#modal_plane_stock").on("click","#btn_save_stock",btn_save_stock_Clicked);$("#modal_plane_stock").on("click","#btn_stock_reset",btn_stock_reset_Clicked);$("#modal_result_detail").on("click","#btn_calculate_detail",btn_calculate_detail);$("#modal_result_detail").on("change","#detail_calculate_count",function(){return $("#btn_calculate_detail").prop("disabled",!1)});$("#modal_result_detail").on("change",".custom-radio",btn_calculate_detail);$("#modal_result_detail").on("click","#show_detail_slot .nav-item",
function(){detail_slot_tab_Changed($(this))});$("#modal_result_detail").on("click",".btn_show_detail:not(.disabled)",function(){btn_show_detail_Clicked($(this))});$("#modal_result_detail").on("click","#btn_output_slot_dist",btn_output_slot_dist_Clicked);$("#modal_result_detail").on("click","#btn_output_slot_dist_table",btn_output_slot_dist_table_Clicked);$("#modal_collectively_setting").on("click",".btn_remove_plane_all",function(){btn_remove_plane_all_Clicked($(this))});$("#modal_collectively_setting").on("click",
".btn_remove_ship_all",btn_remove_ship_all_Clicked);$("#modal_collectively_setting").on("click",".btn_slot_max",function(){btn_slot_max_Clicked($(this))});$("#modal_collectively_setting").on("click",".btn_slot_min",btn_slot_min_Clicked);$("#modal_collectively_setting").on("click",".btn_slot_default",function(){btn_slot_default_Clicked($(this))});$("#modal_collectively_setting").on("input",".coll_slot_range",function(){coll_slot_range_Changed($(this))});$("#modal_collectively_setting").on("input",
".coll_slot_input",function(){coll_slot_input_Changed($(this))});$("#modal_collectively_setting").on("focus",".coll_slot_input",function(){$(this).select()});$("#modal_collectively_setting").on("click",".btn_remodel",function(){btn_remodel_Clicked($(this))});$("#modal_collectively_setting").on("click",".btn_fighter_prof_max",btn_fighter_prof_max_Clicked);$("#modal_collectively_setting").on("click",".btn_prof",function(){btn_prof_Clicked($(this))});$("#modal_stage2_detail").on("input","#stage2_detail_slot",
stage2_slot_input_Changed);$("#modal_stage2_detail").on("change","#stage2_detail_avoid",calculateStage2Detail);$("#modal_stage2_detail").on("input","#free_anti_air_weight",function(){free_modify_input_Changed($(this))});$("#modal_stage2_detail").on("input","#free_anti_air_bornus",function(){free_modify_input_Changed($(this))});$("#modal_contact_detail").on("change",".custom-radio",contact_detail_redraw);$("#modal_fleet_antiair_input").on("focus","#fleet_antiair_base",function(){$(this).select()});
$("#modal_fleet_antiair_input").on("input","#fleet_antiair_base",fleet_antiair_base_TextChanged);$("#modal_fleet_antiair_input").on("input","#fleet_antiair",fleet_antiair_TextChanged);$("#modal_fleet_antiair_input").on("input",".antiair_weight",updateFleetStage2Table);$("#modal_fleet_antiair_input").on("click",".reset",resetFleetAntiairInput);$("#modal_fleet_antiair_input").on("change","#antiair_grand",antiair_grand_Changed);$("#modal_fleet_antiair_input").on("change","#antiair_air_raid",updateFleetStage2Table);
$("#modal_fleet_antiair_input").on("change","#fleet_antiair_formation",updateFleetStage2Table);$("#modal_fleet_antiair_input").on("input","#import_antiair",import_antiair_Changed);$("#modal_fleet_antiair_input").on("click","#btn_import_antiair",btn_import_antiair_Clicked);$("#modal_fleet_antiair_input").on("change",".select_antiair_cutin_td",function(){antiAirCutinChanged($(this))});$("#modal_fleet_antiair_input").on("input",".cutin_rate",function(){updateAntiAirCutinRate($(this))});$("#modal_fleet_antiair_input").on("click",
".btn_remove_cutin.cur_pointer",function(){btn_remove_cutin_Clicked($(this))});$("#modal_manual_enemy").on("input",".enemy_slot",function(){manual_enemy_input_Changed($(this))});$("#modal_manual_enemy").on("input","#manual_aa_weight",function(){manual_enemy_input_Changed($(this))});$("#modal_manual_enemy").on("input","#manual_aa_bonus",function(){manual_enemy_input_Changed($(this))});$("#modal_manual_enemy").on("change",".enemy_planes",calculateVirtualEnemy);$("#modal_manual_enemy").on("click","#commit_enemy",
commit_enemy_Clicked);$("#modal_manual_enemy").on("click","#rollback_enemy",rollback_enemy_Clicked);$("#modal_lb_target").on("click",".btn",function(){btn_target_Clicked($(this))});$("#modal_confirm").on("click",".btn_ok",modal_confirm_ok_Clicked);$("#modal_confirm").on("click","#error_str",function(){copyInputTextToClipboard($(this))&&inform_success("\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f")});$("#btn_save_preset").click(btn_save_preset_Clicked);$("#btn_save_preset_sub").click(btn_save_preset_sub_Clicked);
$("#btn_auto_expand").click(btn_auto_expand_Clicked);$("#btn_twitter").click(btn_twitter_Clicked);$("#btn_share").click(function(){$("#modal_share").modal("show")});$("#btn_undo").click(btn_undo_Clicked);$("#btn_redo").click(btn_redo_Clicked);$("#input_url").click(function(){$(this).select()});$("#btn_url_shorten").click(btn_url_shorten_Clicked);$("#draggable_plane_box").on("click","#btn_hide_plane_box",function(){$("#draggable_plane_box").addClass("d-none")});$("#draggable_plane_box").on("click",
"#draggable_plane_type_select .nav-link",function(){createDraggablePlaneTable($(this))});$("#draggable_plane_box").on("change","#draggable_plane_sort_select",function(){createDraggablePlaneTable()});$("#modal_plane_select").on({mouseenter:function(){var a=$(this);timer=setTimeout(function(){showPlaneBasicToolTip(a,!0)},500)},mouseleave:function(){timer&&clearTimeout(timer);hideTooltip($(this)[0])}},".plane_tr, .plane_tr_disabled");$("#landBase_content").on({mouseenter:function(){showPlaneToolTip($(this).parent(),
!0)},mouseleave:function(){hideTooltip($(this).parent()[0])}},".plane_img");$("#friendFleet_content").on({mouseenter:function(){showPlaneToolTip($(this).parent())},mouseleave:function(){hideTooltip($(this).parent()[0])}},".plane_img");$("#friendFleet_content").on({mouseenter:function(){showTooltip($(this)[0],"\u30ed\u30c3\u30af\u3059\u308b\u3068\u3001\u304a\u307e\u304b\u305b\u914d\u5099\u4f7f\u7528\u6642\u306b\u3053\u306e\u30b9\u30ed\u30c3\u30c8\u306e\u4e0a\u66f8\u304d\u3092\u4fdd\u8b77\u3067\u304d\u307e\u3059\u3002")},
mouseleave:function(){hideTooltip($(this)[0])}},".plane_unlock");$("#friendFleet_content").on({mouseenter:function(){showTooltip($(this)[0],"\u30ed\u30c3\u30af\u4e2d\u3067\u3059\u3002\u304a\u307e\u304b\u305b\u914d\u5099\u4f7f\u7528\u6642\u3001\u3053\u306e\u30b9\u30ed\u30c3\u30c8\u306f\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002")},mouseleave:function(){hideTooltip($(this)[0])}},".plane_lock");$("#friendFleet_content").on({mouseenter:function(){showTooltip($(this)[0],"\u8266\u5a18\u3001\u88c5\u5099\u306f\u7dad\u6301\u3057\u305f\u307e\u307e\u8a08\u7b97\u5bfe\u8c61\u304b\u3089\u7701\u304d\u307e\u3059\u3002")},
mouseleave:function(){hideTooltip($(this)[0])}},".ship_disabled");$("#main").on({mouseenter:function(){showTooltip($(this)[0],"\u6a5f\u4f53\u30d7\u30ea\u30bb\u30c3\u30c8")},mouseleave:function(){hideTooltip($(this)[0])}},".btn_plane_preset");$("#landBase_content").on({mouseenter:function(){showTooltip($(this)[0],"\u88c5\u5099\u30ea\u30bb\u30c3\u30c8")},mouseleave:function(){hideTooltip($(this)[0])}},".btn_reset_landBase");$("#friendFleet_content").on({mouseenter:function(){showTooltip($(this)[0],
"\u88c5\u5099\u30ea\u30bb\u30c3\u30c8")},mouseleave:function(){hideTooltip($(this)[0])}},".btn_reset_ship_plane");$("#friendFleet_content").on({mouseenter:function(){showTooltip($(this)[0],"\u9589\u3058\u308b")},mouseleave:function(){hideTooltip($(this)[0])}},".btn_remove_ship");$("#result_content").on({mouseenter:function(){shoot_down_table_tbody_MouseEnter($(this))},mouseleave:function(){shoot_down_table_tbody_MouseLeave($(this))}},"#shoot_down_table_tbody td");$("#result_content").on({mouseenter:function(){progress_area_MouseEnter($(this))},
mouseleave:function(){progress_area_MouseLeave($(this))}},".progress_area");$("#result_content").on({mouseenter:function(){rate_table_MouseEnter($(this))},mouseleave:function(){rate_table_MouseLeave($(this))}},"#rate_table tbody td");$("#result_content").on({mouseenter:function(){enemy_shoot_down_table_tbody_MouseEnter($(this))},mouseleave:function(){enemy_shoot_down_table_tbody_MouseLeave($(this))}},"#enemy_shoot_down_tbody td");$("#result_content").on({mouseenter:function(){showEnemyPlaneToolTip($(this))},
mouseleave:function(){hideTooltip($(this)[0])}},".img-size-36");$(window).resize(function(){timer&&clearTimeout(timer);timer=setTimeout(function(){"none"===$("#lb_tab_select").css("display")||$("#lb_item1").attr("class").includes("tab-pane")?"none"===$("#lb_tab_select").css("display")&&$("#lb_item1").attr("class").includes("tab-pane")&&($(".lb_tab").removeClass("tab-pane fade").show().fadeIn(),$(".baseNo").addClass("sortable_handle cur_move")):($(".lb_tab").addClass("tab-pane fade"),$(".lb_tab:first").tab("show"),
$(".baseNo").removeClass("sortable_handle cur_move"))},50)});Sortable.create($("#main")[0],{handle:".trade_enabled",animation:200,scroll:!0,onEnd:main_contents_Sortable_End});Sortable.create($("#battle_result")[0],{handle:".drag_handle",animation:200,scroll:!0});Sortable.create($("#lb_tab_parent")[0],{handle:".sortable_handle",animation:200,onEnd:function(){$(".lb_tab").each(function(a,b){$(b).attr("id","lb_item"+(a+1));$(b).find(".baseNo").html("<span>\u7b2c"+(a+1)+"\u57fa\u5730\u822a\u7a7a\u968a</span>");
$(b).find(".simple_lb_progress").each(function(c,d){$(d).attr("id","simple_lb_bar_"+(a+1)+"_"+(c+1))});$(b).find(".btn_show_contact_rate_lb")[0].dataset.lb=a+1});calculate()}});$(".fleet_tab").each(function(a,b){Sortable.create($(b)[0],{handle:".sortable_handle",animation:200,scroll:!0,onEnd:function(){$(".ship_tab").each(function(c,d){$(d).attr("id","shipNo_"+(c+1))});calculate()}})});$(".lb_plane").draggable({delay:100,helper:"clone",handle:".drag_handle",zIndex:1E3,start:function(a,b){$(b.helper).css("width",
320);$(b.helper).find(".dropdown-menu").remove()},stop:function(){lb_plane_DragEnd($(this))}});$(".lb_plane").droppable({accept:".lb_plane, .plane_tr_draggable",hoverClass:"plane_draggable_hover",tolerance:"pointer",drop:function(a,b){lb_plane_Drop($(this),b)}});$("#landBase_content_main").droppable({accept:".lb_plane",tolerance:"pointer",over:function(a,b){b.helper.animate({opacity:"1.0"},100);isOut=!1},out:function(a,b){b.helper.animate({opacity:"0.2"},100);isOut=!0}});$(".ship_plane_draggable").draggable({delay:100,
helper:"clone",handle:".drag_handle",zIndex:1E3,cursorAt:{left:55},start:function(a,b){ship_plane_DragStart(b)},stop:function(){ship_plane_DragEnd($(this))}});$(".ship_plane").droppable({accept:".ship_plane_draggable, .plane_tr_draggable",hoverClass:"plane_draggable_hover",tolerance:"pointer",over:function(a,b){ship_plane_DragOver($(this),b)},drop:function(a,b){ship_plane_Drop($(this),b)}});$(".friendFleet_tab").droppable({accept:".ship_plane_draggable",tolerance:"pointer",over:function(a,b){isOut=
!1;b.helper.stop().animate({opacity:"1.0"},100)},out:function(a,b){isOut=!0;b.helper.stop().animate({opacity:"0.2"},100)}});Sortable.create($("#battle_container")[0],{handle:".sortable_handle",animation:150,onEnd:function(){$(".battle_content").each(function(a,b){$(b).find(".battle_no").text(a+1)});calculate()}});$("#draggable_plane_box").draggable({handle:".drag_handle"});$("#main").fadeIn();$("#simulator_loading").remove()});